(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var R1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ip={exports:{}},Tc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w1;function HL(){if(w1)return Tc;w1=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,i,r){var a=null;if(r!==void 0&&(a=""+r),i.key!==void 0&&(a=""+i.key),"key"in i){r={};for(var l in i)l!=="key"&&(r[l]=i[l])}else r=i;return i=r.ref,{$$typeof:n,type:s,key:a,ref:i!==void 0?i:null,props:r}}return Tc.Fragment=e,Tc.jsx=t,Tc.jsxs=t,Tc}var C1;function zL(){return C1||(C1=1,Ip.exports=HL()),Ip.exports}var y=zL(),Rp={exports:{}},gt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L1;function KL(){if(L1)return gt;L1=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function g(B){return B===null||typeof B!="object"?null:(B=m&&B[m]||B["@@iterator"],typeof B=="function"?B:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,x={};function T(B,M,z){this.props=B,this.context=M,this.refs=x,this.updater=z||v}T.prototype.isReactComponent={},T.prototype.setState=function(B,M){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,M,"setState")},T.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function A(){}A.prototype=T.prototype;function E(B,M,z){this.props=B,this.context=M,this.refs=x,this.updater=z||v}var R=E.prototype=new A;R.constructor=E,S(R,T.prototype),R.isPureReactComponent=!0;var L=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},D=Object.prototype.hasOwnProperty;function _(B,M,z,G,de,Te){return z=Te.ref,{$$typeof:n,type:B,key:M,ref:z!==void 0?z:null,props:Te}}function k(B,M){return _(B.type,M,void 0,void 0,void 0,B.props)}function N(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function F(B){var M={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(z){return M[z]})}var V=/\/+/g;function H(B,M){return typeof B=="object"&&B!==null&&B.key!=null?F(""+B.key):M.toString(36)}function J(){}function X(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(J,J):(B.status="pending",B.then(function(M){B.status==="pending"&&(B.status="fulfilled",B.value=M)},function(M){B.status==="pending"&&(B.status="rejected",B.reason=M)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Q(B,M,z,G,de){var Te=typeof B;(Te==="undefined"||Te==="boolean")&&(B=null);var pe=!1;if(B===null)pe=!0;else switch(Te){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(B.$$typeof){case n:case e:pe=!0;break;case h:return pe=B._init,Q(pe(B._payload),M,z,G,de)}}if(pe)return de=de(B),pe=G===""?"."+H(B,0):G,L(de)?(z="",pe!=null&&(z=pe.replace(V,"$&/")+"/"),Q(de,M,z,"",function(Oe){return Oe})):de!=null&&(N(de)&&(de=k(de,z+(de.key==null||B&&B.key===de.key?"":(""+de.key).replace(V,"$&/")+"/")+pe)),M.push(de)),1;pe=0;var Qe=G===""?".":G+":";if(L(B))for(var ce=0;ce<B.length;ce++)G=B[ce],Te=Qe+H(G,ce),pe+=Q(G,M,z,Te,de);else if(ce=g(B),typeof ce=="function")for(B=ce.call(B),ce=0;!(G=B.next()).done;)G=G.value,Te=Qe+H(G,ce++),pe+=Q(G,M,z,Te,de);else if(Te==="object"){if(typeof B.then=="function")return Q(X(B),M,z,G,de);throw M=String(B),Error("Objects are not valid as a React child (found: "+(M==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":M)+"). If you meant to render a collection of children, use an array instead.")}return pe}function j(B,M,z){if(B==null)return B;var G=[],de=0;return Q(B,G,"","",function(Te){return M.call(z,Te,de++)}),G}function K(B){if(B._status===-1){var M=B._result;M=M(),M.then(function(z){(B._status===0||B._status===-1)&&(B._status=1,B._result=z)},function(z){(B._status===0||B._status===-1)&&(B._status=2,B._result=z)}),B._status===-1&&(B._status=0,B._result=M)}if(B._status===1)return B._result.default;throw B._result}var Y=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var M=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(M))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function re(){}return gt.Children={map:j,forEach:function(B,M,z){j(B,function(){M.apply(this,arguments)},z)},count:function(B){var M=0;return j(B,function(){M++}),M},toArray:function(B){return j(B,function(M){return M})||[]},only:function(B){if(!N(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},gt.Component=T,gt.Fragment=t,gt.Profiler=i,gt.PureComponent=E,gt.StrictMode=s,gt.Suspense=u,gt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,gt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return w.H.useMemoCache(B)}},gt.cache=function(B){return function(){return B.apply(null,arguments)}},gt.cloneElement=function(B,M,z){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var G=S({},B.props),de=B.key,Te=void 0;if(M!=null)for(pe in M.ref!==void 0&&(Te=void 0),M.key!==void 0&&(de=""+M.key),M)!D.call(M,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&M.ref===void 0||(G[pe]=M[pe]);var pe=arguments.length-2;if(pe===1)G.children=z;else if(1<pe){for(var Qe=Array(pe),ce=0;ce<pe;ce++)Qe[ce]=arguments[ce+2];G.children=Qe}return _(B.type,de,void 0,void 0,Te,G)},gt.createContext=function(B){return B={$$typeof:a,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:r,_context:B},B},gt.createElement=function(B,M,z){var G,de={},Te=null;if(M!=null)for(G in M.key!==void 0&&(Te=""+M.key),M)D.call(M,G)&&G!=="key"&&G!=="__self"&&G!=="__source"&&(de[G]=M[G]);var pe=arguments.length-2;if(pe===1)de.children=z;else if(1<pe){for(var Qe=Array(pe),ce=0;ce<pe;ce++)Qe[ce]=arguments[ce+2];de.children=Qe}if(B&&B.defaultProps)for(G in pe=B.defaultProps,pe)de[G]===void 0&&(de[G]=pe[G]);return _(B,Te,void 0,void 0,null,de)},gt.createRef=function(){return{current:null}},gt.forwardRef=function(B){return{$$typeof:l,render:B}},gt.isValidElement=N,gt.lazy=function(B){return{$$typeof:h,_payload:{_status:-1,_result:B},_init:K}},gt.memo=function(B,M){return{$$typeof:d,type:B,compare:M===void 0?null:M}},gt.startTransition=function(B){var M=w.T,z={};w.T=z;try{var G=B(),de=w.S;de!==null&&de(z,G),typeof G=="object"&&G!==null&&typeof G.then=="function"&&G.then(re,Y)}catch(Te){Y(Te)}finally{w.T=M}},gt.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},gt.use=function(B){return w.H.use(B)},gt.useActionState=function(B,M,z){return w.H.useActionState(B,M,z)},gt.useCallback=function(B,M){return w.H.useCallback(B,M)},gt.useContext=function(B){return w.H.useContext(B)},gt.useDebugValue=function(){},gt.useDeferredValue=function(B,M){return w.H.useDeferredValue(B,M)},gt.useEffect=function(B,M,z){var G=w.H;if(typeof z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return G.useEffect(B,M)},gt.useId=function(){return w.H.useId()},gt.useImperativeHandle=function(B,M,z){return w.H.useImperativeHandle(B,M,z)},gt.useInsertionEffect=function(B,M){return w.H.useInsertionEffect(B,M)},gt.useLayoutEffect=function(B,M){return w.H.useLayoutEffect(B,M)},gt.useMemo=function(B,M){return w.H.useMemo(B,M)},gt.useOptimistic=function(B,M){return w.H.useOptimistic(B,M)},gt.useReducer=function(B,M,z){return w.H.useReducer(B,M,z)},gt.useRef=function(B){return w.H.useRef(B)},gt.useState=function(B){return w.H.useState(B)},gt.useSyncExternalStore=function(B,M,z){return w.H.useSyncExternalStore(B,M,z)},gt.useTransition=function(){return w.H.useTransition()},gt.version="19.1.1",gt}var D1;function P0(){return D1||(D1=1,Rp.exports=KL()),Rp.exports}var C=P0();const Se=_0(C);var wp={exports:{}},Ec={},Cp={exports:{}},Lp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O1;function YL(){return O1||(O1=1,(function(n){function e(j,K){var Y=j.length;j.push(K);e:for(;0<Y;){var re=Y-1>>>1,B=j[re];if(0<i(B,K))j[re]=K,j[Y]=B,Y=re;else break e}}function t(j){return j.length===0?null:j[0]}function s(j){if(j.length===0)return null;var K=j[0],Y=j.pop();if(Y!==K){j[0]=Y;e:for(var re=0,B=j.length,M=B>>>1;re<M;){var z=2*(re+1)-1,G=j[z],de=z+1,Te=j[de];if(0>i(G,Y))de<B&&0>i(Te,G)?(j[re]=Te,j[de]=Y,re=de):(j[re]=G,j[z]=Y,re=z);else if(de<B&&0>i(Te,Y))j[re]=Te,j[de]=Y,re=de;else break e}}return K}function i(j,K){var Y=j.sortIndex-K.sortIndex;return Y!==0?Y:j.id-K.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var u=[],d=[],h=1,m=null,g=3,v=!1,S=!1,x=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function L(j){for(var K=t(d);K!==null;){if(K.callback===null)s(d);else if(K.startTime<=j)s(d),K.sortIndex=K.expirationTime,e(u,K);else break;K=t(d)}}function w(j){if(x=!1,L(j),!S)if(t(u)!==null)S=!0,D||(D=!0,H());else{var K=t(d);K!==null&&Q(w,K.startTime-j)}}var D=!1,_=-1,k=5,N=-1;function F(){return T?!0:!(n.unstable_now()-N<k)}function V(){if(T=!1,D){var j=n.unstable_now();N=j;var K=!0;try{e:{S=!1,x&&(x=!1,E(_),_=-1),v=!0;var Y=g;try{t:{for(L(j),m=t(u);m!==null&&!(m.expirationTime>j&&F());){var re=m.callback;if(typeof re=="function"){m.callback=null,g=m.priorityLevel;var B=re(m.expirationTime<=j);if(j=n.unstable_now(),typeof B=="function"){m.callback=B,L(j),K=!0;break t}m===t(u)&&s(u),L(j)}else s(u);m=t(u)}if(m!==null)K=!0;else{var M=t(d);M!==null&&Q(w,M.startTime-j),K=!1}}break e}finally{m=null,g=Y,v=!1}K=void 0}}finally{K?H():D=!1}}}var H;if(typeof R=="function")H=function(){R(V)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,X=J.port2;J.port1.onmessage=V,H=function(){X.postMessage(null)}}else H=function(){A(V,0)};function Q(j,K){_=A(function(){j(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(j){j.callback=null},n.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<j?Math.floor(1e3/j):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_next=function(j){switch(g){case 1:case 2:case 3:var K=3;break;default:K=g}var Y=g;g=K;try{return j()}finally{g=Y}},n.unstable_requestPaint=function(){T=!0},n.unstable_runWithPriority=function(j,K){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var Y=g;g=j;try{return K()}finally{g=Y}},n.unstable_scheduleCallback=function(j,K,Y){var re=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,j){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=Y+B,j={id:h++,callback:K,priorityLevel:j,startTime:Y,expirationTime:B,sortIndex:-1},Y>re?(j.sortIndex=Y,e(d,j),t(u)===null&&j===t(d)&&(x?(E(_),_=-1):x=!0,Q(w,Y-re))):(j.sortIndex=B,e(u,j),S||v||(S=!0,D||(D=!0,H()))),j},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(j){var K=g;return function(){var Y=g;g=K;try{return j.apply(this,arguments)}finally{g=Y}}}})(Lp)),Lp}var _1;function qL(){return _1||(_1=1,Cp.exports=YL()),Cp.exports}var Dp={exports:{}},bn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P1;function QL(){if(P1)return bn;P1=1;var n=P0();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(u,d,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:m==null?null:""+m,children:u,containerInfo:d,implementation:h}}var a=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return bn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,bn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return r(u,d,null,h)},bn.flushSync=function(u){var d=a.T,h=s.p;try{if(a.T=null,s.p=2,u)return u()}finally{a.T=d,s.p=h,s.d.f()}},bn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(u,d))},bn.prefetchDNS=function(u){typeof u=="string"&&s.d.D(u)},bn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,m=l(h,d.crossOrigin),g=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?s.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:g,fetchPriority:v}):h==="script"&&s.d.X(u,{crossOrigin:m,integrity:g,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},bn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);s.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(u)},bn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,m=l(h,d.crossOrigin);s.d.L(u,h,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},bn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);s.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(u)},bn.requestFormReset=function(u){s.d.r(u)},bn.unstable_batchedUpdates=function(u,d){return u(d)},bn.useFormState=function(u,d,h){return a.H.useFormState(u,d,h)},bn.useFormStatus=function(){return a.H.useHostTransitionStatus()},bn.version="19.1.1",bn}var N1;function CE(){if(N1)return Dp.exports;N1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Dp.exports=QL(),Dp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k1;function XL(){if(k1)return Ec;k1=1;var n=qL(),e=P0(),t=CE();function s(o){var c="https://react.dev/errors/"+o;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function r(o){var c=o,f=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,(c.flags&4098)!==0&&(f=c.return),o=c.return;while(o)}return c.tag===3?f:null}function a(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function l(o){if(r(o)!==o)throw Error(s(188))}function u(o){var c=o.alternate;if(!c){if(c=r(o),c===null)throw Error(s(188));return c!==o?null:o}for(var f=o,p=c;;){var b=f.return;if(b===null)break;var I=b.alternate;if(I===null){if(p=b.return,p!==null){f=p;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===f)return l(b),o;if(I===p)return l(b),c;I=I.sibling}throw Error(s(188))}if(f.return!==p.return)f=b,p=I;else{for(var P=!1,U=b.child;U;){if(U===f){P=!0,f=b,p=I;break}if(U===p){P=!0,p=b,f=I;break}U=U.sibling}if(!P){for(U=I.child;U;){if(U===f){P=!0,f=I,p=b;break}if(U===p){P=!0,p=I,f=b;break}U=U.sibling}if(!P)throw Error(s(189))}}if(f.alternate!==p)throw Error(s(190))}if(f.tag!==3)throw Error(s(188));return f.stateNode.current===f?o:c}function d(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o;for(o=o.child;o!==null;){if(c=d(o),c!==null)return c;o=o.sibling}return null}var h=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),R=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function H(o){return o===null||typeof o!="object"?null:(o=V&&o[V]||o["@@iterator"],typeof o=="function"?o:null)}var J=Symbol.for("react.client.reference");function X(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===J?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case S:return"Fragment";case T:return"Profiler";case x:return"StrictMode";case w:return"Suspense";case D:return"SuspenseList";case N:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case v:return"Portal";case R:return(o.displayName||"Context")+".Provider";case E:return(o._context.displayName||"Context")+".Consumer";case L:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case _:return c=o.displayName||null,c!==null?c:X(o.type)||"Memo";case k:c=o._payload,o=o._init;try{return X(o(c))}catch{}}return null}var Q=Array.isArray,j=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},re=[],B=-1;function M(o){return{current:o}}function z(o){0>B||(o.current=re[B],re[B]=null,B--)}function G(o,c){B++,re[B]=o.current,o.current=c}var de=M(null),Te=M(null),pe=M(null),Qe=M(null);function ce(o,c){switch(G(pe,c),G(Te,o),G(de,null),c.nodeType){case 9:case 11:o=(o=c.documentElement)&&(o=o.namespaceURI)?e1(o):0;break;default:if(o=c.tagName,c=c.namespaceURI)c=e1(c),o=t1(c,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}z(de),G(de,o)}function Oe(){z(de),z(Te),z(pe)}function Ue(o){o.memoizedState!==null&&G(Qe,o);var c=de.current,f=t1(c,o.type);c!==f&&(G(Te,o),G(de,f))}function Ze(o){Te.current===o&&(z(de),z(Te)),Qe.current===o&&(z(Qe),yc._currentValue=Y)}var nt=Object.prototype.hasOwnProperty,Dt=n.unstable_scheduleCallback,Nt=n.unstable_cancelCallback,Ot=n.unstable_shouldYield,ke=n.unstable_requestPaint,Je=n.unstable_now,ot=n.unstable_getCurrentPriorityLevel,kt=n.unstable_ImmediatePriority,vt=n.unstable_UserBlockingPriority,fe=n.unstable_NormalPriority,ze=n.unstable_LowPriority,Ve=n.unstable_IdlePriority,Fe=n.log,et=n.unstable_setDisableYieldValue,W=null,se=null;function me(o){if(typeof Fe=="function"&&et(o),se&&typeof se.setStrictMode=="function")try{se.setStrictMode(W,o)}catch{}}var he=Math.clz32?Math.clz32:ht,Ke=Math.log,Be=Math.LN2;function ht(o){return o>>>=0,o===0?32:31-(Ke(o)/Be|0)|0}var Mt=256,_t=4194304;function It(o){var c=o&42;if(c!==0)return c;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Ss(o,c,f){var p=o.pendingLanes;if(p===0)return 0;var b=0,I=o.suspendedLanes,P=o.pingedLanes;o=o.warmLanes;var U=p&134217727;return U!==0?(p=U&~I,p!==0?b=It(p):(P&=U,P!==0?b=It(P):f||(f=U&~o,f!==0&&(b=It(f))))):(U=p&~I,U!==0?b=It(U):P!==0?b=It(P):f||(f=p&~o,f!==0&&(b=It(f)))),b===0?0:c!==0&&c!==b&&(c&I)===0&&(I=b&-b,f=c&-c,I>=f||I===32&&(f&4194048)!==0)?c:b}function ds(o,c){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&c)===0}function Vs(o,c){switch(o){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $s(){var o=Mt;return Mt<<=1,(Mt&4194048)===0&&(Mt=256),o}function dn(){var o=_t;return _t<<=1,(_t&62914560)===0&&(_t=4194304),o}function it(o){for(var c=[],f=0;31>f;f++)c.push(o);return c}function rt(o,c){o.pendingLanes|=c,c!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function ns(o,c,f,p,b,I){var P=o.pendingLanes;o.pendingLanes=f,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=f,o.entangledLanes&=f,o.errorRecoveryDisabledLanes&=f,o.shellSuspendCounter=0;var U=o.entanglements,$=o.expirationTimes,ie=o.hiddenUpdates;for(f=P&~f;0<f;){var ge=31-he(f),be=1<<ge;U[ge]=0,$[ge]=-1;var ae=ie[ge];if(ae!==null)for(ie[ge]=null,ge=0;ge<ae.length;ge++){var le=ae[ge];le!==null&&(le.lane&=-536870913)}f&=~be}p!==0&&bs(o,p,0),I!==0&&b===0&&o.tag!==0&&(o.suspendedLanes|=I&~(P&~c))}function bs(o,c,f){o.pendingLanes|=c,o.suspendedLanes&=~c;var p=31-he(c);o.entangledLanes|=c,o.entanglements[p]=o.entanglements[p]|1073741824|f&4194090}function Ts(o,c){var f=o.entangledLanes|=c;for(o=o.entanglements;f;){var p=31-he(f),b=1<<p;b&c|o[p]&c&&(o[p]|=c),f&=~b}}function ps(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function gs(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function Ms(){var o=K.p;return o!==0?o:(o=window.event,o===void 0?32:S1(o.type))}function Rs(o,c){var f=K.p;try{return K.p=o,c()}finally{K.p=f}}var St=Math.random().toString(36).slice(2),Pt="__reactFiber$"+St,jt="__reactProps$"+St,zt="__reactContainer$"+St,ws="__reactEvents$"+St,Cs="__reactListeners$"+St,Qs="__reactHandles$"+St,Ee="__reactResources$"+St,rn="__reactMarker$"+St;function wa(o){delete o[Pt],delete o[jt],delete o[ws],delete o[Cs],delete o[Qs]}function Ki(o){var c=o[Pt];if(c)return c;for(var f=o.parentNode;f;){if(c=f[zt]||f[Pt]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(o=r1(o);o!==null;){if(f=o[Pt])return f;o=r1(o)}return c}o=f,f=o.parentNode}return null}function Fr(o){if(o=o[Pt]||o[zt]){var c=o.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return o}return null}function oe(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o.stateNode;throw Error(s(33))}function Ye(o){var c=o[Ee];return c||(c=o[Ee]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function tt(o){o[rn]=!0}var bt=new Set,Gs={};function Us(o,c){Ls(o,c),Ls(o+"Capture",c)}function Ls(o,c){for(Gs[o]=c,o=0;o<c.length;o++)bt.add(c[o])}var Yi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Kn={},Au={};function Iu(o){return nt.call(Au,o)?!0:nt.call(Kn,o)?!1:Yi.test(o)?Au[o]=!0:(Kn[o]=!0,!1)}function lo(o,c,f){if(Iu(c))if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":o.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){o.removeAttribute(c);return}}o.setAttribute(c,""+f)}}function co(o,c,f){if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(c);return}o.setAttribute(c,""+f)}}function hi(o,c,f,p){if(p===null)o.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttributeNS(c,f,""+p)}}var Br,bf;function jr(o){if(Br===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);Br=c&&c[1]||"",bf=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Br+o+bf}var Ru=!1;function Ll(o,c){if(!o||Ru)return"";Ru=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var be=function(){throw Error()};if(Object.defineProperty(be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(be,[])}catch(le){var ae=le}Reflect.construct(o,[],be)}else{try{be.call()}catch(le){ae=le}o.call(be.prototype)}}else{try{throw Error()}catch(le){ae=le}(be=o())&&typeof be.catch=="function"&&be.catch(function(){})}}catch(le){if(le&&ae&&typeof le.stack=="string")return[le.stack,ae.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=p.DetermineComponentFrameRoot(),P=I[0],U=I[1];if(P&&U){var $=P.split(`
`),ie=U.split(`
`);for(b=p=0;p<$.length&&!$[p].includes("DetermineComponentFrameRoot");)p++;for(;b<ie.length&&!ie[b].includes("DetermineComponentFrameRoot");)b++;if(p===$.length||b===ie.length)for(p=$.length-1,b=ie.length-1;1<=p&&0<=b&&$[p]!==ie[b];)b--;for(;1<=p&&0<=b;p--,b--)if($[p]!==ie[b]){if(p!==1||b!==1)do if(p--,b--,0>b||$[p]!==ie[b]){var ge=`
`+$[p].replace(" at new "," at ");return o.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",o.displayName)),ge}while(1<=p&&0<=b);break}}}finally{Ru=!1,Error.prepareStackTrace=f}return(f=o?o.displayName||o.name:"")?jr(f):""}function uo(o){switch(o.tag){case 26:case 27:case 5:return jr(o.type);case 16:return jr("Lazy");case 13:return jr("Suspense");case 19:return jr("SuspenseList");case 0:case 15:return Ll(o.type,!1);case 11:return Ll(o.type.render,!1);case 1:return Ll(o.type,!0);case 31:return jr("Activity");default:return""}}function qy(o){try{var c="";do c+=uo(o),o=o.return;while(o);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function fi(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Qy(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Bw(o){var c=Qy(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),p=""+o[c];if(!o.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,I=f.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return b.call(this)},set:function(P){p=""+P,I.call(this,P)}}),Object.defineProperty(o,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(P){p=""+P},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function wu(o){o._valueTracker||(o._valueTracker=Bw(o))}function Xy(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return o&&(p=Qy(o)?o.checked?"true":"false":o.value),o=p,o!==f?(c.setValue(o),!0):!1}function Cu(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var jw=/[\n"\\]/g;function mi(o){return o.replace(jw,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Tf(o,c,f,p,b,I,P,U){o.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?o.type=P:o.removeAttribute("type"),c!=null?P==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+fi(c)):o.value!==""+fi(c)&&(o.value=""+fi(c)):P!=="submit"&&P!=="reset"||o.removeAttribute("value"),c!=null?Ef(o,P,fi(c)):f!=null?Ef(o,P,fi(f)):p!=null&&o.removeAttribute("value"),b==null&&I!=null&&(o.defaultChecked=!!I),b!=null&&(o.checked=b&&typeof b!="function"&&typeof b!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?o.name=""+fi(U):o.removeAttribute("name")}function Wy(o,c,f,p,b,I,P,U){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(o.type=I),c!=null||f!=null){if(!(I!=="submit"&&I!=="reset"||c!=null))return;f=f!=null?""+fi(f):"",c=c!=null?""+fi(c):f,U||c===o.value||(o.value=c),o.defaultValue=c}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,o.checked=U?o.checked:!!p,o.defaultChecked=!!p,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(o.name=P)}function Ef(o,c,f){c==="number"&&Cu(o.ownerDocument)===o||o.defaultValue===""+f||(o.defaultValue=""+f)}function ho(o,c,f,p){if(o=o.options,c){c={};for(var b=0;b<f.length;b++)c["$"+f[b]]=!0;for(f=0;f<o.length;f++)b=c.hasOwnProperty("$"+o[f].value),o[f].selected!==b&&(o[f].selected=b),b&&p&&(o[f].defaultSelected=!0)}else{for(f=""+fi(f),c=null,b=0;b<o.length;b++){if(o[b].value===f){o[b].selected=!0,p&&(o[b].defaultSelected=!0);return}c!==null||o[b].disabled||(c=o[b])}c!==null&&(c.selected=!0)}}function Zy(o,c,f){if(c!=null&&(c=""+fi(c),c!==o.value&&(o.value=c),f==null)){o.defaultValue!==c&&(o.defaultValue=c);return}o.defaultValue=f!=null?""+fi(f):""}function Jy(o,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(s(92));if(Q(p)){if(1<p.length)throw Error(s(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=fi(c),o.defaultValue=f,p=o.textContent,p===f&&p!==""&&p!==null&&(o.value=p)}function fo(o,c){if(c){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=c;return}}o.textContent=c}var Vw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ev(o,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?o.setProperty(c,""):c==="float"?o.cssFloat="":o[c]="":p?o.setProperty(c,f):typeof f!="number"||f===0||Vw.has(c)?c==="float"?o.cssFloat=f:o[c]=(""+f).trim():o[c]=f+"px"}function tv(o,c,f){if(c!=null&&typeof c!="object")throw Error(s(62));if(o=o.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?o.setProperty(p,""):p==="float"?o.cssFloat="":o[p]="");for(var b in c)p=c[b],c.hasOwnProperty(b)&&f[b]!==p&&ev(o,b,p)}else for(var I in c)c.hasOwnProperty(I)&&ev(o,I,c[I])}function Af(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $w=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Gw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lu(o){return Gw.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var If=null;function Rf(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var mo=null,po=null;function sv(o){var c=Fr(o);if(c&&(o=c.stateNode)){var f=o[jt]||null;e:switch(o=c.stateNode,c.type){case"input":if(Tf(o,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+mi(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==o&&p.form===o.form){var b=p[jt]||null;if(!b)throw Error(s(90));Tf(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===o.form&&Xy(p)}break e;case"textarea":Zy(o,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&ho(o,!!f.multiple,c,!1)}}}var wf=!1;function nv(o,c,f){if(wf)return o(c,f);wf=!0;try{var p=o(c);return p}finally{if(wf=!1,(mo!==null||po!==null)&&(md(),mo&&(c=mo,o=po,po=mo=null,sv(c),o)))for(c=0;c<o.length;c++)sv(o[c])}}function Dl(o,c){var f=o.stateNode;if(f===null)return null;var p=f[jt]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(o=o.type,p=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!p;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(s(231,c,typeof f));return f}var gr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cf=!1;if(gr)try{var Ol={};Object.defineProperty(Ol,"passive",{get:function(){Cf=!0}}),window.addEventListener("test",Ol,Ol),window.removeEventListener("test",Ol,Ol)}catch{Cf=!1}var Vr=null,Lf=null,Du=null;function iv(){if(Du)return Du;var o,c=Lf,f=c.length,p,b="value"in Vr?Vr.value:Vr.textContent,I=b.length;for(o=0;o<f&&c[o]===b[o];o++);var P=f-o;for(p=1;p<=P&&c[f-p]===b[I-p];p++);return Du=b.slice(o,1<p?1-p:void 0)}function Ou(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function _u(){return!0}function rv(){return!1}function Pn(o){function c(f,p,b,I,P){this._reactName=f,this._targetInst=b,this.type=p,this.nativeEvent=I,this.target=P,this.currentTarget=null;for(var U in o)o.hasOwnProperty(U)&&(f=o[U],this[U]=f?f(I):I[U]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?_u:rv,this.isPropagationStopped=rv,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=_u)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=_u)},persist:function(){},isPersistent:_u}),c}var Ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pu=Pn(Ca),_l=h({},Ca,{view:0,detail:0}),Hw=Pn(_l),Df,Of,Pl,Nu=h({},_l,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Pl&&(Pl&&o.type==="mousemove"?(Df=o.screenX-Pl.screenX,Of=o.screenY-Pl.screenY):Of=Df=0,Pl=o),Df)},movementY:function(o){return"movementY"in o?o.movementY:Of}}),av=Pn(Nu),zw=h({},Nu,{dataTransfer:0}),Kw=Pn(zw),Yw=h({},_l,{relatedTarget:0}),_f=Pn(Yw),qw=h({},Ca,{animationName:0,elapsedTime:0,pseudoElement:0}),Qw=Pn(qw),Xw=h({},Ca,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),Ww=Pn(Xw),Zw=h({},Ca,{data:0}),ov=Pn(Zw),Jw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sC(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=tC[o])?!!c[o]:!1}function Pf(){return sC}var nC=h({},_l,{key:function(o){if(o.key){var c=Jw[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=Ou(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?eC[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pf,charCode:function(o){return o.type==="keypress"?Ou(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Ou(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),iC=Pn(nC),rC=h({},Nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lv=Pn(rC),aC=h({},_l,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pf}),oC=Pn(aC),lC=h({},Ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),cC=Pn(lC),uC=h({},Nu,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),dC=Pn(uC),hC=h({},Ca,{newState:0,oldState:0}),fC=Pn(hC),mC=[9,13,27,32],Nf=gr&&"CompositionEvent"in window,Nl=null;gr&&"documentMode"in document&&(Nl=document.documentMode);var pC=gr&&"TextEvent"in window&&!Nl,cv=gr&&(!Nf||Nl&&8<Nl&&11>=Nl),uv=" ",dv=!1;function hv(o,c){switch(o){case"keyup":return mC.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fv(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var go=!1;function gC(o,c){switch(o){case"compositionend":return fv(c);case"keypress":return c.which!==32?null:(dv=!0,uv);case"textInput":return o=c.data,o===uv&&dv?null:o;default:return null}}function yC(o,c){if(go)return o==="compositionend"||!Nf&&hv(o,c)?(o=iv(),Du=Lf=Vr=null,go=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return cv&&c.locale!=="ko"?null:c.data;default:return null}}var vC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mv(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!vC[o.type]:c==="textarea"}function pv(o,c,f,p){mo?po?po.push(p):po=[p]:mo=p,c=Sd(c,"onChange"),0<c.length&&(f=new Pu("onChange","change",null,f,p),o.push({event:f,listeners:c}))}var kl=null,Ml=null;function xC(o){QS(o,0)}function ku(o){var c=oe(o);if(Xy(c))return o}function gv(o,c){if(o==="change")return c}var yv=!1;if(gr){var kf;if(gr){var Mf="oninput"in document;if(!Mf){var vv=document.createElement("div");vv.setAttribute("oninput","return;"),Mf=typeof vv.oninput=="function"}kf=Mf}else kf=!1;yv=kf&&(!document.documentMode||9<document.documentMode)}function xv(){kl&&(kl.detachEvent("onpropertychange",Sv),Ml=kl=null)}function Sv(o){if(o.propertyName==="value"&&ku(Ml)){var c=[];pv(c,Ml,o,Rf(o)),nv(xC,c)}}function SC(o,c,f){o==="focusin"?(xv(),kl=c,Ml=f,kl.attachEvent("onpropertychange",Sv)):o==="focusout"&&xv()}function bC(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return ku(Ml)}function TC(o,c){if(o==="click")return ku(c)}function EC(o,c){if(o==="input"||o==="change")return ku(c)}function AC(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var Yn=typeof Object.is=="function"?Object.is:AC;function Ul(o,c){if(Yn(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var f=Object.keys(o),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var b=f[p];if(!nt.call(c,b)||!Yn(o[b],c[b]))return!1}return!0}function bv(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Tv(o,c){var f=bv(o);o=0;for(var p;f;){if(f.nodeType===3){if(p=o+f.textContent.length,o<=c&&p>=c)return{node:f,offset:c-o};o=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=bv(f)}}function Ev(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?Ev(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function Av(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var c=Cu(o.document);c instanceof o.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)o=c.contentWindow;else break;c=Cu(o.document)}return c}function Uf(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}var IC=gr&&"documentMode"in document&&11>=document.documentMode,yo=null,Ff=null,Fl=null,Bf=!1;function Iv(o,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Bf||yo==null||yo!==Cu(p)||(p=yo,"selectionStart"in p&&Uf(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Fl&&Ul(Fl,p)||(Fl=p,p=Sd(Ff,"onSelect"),0<p.length&&(c=new Pu("onSelect","select",null,c,f),o.push({event:c,listeners:p}),c.target=yo)))}function La(o,c){var f={};return f[o.toLowerCase()]=c.toLowerCase(),f["Webkit"+o]="webkit"+c,f["Moz"+o]="moz"+c,f}var vo={animationend:La("Animation","AnimationEnd"),animationiteration:La("Animation","AnimationIteration"),animationstart:La("Animation","AnimationStart"),transitionrun:La("Transition","TransitionRun"),transitionstart:La("Transition","TransitionStart"),transitioncancel:La("Transition","TransitionCancel"),transitionend:La("Transition","TransitionEnd")},jf={},Rv={};gr&&(Rv=document.createElement("div").style,"AnimationEvent"in window||(delete vo.animationend.animation,delete vo.animationiteration.animation,delete vo.animationstart.animation),"TransitionEvent"in window||delete vo.transitionend.transition);function Da(o){if(jf[o])return jf[o];if(!vo[o])return o;var c=vo[o],f;for(f in c)if(c.hasOwnProperty(f)&&f in Rv)return jf[o]=c[f];return o}var wv=Da("animationend"),Cv=Da("animationiteration"),Lv=Da("animationstart"),RC=Da("transitionrun"),wC=Da("transitionstart"),CC=Da("transitioncancel"),Dv=Da("transitionend"),Ov=new Map,Vf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vf.push("scrollEnd");function Pi(o,c){Ov.set(o,c),Us(c,[o])}var _v=new WeakMap;function pi(o,c){if(typeof o=="object"&&o!==null){var f=_v.get(o);return f!==void 0?f:(c={value:o,source:c,stack:qy(c)},_v.set(o,c),c)}return{value:o,source:c,stack:qy(c)}}var gi=[],xo=0,$f=0;function Mu(){for(var o=xo,c=$f=xo=0;c<o;){var f=gi[c];gi[c++]=null;var p=gi[c];gi[c++]=null;var b=gi[c];gi[c++]=null;var I=gi[c];if(gi[c++]=null,p!==null&&b!==null){var P=p.pending;P===null?b.next=b:(b.next=P.next,P.next=b),p.pending=b}I!==0&&Pv(f,b,I)}}function Uu(o,c,f,p){gi[xo++]=o,gi[xo++]=c,gi[xo++]=f,gi[xo++]=p,$f|=p,o.lanes|=p,o=o.alternate,o!==null&&(o.lanes|=p)}function Gf(o,c,f,p){return Uu(o,c,f,p),Fu(o)}function So(o,c){return Uu(o,null,null,c),Fu(o)}function Pv(o,c,f){o.lanes|=f;var p=o.alternate;p!==null&&(p.lanes|=f);for(var b=!1,I=o.return;I!==null;)I.childLanes|=f,p=I.alternate,p!==null&&(p.childLanes|=f),I.tag===22&&(o=I.stateNode,o===null||o._visibility&1||(b=!0)),o=I,I=I.return;return o.tag===3?(I=o.stateNode,b&&c!==null&&(b=31-he(f),o=I.hiddenUpdates,p=o[b],p===null?o[b]=[c]:p.push(c),c.lane=f|536870912),I):null}function Fu(o){if(50<cc)throw cc=0,Qm=null,Error(s(185));for(var c=o.return;c!==null;)o=c,c=o.return;return o.tag===3?o.stateNode:null}var bo={};function LC(o,c,f,p){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(o,c,f,p){return new LC(o,c,f,p)}function Hf(o){return o=o.prototype,!(!o||!o.isReactComponent)}function yr(o,c){var f=o.alternate;return f===null?(f=qn(o.tag,c,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=c,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&65011712,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,c=o.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f.refCleanup=o.refCleanup,f}function Nv(o,c){o.flags&=65011714;var f=o.alternate;return f===null?(o.childLanes=0,o.lanes=c,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=f.childLanes,o.lanes=f.lanes,o.child=f.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=f.memoizedProps,o.memoizedState=f.memoizedState,o.updateQueue=f.updateQueue,o.type=f.type,c=f.dependencies,o.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),o}function Bu(o,c,f,p,b,I){var P=0;if(p=o,typeof o=="function")Hf(o)&&(P=1);else if(typeof o=="string")P=OL(o,f,de.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case N:return o=qn(31,f,c,b),o.elementType=N,o.lanes=I,o;case S:return Oa(f.children,b,I,c);case x:P=8,b|=24;break;case T:return o=qn(12,f,c,b|2),o.elementType=T,o.lanes=I,o;case w:return o=qn(13,f,c,b),o.elementType=w,o.lanes=I,o;case D:return o=qn(19,f,c,b),o.elementType=D,o.lanes=I,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case A:case R:P=10;break e;case E:P=9;break e;case L:P=11;break e;case _:P=14;break e;case k:P=16,p=null;break e}P=29,f=Error(s(130,o===null?"null":typeof o,"")),p=null}return c=qn(P,f,c,b),c.elementType=o,c.type=p,c.lanes=I,c}function Oa(o,c,f,p){return o=qn(7,o,p,c),o.lanes=f,o}function zf(o,c,f){return o=qn(6,o,null,c),o.lanes=f,o}function Kf(o,c,f){return c=qn(4,o.children!==null?o.children:[],o.key,c),c.lanes=f,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}var To=[],Eo=0,ju=null,Vu=0,yi=[],vi=0,_a=null,vr=1,xr="";function Pa(o,c){To[Eo++]=Vu,To[Eo++]=ju,ju=o,Vu=c}function kv(o,c,f){yi[vi++]=vr,yi[vi++]=xr,yi[vi++]=_a,_a=o;var p=vr;o=xr;var b=32-he(p)-1;p&=~(1<<b),f+=1;var I=32-he(c)+b;if(30<I){var P=b-b%5;I=(p&(1<<P)-1).toString(32),p>>=P,b-=P,vr=1<<32-he(c)+b|f<<b|p,xr=I+o}else vr=1<<I|f<<b|p,xr=o}function Yf(o){o.return!==null&&(Pa(o,1),kv(o,1,0))}function qf(o){for(;o===ju;)ju=To[--Eo],To[Eo]=null,Vu=To[--Eo],To[Eo]=null;for(;o===_a;)_a=yi[--vi],yi[vi]=null,xr=yi[--vi],yi[vi]=null,vr=yi[--vi],yi[vi]=null}var Rn=null,Ds=null,Gt=!1,Na=null,qi=!1,Qf=Error(s(519));function ka(o){var c=Error(s(418,""));throw Vl(pi(c,o)),Qf}function Mv(o){var c=o.stateNode,f=o.type,p=o.memoizedProps;switch(c[Pt]=o,c[jt]=p,f){case"dialog":Lt("cancel",c),Lt("close",c);break;case"iframe":case"object":case"embed":Lt("load",c);break;case"video":case"audio":for(f=0;f<dc.length;f++)Lt(dc[f],c);break;case"source":Lt("error",c);break;case"img":case"image":case"link":Lt("error",c),Lt("load",c);break;case"details":Lt("toggle",c);break;case"input":Lt("invalid",c),Wy(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),wu(c);break;case"select":Lt("invalid",c);break;case"textarea":Lt("invalid",c),Jy(c,p.value,p.defaultValue,p.children),wu(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||JS(c.textContent,f)?(p.popover!=null&&(Lt("beforetoggle",c),Lt("toggle",c)),p.onScroll!=null&&Lt("scroll",c),p.onScrollEnd!=null&&Lt("scrollend",c),p.onClick!=null&&(c.onclick=bd),c=!0):c=!1,c||ka(o)}function Uv(o){for(Rn=o.return;Rn;)switch(Rn.tag){case 5:case 13:qi=!1;return;case 27:case 3:qi=!0;return;default:Rn=Rn.return}}function Bl(o){if(o!==Rn)return!1;if(!Gt)return Uv(o),Gt=!0,!1;var c=o.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=o.type,f=!(f!=="form"&&f!=="button")||dp(o.type,o.memoizedProps)),f=!f),f&&Ds&&ka(o),Uv(o),c===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(s(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8)if(f=o.data,f==="/$"){if(c===0){Ds=ki(o.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;o=o.nextSibling}Ds=null}}else c===27?(c=Ds,na(o.type)?(o=pp,pp=null,Ds=o):Ds=c):Ds=Rn?ki(o.stateNode.nextSibling):null;return!0}function jl(){Ds=Rn=null,Gt=!1}function Fv(){var o=Na;return o!==null&&(Mn===null?Mn=o:Mn.push.apply(Mn,o),Na=null),o}function Vl(o){Na===null?Na=[o]:Na.push(o)}var Xf=M(null),Ma=null,Sr=null;function $r(o,c,f){G(Xf,c._currentValue),c._currentValue=f}function br(o){o._currentValue=Xf.current,z(Xf)}function Wf(o,c,f){for(;o!==null;){var p=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),o===f)break;o=o.return}}function Zf(o,c,f,p){var b=o.child;for(b!==null&&(b.return=o);b!==null;){var I=b.dependencies;if(I!==null){var P=b.child;I=I.firstContext;e:for(;I!==null;){var U=I;I=b;for(var $=0;$<c.length;$++)if(U.context===c[$]){I.lanes|=f,U=I.alternate,U!==null&&(U.lanes|=f),Wf(I.return,f,o),p||(P=null);break e}I=U.next}}else if(b.tag===18){if(P=b.return,P===null)throw Error(s(341));P.lanes|=f,I=P.alternate,I!==null&&(I.lanes|=f),Wf(P,f,o),P=null}else P=b.child;if(P!==null)P.return=b;else for(P=b;P!==null;){if(P===o){P=null;break}if(b=P.sibling,b!==null){b.return=P.return,P=b;break}P=P.return}b=P}}function $l(o,c,f,p){o=null;for(var b=c,I=!1;b!==null;){if(!I){if((b.flags&524288)!==0)I=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var P=b.alternate;if(P===null)throw Error(s(387));if(P=P.memoizedProps,P!==null){var U=b.type;Yn(b.pendingProps.value,P.value)||(o!==null?o.push(U):o=[U])}}else if(b===Qe.current){if(P=b.alternate,P===null)throw Error(s(387));P.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(o!==null?o.push(yc):o=[yc])}b=b.return}o!==null&&Zf(c,o,f,p),c.flags|=262144}function $u(o){for(o=o.firstContext;o!==null;){if(!Yn(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Ua(o){Ma=o,Sr=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Sn(o){return Bv(Ma,o)}function Gu(o,c){return Ma===null&&Ua(o),Bv(o,c)}function Bv(o,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Sr===null){if(o===null)throw Error(s(308));Sr=c,o.dependencies={lanes:0,firstContext:c},o.flags|=524288}else Sr=Sr.next=c;return f}var DC=typeof AbortController<"u"?AbortController:function(){var o=[],c=this.signal={aborted:!1,addEventListener:function(f,p){o.push(p)}};this.abort=function(){c.aborted=!0,o.forEach(function(f){return f()})}},OC=n.unstable_scheduleCallback,_C=n.unstable_NormalPriority,Xs={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jf(){return{controller:new DC,data:new Map,refCount:0}}function Gl(o){o.refCount--,o.refCount===0&&OC(_C,function(){o.controller.abort()})}var Hl=null,em=0,Ao=0,Io=null;function PC(o,c){if(Hl===null){var f=Hl=[];em=0,Ao=sp(),Io={status:"pending",value:void 0,then:function(p){f.push(p)}}}return em++,c.then(jv,jv),c}function jv(){if(--em===0&&Hl!==null){Io!==null&&(Io.status="fulfilled");var o=Hl;Hl=null,Ao=0,Io=null;for(var c=0;c<o.length;c++)(0,o[c])()}}function NC(o,c){var f=[],p={status:"pending",value:null,reason:null,then:function(b){f.push(b)}};return o.then(function(){p.status="fulfilled",p.value=c;for(var b=0;b<f.length;b++)(0,f[b])(c)},function(b){for(p.status="rejected",p.reason=b,b=0;b<f.length;b++)(0,f[b])(void 0)}),p}var Vv=j.S;j.S=function(o,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&PC(o,c),Vv!==null&&Vv(o,c)};var Fa=M(null);function tm(){var o=Fa.current;return o!==null?o:cs.pooledCache}function Hu(o,c){c===null?G(Fa,Fa.current):G(Fa,c.pool)}function $v(){var o=tm();return o===null?null:{parent:Xs._currentValue,pool:o}}var zl=Error(s(460)),Gv=Error(s(474)),zu=Error(s(542)),sm={then:function(){}};function Hv(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Ku(){}function zv(o,c,f){switch(f=o[f],f===void 0?o.push(c):f!==c&&(c.then(Ku,Ku),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,Yv(o),o;default:if(typeof c.status=="string")c.then(Ku,Ku);else{if(o=cs,o!==null&&100<o.shellSuspendCounter)throw Error(s(482));o=c,o.status="pending",o.then(function(p){if(c.status==="pending"){var b=c;b.status="fulfilled",b.value=p}},function(p){if(c.status==="pending"){var b=c;b.status="rejected",b.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,Yv(o),o}throw Kl=c,zl}}var Kl=null;function Kv(){if(Kl===null)throw Error(s(459));var o=Kl;return Kl=null,o}function Yv(o){if(o===zl||o===zu)throw Error(s(483))}var Gr=!1;function nm(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function im(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function Hr(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function zr(o,c,f){var p=o.updateQueue;if(p===null)return null;if(p=p.shared,(qt&2)!==0){var b=p.pending;return b===null?c.next=c:(c.next=b.next,b.next=c),p.pending=c,c=Fu(o),Pv(o,null,f),c}return Uu(o,p,c,f),Fu(o)}function Yl(o,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=o.pendingLanes,f|=p,c.lanes=f,Ts(o,f)}}function rm(o,c){var f=o.updateQueue,p=o.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var b=null,I=null;if(f=f.firstBaseUpdate,f!==null){do{var P={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};I===null?b=I=P:I=I.next=P,f=f.next}while(f!==null);I===null?b=I=c:I=I.next=c}else b=I=c;f={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:p.shared,callbacks:p.callbacks},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=c:o.next=c,f.lastBaseUpdate=c}var am=!1;function ql(){if(am){var o=Io;if(o!==null)throw o}}function Ql(o,c,f,p){am=!1;var b=o.updateQueue;Gr=!1;var I=b.firstBaseUpdate,P=b.lastBaseUpdate,U=b.shared.pending;if(U!==null){b.shared.pending=null;var $=U,ie=$.next;$.next=null,P===null?I=ie:P.next=ie,P=$;var ge=o.alternate;ge!==null&&(ge=ge.updateQueue,U=ge.lastBaseUpdate,U!==P&&(U===null?ge.firstBaseUpdate=ie:U.next=ie,ge.lastBaseUpdate=$))}if(I!==null){var be=b.baseState;P=0,ge=ie=$=null,U=I;do{var ae=U.lane&-536870913,le=ae!==U.lane;if(le?(Ft&ae)===ae:(p&ae)===ae){ae!==0&&ae===Ao&&(am=!0),ge!==null&&(ge=ge.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var lt=o,st=U;ae=c;var es=f;switch(st.tag){case 1:if(lt=st.payload,typeof lt=="function"){be=lt.call(es,be,ae);break e}be=lt;break e;case 3:lt.flags=lt.flags&-65537|128;case 0:if(lt=st.payload,ae=typeof lt=="function"?lt.call(es,be,ae):lt,ae==null)break e;be=h({},be,ae);break e;case 2:Gr=!0}}ae=U.callback,ae!==null&&(o.flags|=64,le&&(o.flags|=8192),le=b.callbacks,le===null?b.callbacks=[ae]:le.push(ae))}else le={lane:ae,tag:U.tag,payload:U.payload,callback:U.callback,next:null},ge===null?(ie=ge=le,$=be):ge=ge.next=le,P|=ae;if(U=U.next,U===null){if(U=b.shared.pending,U===null)break;le=U,U=le.next,le.next=null,b.lastBaseUpdate=le,b.shared.pending=null}}while(!0);ge===null&&($=be),b.baseState=$,b.firstBaseUpdate=ie,b.lastBaseUpdate=ge,I===null&&(b.shared.lanes=0),Jr|=P,o.lanes=P,o.memoizedState=be}}function qv(o,c){if(typeof o!="function")throw Error(s(191,o));o.call(c)}function Qv(o,c){var f=o.callbacks;if(f!==null)for(o.callbacks=null,o=0;o<f.length;o++)qv(f[o],c)}var Ro=M(null),Yu=M(0);function Xv(o,c){o=Cr,G(Yu,o),G(Ro,c),Cr=o|c.baseLanes}function om(){G(Yu,Cr),G(Ro,Ro.current)}function lm(){Cr=Yu.current,z(Ro),z(Yu)}var Kr=0,Tt=null,Zt=null,Hs=null,qu=!1,wo=!1,Ba=!1,Qu=0,Xl=0,Co=null,kC=0;function Fs(){throw Error(s(321))}function cm(o,c){if(c===null)return!1;for(var f=0;f<c.length&&f<o.length;f++)if(!Yn(o[f],c[f]))return!1;return!0}function um(o,c,f,p,b,I){return Kr=I,Tt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,j.H=o===null||o.memoizedState===null?Px:Nx,Ba=!1,I=f(p,b),Ba=!1,wo&&(I=Zv(c,f,p,b)),Wv(o),I}function Wv(o){j.H=td;var c=Zt!==null&&Zt.next!==null;if(Kr=0,Hs=Zt=Tt=null,qu=!1,Xl=0,Co=null,c)throw Error(s(300));o===null||an||(o=o.dependencies,o!==null&&$u(o)&&(an=!0))}function Zv(o,c,f,p){Tt=o;var b=0;do{if(wo&&(Co=null),Xl=0,wo=!1,25<=b)throw Error(s(301));if(b+=1,Hs=Zt=null,o.updateQueue!=null){var I=o.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}j.H=$C,I=c(f,p)}while(wo);return I}function MC(){var o=j.H,c=o.useState()[0];return c=typeof c.then=="function"?Wl(c):c,o=o.useState()[0],(Zt!==null?Zt.memoizedState:null)!==o&&(Tt.flags|=1024),c}function dm(){var o=Qu!==0;return Qu=0,o}function hm(o,c,f){c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~f}function fm(o){if(qu){for(o=o.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}qu=!1}Kr=0,Hs=Zt=Tt=null,wo=!1,Xl=Qu=0,Co=null}function Nn(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hs===null?Tt.memoizedState=Hs=o:Hs=Hs.next=o,Hs}function zs(){if(Zt===null){var o=Tt.alternate;o=o!==null?o.memoizedState:null}else o=Zt.next;var c=Hs===null?Tt.memoizedState:Hs.next;if(c!==null)Hs=c,Zt=o;else{if(o===null)throw Tt.alternate===null?Error(s(467)):Error(s(310));Zt=o,o={memoizedState:Zt.memoizedState,baseState:Zt.baseState,baseQueue:Zt.baseQueue,queue:Zt.queue,next:null},Hs===null?Tt.memoizedState=Hs=o:Hs=Hs.next=o}return Hs}function mm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wl(o){var c=Xl;return Xl+=1,Co===null&&(Co=[]),o=zv(Co,o,c),c=Tt,(Hs===null?c.memoizedState:Hs.next)===null&&(c=c.alternate,j.H=c===null||c.memoizedState===null?Px:Nx),o}function Xu(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Wl(o);if(o.$$typeof===R)return Sn(o)}throw Error(s(438,String(o)))}function pm(o){var c=null,f=Tt.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=Tt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(b){return b.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=mm(),Tt.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(o),p=0;p<o;p++)f[p]=F;return c.index++,f}function Tr(o,c){return typeof c=="function"?c(o):c}function Wu(o){var c=zs();return gm(c,Zt,o)}function gm(o,c,f){var p=o.queue;if(p===null)throw Error(s(311));p.lastRenderedReducer=f;var b=o.baseQueue,I=p.pending;if(I!==null){if(b!==null){var P=b.next;b.next=I.next,I.next=P}c.baseQueue=b=I,p.pending=null}if(I=o.baseState,b===null)o.memoizedState=I;else{c=b.next;var U=P=null,$=null,ie=c,ge=!1;do{var be=ie.lane&-536870913;if(be!==ie.lane?(Ft&be)===be:(Kr&be)===be){var ae=ie.revertLane;if(ae===0)$!==null&&($=$.next={lane:0,revertLane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),be===Ao&&(ge=!0);else if((Kr&ae)===ae){ie=ie.next,ae===Ao&&(ge=!0);continue}else be={lane:0,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},$===null?(U=$=be,P=I):$=$.next=be,Tt.lanes|=ae,Jr|=ae;be=ie.action,Ba&&f(I,be),I=ie.hasEagerState?ie.eagerState:f(I,be)}else ae={lane:be,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},$===null?(U=$=ae,P=I):$=$.next=ae,Tt.lanes|=be,Jr|=be;ie=ie.next}while(ie!==null&&ie!==c);if($===null?P=I:$.next=U,!Yn(I,o.memoizedState)&&(an=!0,ge&&(f=Io,f!==null)))throw f;o.memoizedState=I,o.baseState=P,o.baseQueue=$,p.lastRenderedState=I}return b===null&&(p.lanes=0),[o.memoizedState,p.dispatch]}function ym(o){var c=zs(),f=c.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=o;var p=f.dispatch,b=f.pending,I=c.memoizedState;if(b!==null){f.pending=null;var P=b=b.next;do I=o(I,P.action),P=P.next;while(P!==b);Yn(I,c.memoizedState)||(an=!0),c.memoizedState=I,c.baseQueue===null&&(c.baseState=I),f.lastRenderedState=I}return[I,p]}function Jv(o,c,f){var p=Tt,b=zs(),I=Gt;if(I){if(f===void 0)throw Error(s(407));f=f()}else f=c();var P=!Yn((Zt||b).memoizedState,f);P&&(b.memoizedState=f,an=!0),b=b.queue;var U=sx.bind(null,p,b,o);if(Zl(2048,8,U,[o]),b.getSnapshot!==c||P||Hs!==null&&Hs.memoizedState.tag&1){if(p.flags|=2048,Lo(9,Zu(),tx.bind(null,p,b,f,c),null),cs===null)throw Error(s(349));I||(Kr&124)!==0||ex(p,c,f)}return f}function ex(o,c,f){o.flags|=16384,o={getSnapshot:c,value:f},c=Tt.updateQueue,c===null?(c=mm(),Tt.updateQueue=c,c.stores=[o]):(f=c.stores,f===null?c.stores=[o]:f.push(o))}function tx(o,c,f,p){c.value=f,c.getSnapshot=p,nx(c)&&ix(o)}function sx(o,c,f){return f(function(){nx(c)&&ix(o)})}function nx(o){var c=o.getSnapshot;o=o.value;try{var f=c();return!Yn(o,f)}catch{return!0}}function ix(o){var c=So(o,2);c!==null&&Jn(c,o,2)}function vm(o){var c=Nn();if(typeof o=="function"){var f=o;if(o=f(),Ba){me(!0);try{f()}finally{me(!1)}}}return c.memoizedState=c.baseState=o,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tr,lastRenderedState:o},c}function rx(o,c,f,p){return o.baseState=f,gm(o,Zt,typeof p=="function"?p:Tr)}function UC(o,c,f,p,b){if(ed(o))throw Error(s(485));if(o=c.action,o!==null){var I={payload:b,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){I.listeners.push(P)}};j.T!==null?f(!0):I.isTransition=!1,p(I),f=c.pending,f===null?(I.next=c.pending=I,ax(c,I)):(I.next=f.next,c.pending=f.next=I)}}function ax(o,c){var f=c.action,p=c.payload,b=o.state;if(c.isTransition){var I=j.T,P={};j.T=P;try{var U=f(b,p),$=j.S;$!==null&&$(P,U),ox(o,c,U)}catch(ie){xm(o,c,ie)}finally{j.T=I}}else try{I=f(b,p),ox(o,c,I)}catch(ie){xm(o,c,ie)}}function ox(o,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){lx(o,c,p)},function(p){return xm(o,c,p)}):lx(o,c,f)}function lx(o,c,f){c.status="fulfilled",c.value=f,cx(c),o.state=f,c=o.pending,c!==null&&(f=c.next,f===c?o.pending=null:(f=f.next,c.next=f,ax(o,f)))}function xm(o,c,f){var p=o.pending;if(o.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,cx(c),c=c.next;while(c!==p)}o.action=null}function cx(o){o=o.listeners;for(var c=0;c<o.length;c++)(0,o[c])()}function ux(o,c){return c}function dx(o,c){if(Gt){var f=cs.formState;if(f!==null){e:{var p=Tt;if(Gt){if(Ds){t:{for(var b=Ds,I=qi;b.nodeType!==8;){if(!I){b=null;break t}if(b=ki(b.nextSibling),b===null){b=null;break t}}I=b.data,b=I==="F!"||I==="F"?b:null}if(b){Ds=ki(b.nextSibling),p=b.data==="F!";break e}}ka(p)}p=!1}p&&(c=f[0])}}return f=Nn(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ux,lastRenderedState:c},f.queue=p,f=Dx.bind(null,Tt,p),p.dispatch=f,p=vm(!1),I=Am.bind(null,Tt,!1,p.queue),p=Nn(),b={state:c,dispatch:null,action:o,pending:null},p.queue=b,f=UC.bind(null,Tt,b,I,f),b.dispatch=f,p.memoizedState=o,[c,f,!1]}function hx(o){var c=zs();return fx(c,Zt,o)}function fx(o,c,f){if(c=gm(o,c,ux)[0],o=Wu(Tr)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Wl(c)}catch(P){throw P===zl?zu:P}else p=c;c=zs();var b=c.queue,I=b.dispatch;return f!==c.memoizedState&&(Tt.flags|=2048,Lo(9,Zu(),FC.bind(null,b,f),null)),[p,I,o]}function FC(o,c){o.action=c}function mx(o){var c=zs(),f=Zt;if(f!==null)return fx(c,f,o);zs(),c=c.memoizedState,f=zs();var p=f.queue.dispatch;return f.memoizedState=o,[c,p,!1]}function Lo(o,c,f,p){return o={tag:o,create:f,deps:p,inst:c,next:null},c=Tt.updateQueue,c===null&&(c=mm(),Tt.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=o.next=o:(p=f.next,f.next=o,o.next=p,c.lastEffect=o),o}function Zu(){return{destroy:void 0,resource:void 0}}function px(){return zs().memoizedState}function Ju(o,c,f,p){var b=Nn();p=p===void 0?null:p,Tt.flags|=o,b.memoizedState=Lo(1|c,Zu(),f,p)}function Zl(o,c,f,p){var b=zs();p=p===void 0?null:p;var I=b.memoizedState.inst;Zt!==null&&p!==null&&cm(p,Zt.memoizedState.deps)?b.memoizedState=Lo(c,I,f,p):(Tt.flags|=o,b.memoizedState=Lo(1|c,I,f,p))}function gx(o,c){Ju(8390656,8,o,c)}function yx(o,c){Zl(2048,8,o,c)}function vx(o,c){return Zl(4,2,o,c)}function xx(o,c){return Zl(4,4,o,c)}function Sx(o,c){if(typeof c=="function"){o=o();var f=c(o);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function bx(o,c,f){f=f!=null?f.concat([o]):null,Zl(4,4,Sx.bind(null,c,o),f)}function Sm(){}function Tx(o,c){var f=zs();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&cm(c,p[1])?p[0]:(f.memoizedState=[o,c],o)}function Ex(o,c){var f=zs();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&cm(c,p[1]))return p[0];if(p=o(),Ba){me(!0);try{o()}finally{me(!1)}}return f.memoizedState=[p,c],p}function bm(o,c,f){return f===void 0||(Kr&1073741824)!==0?o.memoizedState=c:(o.memoizedState=f,o=RS(),Tt.lanes|=o,Jr|=o,f)}function Ax(o,c,f,p){return Yn(f,c)?f:Ro.current!==null?(o=bm(o,f,p),Yn(o,c)||(an=!0),o):(Kr&42)===0?(an=!0,o.memoizedState=f):(o=RS(),Tt.lanes|=o,Jr|=o,c)}function Ix(o,c,f,p,b){var I=K.p;K.p=I!==0&&8>I?I:8;var P=j.T,U={};j.T=U,Am(o,!1,c,f);try{var $=b(),ie=j.S;if(ie!==null&&ie(U,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var ge=NC($,p);Jl(o,c,ge,Zn(o))}else Jl(o,c,p,Zn(o))}catch(be){Jl(o,c,{then:function(){},status:"rejected",reason:be},Zn())}finally{K.p=I,j.T=P}}function BC(){}function Tm(o,c,f,p){if(o.tag!==5)throw Error(s(476));var b=Rx(o).queue;Ix(o,b,c,Y,f===null?BC:function(){return wx(o),f(p)})}function Rx(o){var c=o.memoizedState;if(c!==null)return c;c={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tr,lastRenderedState:Y},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tr,lastRenderedState:f},next:null},o.memoizedState=c,o=o.alternate,o!==null&&(o.memoizedState=c),c}function wx(o){var c=Rx(o).next.queue;Jl(o,c,{},Zn())}function Em(){return Sn(yc)}function Cx(){return zs().memoizedState}function Lx(){return zs().memoizedState}function jC(o){for(var c=o.return;c!==null;){switch(c.tag){case 24:case 3:var f=Zn();o=Hr(f);var p=zr(c,o,f);p!==null&&(Jn(p,c,f),Yl(p,c,f)),c={cache:Jf()},o.payload=c;return}c=c.return}}function VC(o,c,f){var p=Zn();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},ed(o)?Ox(c,f):(f=Gf(o,c,f,p),f!==null&&(Jn(f,o,p),_x(f,c,p)))}function Dx(o,c,f){var p=Zn();Jl(o,c,f,p)}function Jl(o,c,f,p){var b={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(ed(o))Ox(c,b);else{var I=o.alternate;if(o.lanes===0&&(I===null||I.lanes===0)&&(I=c.lastRenderedReducer,I!==null))try{var P=c.lastRenderedState,U=I(P,f);if(b.hasEagerState=!0,b.eagerState=U,Yn(U,P))return Uu(o,c,b,0),cs===null&&Mu(),!1}catch{}finally{}if(f=Gf(o,c,b,p),f!==null)return Jn(f,o,p),_x(f,c,p),!0}return!1}function Am(o,c,f,p){if(p={lane:2,revertLane:sp(),action:p,hasEagerState:!1,eagerState:null,next:null},ed(o)){if(c)throw Error(s(479))}else c=Gf(o,f,p,2),c!==null&&Jn(c,o,2)}function ed(o){var c=o.alternate;return o===Tt||c!==null&&c===Tt}function Ox(o,c){wo=qu=!0;var f=o.pending;f===null?c.next=c:(c.next=f.next,f.next=c),o.pending=c}function _x(o,c,f){if((f&4194048)!==0){var p=c.lanes;p&=o.pendingLanes,f|=p,c.lanes=f,Ts(o,f)}}var td={readContext:Sn,use:Xu,useCallback:Fs,useContext:Fs,useEffect:Fs,useImperativeHandle:Fs,useLayoutEffect:Fs,useInsertionEffect:Fs,useMemo:Fs,useReducer:Fs,useRef:Fs,useState:Fs,useDebugValue:Fs,useDeferredValue:Fs,useTransition:Fs,useSyncExternalStore:Fs,useId:Fs,useHostTransitionStatus:Fs,useFormState:Fs,useActionState:Fs,useOptimistic:Fs,useMemoCache:Fs,useCacheRefresh:Fs},Px={readContext:Sn,use:Xu,useCallback:function(o,c){return Nn().memoizedState=[o,c===void 0?null:c],o},useContext:Sn,useEffect:gx,useImperativeHandle:function(o,c,f){f=f!=null?f.concat([o]):null,Ju(4194308,4,Sx.bind(null,c,o),f)},useLayoutEffect:function(o,c){return Ju(4194308,4,o,c)},useInsertionEffect:function(o,c){Ju(4,2,o,c)},useMemo:function(o,c){var f=Nn();c=c===void 0?null:c;var p=o();if(Ba){me(!0);try{o()}finally{me(!1)}}return f.memoizedState=[p,c],p},useReducer:function(o,c,f){var p=Nn();if(f!==void 0){var b=f(c);if(Ba){me(!0);try{f(c)}finally{me(!1)}}}else b=c;return p.memoizedState=p.baseState=b,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:b},p.queue=o,o=o.dispatch=VC.bind(null,Tt,o),[p.memoizedState,o]},useRef:function(o){var c=Nn();return o={current:o},c.memoizedState=o},useState:function(o){o=vm(o);var c=o.queue,f=Dx.bind(null,Tt,c);return c.dispatch=f,[o.memoizedState,f]},useDebugValue:Sm,useDeferredValue:function(o,c){var f=Nn();return bm(f,o,c)},useTransition:function(){var o=vm(!1);return o=Ix.bind(null,Tt,o.queue,!0,!1),Nn().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,c,f){var p=Tt,b=Nn();if(Gt){if(f===void 0)throw Error(s(407));f=f()}else{if(f=c(),cs===null)throw Error(s(349));(Ft&124)!==0||ex(p,c,f)}b.memoizedState=f;var I={value:f,getSnapshot:c};return b.queue=I,gx(sx.bind(null,p,I,o),[o]),p.flags|=2048,Lo(9,Zu(),tx.bind(null,p,I,f,c),null),f},useId:function(){var o=Nn(),c=cs.identifierPrefix;if(Gt){var f=xr,p=vr;f=(p&~(1<<32-he(p)-1)).toString(32)+f,c=""+c+"R"+f,f=Qu++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=kC++,c=""+c+"r"+f.toString(32)+"";return o.memoizedState=c},useHostTransitionStatus:Em,useFormState:dx,useActionState:dx,useOptimistic:function(o){var c=Nn();c.memoizedState=c.baseState=o;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=Am.bind(null,Tt,!0,f),f.dispatch=c,[o,c]},useMemoCache:pm,useCacheRefresh:function(){return Nn().memoizedState=jC.bind(null,Tt)}},Nx={readContext:Sn,use:Xu,useCallback:Tx,useContext:Sn,useEffect:yx,useImperativeHandle:bx,useInsertionEffect:vx,useLayoutEffect:xx,useMemo:Ex,useReducer:Wu,useRef:px,useState:function(){return Wu(Tr)},useDebugValue:Sm,useDeferredValue:function(o,c){var f=zs();return Ax(f,Zt.memoizedState,o,c)},useTransition:function(){var o=Wu(Tr)[0],c=zs().memoizedState;return[typeof o=="boolean"?o:Wl(o),c]},useSyncExternalStore:Jv,useId:Cx,useHostTransitionStatus:Em,useFormState:hx,useActionState:hx,useOptimistic:function(o,c){var f=zs();return rx(f,Zt,o,c)},useMemoCache:pm,useCacheRefresh:Lx},$C={readContext:Sn,use:Xu,useCallback:Tx,useContext:Sn,useEffect:yx,useImperativeHandle:bx,useInsertionEffect:vx,useLayoutEffect:xx,useMemo:Ex,useReducer:ym,useRef:px,useState:function(){return ym(Tr)},useDebugValue:Sm,useDeferredValue:function(o,c){var f=zs();return Zt===null?bm(f,o,c):Ax(f,Zt.memoizedState,o,c)},useTransition:function(){var o=ym(Tr)[0],c=zs().memoizedState;return[typeof o=="boolean"?o:Wl(o),c]},useSyncExternalStore:Jv,useId:Cx,useHostTransitionStatus:Em,useFormState:mx,useActionState:mx,useOptimistic:function(o,c){var f=zs();return Zt!==null?rx(f,Zt,o,c):(f.baseState=o,[o,f.queue.dispatch])},useMemoCache:pm,useCacheRefresh:Lx},Do=null,ec=0;function sd(o){var c=ec;return ec+=1,Do===null&&(Do=[]),zv(Do,o,c)}function tc(o,c){c=c.props.ref,o.ref=c!==void 0?c:null}function nd(o,c){throw c.$$typeof===m?Error(s(525)):(o=Object.prototype.toString.call(c),Error(s(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o)))}function kx(o){var c=o._init;return c(o._payload)}function Mx(o){function c(Z,q){if(o){var ne=Z.deletions;ne===null?(Z.deletions=[q],Z.flags|=16):ne.push(q)}}function f(Z,q){if(!o)return null;for(;q!==null;)c(Z,q),q=q.sibling;return null}function p(Z){for(var q=new Map;Z!==null;)Z.key!==null?q.set(Z.key,Z):q.set(Z.index,Z),Z=Z.sibling;return q}function b(Z,q){return Z=yr(Z,q),Z.index=0,Z.sibling=null,Z}function I(Z,q,ne){return Z.index=ne,o?(ne=Z.alternate,ne!==null?(ne=ne.index,ne<q?(Z.flags|=67108866,q):ne):(Z.flags|=67108866,q)):(Z.flags|=1048576,q)}function P(Z){return o&&Z.alternate===null&&(Z.flags|=67108866),Z}function U(Z,q,ne,xe){return q===null||q.tag!==6?(q=zf(ne,Z.mode,xe),q.return=Z,q):(q=b(q,ne),q.return=Z,q)}function $(Z,q,ne,xe){var He=ne.type;return He===S?ge(Z,q,ne.props.children,xe,ne.key):q!==null&&(q.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===k&&kx(He)===q.type)?(q=b(q,ne.props),tc(q,ne),q.return=Z,q):(q=Bu(ne.type,ne.key,ne.props,null,Z.mode,xe),tc(q,ne),q.return=Z,q)}function ie(Z,q,ne,xe){return q===null||q.tag!==4||q.stateNode.containerInfo!==ne.containerInfo||q.stateNode.implementation!==ne.implementation?(q=Kf(ne,Z.mode,xe),q.return=Z,q):(q=b(q,ne.children||[]),q.return=Z,q)}function ge(Z,q,ne,xe,He){return q===null||q.tag!==7?(q=Oa(ne,Z.mode,xe,He),q.return=Z,q):(q=b(q,ne),q.return=Z,q)}function be(Z,q,ne){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return q=zf(""+q,Z.mode,ne),q.return=Z,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case g:return ne=Bu(q.type,q.key,q.props,null,Z.mode,ne),tc(ne,q),ne.return=Z,ne;case v:return q=Kf(q,Z.mode,ne),q.return=Z,q;case k:var xe=q._init;return q=xe(q._payload),be(Z,q,ne)}if(Q(q)||H(q))return q=Oa(q,Z.mode,ne,null),q.return=Z,q;if(typeof q.then=="function")return be(Z,sd(q),ne);if(q.$$typeof===R)return be(Z,Gu(Z,q),ne);nd(Z,q)}return null}function ae(Z,q,ne,xe){var He=q!==null?q.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return He!==null?null:U(Z,q,""+ne,xe);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case g:return ne.key===He?$(Z,q,ne,xe):null;case v:return ne.key===He?ie(Z,q,ne,xe):null;case k:return He=ne._init,ne=He(ne._payload),ae(Z,q,ne,xe)}if(Q(ne)||H(ne))return He!==null?null:ge(Z,q,ne,xe,null);if(typeof ne.then=="function")return ae(Z,q,sd(ne),xe);if(ne.$$typeof===R)return ae(Z,q,Gu(Z,ne),xe);nd(Z,ne)}return null}function le(Z,q,ne,xe,He){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return Z=Z.get(ne)||null,U(q,Z,""+xe,He);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case g:return Z=Z.get(xe.key===null?ne:xe.key)||null,$(q,Z,xe,He);case v:return Z=Z.get(xe.key===null?ne:xe.key)||null,ie(q,Z,xe,He);case k:var Rt=xe._init;return xe=Rt(xe._payload),le(Z,q,ne,xe,He)}if(Q(xe)||H(xe))return Z=Z.get(ne)||null,ge(q,Z,xe,He,null);if(typeof xe.then=="function")return le(Z,q,ne,sd(xe),He);if(xe.$$typeof===R)return le(Z,q,ne,Gu(q,xe),He);nd(q,xe)}return null}function lt(Z,q,ne,xe){for(var He=null,Rt=null,Xe=q,at=q=0,ln=null;Xe!==null&&at<ne.length;at++){Xe.index>at?(ln=Xe,Xe=null):ln=Xe.sibling;var Vt=ae(Z,Xe,ne[at],xe);if(Vt===null){Xe===null&&(Xe=ln);break}o&&Xe&&Vt.alternate===null&&c(Z,Xe),q=I(Vt,q,at),Rt===null?He=Vt:Rt.sibling=Vt,Rt=Vt,Xe=ln}if(at===ne.length)return f(Z,Xe),Gt&&Pa(Z,at),He;if(Xe===null){for(;at<ne.length;at++)Xe=be(Z,ne[at],xe),Xe!==null&&(q=I(Xe,q,at),Rt===null?He=Xe:Rt.sibling=Xe,Rt=Xe);return Gt&&Pa(Z,at),He}for(Xe=p(Xe);at<ne.length;at++)ln=le(Xe,Z,at,ne[at],xe),ln!==null&&(o&&ln.alternate!==null&&Xe.delete(ln.key===null?at:ln.key),q=I(ln,q,at),Rt===null?He=ln:Rt.sibling=ln,Rt=ln);return o&&Xe.forEach(function(la){return c(Z,la)}),Gt&&Pa(Z,at),He}function st(Z,q,ne,xe){if(ne==null)throw Error(s(151));for(var He=null,Rt=null,Xe=q,at=q=0,ln=null,Vt=ne.next();Xe!==null&&!Vt.done;at++,Vt=ne.next()){Xe.index>at?(ln=Xe,Xe=null):ln=Xe.sibling;var la=ae(Z,Xe,Vt.value,xe);if(la===null){Xe===null&&(Xe=ln);break}o&&Xe&&la.alternate===null&&c(Z,Xe),q=I(la,q,at),Rt===null?He=la:Rt.sibling=la,Rt=la,Xe=ln}if(Vt.done)return f(Z,Xe),Gt&&Pa(Z,at),He;if(Xe===null){for(;!Vt.done;at++,Vt=ne.next())Vt=be(Z,Vt.value,xe),Vt!==null&&(q=I(Vt,q,at),Rt===null?He=Vt:Rt.sibling=Vt,Rt=Vt);return Gt&&Pa(Z,at),He}for(Xe=p(Xe);!Vt.done;at++,Vt=ne.next())Vt=le(Xe,Z,at,Vt.value,xe),Vt!==null&&(o&&Vt.alternate!==null&&Xe.delete(Vt.key===null?at:Vt.key),q=I(Vt,q,at),Rt===null?He=Vt:Rt.sibling=Vt,Rt=Vt);return o&&Xe.forEach(function(GL){return c(Z,GL)}),Gt&&Pa(Z,at),He}function es(Z,q,ne,xe){if(typeof ne=="object"&&ne!==null&&ne.type===S&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case g:e:{for(var He=ne.key;q!==null;){if(q.key===He){if(He=ne.type,He===S){if(q.tag===7){f(Z,q.sibling),xe=b(q,ne.props.children),xe.return=Z,Z=xe;break e}}else if(q.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===k&&kx(He)===q.type){f(Z,q.sibling),xe=b(q,ne.props),tc(xe,ne),xe.return=Z,Z=xe;break e}f(Z,q);break}else c(Z,q);q=q.sibling}ne.type===S?(xe=Oa(ne.props.children,Z.mode,xe,ne.key),xe.return=Z,Z=xe):(xe=Bu(ne.type,ne.key,ne.props,null,Z.mode,xe),tc(xe,ne),xe.return=Z,Z=xe)}return P(Z);case v:e:{for(He=ne.key;q!==null;){if(q.key===He)if(q.tag===4&&q.stateNode.containerInfo===ne.containerInfo&&q.stateNode.implementation===ne.implementation){f(Z,q.sibling),xe=b(q,ne.children||[]),xe.return=Z,Z=xe;break e}else{f(Z,q);break}else c(Z,q);q=q.sibling}xe=Kf(ne,Z.mode,xe),xe.return=Z,Z=xe}return P(Z);case k:return He=ne._init,ne=He(ne._payload),es(Z,q,ne,xe)}if(Q(ne))return lt(Z,q,ne,xe);if(H(ne)){if(He=H(ne),typeof He!="function")throw Error(s(150));return ne=He.call(ne),st(Z,q,ne,xe)}if(typeof ne.then=="function")return es(Z,q,sd(ne),xe);if(ne.$$typeof===R)return es(Z,q,Gu(Z,ne),xe);nd(Z,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint"?(ne=""+ne,q!==null&&q.tag===6?(f(Z,q.sibling),xe=b(q,ne),xe.return=Z,Z=xe):(f(Z,q),xe=zf(ne,Z.mode,xe),xe.return=Z,Z=xe),P(Z)):f(Z,q)}return function(Z,q,ne,xe){try{ec=0;var He=es(Z,q,ne,xe);return Do=null,He}catch(Xe){if(Xe===zl||Xe===zu)throw Xe;var Rt=qn(29,Xe,null,Z.mode);return Rt.lanes=xe,Rt.return=Z,Rt}finally{}}}var Oo=Mx(!0),Ux=Mx(!1),xi=M(null),Qi=null;function Yr(o){var c=o.alternate;G(Ws,Ws.current&1),G(xi,o),Qi===null&&(c===null||Ro.current!==null||c.memoizedState!==null)&&(Qi=o)}function Fx(o){if(o.tag===22){if(G(Ws,Ws.current),G(xi,o),Qi===null){var c=o.alternate;c!==null&&c.memoizedState!==null&&(Qi=o)}}else qr()}function qr(){G(Ws,Ws.current),G(xi,xi.current)}function Er(o){z(xi),Qi===o&&(Qi=null),z(Ws)}var Ws=M(0);function id(o){for(var c=o;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||mp(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Im(o,c,f,p){c=o.memoizedState,f=f(p,c),f=f==null?c:h({},c,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var Rm={enqueueSetState:function(o,c,f){o=o._reactInternals;var p=Zn(),b=Hr(p);b.payload=c,f!=null&&(b.callback=f),c=zr(o,b,p),c!==null&&(Jn(c,o,p),Yl(c,o,p))},enqueueReplaceState:function(o,c,f){o=o._reactInternals;var p=Zn(),b=Hr(p);b.tag=1,b.payload=c,f!=null&&(b.callback=f),c=zr(o,b,p),c!==null&&(Jn(c,o,p),Yl(c,o,p))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var f=Zn(),p=Hr(f);p.tag=2,c!=null&&(p.callback=c),c=zr(o,p,f),c!==null&&(Jn(c,o,f),Yl(c,o,f))}};function Bx(o,c,f,p,b,I,P){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(p,I,P):c.prototype&&c.prototype.isPureReactComponent?!Ul(f,p)||!Ul(b,I):!0}function jx(o,c,f,p){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==o&&Rm.enqueueReplaceState(c,c.state,null)}function ja(o,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(o=o.defaultProps){f===c&&(f=h({},f));for(var b in o)f[b]===void 0&&(f[b]=o[b])}return f}var rd=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function Vx(o){rd(o)}function $x(o){console.error(o)}function Gx(o){rd(o)}function ad(o,c){try{var f=o.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function Hx(o,c,f){try{var p=o.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function wm(o,c,f){return f=Hr(f),f.tag=3,f.payload={element:null},f.callback=function(){ad(o,c)},f}function zx(o){return o=Hr(o),o.tag=3,o}function Kx(o,c,f,p){var b=f.type.getDerivedStateFromError;if(typeof b=="function"){var I=p.value;o.payload=function(){return b(I)},o.callback=function(){Hx(c,f,p)}}var P=f.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(o.callback=function(){Hx(c,f,p),typeof b!="function"&&(ea===null?ea=new Set([this]):ea.add(this));var U=p.stack;this.componentDidCatch(p.value,{componentStack:U!==null?U:""})})}function GC(o,c,f,p,b){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&$l(c,f,b,!0),f=xi.current,f!==null){switch(f.tag){case 13:return Qi===null?Wm():f.alternate===null&&Os===0&&(Os=3),f.flags&=-257,f.flags|=65536,f.lanes=b,p===sm?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),Jm(o,p,b)),!1;case 22:return f.flags|=65536,p===sm?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),Jm(o,p,b)),!1}throw Error(s(435,f.tag))}return Jm(o,p,b),Wm(),!1}if(Gt)return c=xi.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=b,p!==Qf&&(o=Error(s(422),{cause:p}),Vl(pi(o,f)))):(p!==Qf&&(c=Error(s(423),{cause:p}),Vl(pi(c,f))),o=o.current.alternate,o.flags|=65536,b&=-b,o.lanes|=b,p=pi(p,f),b=wm(o.stateNode,p,b),rm(o,b),Os!==4&&(Os=2)),!1;var I=Error(s(520),{cause:p});if(I=pi(I,f),lc===null?lc=[I]:lc.push(I),Os!==4&&(Os=2),c===null)return!0;p=pi(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,o=b&-b,f.lanes|=o,o=wm(f.stateNode,p,o),rm(f,o),!1;case 1:if(c=f.type,I=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(ea===null||!ea.has(I))))return f.flags|=65536,b&=-b,f.lanes|=b,b=zx(b),Kx(b,o,f,p),rm(f,b),!1}f=f.return}while(f!==null);return!1}var Yx=Error(s(461)),an=!1;function hn(o,c,f,p){c.child=o===null?Ux(c,null,f,p):Oo(c,o.child,f,p)}function qx(o,c,f,p,b){f=f.render;var I=c.ref;if("ref"in p){var P={};for(var U in p)U!=="ref"&&(P[U]=p[U])}else P=p;return Ua(c),p=um(o,c,f,P,I,b),U=dm(),o!==null&&!an?(hm(o,c,b),Ar(o,c,b)):(Gt&&U&&Yf(c),c.flags|=1,hn(o,c,p,b),c.child)}function Qx(o,c,f,p,b){if(o===null){var I=f.type;return typeof I=="function"&&!Hf(I)&&I.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=I,Xx(o,c,I,p,b)):(o=Bu(f.type,null,p,c,c.mode,b),o.ref=c.ref,o.return=c,c.child=o)}if(I=o.child,!km(o,b)){var P=I.memoizedProps;if(f=f.compare,f=f!==null?f:Ul,f(P,p)&&o.ref===c.ref)return Ar(o,c,b)}return c.flags|=1,o=yr(I,p),o.ref=c.ref,o.return=c,c.child=o}function Xx(o,c,f,p,b){if(o!==null){var I=o.memoizedProps;if(Ul(I,p)&&o.ref===c.ref)if(an=!1,c.pendingProps=p=I,km(o,b))(o.flags&131072)!==0&&(an=!0);else return c.lanes=o.lanes,Ar(o,c,b)}return Cm(o,c,f,p,b)}function Wx(o,c,f){var p=c.pendingProps,b=p.children,I=o!==null?o.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=I!==null?I.baseLanes|f:f,o!==null){for(b=c.child=o.child,I=0;b!==null;)I=I|b.lanes|b.childLanes,b=b.sibling;c.childLanes=I&~p}else c.childLanes=0,c.child=null;return Zx(o,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},o!==null&&Hu(c,I!==null?I.cachePool:null),I!==null?Xv(c,I):om(),Fx(c);else return c.lanes=c.childLanes=536870912,Zx(o,c,I!==null?I.baseLanes|f:f,f)}else I!==null?(Hu(c,I.cachePool),Xv(c,I),qr(),c.memoizedState=null):(o!==null&&Hu(c,null),om(),qr());return hn(o,c,b,f),c.child}function Zx(o,c,f,p){var b=tm();return b=b===null?null:{parent:Xs._currentValue,pool:b},c.memoizedState={baseLanes:f,cachePool:b},o!==null&&Hu(c,null),om(),Fx(c),o!==null&&$l(o,c,p,!0),null}function od(o,c){var f=c.ref;if(f===null)o!==null&&o.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(s(284));(o===null||o.ref!==f)&&(c.flags|=4194816)}}function Cm(o,c,f,p,b){return Ua(c),f=um(o,c,f,p,void 0,b),p=dm(),o!==null&&!an?(hm(o,c,b),Ar(o,c,b)):(Gt&&p&&Yf(c),c.flags|=1,hn(o,c,f,b),c.child)}function Jx(o,c,f,p,b,I){return Ua(c),c.updateQueue=null,f=Zv(c,p,f,b),Wv(o),p=dm(),o!==null&&!an?(hm(o,c,I),Ar(o,c,I)):(Gt&&p&&Yf(c),c.flags|=1,hn(o,c,f,I),c.child)}function eS(o,c,f,p,b){if(Ua(c),c.stateNode===null){var I=bo,P=f.contextType;typeof P=="object"&&P!==null&&(I=Sn(P)),I=new f(p,I),c.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=Rm,c.stateNode=I,I._reactInternals=c,I=c.stateNode,I.props=p,I.state=c.memoizedState,I.refs={},nm(c),P=f.contextType,I.context=typeof P=="object"&&P!==null?Sn(P):bo,I.state=c.memoizedState,P=f.getDerivedStateFromProps,typeof P=="function"&&(Im(c,f,P,p),I.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(P=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),P!==I.state&&Rm.enqueueReplaceState(I,I.state,null),Ql(c,p,I,b),ql(),I.state=c.memoizedState),typeof I.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(o===null){I=c.stateNode;var U=c.memoizedProps,$=ja(f,U);I.props=$;var ie=I.context,ge=f.contextType;P=bo,typeof ge=="object"&&ge!==null&&(P=Sn(ge));var be=f.getDerivedStateFromProps;ge=typeof be=="function"||typeof I.getSnapshotBeforeUpdate=="function",U=c.pendingProps!==U,ge||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(U||ie!==P)&&jx(c,I,p,P),Gr=!1;var ae=c.memoizedState;I.state=ae,Ql(c,p,I,b),ql(),ie=c.memoizedState,U||ae!==ie||Gr?(typeof be=="function"&&(Im(c,f,be,p),ie=c.memoizedState),($=Gr||Bx(c,f,$,p,ae,ie,P))?(ge||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(c.flags|=4194308)):(typeof I.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=ie),I.props=p,I.state=ie,I.context=P,p=$):(typeof I.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{I=c.stateNode,im(o,c),P=c.memoizedProps,ge=ja(f,P),I.props=ge,be=c.pendingProps,ae=I.context,ie=f.contextType,$=bo,typeof ie=="object"&&ie!==null&&($=Sn(ie)),U=f.getDerivedStateFromProps,(ie=typeof U=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(P!==be||ae!==$)&&jx(c,I,p,$),Gr=!1,ae=c.memoizedState,I.state=ae,Ql(c,p,I,b),ql();var le=c.memoizedState;P!==be||ae!==le||Gr||o!==null&&o.dependencies!==null&&$u(o.dependencies)?(typeof U=="function"&&(Im(c,f,U,p),le=c.memoizedState),(ge=Gr||Bx(c,f,ge,p,ae,le,$)||o!==null&&o.dependencies!==null&&$u(o.dependencies))?(ie||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(p,le,$),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(p,le,$)),typeof I.componentDidUpdate=="function"&&(c.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof I.componentDidUpdate!="function"||P===o.memoizedProps&&ae===o.memoizedState||(c.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&ae===o.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=le),I.props=p,I.state=le,I.context=$,p=ge):(typeof I.componentDidUpdate!="function"||P===o.memoizedProps&&ae===o.memoizedState||(c.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&ae===o.memoizedState||(c.flags|=1024),p=!1)}return I=p,od(o,c),p=(c.flags&128)!==0,I||p?(I=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:I.render(),c.flags|=1,o!==null&&p?(c.child=Oo(c,o.child,null,b),c.child=Oo(c,null,f,b)):hn(o,c,f,b),c.memoizedState=I.state,o=c.child):o=Ar(o,c,b),o}function tS(o,c,f,p){return jl(),c.flags|=256,hn(o,c,f,p),c.child}var Lm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dm(o){return{baseLanes:o,cachePool:$v()}}function Om(o,c,f){return o=o!==null?o.childLanes&~f:0,c&&(o|=Si),o}function sS(o,c,f){var p=c.pendingProps,b=!1,I=(c.flags&128)!==0,P;if((P=I)||(P=o!==null&&o.memoizedState===null?!1:(Ws.current&2)!==0),P&&(b=!0,c.flags&=-129),P=(c.flags&32)!==0,c.flags&=-33,o===null){if(Gt){if(b?Yr(c):qr(),Gt){var U=Ds,$;if($=U){e:{for($=U,U=qi;$.nodeType!==8;){if(!U){U=null;break e}if($=ki($.nextSibling),$===null){U=null;break e}}U=$}U!==null?(c.memoizedState={dehydrated:U,treeContext:_a!==null?{id:vr,overflow:xr}:null,retryLane:536870912,hydrationErrors:null},$=qn(18,null,null,0),$.stateNode=U,$.return=c,c.child=$,Rn=c,Ds=null,$=!0):$=!1}$||ka(c)}if(U=c.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return mp(U)?c.lanes=32:c.lanes=536870912,null;Er(c)}return U=p.children,p=p.fallback,b?(qr(),b=c.mode,U=ld({mode:"hidden",children:U},b),p=Oa(p,b,f,null),U.return=c,p.return=c,U.sibling=p,c.child=U,b=c.child,b.memoizedState=Dm(f),b.childLanes=Om(o,P,f),c.memoizedState=Lm,p):(Yr(c),_m(c,U))}if($=o.memoizedState,$!==null&&(U=$.dehydrated,U!==null)){if(I)c.flags&256?(Yr(c),c.flags&=-257,c=Pm(o,c,f)):c.memoizedState!==null?(qr(),c.child=o.child,c.flags|=128,c=null):(qr(),b=p.fallback,U=c.mode,p=ld({mode:"visible",children:p.children},U),b=Oa(b,U,f,null),b.flags|=2,p.return=c,b.return=c,p.sibling=b,c.child=p,Oo(c,o.child,null,f),p=c.child,p.memoizedState=Dm(f),p.childLanes=Om(o,P,f),c.memoizedState=Lm,c=b);else if(Yr(c),mp(U)){if(P=U.nextSibling&&U.nextSibling.dataset,P)var ie=P.dgst;P=ie,p=Error(s(419)),p.stack="",p.digest=P,Vl({value:p,source:null,stack:null}),c=Pm(o,c,f)}else if(an||$l(o,c,f,!1),P=(f&o.childLanes)!==0,an||P){if(P=cs,P!==null&&(p=f&-f,p=(p&42)!==0?1:ps(p),p=(p&(P.suspendedLanes|f))!==0?0:p,p!==0&&p!==$.retryLane))throw $.retryLane=p,So(o,p),Jn(P,o,p),Yx;U.data==="$?"||Wm(),c=Pm(o,c,f)}else U.data==="$?"?(c.flags|=192,c.child=o.child,c=null):(o=$.treeContext,Ds=ki(U.nextSibling),Rn=c,Gt=!0,Na=null,qi=!1,o!==null&&(yi[vi++]=vr,yi[vi++]=xr,yi[vi++]=_a,vr=o.id,xr=o.overflow,_a=c),c=_m(c,p.children),c.flags|=4096);return c}return b?(qr(),b=p.fallback,U=c.mode,$=o.child,ie=$.sibling,p=yr($,{mode:"hidden",children:p.children}),p.subtreeFlags=$.subtreeFlags&65011712,ie!==null?b=yr(ie,b):(b=Oa(b,U,f,null),b.flags|=2),b.return=c,p.return=c,p.sibling=b,c.child=p,p=b,b=c.child,U=o.child.memoizedState,U===null?U=Dm(f):($=U.cachePool,$!==null?(ie=Xs._currentValue,$=$.parent!==ie?{parent:ie,pool:ie}:$):$=$v(),U={baseLanes:U.baseLanes|f,cachePool:$}),b.memoizedState=U,b.childLanes=Om(o,P,f),c.memoizedState=Lm,p):(Yr(c),f=o.child,o=f.sibling,f=yr(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,o!==null&&(P=c.deletions,P===null?(c.deletions=[o],c.flags|=16):P.push(o)),c.child=f,c.memoizedState=null,f)}function _m(o,c){return c=ld({mode:"visible",children:c},o.mode),c.return=o,o.child=c}function ld(o,c){return o=qn(22,o,null,c),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function Pm(o,c,f){return Oo(c,o.child,null,f),o=_m(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function nS(o,c,f){o.lanes|=c;var p=o.alternate;p!==null&&(p.lanes|=c),Wf(o.return,c,f)}function Nm(o,c,f,p,b){var I=o.memoizedState;I===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:b}:(I.isBackwards=c,I.rendering=null,I.renderingStartTime=0,I.last=p,I.tail=f,I.tailMode=b)}function iS(o,c,f){var p=c.pendingProps,b=p.revealOrder,I=p.tail;if(hn(o,c,p.children,f),p=Ws.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&nS(o,f,c);else if(o.tag===19)nS(o,f,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}p&=1}switch(G(Ws,p),b){case"forwards":for(f=c.child,b=null;f!==null;)o=f.alternate,o!==null&&id(o)===null&&(b=f),f=f.sibling;f=b,f===null?(b=c.child,c.child=null):(b=f.sibling,f.sibling=null),Nm(c,!1,b,f,I);break;case"backwards":for(f=null,b=c.child,c.child=null;b!==null;){if(o=b.alternate,o!==null&&id(o)===null){c.child=b;break}o=b.sibling,b.sibling=f,f=b,b=o}Nm(c,!0,f,null,I);break;case"together":Nm(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Ar(o,c,f){if(o!==null&&(c.dependencies=o.dependencies),Jr|=c.lanes,(f&c.childLanes)===0)if(o!==null){if($l(o,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(o!==null&&c.child!==o.child)throw Error(s(153));if(c.child!==null){for(o=c.child,f=yr(o,o.pendingProps),c.child=f,f.return=c;o.sibling!==null;)o=o.sibling,f=f.sibling=yr(o,o.pendingProps),f.return=c;f.sibling=null}return c.child}function km(o,c){return(o.lanes&c)!==0?!0:(o=o.dependencies,!!(o!==null&&$u(o)))}function HC(o,c,f){switch(c.tag){case 3:ce(c,c.stateNode.containerInfo),$r(c,Xs,o.memoizedState.cache),jl();break;case 27:case 5:Ue(c);break;case 4:ce(c,c.stateNode.containerInfo);break;case 10:$r(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(Yr(c),c.flags|=128,null):(f&c.child.childLanes)!==0?sS(o,c,f):(Yr(c),o=Ar(o,c,f),o!==null?o.sibling:null);Yr(c);break;case 19:var b=(o.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||($l(o,c,f,!1),p=(f&c.childLanes)!==0),b){if(p)return iS(o,c,f);c.flags|=128}if(b=c.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),G(Ws,Ws.current),p)break;return null;case 22:case 23:return c.lanes=0,Wx(o,c,f);case 24:$r(c,Xs,o.memoizedState.cache)}return Ar(o,c,f)}function rS(o,c,f){if(o!==null)if(o.memoizedProps!==c.pendingProps)an=!0;else{if(!km(o,f)&&(c.flags&128)===0)return an=!1,HC(o,c,f);an=(o.flags&131072)!==0}else an=!1,Gt&&(c.flags&1048576)!==0&&kv(c,Vu,c.index);switch(c.lanes=0,c.tag){case 16:e:{o=c.pendingProps;var p=c.elementType,b=p._init;if(p=b(p._payload),c.type=p,typeof p=="function")Hf(p)?(o=ja(p,o),c.tag=1,c=eS(null,c,p,o,f)):(c.tag=0,c=Cm(null,c,p,o,f));else{if(p!=null){if(b=p.$$typeof,b===L){c.tag=11,c=qx(null,c,p,o,f);break e}else if(b===_){c.tag=14,c=Qx(null,c,p,o,f);break e}}throw c=X(p)||p,Error(s(306,c,""))}}return c;case 0:return Cm(o,c,c.type,c.pendingProps,f);case 1:return p=c.type,b=ja(p,c.pendingProps),eS(o,c,p,b,f);case 3:e:{if(ce(c,c.stateNode.containerInfo),o===null)throw Error(s(387));p=c.pendingProps;var I=c.memoizedState;b=I.element,im(o,c),Ql(c,p,null,f);var P=c.memoizedState;if(p=P.cache,$r(c,Xs,p),p!==I.cache&&Zf(c,[Xs],f,!0),ql(),p=P.element,I.isDehydrated)if(I={element:p,isDehydrated:!1,cache:P.cache},c.updateQueue.baseState=I,c.memoizedState=I,c.flags&256){c=tS(o,c,p,f);break e}else if(p!==b){b=pi(Error(s(424)),c),Vl(b),c=tS(o,c,p,f);break e}else{switch(o=c.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Ds=ki(o.firstChild),Rn=c,Gt=!0,Na=null,qi=!0,f=Ux(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(jl(),p===b){c=Ar(o,c,f);break e}hn(o,c,p,f)}c=c.child}return c;case 26:return od(o,c),o===null?(f=c1(c.type,null,c.pendingProps,null))?c.memoizedState=f:Gt||(f=c.type,o=c.pendingProps,p=Td(pe.current).createElement(f),p[Pt]=c,p[jt]=o,mn(p,f,o),tt(p),c.stateNode=p):c.memoizedState=c1(c.type,o.memoizedProps,c.pendingProps,o.memoizedState),null;case 27:return Ue(c),o===null&&Gt&&(p=c.stateNode=a1(c.type,c.pendingProps,pe.current),Rn=c,qi=!0,b=Ds,na(c.type)?(pp=b,Ds=ki(p.firstChild)):Ds=b),hn(o,c,c.pendingProps.children,f),od(o,c),o===null&&(c.flags|=4194304),c.child;case 5:return o===null&&Gt&&((b=p=Ds)&&(p=vL(p,c.type,c.pendingProps,qi),p!==null?(c.stateNode=p,Rn=c,Ds=ki(p.firstChild),qi=!1,b=!0):b=!1),b||ka(c)),Ue(c),b=c.type,I=c.pendingProps,P=o!==null?o.memoizedProps:null,p=I.children,dp(b,I)?p=null:P!==null&&dp(b,P)&&(c.flags|=32),c.memoizedState!==null&&(b=um(o,c,MC,null,null,f),yc._currentValue=b),od(o,c),hn(o,c,p,f),c.child;case 6:return o===null&&Gt&&((o=f=Ds)&&(f=xL(f,c.pendingProps,qi),f!==null?(c.stateNode=f,Rn=c,Ds=null,o=!0):o=!1),o||ka(c)),null;case 13:return sS(o,c,f);case 4:return ce(c,c.stateNode.containerInfo),p=c.pendingProps,o===null?c.child=Oo(c,null,p,f):hn(o,c,p,f),c.child;case 11:return qx(o,c,c.type,c.pendingProps,f);case 7:return hn(o,c,c.pendingProps,f),c.child;case 8:return hn(o,c,c.pendingProps.children,f),c.child;case 12:return hn(o,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,$r(c,c.type,p.value),hn(o,c,p.children,f),c.child;case 9:return b=c.type._context,p=c.pendingProps.children,Ua(c),b=Sn(b),p=p(b),c.flags|=1,hn(o,c,p,f),c.child;case 14:return Qx(o,c,c.type,c.pendingProps,f);case 15:return Xx(o,c,c.type,c.pendingProps,f);case 19:return iS(o,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},o===null?(f=ld(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=yr(o.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return Wx(o,c,f);case 24:return Ua(c),p=Sn(Xs),o===null?(b=tm(),b===null&&(b=cs,I=Jf(),b.pooledCache=I,I.refCount++,I!==null&&(b.pooledCacheLanes|=f),b=I),c.memoizedState={parent:p,cache:b},nm(c),$r(c,Xs,b)):((o.lanes&f)!==0&&(im(o,c),Ql(c,null,null,f),ql()),b=o.memoizedState,I=c.memoizedState,b.parent!==p?(b={parent:p,cache:p},c.memoizedState=b,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=b),$r(c,Xs,p)):(p=I.cache,$r(c,Xs,p),p!==b.cache&&Zf(c,[Xs],f,!0))),hn(o,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(s(156,c.tag))}function Ir(o){o.flags|=4}function aS(o,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!m1(c)){if(c=xi.current,c!==null&&((Ft&4194048)===Ft?Qi!==null:(Ft&62914560)!==Ft&&(Ft&536870912)===0||c!==Qi))throw Kl=sm,Gv;o.flags|=8192}}function cd(o,c){c!==null&&(o.flags|=4),o.flags&16384&&(c=o.tag!==22?dn():536870912,o.lanes|=c,ko|=c)}function sc(o,c){if(!Gt)switch(o.tailMode){case"hidden":c=o.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:p.sibling=null}}function Es(o){var c=o.alternate!==null&&o.alternate.child===o.child,f=0,p=0;if(c)for(var b=o.child;b!==null;)f|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=o,b=b.sibling;else for(b=o.child;b!==null;)f|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=o,b=b.sibling;return o.subtreeFlags|=p,o.childLanes=f,c}function zC(o,c,f){var p=c.pendingProps;switch(qf(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Es(c),null;case 1:return Es(c),null;case 3:return f=c.stateNode,p=null,o!==null&&(p=o.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),br(Xs),Oe(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(Bl(c)?Ir(c):o===null||o.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Fv())),Es(c),null;case 26:return f=c.memoizedState,o===null?(Ir(c),f!==null?(Es(c),aS(c,f)):(Es(c),c.flags&=-16777217)):f?f!==o.memoizedState?(Ir(c),Es(c),aS(c,f)):(Es(c),c.flags&=-16777217):(o.memoizedProps!==p&&Ir(c),Es(c),c.flags&=-16777217),null;case 27:Ze(c),f=pe.current;var b=c.type;if(o!==null&&c.stateNode!=null)o.memoizedProps!==p&&Ir(c);else{if(!p){if(c.stateNode===null)throw Error(s(166));return Es(c),null}o=de.current,Bl(c)?Mv(c):(o=a1(b,p,f),c.stateNode=o,Ir(c))}return Es(c),null;case 5:if(Ze(c),f=c.type,o!==null&&c.stateNode!=null)o.memoizedProps!==p&&Ir(c);else{if(!p){if(c.stateNode===null)throw Error(s(166));return Es(c),null}if(o=de.current,Bl(c))Mv(c);else{switch(b=Td(pe.current),o){case 1:o=b.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:o=b.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":o=b.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":o=b.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":o=b.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof p.is=="string"?b.createElement("select",{is:p.is}):b.createElement("select"),p.multiple?o.multiple=!0:p.size&&(o.size=p.size);break;default:o=typeof p.is=="string"?b.createElement(f,{is:p.is}):b.createElement(f)}}o[Pt]=c,o[jt]=p;e:for(b=c.child;b!==null;){if(b.tag===5||b.tag===6)o.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===c)break e;for(;b.sibling===null;){if(b.return===null||b.return===c)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}c.stateNode=o;e:switch(mn(o,f,p),f){case"button":case"input":case"select":case"textarea":o=!!p.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&Ir(c)}}return Es(c),c.flags&=-16777217,null;case 6:if(o&&c.stateNode!=null)o.memoizedProps!==p&&Ir(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(s(166));if(o=pe.current,Bl(c)){if(o=c.stateNode,f=c.memoizedProps,p=null,b=Rn,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}o[Pt]=c,o=!!(o.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||JS(o.nodeValue,f)),o||ka(c)}else o=Td(o).createTextNode(p),o[Pt]=c,c.stateNode=o}return Es(c),null;case 13:if(p=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(b=Bl(c),p!==null&&p.dehydrated!==null){if(o===null){if(!b)throw Error(s(318));if(b=c.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(s(317));b[Pt]=c}else jl(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Es(c),b=!1}else b=Fv(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=b),b=!0;if(!b)return c.flags&256?(Er(c),c):(Er(c),null)}if(Er(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,o=o!==null&&o.memoizedState!==null,f){p=c.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool);var I=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(I=p.memoizedState.cachePool.pool),I!==b&&(p.flags|=2048)}return f!==o&&f&&(c.child.flags|=8192),cd(c,c.updateQueue),Es(c),null;case 4:return Oe(),o===null&&ap(c.stateNode.containerInfo),Es(c),null;case 10:return br(c.type),Es(c),null;case 19:if(z(Ws),b=c.memoizedState,b===null)return Es(c),null;if(p=(c.flags&128)!==0,I=b.rendering,I===null)if(p)sc(b,!1);else{if(Os!==0||o!==null&&(o.flags&128)!==0)for(o=c.child;o!==null;){if(I=id(o),I!==null){for(c.flags|=128,sc(b,!1),o=I.updateQueue,c.updateQueue=o,cd(c,o),c.subtreeFlags=0,o=f,f=c.child;f!==null;)Nv(f,o),f=f.sibling;return G(Ws,Ws.current&1|2),c.child}o=o.sibling}b.tail!==null&&Je()>hd&&(c.flags|=128,p=!0,sc(b,!1),c.lanes=4194304)}else{if(!p)if(o=id(I),o!==null){if(c.flags|=128,p=!0,o=o.updateQueue,c.updateQueue=o,cd(c,o),sc(b,!0),b.tail===null&&b.tailMode==="hidden"&&!I.alternate&&!Gt)return Es(c),null}else 2*Je()-b.renderingStartTime>hd&&f!==536870912&&(c.flags|=128,p=!0,sc(b,!1),c.lanes=4194304);b.isBackwards?(I.sibling=c.child,c.child=I):(o=b.last,o!==null?o.sibling=I:c.child=I,b.last=I)}return b.tail!==null?(c=b.tail,b.rendering=c,b.tail=c.sibling,b.renderingStartTime=Je(),c.sibling=null,o=Ws.current,G(Ws,p?o&1|2:o&1),c):(Es(c),null);case 22:case 23:return Er(c),lm(),p=c.memoizedState!==null,o!==null?o.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Es(c),c.subtreeFlags&6&&(c.flags|=8192)):Es(c),f=c.updateQueue,f!==null&&cd(c,f.retryQueue),f=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),o!==null&&z(Fa),null;case 24:return f=null,o!==null&&(f=o.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),br(Xs),Es(c),null;case 25:return null;case 30:return null}throw Error(s(156,c.tag))}function KC(o,c){switch(qf(c),c.tag){case 1:return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return br(Xs),Oe(),o=c.flags,(o&65536)!==0&&(o&128)===0?(c.flags=o&-65537|128,c):null;case 26:case 27:case 5:return Ze(c),null;case 13:if(Er(c),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(s(340));jl()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return z(Ws),null;case 4:return Oe(),null;case 10:return br(c.type),null;case 22:case 23:return Er(c),lm(),o!==null&&z(Fa),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 24:return br(Xs),null;case 25:return null;default:return null}}function oS(o,c){switch(qf(c),c.tag){case 3:br(Xs),Oe();break;case 26:case 27:case 5:Ze(c);break;case 4:Oe();break;case 13:Er(c);break;case 19:z(Ws);break;case 10:br(c.type);break;case 22:case 23:Er(c),lm(),o!==null&&z(Fa);break;case 24:br(Xs)}}function nc(o,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var b=p.next;f=b;do{if((f.tag&o)===o){p=void 0;var I=f.create,P=f.inst;p=I(),P.destroy=p}f=f.next}while(f!==b)}}catch(U){is(c,c.return,U)}}function Qr(o,c,f){try{var p=c.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var I=b.next;p=I;do{if((p.tag&o)===o){var P=p.inst,U=P.destroy;if(U!==void 0){P.destroy=void 0,b=c;var $=f,ie=U;try{ie()}catch(ge){is(b,$,ge)}}}p=p.next}while(p!==I)}}catch(ge){is(c,c.return,ge)}}function lS(o){var c=o.updateQueue;if(c!==null){var f=o.stateNode;try{Qv(c,f)}catch(p){is(o,o.return,p)}}}function cS(o,c,f){f.props=ja(o.type,o.memoizedProps),f.state=o.memoizedState;try{f.componentWillUnmount()}catch(p){is(o,c,p)}}function ic(o,c){try{var f=o.ref;if(f!==null){switch(o.tag){case 26:case 27:case 5:var p=o.stateNode;break;case 30:p=o.stateNode;break;default:p=o.stateNode}typeof f=="function"?o.refCleanup=f(p):f.current=p}}catch(b){is(o,c,b)}}function Xi(o,c){var f=o.ref,p=o.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(b){is(o,c,b)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(b){is(o,c,b)}else f.current=null}function uS(o){var c=o.type,f=o.memoizedProps,p=o.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(b){is(o,o.return,b)}}function Mm(o,c,f){try{var p=o.stateNode;fL(p,o.type,f,c),p[jt]=c}catch(b){is(o,o.return,b)}}function dS(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&na(o.type)||o.tag===4}function Um(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||dS(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&na(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Fm(o,c,f){var p=o.tag;if(p===5||p===6)o=o.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(o,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(o),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=bd));else if(p!==4&&(p===27&&na(o.type)&&(f=o.stateNode,c=null),o=o.child,o!==null))for(Fm(o,c,f),o=o.sibling;o!==null;)Fm(o,c,f),o=o.sibling}function ud(o,c,f){var p=o.tag;if(p===5||p===6)o=o.stateNode,c?f.insertBefore(o,c):f.appendChild(o);else if(p!==4&&(p===27&&na(o.type)&&(f=o.stateNode),o=o.child,o!==null))for(ud(o,c,f),o=o.sibling;o!==null;)ud(o,c,f),o=o.sibling}function hS(o){var c=o.stateNode,f=o.memoizedProps;try{for(var p=o.type,b=c.attributes;b.length;)c.removeAttributeNode(b[0]);mn(c,p,f),c[Pt]=o,c[jt]=f}catch(I){is(o,o.return,I)}}var Rr=!1,Bs=!1,Bm=!1,fS=typeof WeakSet=="function"?WeakSet:Set,on=null;function YC(o,c){if(o=o.containerInfo,cp=Cd,o=Av(o),Uf(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var b=p.anchorOffset,I=p.focusNode;p=p.focusOffset;try{f.nodeType,I.nodeType}catch{f=null;break e}var P=0,U=-1,$=-1,ie=0,ge=0,be=o,ae=null;t:for(;;){for(var le;be!==f||b!==0&&be.nodeType!==3||(U=P+b),be!==I||p!==0&&be.nodeType!==3||($=P+p),be.nodeType===3&&(P+=be.nodeValue.length),(le=be.firstChild)!==null;)ae=be,be=le;for(;;){if(be===o)break t;if(ae===f&&++ie===b&&(U=P),ae===I&&++ge===p&&($=P),(le=be.nextSibling)!==null)break;be=ae,ae=be.parentNode}be=le}f=U===-1||$===-1?null:{start:U,end:$}}else f=null}f=f||{start:0,end:0}}else f=null;for(up={focusedElem:o,selectionRange:f},Cd=!1,on=c;on!==null;)if(c=on,o=c.child,(c.subtreeFlags&1024)!==0&&o!==null)o.return=c,on=o;else for(;on!==null;){switch(c=on,I=c.alternate,o=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&I!==null){o=void 0,f=c,b=I.memoizedProps,I=I.memoizedState,p=f.stateNode;try{var lt=ja(f.type,b,f.elementType===f.type);o=p.getSnapshotBeforeUpdate(lt,I),p.__reactInternalSnapshotBeforeUpdate=o}catch(st){is(f,f.return,st)}}break;case 3:if((o&1024)!==0){if(o=c.stateNode.containerInfo,f=o.nodeType,f===9)fp(o);else if(f===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":fp(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(s(163))}if(o=c.sibling,o!==null){o.return=c.return,on=o;break}on=c.return}}function mS(o,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Xr(o,f),p&4&&nc(5,f);break;case 1:if(Xr(o,f),p&4)if(o=f.stateNode,c===null)try{o.componentDidMount()}catch(P){is(f,f.return,P)}else{var b=ja(f.type,c.memoizedProps);c=c.memoizedState;try{o.componentDidUpdate(b,c,o.__reactInternalSnapshotBeforeUpdate)}catch(P){is(f,f.return,P)}}p&64&&lS(f),p&512&&ic(f,f.return);break;case 3:if(Xr(o,f),p&64&&(o=f.updateQueue,o!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{Qv(o,c)}catch(P){is(f,f.return,P)}}break;case 27:c===null&&p&4&&hS(f);case 26:case 5:Xr(o,f),c===null&&p&4&&uS(f),p&512&&ic(f,f.return);break;case 12:Xr(o,f);break;case 13:Xr(o,f),p&4&&yS(o,f),p&64&&(o=f.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(f=sL.bind(null,f),SL(o,f))));break;case 22:if(p=f.memoizedState!==null||Rr,!p){c=c!==null&&c.memoizedState!==null||Bs,b=Rr;var I=Bs;Rr=p,(Bs=c)&&!I?Wr(o,f,(f.subtreeFlags&8772)!==0):Xr(o,f),Rr=b,Bs=I}break;case 30:break;default:Xr(o,f)}}function pS(o){var c=o.alternate;c!==null&&(o.alternate=null,pS(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&wa(c)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var ys=null,kn=!1;function wr(o,c,f){for(f=f.child;f!==null;)gS(o,c,f),f=f.sibling}function gS(o,c,f){if(se&&typeof se.onCommitFiberUnmount=="function")try{se.onCommitFiberUnmount(W,f)}catch{}switch(f.tag){case 26:Bs||Xi(f,c),wr(o,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Bs||Xi(f,c);var p=ys,b=kn;na(f.type)&&(ys=f.stateNode,kn=!1),wr(o,c,f),fc(f.stateNode),ys=p,kn=b;break;case 5:Bs||Xi(f,c);case 6:if(p=ys,b=kn,ys=null,wr(o,c,f),ys=p,kn=b,ys!==null)if(kn)try{(ys.nodeType===9?ys.body:ys.nodeName==="HTML"?ys.ownerDocument.body:ys).removeChild(f.stateNode)}catch(I){is(f,c,I)}else try{ys.removeChild(f.stateNode)}catch(I){is(f,c,I)}break;case 18:ys!==null&&(kn?(o=ys,i1(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,f.stateNode),bc(o)):i1(ys,f.stateNode));break;case 4:p=ys,b=kn,ys=f.stateNode.containerInfo,kn=!0,wr(o,c,f),ys=p,kn=b;break;case 0:case 11:case 14:case 15:Bs||Qr(2,f,c),Bs||Qr(4,f,c),wr(o,c,f);break;case 1:Bs||(Xi(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&cS(f,c,p)),wr(o,c,f);break;case 21:wr(o,c,f);break;case 22:Bs=(p=Bs)||f.memoizedState!==null,wr(o,c,f),Bs=p;break;default:wr(o,c,f)}}function yS(o,c){if(c.memoizedState===null&&(o=c.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{bc(o)}catch(f){is(c,c.return,f)}}function qC(o){switch(o.tag){case 13:case 19:var c=o.stateNode;return c===null&&(c=o.stateNode=new fS),c;case 22:return o=o.stateNode,c=o._retryCache,c===null&&(c=o._retryCache=new fS),c;default:throw Error(s(435,o.tag))}}function jm(o,c){var f=qC(o);c.forEach(function(p){var b=nL.bind(null,o,p);f.has(p)||(f.add(p),p.then(b,b))})}function Qn(o,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var b=f[p],I=o,P=c,U=P;e:for(;U!==null;){switch(U.tag){case 27:if(na(U.type)){ys=U.stateNode,kn=!1;break e}break;case 5:ys=U.stateNode,kn=!1;break e;case 3:case 4:ys=U.stateNode.containerInfo,kn=!0;break e}U=U.return}if(ys===null)throw Error(s(160));gS(I,P,b),ys=null,kn=!1,I=b.alternate,I!==null&&(I.return=null),b.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)vS(c,o),c=c.sibling}var Ni=null;function vS(o,c){var f=o.alternate,p=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Qn(c,o),Xn(o),p&4&&(Qr(3,o,o.return),nc(3,o),Qr(5,o,o.return));break;case 1:Qn(c,o),Xn(o),p&512&&(Bs||f===null||Xi(f,f.return)),p&64&&Rr&&(o=o.updateQueue,o!==null&&(p=o.callbacks,p!==null&&(f=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var b=Ni;if(Qn(c,o),Xn(o),p&512&&(Bs||f===null||Xi(f,f.return)),p&4){var I=f!==null?f.memoizedState:null;if(p=o.memoizedState,f===null)if(p===null)if(o.stateNode===null){e:{p=o.type,f=o.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":I=b.getElementsByTagName("title")[0],(!I||I[rn]||I[Pt]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=b.createElement(p),b.head.insertBefore(I,b.querySelector("head > title"))),mn(I,p,f),I[Pt]=o,tt(I),p=I;break e;case"link":var P=h1("link","href",b).get(p+(f.href||""));if(P){for(var U=0;U<P.length;U++)if(I=P[U],I.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&I.getAttribute("rel")===(f.rel==null?null:f.rel)&&I.getAttribute("title")===(f.title==null?null:f.title)&&I.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){P.splice(U,1);break t}}I=b.createElement(p),mn(I,p,f),b.head.appendChild(I);break;case"meta":if(P=h1("meta","content",b).get(p+(f.content||""))){for(U=0;U<P.length;U++)if(I=P[U],I.getAttribute("content")===(f.content==null?null:""+f.content)&&I.getAttribute("name")===(f.name==null?null:f.name)&&I.getAttribute("property")===(f.property==null?null:f.property)&&I.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&I.getAttribute("charset")===(f.charSet==null?null:f.charSet)){P.splice(U,1);break t}}I=b.createElement(p),mn(I,p,f),b.head.appendChild(I);break;default:throw Error(s(468,p))}I[Pt]=o,tt(I),p=I}o.stateNode=p}else f1(b,o.type,o.stateNode);else o.stateNode=d1(b,p,o.memoizedProps);else I!==p?(I===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):I.count--,p===null?f1(b,o.type,o.stateNode):d1(b,p,o.memoizedProps)):p===null&&o.stateNode!==null&&Mm(o,o.memoizedProps,f.memoizedProps)}break;case 27:Qn(c,o),Xn(o),p&512&&(Bs||f===null||Xi(f,f.return)),f!==null&&p&4&&Mm(o,o.memoizedProps,f.memoizedProps);break;case 5:if(Qn(c,o),Xn(o),p&512&&(Bs||f===null||Xi(f,f.return)),o.flags&32){b=o.stateNode;try{fo(b,"")}catch(le){is(o,o.return,le)}}p&4&&o.stateNode!=null&&(b=o.memoizedProps,Mm(o,b,f!==null?f.memoizedProps:b)),p&1024&&(Bm=!0);break;case 6:if(Qn(c,o),Xn(o),p&4){if(o.stateNode===null)throw Error(s(162));p=o.memoizedProps,f=o.stateNode;try{f.nodeValue=p}catch(le){is(o,o.return,le)}}break;case 3:if(Id=null,b=Ni,Ni=Ed(c.containerInfo),Qn(c,o),Ni=b,Xn(o),p&4&&f!==null&&f.memoizedState.isDehydrated)try{bc(c.containerInfo)}catch(le){is(o,o.return,le)}Bm&&(Bm=!1,xS(o));break;case 4:p=Ni,Ni=Ed(o.stateNode.containerInfo),Qn(c,o),Xn(o),Ni=p;break;case 12:Qn(c,o),Xn(o);break;case 13:Qn(c,o),Xn(o),o.child.flags&8192&&o.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Km=Je()),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,jm(o,p)));break;case 22:b=o.memoizedState!==null;var $=f!==null&&f.memoizedState!==null,ie=Rr,ge=Bs;if(Rr=ie||b,Bs=ge||$,Qn(c,o),Bs=ge,Rr=ie,Xn(o),p&8192)e:for(c=o.stateNode,c._visibility=b?c._visibility&-2:c._visibility|1,b&&(f===null||$||Rr||Bs||Va(o)),f=null,c=o;;){if(c.tag===5||c.tag===26){if(f===null){$=f=c;try{if(I=$.stateNode,b)P=I.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{U=$.stateNode;var be=$.memoizedProps.style,ae=be!=null&&be.hasOwnProperty("display")?be.display:null;U.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(le){is($,$.return,le)}}}else if(c.tag===6){if(f===null){$=c;try{$.stateNode.nodeValue=b?"":$.memoizedProps}catch(le){is($,$.return,le)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===o)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break e;for(;c.sibling===null;){if(c.return===null||c.return===o)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=o.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,jm(o,f))));break;case 19:Qn(c,o),Xn(o),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,jm(o,p)));break;case 30:break;case 21:break;default:Qn(c,o),Xn(o)}}function Xn(o){var c=o.flags;if(c&2){try{for(var f,p=o.return;p!==null;){if(dS(p)){f=p;break}p=p.return}if(f==null)throw Error(s(160));switch(f.tag){case 27:var b=f.stateNode,I=Um(o);ud(o,I,b);break;case 5:var P=f.stateNode;f.flags&32&&(fo(P,""),f.flags&=-33);var U=Um(o);ud(o,U,P);break;case 3:case 4:var $=f.stateNode.containerInfo,ie=Um(o);Fm(o,ie,$);break;default:throw Error(s(161))}}catch(ge){is(o,o.return,ge)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function xS(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var c=o;xS(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),o=o.sibling}}function Xr(o,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)mS(o,c.alternate,c),c=c.sibling}function Va(o){for(o=o.child;o!==null;){var c=o;switch(c.tag){case 0:case 11:case 14:case 15:Qr(4,c,c.return),Va(c);break;case 1:Xi(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&cS(c,c.return,f),Va(c);break;case 27:fc(c.stateNode);case 26:case 5:Xi(c,c.return),Va(c);break;case 22:c.memoizedState===null&&Va(c);break;case 30:Va(c);break;default:Va(c)}o=o.sibling}}function Wr(o,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,b=o,I=c,P=I.flags;switch(I.tag){case 0:case 11:case 15:Wr(b,I,f),nc(4,I);break;case 1:if(Wr(b,I,f),p=I,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ie){is(p,p.return,ie)}if(p=I,b=p.updateQueue,b!==null){var U=p.stateNode;try{var $=b.shared.hiddenCallbacks;if($!==null)for(b.shared.hiddenCallbacks=null,b=0;b<$.length;b++)qv($[b],U)}catch(ie){is(p,p.return,ie)}}f&&P&64&&lS(I),ic(I,I.return);break;case 27:hS(I);case 26:case 5:Wr(b,I,f),f&&p===null&&P&4&&uS(I),ic(I,I.return);break;case 12:Wr(b,I,f);break;case 13:Wr(b,I,f),f&&P&4&&yS(b,I);break;case 22:I.memoizedState===null&&Wr(b,I,f),ic(I,I.return);break;case 30:break;default:Wr(b,I,f)}c=c.sibling}}function Vm(o,c){var f=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),o=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(o=c.memoizedState.cachePool.pool),o!==f&&(o!=null&&o.refCount++,f!=null&&Gl(f))}function $m(o,c){o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&Gl(o))}function Wi(o,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)SS(o,c,f,p),c=c.sibling}function SS(o,c,f,p){var b=c.flags;switch(c.tag){case 0:case 11:case 15:Wi(o,c,f,p),b&2048&&nc(9,c);break;case 1:Wi(o,c,f,p);break;case 3:Wi(o,c,f,p),b&2048&&(o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&Gl(o)));break;case 12:if(b&2048){Wi(o,c,f,p),o=c.stateNode;try{var I=c.memoizedProps,P=I.id,U=I.onPostCommit;typeof U=="function"&&U(P,c.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch($){is(c,c.return,$)}}else Wi(o,c,f,p);break;case 13:Wi(o,c,f,p);break;case 23:break;case 22:I=c.stateNode,P=c.alternate,c.memoizedState!==null?I._visibility&2?Wi(o,c,f,p):rc(o,c):I._visibility&2?Wi(o,c,f,p):(I._visibility|=2,_o(o,c,f,p,(c.subtreeFlags&10256)!==0)),b&2048&&Vm(P,c);break;case 24:Wi(o,c,f,p),b&2048&&$m(c.alternate,c);break;default:Wi(o,c,f,p)}}function _o(o,c,f,p,b){for(b=b&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var I=o,P=c,U=f,$=p,ie=P.flags;switch(P.tag){case 0:case 11:case 15:_o(I,P,U,$,b),nc(8,P);break;case 23:break;case 22:var ge=P.stateNode;P.memoizedState!==null?ge._visibility&2?_o(I,P,U,$,b):rc(I,P):(ge._visibility|=2,_o(I,P,U,$,b)),b&&ie&2048&&Vm(P.alternate,P);break;case 24:_o(I,P,U,$,b),b&&ie&2048&&$m(P.alternate,P);break;default:_o(I,P,U,$,b)}c=c.sibling}}function rc(o,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=o,p=c,b=p.flags;switch(p.tag){case 22:rc(f,p),b&2048&&Vm(p.alternate,p);break;case 24:rc(f,p),b&2048&&$m(p.alternate,p);break;default:rc(f,p)}c=c.sibling}}var ac=8192;function Po(o){if(o.subtreeFlags&ac)for(o=o.child;o!==null;)bS(o),o=o.sibling}function bS(o){switch(o.tag){case 26:Po(o),o.flags&ac&&o.memoizedState!==null&&PL(Ni,o.memoizedState,o.memoizedProps);break;case 5:Po(o);break;case 3:case 4:var c=Ni;Ni=Ed(o.stateNode.containerInfo),Po(o),Ni=c;break;case 22:o.memoizedState===null&&(c=o.alternate,c!==null&&c.memoizedState!==null?(c=ac,ac=16777216,Po(o),ac=c):Po(o));break;default:Po(o)}}function TS(o){var c=o.alternate;if(c!==null&&(o=c.child,o!==null)){c.child=null;do c=o.sibling,o.sibling=null,o=c;while(o!==null)}}function oc(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];on=p,AS(p,o)}TS(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)ES(o),o=o.sibling}function ES(o){switch(o.tag){case 0:case 11:case 15:oc(o),o.flags&2048&&Qr(9,o,o.return);break;case 3:oc(o);break;case 12:oc(o);break;case 22:var c=o.stateNode;o.memoizedState!==null&&c._visibility&2&&(o.return===null||o.return.tag!==13)?(c._visibility&=-3,dd(o)):oc(o);break;default:oc(o)}}function dd(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];on=p,AS(p,o)}TS(o)}for(o=o.child;o!==null;){switch(c=o,c.tag){case 0:case 11:case 15:Qr(8,c,c.return),dd(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,dd(c));break;default:dd(c)}o=o.sibling}}function AS(o,c){for(;on!==null;){var f=on;switch(f.tag){case 0:case 11:case 15:Qr(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Gl(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,on=p;else e:for(f=o;on!==null;){p=on;var b=p.sibling,I=p.return;if(pS(p),p===f){on=null;break e}if(b!==null){b.return=I,on=b;break e}on=I}}}var QC={getCacheForType:function(o){var c=Sn(Xs),f=c.data.get(o);return f===void 0&&(f=o(),c.data.set(o,f)),f}},XC=typeof WeakMap=="function"?WeakMap:Map,qt=0,cs=null,Ct=null,Ft=0,Qt=0,Wn=null,Zr=!1,No=!1,Gm=!1,Cr=0,Os=0,Jr=0,$a=0,Hm=0,Si=0,ko=0,lc=null,Mn=null,zm=!1,Km=0,hd=1/0,fd=null,ea=null,fn=0,ta=null,Mo=null,Uo=0,Ym=0,qm=null,IS=null,cc=0,Qm=null;function Zn(){if((qt&2)!==0&&Ft!==0)return Ft&-Ft;if(j.T!==null){var o=Ao;return o!==0?o:sp()}return Ms()}function RS(){Si===0&&(Si=(Ft&536870912)===0||Gt?$s():536870912);var o=xi.current;return o!==null&&(o.flags|=32),Si}function Jn(o,c,f){(o===cs&&(Qt===2||Qt===9)||o.cancelPendingCommit!==null)&&(Fo(o,0),sa(o,Ft,Si,!1)),rt(o,f),((qt&2)===0||o!==cs)&&(o===cs&&((qt&2)===0&&($a|=f),Os===4&&sa(o,Ft,Si,!1)),Zi(o))}function wS(o,c,f){if((qt&6)!==0)throw Error(s(327));var p=!f&&(c&124)===0&&(c&o.expiredLanes)===0||ds(o,c),b=p?JC(o,c):Zm(o,c,!0),I=p;do{if(b===0){No&&!p&&sa(o,c,0,!1);break}else{if(f=o.current.alternate,I&&!WC(f)){b=Zm(o,c,!1),I=!1;continue}if(b===2){if(I=c,o.errorRecoveryDisabledLanes&I)var P=0;else P=o.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){c=P;e:{var U=o;b=lc;var $=U.current.memoizedState.isDehydrated;if($&&(Fo(U,P).flags|=256),P=Zm(U,P,!1),P!==2){if(Gm&&!$){U.errorRecoveryDisabledLanes|=I,$a|=I,b=4;break e}I=Mn,Mn=b,I!==null&&(Mn===null?Mn=I:Mn.push.apply(Mn,I))}b=P}if(I=!1,b!==2)continue}}if(b===1){Fo(o,0),sa(o,c,0,!0);break}e:{switch(p=o,I=b,I){case 0:case 1:throw Error(s(345));case 4:if((c&4194048)!==c)break;case 6:sa(p,c,Si,!Zr);break e;case 2:Mn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((c&62914560)===c&&(b=Km+300-Je(),10<b)){if(sa(p,c,Si,!Zr),Ss(p,0,!0)!==0)break e;p.timeoutHandle=s1(CS.bind(null,p,f,Mn,fd,zm,c,Si,$a,ko,Zr,I,2,-0,0),b);break e}CS(p,f,Mn,fd,zm,c,Si,$a,ko,Zr,I,0,-0,0)}}break}while(!0);Zi(o)}function CS(o,c,f,p,b,I,P,U,$,ie,ge,be,ae,le){if(o.timeoutHandle=-1,be=c.subtreeFlags,(be&8192||(be&16785408)===16785408)&&(gc={stylesheets:null,count:0,unsuspend:_L},bS(c),be=NL(),be!==null)){o.cancelPendingCommit=be(kS.bind(null,o,c,I,f,p,b,P,U,$,ge,1,ae,le)),sa(o,I,P,!ie);return}kS(o,c,I,f,p,b,P,U,$)}function WC(o){for(var c=o;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var b=f[p],I=b.getSnapshot;b=b.value;try{if(!Yn(I(),b))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function sa(o,c,f,p){c&=~Hm,c&=~$a,o.suspendedLanes|=c,o.pingedLanes&=~c,p&&(o.warmLanes|=c),p=o.expirationTimes;for(var b=c;0<b;){var I=31-he(b),P=1<<I;p[I]=-1,b&=~P}f!==0&&bs(o,f,c)}function md(){return(qt&6)===0?(uc(0),!1):!0}function Xm(){if(Ct!==null){if(Qt===0)var o=Ct.return;else o=Ct,Sr=Ma=null,fm(o),Do=null,ec=0,o=Ct;for(;o!==null;)oS(o.alternate,o),o=o.return;Ct=null}}function Fo(o,c){var f=o.timeoutHandle;f!==-1&&(o.timeoutHandle=-1,pL(f)),f=o.cancelPendingCommit,f!==null&&(o.cancelPendingCommit=null,f()),Xm(),cs=o,Ct=f=yr(o.current,null),Ft=c,Qt=0,Wn=null,Zr=!1,No=ds(o,c),Gm=!1,ko=Si=Hm=$a=Jr=Os=0,Mn=lc=null,zm=!1,(c&8)!==0&&(c|=c&32);var p=o.entangledLanes;if(p!==0)for(o=o.entanglements,p&=c;0<p;){var b=31-he(p),I=1<<b;c|=o[b],p&=~I}return Cr=c,Mu(),f}function LS(o,c){Tt=null,j.H=td,c===zl||c===zu?(c=Kv(),Qt=3):c===Gv?(c=Kv(),Qt=4):Qt=c===Yx?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Wn=c,Ct===null&&(Os=1,ad(o,pi(c,o.current)))}function DS(){var o=j.H;return j.H=td,o===null?td:o}function OS(){var o=j.A;return j.A=QC,o}function Wm(){Os=4,Zr||(Ft&4194048)!==Ft&&xi.current!==null||(No=!0),(Jr&134217727)===0&&($a&134217727)===0||cs===null||sa(cs,Ft,Si,!1)}function Zm(o,c,f){var p=qt;qt|=2;var b=DS(),I=OS();(cs!==o||Ft!==c)&&(fd=null,Fo(o,c)),c=!1;var P=Os;e:do try{if(Qt!==0&&Ct!==null){var U=Ct,$=Wn;switch(Qt){case 8:Xm(),P=6;break e;case 3:case 2:case 9:case 6:xi.current===null&&(c=!0);var ie=Qt;if(Qt=0,Wn=null,Bo(o,U,$,ie),f&&No){P=0;break e}break;default:ie=Qt,Qt=0,Wn=null,Bo(o,U,$,ie)}}ZC(),P=Os;break}catch(ge){LS(o,ge)}while(!0);return c&&o.shellSuspendCounter++,Sr=Ma=null,qt=p,j.H=b,j.A=I,Ct===null&&(cs=null,Ft=0,Mu()),P}function ZC(){for(;Ct!==null;)_S(Ct)}function JC(o,c){var f=qt;qt|=2;var p=DS(),b=OS();cs!==o||Ft!==c?(fd=null,hd=Je()+500,Fo(o,c)):No=ds(o,c);e:do try{if(Qt!==0&&Ct!==null){c=Ct;var I=Wn;t:switch(Qt){case 1:Qt=0,Wn=null,Bo(o,c,I,1);break;case 2:case 9:if(Hv(I)){Qt=0,Wn=null,PS(c);break}c=function(){Qt!==2&&Qt!==9||cs!==o||(Qt=7),Zi(o)},I.then(c,c);break e;case 3:Qt=7;break e;case 4:Qt=5;break e;case 7:Hv(I)?(Qt=0,Wn=null,PS(c)):(Qt=0,Wn=null,Bo(o,c,I,7));break;case 5:var P=null;switch(Ct.tag){case 26:P=Ct.memoizedState;case 5:case 27:var U=Ct;if(!P||m1(P)){Qt=0,Wn=null;var $=U.sibling;if($!==null)Ct=$;else{var ie=U.return;ie!==null?(Ct=ie,pd(ie)):Ct=null}break t}}Qt=0,Wn=null,Bo(o,c,I,5);break;case 6:Qt=0,Wn=null,Bo(o,c,I,6);break;case 8:Xm(),Os=6;break e;default:throw Error(s(462))}}eL();break}catch(ge){LS(o,ge)}while(!0);return Sr=Ma=null,j.H=p,j.A=b,qt=f,Ct!==null?0:(cs=null,Ft=0,Mu(),Os)}function eL(){for(;Ct!==null&&!Ot();)_S(Ct)}function _S(o){var c=rS(o.alternate,o,Cr);o.memoizedProps=o.pendingProps,c===null?pd(o):Ct=c}function PS(o){var c=o,f=c.alternate;switch(c.tag){case 15:case 0:c=Jx(f,c,c.pendingProps,c.type,void 0,Ft);break;case 11:c=Jx(f,c,c.pendingProps,c.type.render,c.ref,Ft);break;case 5:fm(c);default:oS(f,c),c=Ct=Nv(c,Cr),c=rS(f,c,Cr)}o.memoizedProps=o.pendingProps,c===null?pd(o):Ct=c}function Bo(o,c,f,p){Sr=Ma=null,fm(c),Do=null,ec=0;var b=c.return;try{if(GC(o,b,c,f,Ft)){Os=1,ad(o,pi(f,o.current)),Ct=null;return}}catch(I){if(b!==null)throw Ct=b,I;Os=1,ad(o,pi(f,o.current)),Ct=null;return}c.flags&32768?(Gt||p===1?o=!0:No||(Ft&536870912)!==0?o=!1:(Zr=o=!0,(p===2||p===9||p===3||p===6)&&(p=xi.current,p!==null&&p.tag===13&&(p.flags|=16384))),NS(c,o)):pd(c)}function pd(o){var c=o;do{if((c.flags&32768)!==0){NS(c,Zr);return}o=c.return;var f=zC(c.alternate,c,Cr);if(f!==null){Ct=f;return}if(c=c.sibling,c!==null){Ct=c;return}Ct=c=o}while(c!==null);Os===0&&(Os=5)}function NS(o,c){do{var f=KC(o.alternate,o);if(f!==null){f.flags&=32767,Ct=f;return}if(f=o.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(o=o.sibling,o!==null)){Ct=o;return}Ct=o=f}while(o!==null);Os=6,Ct=null}function kS(o,c,f,p,b,I,P,U,$){o.cancelPendingCommit=null;do gd();while(fn!==0);if((qt&6)!==0)throw Error(s(327));if(c!==null){if(c===o.current)throw Error(s(177));if(I=c.lanes|c.childLanes,I|=$f,ns(o,f,I,P,U,$),o===cs&&(Ct=cs=null,Ft=0),Mo=c,ta=o,Uo=f,Ym=I,qm=b,IS=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,iL(fe,function(){return jS(),null})):(o.callbackNode=null,o.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=j.T,j.T=null,b=K.p,K.p=2,P=qt,qt|=4;try{YC(o,c,f)}finally{qt=P,K.p=b,j.T=p}}fn=1,MS(),US(),FS()}}function MS(){if(fn===1){fn=0;var o=ta,c=Mo,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=j.T,j.T=null;var p=K.p;K.p=2;var b=qt;qt|=4;try{vS(c,o);var I=up,P=Av(o.containerInfo),U=I.focusedElem,$=I.selectionRange;if(P!==U&&U&&U.ownerDocument&&Ev(U.ownerDocument.documentElement,U)){if($!==null&&Uf(U)){var ie=$.start,ge=$.end;if(ge===void 0&&(ge=ie),"selectionStart"in U)U.selectionStart=ie,U.selectionEnd=Math.min(ge,U.value.length);else{var be=U.ownerDocument||document,ae=be&&be.defaultView||window;if(ae.getSelection){var le=ae.getSelection(),lt=U.textContent.length,st=Math.min($.start,lt),es=$.end===void 0?st:Math.min($.end,lt);!le.extend&&st>es&&(P=es,es=st,st=P);var Z=Tv(U,st),q=Tv(U,es);if(Z&&q&&(le.rangeCount!==1||le.anchorNode!==Z.node||le.anchorOffset!==Z.offset||le.focusNode!==q.node||le.focusOffset!==q.offset)){var ne=be.createRange();ne.setStart(Z.node,Z.offset),le.removeAllRanges(),st>es?(le.addRange(ne),le.extend(q.node,q.offset)):(ne.setEnd(q.node,q.offset),le.addRange(ne))}}}}for(be=[],le=U;le=le.parentNode;)le.nodeType===1&&be.push({element:le,left:le.scrollLeft,top:le.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<be.length;U++){var xe=be[U];xe.element.scrollLeft=xe.left,xe.element.scrollTop=xe.top}}Cd=!!cp,up=cp=null}finally{qt=b,K.p=p,j.T=f}}o.current=c,fn=2}}function US(){if(fn===2){fn=0;var o=ta,c=Mo,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=j.T,j.T=null;var p=K.p;K.p=2;var b=qt;qt|=4;try{mS(o,c.alternate,c)}finally{qt=b,K.p=p,j.T=f}}fn=3}}function FS(){if(fn===4||fn===3){fn=0,ke();var o=ta,c=Mo,f=Uo,p=IS;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?fn=5:(fn=0,Mo=ta=null,BS(o,o.pendingLanes));var b=o.pendingLanes;if(b===0&&(ea=null),gs(f),c=c.stateNode,se&&typeof se.onCommitFiberRoot=="function")try{se.onCommitFiberRoot(W,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=j.T,b=K.p,K.p=2,j.T=null;try{for(var I=o.onRecoverableError,P=0;P<p.length;P++){var U=p[P];I(U.value,{componentStack:U.stack})}}finally{j.T=c,K.p=b}}(Uo&3)!==0&&gd(),Zi(o),b=o.pendingLanes,(f&4194090)!==0&&(b&42)!==0?o===Qm?cc++:(cc=0,Qm=o):cc=0,uc(0)}}function BS(o,c){(o.pooledCacheLanes&=c)===0&&(c=o.pooledCache,c!=null&&(o.pooledCache=null,Gl(c)))}function gd(o){return MS(),US(),FS(),jS()}function jS(){if(fn!==5)return!1;var o=ta,c=Ym;Ym=0;var f=gs(Uo),p=j.T,b=K.p;try{K.p=32>f?32:f,j.T=null,f=qm,qm=null;var I=ta,P=Uo;if(fn=0,Mo=ta=null,Uo=0,(qt&6)!==0)throw Error(s(331));var U=qt;if(qt|=4,ES(I.current),SS(I,I.current,P,f),qt=U,uc(0,!1),se&&typeof se.onPostCommitFiberRoot=="function")try{se.onPostCommitFiberRoot(W,I)}catch{}return!0}finally{K.p=b,j.T=p,BS(o,c)}}function VS(o,c,f){c=pi(f,c),c=wm(o.stateNode,c,2),o=zr(o,c,2),o!==null&&(rt(o,2),Zi(o))}function is(o,c,f){if(o.tag===3)VS(o,o,f);else for(;c!==null;){if(c.tag===3){VS(c,o,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ea===null||!ea.has(p))){o=pi(f,o),f=zx(2),p=zr(c,f,2),p!==null&&(Kx(f,p,c,o),rt(p,2),Zi(p));break}}c=c.return}}function Jm(o,c,f){var p=o.pingCache;if(p===null){p=o.pingCache=new XC;var b=new Set;p.set(c,b)}else b=p.get(c),b===void 0&&(b=new Set,p.set(c,b));b.has(f)||(Gm=!0,b.add(f),o=tL.bind(null,o,c,f),c.then(o,o))}function tL(o,c,f){var p=o.pingCache;p!==null&&p.delete(c),o.pingedLanes|=o.suspendedLanes&f,o.warmLanes&=~f,cs===o&&(Ft&f)===f&&(Os===4||Os===3&&(Ft&62914560)===Ft&&300>Je()-Km?(qt&2)===0&&Fo(o,0):Hm|=f,ko===Ft&&(ko=0)),Zi(o)}function $S(o,c){c===0&&(c=dn()),o=So(o,c),o!==null&&(rt(o,c),Zi(o))}function sL(o){var c=o.memoizedState,f=0;c!==null&&(f=c.retryLane),$S(o,f)}function nL(o,c){var f=0;switch(o.tag){case 13:var p=o.stateNode,b=o.memoizedState;b!==null&&(f=b.retryLane);break;case 19:p=o.stateNode;break;case 22:p=o.stateNode._retryCache;break;default:throw Error(s(314))}p!==null&&p.delete(c),$S(o,f)}function iL(o,c){return Dt(o,c)}var yd=null,jo=null,ep=!1,vd=!1,tp=!1,Ga=0;function Zi(o){o!==jo&&o.next===null&&(jo===null?yd=jo=o:jo=jo.next=o),vd=!0,ep||(ep=!0,aL())}function uc(o,c){if(!tp&&vd){tp=!0;do for(var f=!1,p=yd;p!==null;){if(o!==0){var b=p.pendingLanes;if(b===0)var I=0;else{var P=p.suspendedLanes,U=p.pingedLanes;I=(1<<31-he(42|o)+1)-1,I&=b&~(P&~U),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(f=!0,KS(p,I))}else I=Ft,I=Ss(p,p===cs?I:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(I&3)===0||ds(p,I)||(f=!0,KS(p,I));p=p.next}while(f);tp=!1}}function rL(){GS()}function GS(){vd=ep=!1;var o=0;Ga!==0&&(mL()&&(o=Ga),Ga=0);for(var c=Je(),f=null,p=yd;p!==null;){var b=p.next,I=HS(p,c);I===0?(p.next=null,f===null?yd=b:f.next=b,b===null&&(jo=f)):(f=p,(o!==0||(I&3)!==0)&&(vd=!0)),p=b}uc(o)}function HS(o,c){for(var f=o.suspendedLanes,p=o.pingedLanes,b=o.expirationTimes,I=o.pendingLanes&-62914561;0<I;){var P=31-he(I),U=1<<P,$=b[P];$===-1?((U&f)===0||(U&p)!==0)&&(b[P]=Vs(U,c)):$<=c&&(o.expiredLanes|=U),I&=~U}if(c=cs,f=Ft,f=Ss(o,o===c?f:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p=o.callbackNode,f===0||o===c&&(Qt===2||Qt===9)||o.cancelPendingCommit!==null)return p!==null&&p!==null&&Nt(p),o.callbackNode=null,o.callbackPriority=0;if((f&3)===0||ds(o,f)){if(c=f&-f,c===o.callbackPriority)return c;switch(p!==null&&Nt(p),gs(f)){case 2:case 8:f=vt;break;case 32:f=fe;break;case 268435456:f=Ve;break;default:f=fe}return p=zS.bind(null,o),f=Dt(f,p),o.callbackPriority=c,o.callbackNode=f,c}return p!==null&&p!==null&&Nt(p),o.callbackPriority=2,o.callbackNode=null,2}function zS(o,c){if(fn!==0&&fn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var f=o.callbackNode;if(gd()&&o.callbackNode!==f)return null;var p=Ft;return p=Ss(o,o===cs?p:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p===0?null:(wS(o,p,c),HS(o,Je()),o.callbackNode!=null&&o.callbackNode===f?zS.bind(null,o):null)}function KS(o,c){if(gd())return null;wS(o,c,!0)}function aL(){gL(function(){(qt&6)!==0?Dt(kt,rL):GS()})}function sp(){return Ga===0&&(Ga=$s()),Ga}function YS(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Lu(""+o)}function qS(o,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,o.id&&f.setAttribute("form",o.id),c.parentNode.insertBefore(f,c),o=new FormData(o),f.parentNode.removeChild(f),o}function oL(o,c,f,p,b){if(c==="submit"&&f&&f.stateNode===b){var I=YS((b[jt]||null).action),P=p.submitter;P&&(c=(c=P[jt]||null)?YS(c.formAction):P.getAttribute("formAction"),c!==null&&(I=c,P=null));var U=new Pu("action","action",null,p,b);o.push({event:U,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ga!==0){var $=P?qS(b,P):new FormData(b);Tm(f,{pending:!0,data:$,method:b.method,action:I},null,$)}}else typeof I=="function"&&(U.preventDefault(),$=P?qS(b,P):new FormData(b),Tm(f,{pending:!0,data:$,method:b.method,action:I},I,$))},currentTarget:b}]})}}for(var np=0;np<Vf.length;np++){var ip=Vf[np],lL=ip.toLowerCase(),cL=ip[0].toUpperCase()+ip.slice(1);Pi(lL,"on"+cL)}Pi(wv,"onAnimationEnd"),Pi(Cv,"onAnimationIteration"),Pi(Lv,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(RC,"onTransitionRun"),Pi(wC,"onTransitionStart"),Pi(CC,"onTransitionCancel"),Pi(Dv,"onTransitionEnd"),Ls("onMouseEnter",["mouseout","mouseover"]),Ls("onMouseLeave",["mouseout","mouseover"]),Ls("onPointerEnter",["pointerout","pointerover"]),Ls("onPointerLeave",["pointerout","pointerover"]),Us("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Us("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Us("onBeforeInput",["compositionend","keypress","textInput","paste"]),Us("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Us("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Us("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(dc));function QS(o,c){c=(c&4)!==0;for(var f=0;f<o.length;f++){var p=o[f],b=p.event;p=p.listeners;e:{var I=void 0;if(c)for(var P=p.length-1;0<=P;P--){var U=p[P],$=U.instance,ie=U.currentTarget;if(U=U.listener,$!==I&&b.isPropagationStopped())break e;I=U,b.currentTarget=ie;try{I(b)}catch(ge){rd(ge)}b.currentTarget=null,I=$}else for(P=0;P<p.length;P++){if(U=p[P],$=U.instance,ie=U.currentTarget,U=U.listener,$!==I&&b.isPropagationStopped())break e;I=U,b.currentTarget=ie;try{I(b)}catch(ge){rd(ge)}b.currentTarget=null,I=$}}}}function Lt(o,c){var f=c[ws];f===void 0&&(f=c[ws]=new Set);var p=o+"__bubble";f.has(p)||(XS(c,o,2,!1),f.add(p))}function rp(o,c,f){var p=0;c&&(p|=4),XS(f,o,p,c)}var xd="_reactListening"+Math.random().toString(36).slice(2);function ap(o){if(!o[xd]){o[xd]=!0,bt.forEach(function(f){f!=="selectionchange"&&(uL.has(f)||rp(f,!1,o),rp(f,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[xd]||(c[xd]=!0,rp("selectionchange",!1,c))}}function XS(o,c,f,p){switch(S1(c)){case 2:var b=UL;break;case 8:b=FL;break;default:b=Sp}f=b.bind(null,c,f,o),b=void 0,!Cf||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(b=!0),p?b!==void 0?o.addEventListener(c,f,{capture:!0,passive:b}):o.addEventListener(c,f,!0):b!==void 0?o.addEventListener(c,f,{passive:b}):o.addEventListener(c,f,!1)}function op(o,c,f,p,b){var I=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var P=p.tag;if(P===3||P===4){var U=p.stateNode.containerInfo;if(U===b)break;if(P===4)for(P=p.return;P!==null;){var $=P.tag;if(($===3||$===4)&&P.stateNode.containerInfo===b)return;P=P.return}for(;U!==null;){if(P=Ki(U),P===null)return;if($=P.tag,$===5||$===6||$===26||$===27){p=I=P;continue e}U=U.parentNode}}p=p.return}nv(function(){var ie=I,ge=Rf(f),be=[];e:{var ae=Ov.get(o);if(ae!==void 0){var le=Pu,lt=o;switch(o){case"keypress":if(Ou(f)===0)break e;case"keydown":case"keyup":le=iC;break;case"focusin":lt="focus",le=_f;break;case"focusout":lt="blur",le=_f;break;case"beforeblur":case"afterblur":le=_f;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":le=av;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":le=Kw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":le=oC;break;case wv:case Cv:case Lv:le=Qw;break;case Dv:le=cC;break;case"scroll":case"scrollend":le=Hw;break;case"wheel":le=dC;break;case"copy":case"cut":case"paste":le=Ww;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":le=lv;break;case"toggle":case"beforetoggle":le=fC}var st=(c&4)!==0,es=!st&&(o==="scroll"||o==="scrollend"),Z=st?ae!==null?ae+"Capture":null:ae;st=[];for(var q=ie,ne;q!==null;){var xe=q;if(ne=xe.stateNode,xe=xe.tag,xe!==5&&xe!==26&&xe!==27||ne===null||Z===null||(xe=Dl(q,Z),xe!=null&&st.push(hc(q,xe,ne))),es)break;q=q.return}0<st.length&&(ae=new le(ae,lt,null,f,ge),be.push({event:ae,listeners:st}))}}if((c&7)===0){e:{if(ae=o==="mouseover"||o==="pointerover",le=o==="mouseout"||o==="pointerout",ae&&f!==If&&(lt=f.relatedTarget||f.fromElement)&&(Ki(lt)||lt[zt]))break e;if((le||ae)&&(ae=ge.window===ge?ge:(ae=ge.ownerDocument)?ae.defaultView||ae.parentWindow:window,le?(lt=f.relatedTarget||f.toElement,le=ie,lt=lt?Ki(lt):null,lt!==null&&(es=r(lt),st=lt.tag,lt!==es||st!==5&&st!==27&&st!==6)&&(lt=null)):(le=null,lt=ie),le!==lt)){if(st=av,xe="onMouseLeave",Z="onMouseEnter",q="mouse",(o==="pointerout"||o==="pointerover")&&(st=lv,xe="onPointerLeave",Z="onPointerEnter",q="pointer"),es=le==null?ae:oe(le),ne=lt==null?ae:oe(lt),ae=new st(xe,q+"leave",le,f,ge),ae.target=es,ae.relatedTarget=ne,xe=null,Ki(ge)===ie&&(st=new st(Z,q+"enter",lt,f,ge),st.target=ne,st.relatedTarget=es,xe=st),es=xe,le&&lt)t:{for(st=le,Z=lt,q=0,ne=st;ne;ne=Vo(ne))q++;for(ne=0,xe=Z;xe;xe=Vo(xe))ne++;for(;0<q-ne;)st=Vo(st),q--;for(;0<ne-q;)Z=Vo(Z),ne--;for(;q--;){if(st===Z||Z!==null&&st===Z.alternate)break t;st=Vo(st),Z=Vo(Z)}st=null}else st=null;le!==null&&WS(be,ae,le,st,!1),lt!==null&&es!==null&&WS(be,es,lt,st,!0)}}e:{if(ae=ie?oe(ie):window,le=ae.nodeName&&ae.nodeName.toLowerCase(),le==="select"||le==="input"&&ae.type==="file")var He=gv;else if(mv(ae))if(yv)He=EC;else{He=bC;var Rt=SC}else le=ae.nodeName,!le||le.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?ie&&Af(ie.elementType)&&(He=gv):He=TC;if(He&&(He=He(o,ie))){pv(be,He,f,ge);break e}Rt&&Rt(o,ae,ie),o==="focusout"&&ie&&ae.type==="number"&&ie.memoizedProps.value!=null&&Ef(ae,"number",ae.value)}switch(Rt=ie?oe(ie):window,o){case"focusin":(mv(Rt)||Rt.contentEditable==="true")&&(yo=Rt,Ff=ie,Fl=null);break;case"focusout":Fl=Ff=yo=null;break;case"mousedown":Bf=!0;break;case"contextmenu":case"mouseup":case"dragend":Bf=!1,Iv(be,f,ge);break;case"selectionchange":if(IC)break;case"keydown":case"keyup":Iv(be,f,ge)}var Xe;if(Nf)e:{switch(o){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else go?hv(o,f)&&(at="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(at="onCompositionStart");at&&(cv&&f.locale!=="ko"&&(go||at!=="onCompositionStart"?at==="onCompositionEnd"&&go&&(Xe=iv()):(Vr=ge,Lf="value"in Vr?Vr.value:Vr.textContent,go=!0)),Rt=Sd(ie,at),0<Rt.length&&(at=new ov(at,o,null,f,ge),be.push({event:at,listeners:Rt}),Xe?at.data=Xe:(Xe=fv(f),Xe!==null&&(at.data=Xe)))),(Xe=pC?gC(o,f):yC(o,f))&&(at=Sd(ie,"onBeforeInput"),0<at.length&&(Rt=new ov("onBeforeInput","beforeinput",null,f,ge),be.push({event:Rt,listeners:at}),Rt.data=Xe)),oL(be,o,ie,f,ge)}QS(be,c)})}function hc(o,c,f){return{instance:o,listener:c,currentTarget:f}}function Sd(o,c){for(var f=c+"Capture",p=[];o!==null;){var b=o,I=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||I===null||(b=Dl(o,f),b!=null&&p.unshift(hc(o,b,I)),b=Dl(o,c),b!=null&&p.push(hc(o,b,I))),o.tag===3)return p;o=o.return}return[]}function Vo(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function WS(o,c,f,p,b){for(var I=c._reactName,P=[];f!==null&&f!==p;){var U=f,$=U.alternate,ie=U.stateNode;if(U=U.tag,$!==null&&$===p)break;U!==5&&U!==26&&U!==27||ie===null||($=ie,b?(ie=Dl(f,I),ie!=null&&P.unshift(hc(f,ie,$))):b||(ie=Dl(f,I),ie!=null&&P.push(hc(f,ie,$)))),f=f.return}P.length!==0&&o.push({event:c,listeners:P})}var dL=/\r\n?/g,hL=/\u0000|\uFFFD/g;function ZS(o){return(typeof o=="string"?o:""+o).replace(dL,`
`).replace(hL,"")}function JS(o,c){return c=ZS(c),ZS(o)===c}function bd(){}function Jt(o,c,f,p,b,I){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||fo(o,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&fo(o,""+p);break;case"className":co(o,"class",p);break;case"tabIndex":co(o,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":co(o,f,p);break;case"style":tv(o,p,I);break;case"data":if(c!=="object"){co(o,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){o.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(f);break}p=Lu(""+p),o.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){o.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(f==="formAction"?(c!=="input"&&Jt(o,c,"name",b.name,b,null),Jt(o,c,"formEncType",b.formEncType,b,null),Jt(o,c,"formMethod",b.formMethod,b,null),Jt(o,c,"formTarget",b.formTarget,b,null)):(Jt(o,c,"encType",b.encType,b,null),Jt(o,c,"method",b.method,b,null),Jt(o,c,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(f);break}p=Lu(""+p),o.setAttribute(f,p);break;case"onClick":p!=null&&(o.onclick=bd);break;case"onScroll":p!=null&&Lt("scroll",o);break;case"onScrollEnd":p!=null&&Lt("scrollend",o);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(f=p.__html,f!=null){if(b.children!=null)throw Error(s(60));o.innerHTML=f}}break;case"multiple":o.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":o.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){o.removeAttribute("xlink:href");break}f=Lu(""+p),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,""+p):o.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,""):o.removeAttribute(f);break;case"capture":case"download":p===!0?o.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,p):o.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?o.setAttribute(f,p):o.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?o.removeAttribute(f):o.setAttribute(f,p);break;case"popover":Lt("beforetoggle",o),Lt("toggle",o),lo(o,"popover",p);break;case"xlinkActuate":hi(o,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":hi(o,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":hi(o,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":hi(o,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":hi(o,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":hi(o,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":hi(o,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":hi(o,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":hi(o,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":lo(o,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=$w.get(f)||f,lo(o,f,p))}}function lp(o,c,f,p,b,I){switch(f){case"style":tv(o,p,I);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(f=p.__html,f!=null){if(b.children!=null)throw Error(s(60));o.innerHTML=f}}break;case"children":typeof p=="string"?fo(o,p):(typeof p=="number"||typeof p=="bigint")&&fo(o,""+p);break;case"onScroll":p!=null&&Lt("scroll",o);break;case"onScrollEnd":p!=null&&Lt("scrollend",o);break;case"onClick":p!=null&&(o.onclick=bd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gs.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(b=f.endsWith("Capture"),c=f.slice(2,b?f.length-7:void 0),I=o[jt]||null,I=I!=null?I[f]:null,typeof I=="function"&&o.removeEventListener(c,I,b),typeof p=="function")){typeof I!="function"&&I!==null&&(f in o?o[f]=null:o.hasAttribute(f)&&o.removeAttribute(f)),o.addEventListener(c,p,b);break e}f in o?o[f]=p:p===!0?o.setAttribute(f,""):lo(o,f,p)}}}function mn(o,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Lt("error",o),Lt("load",o);var p=!1,b=!1,I;for(I in f)if(f.hasOwnProperty(I)){var P=f[I];if(P!=null)switch(I){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Jt(o,c,I,P,f,null)}}b&&Jt(o,c,"srcSet",f.srcSet,f,null),p&&Jt(o,c,"src",f.src,f,null);return;case"input":Lt("invalid",o);var U=I=P=b=null,$=null,ie=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":b=ge;break;case"type":P=ge;break;case"checked":$=ge;break;case"defaultChecked":ie=ge;break;case"value":I=ge;break;case"defaultValue":U=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(s(137,c));break;default:Jt(o,c,p,ge,f,null)}}Wy(o,I,U,$,ie,P,b,!1),wu(o);return;case"select":Lt("invalid",o),p=P=I=null;for(b in f)if(f.hasOwnProperty(b)&&(U=f[b],U!=null))switch(b){case"value":I=U;break;case"defaultValue":P=U;break;case"multiple":p=U;default:Jt(o,c,b,U,f,null)}c=I,f=P,o.multiple=!!p,c!=null?ho(o,!!p,c,!1):f!=null&&ho(o,!!p,f,!0);return;case"textarea":Lt("invalid",o),I=b=p=null;for(P in f)if(f.hasOwnProperty(P)&&(U=f[P],U!=null))switch(P){case"value":p=U;break;case"defaultValue":b=U;break;case"children":I=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(s(91));break;default:Jt(o,c,P,U,f,null)}Jy(o,p,b,I),wu(o);return;case"option":for($ in f)if(f.hasOwnProperty($)&&(p=f[$],p!=null))switch($){case"selected":o.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Jt(o,c,$,p,f,null)}return;case"dialog":Lt("beforetoggle",o),Lt("toggle",o),Lt("cancel",o),Lt("close",o);break;case"iframe":case"object":Lt("load",o);break;case"video":case"audio":for(p=0;p<dc.length;p++)Lt(dc[p],o);break;case"image":Lt("error",o),Lt("load",o);break;case"details":Lt("toggle",o);break;case"embed":case"source":case"link":Lt("error",o),Lt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in f)if(f.hasOwnProperty(ie)&&(p=f[ie],p!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Jt(o,c,ie,p,f,null)}return;default:if(Af(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&lp(o,c,ge,p,f,void 0));return}}for(U in f)f.hasOwnProperty(U)&&(p=f[U],p!=null&&Jt(o,c,U,p,f,null))}function fL(o,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,I=null,P=null,U=null,$=null,ie=null,ge=null;for(le in f){var be=f[le];if(f.hasOwnProperty(le)&&be!=null)switch(le){case"checked":break;case"value":break;case"defaultValue":$=be;default:p.hasOwnProperty(le)||Jt(o,c,le,null,p,be)}}for(var ae in p){var le=p[ae];if(be=f[ae],p.hasOwnProperty(ae)&&(le!=null||be!=null))switch(ae){case"type":I=le;break;case"name":b=le;break;case"checked":ie=le;break;case"defaultChecked":ge=le;break;case"value":P=le;break;case"defaultValue":U=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(s(137,c));break;default:le!==be&&Jt(o,c,ae,le,p,be)}}Tf(o,P,U,$,ie,ge,I,b);return;case"select":le=P=U=ae=null;for(I in f)if($=f[I],f.hasOwnProperty(I)&&$!=null)switch(I){case"value":break;case"multiple":le=$;default:p.hasOwnProperty(I)||Jt(o,c,I,null,p,$)}for(b in p)if(I=p[b],$=f[b],p.hasOwnProperty(b)&&(I!=null||$!=null))switch(b){case"value":ae=I;break;case"defaultValue":U=I;break;case"multiple":P=I;default:I!==$&&Jt(o,c,b,I,p,$)}c=U,f=P,p=le,ae!=null?ho(o,!!f,ae,!1):!!p!=!!f&&(c!=null?ho(o,!!f,c,!0):ho(o,!!f,f?[]:"",!1));return;case"textarea":le=ae=null;for(U in f)if(b=f[U],f.hasOwnProperty(U)&&b!=null&&!p.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:Jt(o,c,U,null,p,b)}for(P in p)if(b=p[P],I=f[P],p.hasOwnProperty(P)&&(b!=null||I!=null))switch(P){case"value":ae=b;break;case"defaultValue":le=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(s(91));break;default:b!==I&&Jt(o,c,P,b,p,I)}Zy(o,ae,le);return;case"option":for(var lt in f)if(ae=f[lt],f.hasOwnProperty(lt)&&ae!=null&&!p.hasOwnProperty(lt))switch(lt){case"selected":o.selected=!1;break;default:Jt(o,c,lt,null,p,ae)}for($ in p)if(ae=p[$],le=f[$],p.hasOwnProperty($)&&ae!==le&&(ae!=null||le!=null))switch($){case"selected":o.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:Jt(o,c,$,ae,p,le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in f)ae=f[st],f.hasOwnProperty(st)&&ae!=null&&!p.hasOwnProperty(st)&&Jt(o,c,st,null,p,ae);for(ie in p)if(ae=p[ie],le=f[ie],p.hasOwnProperty(ie)&&ae!==le&&(ae!=null||le!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(s(137,c));break;default:Jt(o,c,ie,ae,p,le)}return;default:if(Af(c)){for(var es in f)ae=f[es],f.hasOwnProperty(es)&&ae!==void 0&&!p.hasOwnProperty(es)&&lp(o,c,es,void 0,p,ae);for(ge in p)ae=p[ge],le=f[ge],!p.hasOwnProperty(ge)||ae===le||ae===void 0&&le===void 0||lp(o,c,ge,ae,p,le);return}}for(var Z in f)ae=f[Z],f.hasOwnProperty(Z)&&ae!=null&&!p.hasOwnProperty(Z)&&Jt(o,c,Z,null,p,ae);for(be in p)ae=p[be],le=f[be],!p.hasOwnProperty(be)||ae===le||ae==null&&le==null||Jt(o,c,be,ae,p,le)}var cp=null,up=null;function Td(o){return o.nodeType===9?o:o.ownerDocument}function e1(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function t1(o,c){if(o===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&c==="foreignObject"?0:o}function dp(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var hp=null;function mL(){var o=window.event;return o&&o.type==="popstate"?o===hp?!1:(hp=o,!0):(hp=null,!1)}var s1=typeof setTimeout=="function"?setTimeout:void 0,pL=typeof clearTimeout=="function"?clearTimeout:void 0,n1=typeof Promise=="function"?Promise:void 0,gL=typeof queueMicrotask=="function"?queueMicrotask:typeof n1<"u"?function(o){return n1.resolve(null).then(o).catch(yL)}:s1;function yL(o){setTimeout(function(){throw o})}function na(o){return o==="head"}function i1(o,c){var f=c,p=0,b=0;do{var I=f.nextSibling;if(o.removeChild(f),I&&I.nodeType===8)if(f=I.data,f==="/$"){if(0<p&&8>p){f=p;var P=o.ownerDocument;if(f&1&&fc(P.documentElement),f&2&&fc(P.body),f&4)for(f=P.head,fc(f),P=f.firstChild;P;){var U=P.nextSibling,$=P.nodeName;P[rn]||$==="SCRIPT"||$==="STYLE"||$==="LINK"&&P.rel.toLowerCase()==="stylesheet"||f.removeChild(P),P=U}}if(b===0){o.removeChild(I),bc(c);return}b--}else f==="$"||f==="$?"||f==="$!"?b++:p=f.charCodeAt(0)-48;else p=0;f=I}while(f);bc(c)}function fp(o){var c=o.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":fp(f),wa(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}o.removeChild(f)}}function vL(o,c,f,p){for(;o.nodeType===1;){var b=f;if(o.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(p){if(!o[rn])switch(c){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(I=o.getAttribute("rel"),I==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(I!==b.rel||o.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||o.getAttribute("title")!==(b.title==null?null:b.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(I=o.getAttribute("src"),(I!==(b.src==null?null:b.src)||o.getAttribute("type")!==(b.type==null?null:b.type)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&I&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(c==="input"&&o.type==="hidden"){var I=b.name==null?null:""+b.name;if(b.type==="hidden"&&o.getAttribute("name")===I)return o}else return o;if(o=ki(o.nextSibling),o===null)break}return null}function xL(o,c,f){if(c==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!f||(o=ki(o.nextSibling),o===null))return null;return o}function mp(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function SL(o,c){var f=o.ownerDocument;if(o.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),o._reactRetry=p}}function ki(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return o}var pp=null;function r1(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return o;c--}else f==="/$"&&c++}o=o.previousSibling}return null}function a1(o,c,f){switch(c=Td(f),o){case"html":if(o=c.documentElement,!o)throw Error(s(452));return o;case"head":if(o=c.head,!o)throw Error(s(453));return o;case"body":if(o=c.body,!o)throw Error(s(454));return o;default:throw Error(s(451))}}function fc(o){for(var c=o.attributes;c.length;)o.removeAttributeNode(c[0]);wa(o)}var bi=new Map,o1=new Set;function Ed(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var Lr=K.d;K.d={f:bL,r:TL,D:EL,C:AL,L:IL,m:RL,X:CL,S:wL,M:LL};function bL(){var o=Lr.f(),c=md();return o||c}function TL(o){var c=Fr(o);c!==null&&c.tag===5&&c.type==="form"?wx(c):Lr.r(o)}var $o=typeof document>"u"?null:document;function l1(o,c,f){var p=$o;if(p&&typeof c=="string"&&c){var b=mi(c);b='link[rel="'+o+'"][href="'+b+'"]',typeof f=="string"&&(b+='[crossorigin="'+f+'"]'),o1.has(b)||(o1.add(b),o={rel:o,crossOrigin:f,href:c},p.querySelector(b)===null&&(c=p.createElement("link"),mn(c,"link",o),tt(c),p.head.appendChild(c)))}}function EL(o){Lr.D(o),l1("dns-prefetch",o,null)}function AL(o,c){Lr.C(o,c),l1("preconnect",o,c)}function IL(o,c,f){Lr.L(o,c,f);var p=$o;if(p&&o&&c){var b='link[rel="preload"][as="'+mi(c)+'"]';c==="image"&&f&&f.imageSrcSet?(b+='[imagesrcset="'+mi(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(b+='[imagesizes="'+mi(f.imageSizes)+'"]')):b+='[href="'+mi(o)+'"]';var I=b;switch(c){case"style":I=Go(o);break;case"script":I=Ho(o)}bi.has(I)||(o=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:o,as:c},f),bi.set(I,o),p.querySelector(b)!==null||c==="style"&&p.querySelector(mc(I))||c==="script"&&p.querySelector(pc(I))||(c=p.createElement("link"),mn(c,"link",o),tt(c),p.head.appendChild(c)))}}function RL(o,c){Lr.m(o,c);var f=$o;if(f&&o){var p=c&&typeof c.as=="string"?c.as:"script",b='link[rel="modulepreload"][as="'+mi(p)+'"][href="'+mi(o)+'"]',I=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=Ho(o)}if(!bi.has(I)&&(o=h({rel:"modulepreload",href:o},c),bi.set(I,o),f.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(pc(I)))return}p=f.createElement("link"),mn(p,"link",o),tt(p),f.head.appendChild(p)}}}function wL(o,c,f){Lr.S(o,c,f);var p=$o;if(p&&o){var b=Ye(p).hoistableStyles,I=Go(o);c=c||"default";var P=b.get(I);if(!P){var U={loading:0,preload:null};if(P=p.querySelector(mc(I)))U.loading=5;else{o=h({rel:"stylesheet",href:o,"data-precedence":c},f),(f=bi.get(I))&&gp(o,f);var $=P=p.createElement("link");tt($),mn($,"link",o),$._p=new Promise(function(ie,ge){$.onload=ie,$.onerror=ge}),$.addEventListener("load",function(){U.loading|=1}),$.addEventListener("error",function(){U.loading|=2}),U.loading|=4,Ad(P,c,p)}P={type:"stylesheet",instance:P,count:1,state:U},b.set(I,P)}}}function CL(o,c){Lr.X(o,c);var f=$o;if(f&&o){var p=Ye(f).hoistableScripts,b=Ho(o),I=p.get(b);I||(I=f.querySelector(pc(b)),I||(o=h({src:o,async:!0},c),(c=bi.get(b))&&yp(o,c),I=f.createElement("script"),tt(I),mn(I,"link",o),f.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},p.set(b,I))}}function LL(o,c){Lr.M(o,c);var f=$o;if(f&&o){var p=Ye(f).hoistableScripts,b=Ho(o),I=p.get(b);I||(I=f.querySelector(pc(b)),I||(o=h({src:o,async:!0,type:"module"},c),(c=bi.get(b))&&yp(o,c),I=f.createElement("script"),tt(I),mn(I,"link",o),f.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},p.set(b,I))}}function c1(o,c,f,p){var b=(b=pe.current)?Ed(b):null;if(!b)throw Error(s(446));switch(o){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Go(f.href),f=Ye(b).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){o=Go(f.href);var I=Ye(b).hoistableStyles,P=I.get(o);if(P||(b=b.ownerDocument||b,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(o,P),(I=b.querySelector(mc(o)))&&!I._p&&(P.instance=I,P.state.loading=5),bi.has(o)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},bi.set(o,f),I||DL(b,o,f,P.state))),c&&p===null)throw Error(s(528,""));return P}if(c&&p!==null)throw Error(s(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Ho(f),f=Ye(b).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,o))}}function Go(o){return'href="'+mi(o)+'"'}function mc(o){return'link[rel="stylesheet"]['+o+"]"}function u1(o){return h({},o,{"data-precedence":o.precedence,precedence:null})}function DL(o,c,f,p){o.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=o.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),mn(c,"link",f),tt(c),o.head.appendChild(c))}function Ho(o){return'[src="'+mi(o)+'"]'}function pc(o){return"script[async]"+o}function d1(o,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=o.querySelector('style[data-href~="'+mi(f.href)+'"]');if(p)return c.instance=p,tt(p),p;var b=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(o.ownerDocument||o).createElement("style"),tt(p),mn(p,"style",b),Ad(p,f.precedence,o),c.instance=p;case"stylesheet":b=Go(f.href);var I=o.querySelector(mc(b));if(I)return c.state.loading|=4,c.instance=I,tt(I),I;p=u1(f),(b=bi.get(b))&&gp(p,b),I=(o.ownerDocument||o).createElement("link"),tt(I);var P=I;return P._p=new Promise(function(U,$){P.onload=U,P.onerror=$}),mn(I,"link",p),c.state.loading|=4,Ad(I,f.precedence,o),c.instance=I;case"script":return I=Ho(f.src),(b=o.querySelector(pc(I)))?(c.instance=b,tt(b),b):(p=f,(b=bi.get(I))&&(p=h({},f),yp(p,b)),o=o.ownerDocument||o,b=o.createElement("script"),tt(b),mn(b,"link",p),o.head.appendChild(b),c.instance=b);case"void":return null;default:throw Error(s(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Ad(p,f.precedence,o));return c.instance}function Ad(o,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,I=b,P=0;P<p.length;P++){var U=p[P];if(U.dataset.precedence===c)I=U;else if(I!==b)break}I?I.parentNode.insertBefore(o,I.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(o,c.firstChild))}function gp(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.title==null&&(o.title=c.title)}function yp(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.integrity==null&&(o.integrity=c.integrity)}var Id=null;function h1(o,c,f){if(Id===null){var p=new Map,b=Id=new Map;b.set(f,p)}else b=Id,p=b.get(f),p||(p=new Map,b.set(f,p));if(p.has(o))return p;for(p.set(o,null),f=f.getElementsByTagName(o),b=0;b<f.length;b++){var I=f[b];if(!(I[rn]||I[Pt]||o==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var P=I.getAttribute(c)||"";P=o+P;var U=p.get(P);U?U.push(I):p.set(P,[I])}}return p}function f1(o,c,f){o=o.ownerDocument||o,o.head.insertBefore(f,c==="title"?o.querySelector("head > title"):null)}function OL(o,c,f){if(f===1||c.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return o=c.disabled,typeof c.precedence=="string"&&o==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function m1(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var gc=null;function _L(){}function PL(o,c,f){if(gc===null)throw Error(s(475));var p=gc;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=Go(f.href),I=o.querySelector(mc(b));if(I){o=I._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(p.count++,p=Rd.bind(p),o.then(p,p)),c.state.loading|=4,c.instance=I,tt(I);return}I=o.ownerDocument||o,f=u1(f),(b=bi.get(b))&&gp(f,b),I=I.createElement("link"),tt(I);var P=I;P._p=new Promise(function(U,$){P.onload=U,P.onerror=$}),mn(I,"link",f),c.instance=I}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=Rd.bind(p),o.addEventListener("load",c),o.addEventListener("error",c))}}function NL(){if(gc===null)throw Error(s(475));var o=gc;return o.stylesheets&&o.count===0&&vp(o,o.stylesheets),0<o.count?function(c){var f=setTimeout(function(){if(o.stylesheets&&vp(o,o.stylesheets),o.unsuspend){var p=o.unsuspend;o.unsuspend=null,p()}},6e4);return o.unsuspend=c,function(){o.unsuspend=null,clearTimeout(f)}}:null}function Rd(){if(this.count--,this.count===0){if(this.stylesheets)vp(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var wd=null;function vp(o,c){o.stylesheets=null,o.unsuspend!==null&&(o.count++,wd=new Map,c.forEach(kL,o),wd=null,Rd.call(o))}function kL(o,c){if(!(c.state.loading&4)){var f=wd.get(o);if(f)var p=f.get(null);else{f=new Map,wd.set(o,f);for(var b=o.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<b.length;I++){var P=b[I];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(f.set(P.dataset.precedence,P),p=P)}p&&f.set(null,p)}b=c.instance,P=b.getAttribute("data-precedence"),I=f.get(P)||p,I===p&&f.set(null,b),f.set(P,b),this.count++,p=Rd.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),I?I.parentNode.insertBefore(b,I.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(b,o.firstChild)),c.state.loading|=4}}var yc={$$typeof:R,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function ML(o,c,f,p,b,I,P,U){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=it(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=it(0),this.hiddenUpdates=it(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=I,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function p1(o,c,f,p,b,I,P,U,$,ie,ge,be){return o=new ML(o,c,f,P,U,$,ie,be),c=1,I===!0&&(c|=24),I=qn(3,null,null,c),o.current=I,I.stateNode=o,c=Jf(),c.refCount++,o.pooledCache=c,c.refCount++,I.memoizedState={element:p,isDehydrated:f,cache:c},nm(I),o}function g1(o){return o?(o=bo,o):bo}function y1(o,c,f,p,b,I){b=g1(b),p.context===null?p.context=b:p.pendingContext=b,p=Hr(c),p.payload={element:f},I=I===void 0?null:I,I!==null&&(p.callback=I),f=zr(o,p,c),f!==null&&(Jn(f,o,c),Yl(f,o,c))}function v1(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<c?f:c}}function xp(o,c){v1(o,c),(o=o.alternate)&&v1(o,c)}function x1(o){if(o.tag===13){var c=So(o,67108864);c!==null&&Jn(c,o,67108864),xp(o,67108864)}}var Cd=!0;function UL(o,c,f,p){var b=j.T;j.T=null;var I=K.p;try{K.p=2,Sp(o,c,f,p)}finally{K.p=I,j.T=b}}function FL(o,c,f,p){var b=j.T;j.T=null;var I=K.p;try{K.p=8,Sp(o,c,f,p)}finally{K.p=I,j.T=b}}function Sp(o,c,f,p){if(Cd){var b=bp(p);if(b===null)op(o,c,p,Ld,f),b1(o,p);else if(jL(b,o,c,f,p))p.stopPropagation();else if(b1(o,p),c&4&&-1<BL.indexOf(o)){for(;b!==null;){var I=Fr(b);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var P=It(I.pendingLanes);if(P!==0){var U=I;for(U.pendingLanes|=2,U.entangledLanes|=2;P;){var $=1<<31-he(P);U.entanglements[1]|=$,P&=~$}Zi(I),(qt&6)===0&&(hd=Je()+500,uc(0))}}break;case 13:U=So(I,2),U!==null&&Jn(U,I,2),md(),xp(I,2)}if(I=bp(p),I===null&&op(o,c,p,Ld,f),I===b)break;b=I}b!==null&&p.stopPropagation()}else op(o,c,p,null,f)}}function bp(o){return o=Rf(o),Tp(o)}var Ld=null;function Tp(o){if(Ld=null,o=Ki(o),o!==null){var c=r(o);if(c===null)o=null;else{var f=c.tag;if(f===13){if(o=a(c),o!==null)return o;o=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null)}}return Ld=o,null}function S1(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ot()){case kt:return 2;case vt:return 8;case fe:case ze:return 32;case Ve:return 268435456;default:return 32}default:return 32}}var Ep=!1,ia=null,ra=null,aa=null,vc=new Map,xc=new Map,oa=[],BL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function b1(o,c){switch(o){case"focusin":case"focusout":ia=null;break;case"dragenter":case"dragleave":ra=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":vc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":xc.delete(c.pointerId)}}function Sc(o,c,f,p,b,I){return o===null||o.nativeEvent!==I?(o={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:I,targetContainers:[b]},c!==null&&(c=Fr(c),c!==null&&x1(c)),o):(o.eventSystemFlags|=p,c=o.targetContainers,b!==null&&c.indexOf(b)===-1&&c.push(b),o)}function jL(o,c,f,p,b){switch(c){case"focusin":return ia=Sc(ia,o,c,f,p,b),!0;case"dragenter":return ra=Sc(ra,o,c,f,p,b),!0;case"mouseover":return aa=Sc(aa,o,c,f,p,b),!0;case"pointerover":var I=b.pointerId;return vc.set(I,Sc(vc.get(I)||null,o,c,f,p,b)),!0;case"gotpointercapture":return I=b.pointerId,xc.set(I,Sc(xc.get(I)||null,o,c,f,p,b)),!0}return!1}function T1(o){var c=Ki(o.target);if(c!==null){var f=r(c);if(f!==null){if(c=f.tag,c===13){if(c=a(f),c!==null){o.blockedOn=c,Rs(o.priority,function(){if(f.tag===13){var p=Zn();p=ps(p);var b=So(f,p);b!==null&&Jn(b,f,p),xp(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Dd(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var f=bp(o.nativeEvent);if(f===null){f=o.nativeEvent;var p=new f.constructor(f.type,f);If=p,f.target.dispatchEvent(p),If=null}else return c=Fr(f),c!==null&&x1(c),o.blockedOn=f,!1;c.shift()}return!0}function E1(o,c,f){Dd(o)&&f.delete(c)}function VL(){Ep=!1,ia!==null&&Dd(ia)&&(ia=null),ra!==null&&Dd(ra)&&(ra=null),aa!==null&&Dd(aa)&&(aa=null),vc.forEach(E1),xc.forEach(E1)}function Od(o,c){o.blockedOn===c&&(o.blockedOn=null,Ep||(Ep=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,VL)))}var _d=null;function A1(o){_d!==o&&(_d=o,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){_d===o&&(_d=null);for(var c=0;c<o.length;c+=3){var f=o[c],p=o[c+1],b=o[c+2];if(typeof p!="function"){if(Tp(p||f)===null)continue;break}var I=Fr(f);I!==null&&(o.splice(c,3),c-=3,Tm(I,{pending:!0,data:b,method:f.method,action:p},p,b))}}))}function bc(o){function c($){return Od($,o)}ia!==null&&Od(ia,o),ra!==null&&Od(ra,o),aa!==null&&Od(aa,o),vc.forEach(c),xc.forEach(c);for(var f=0;f<oa.length;f++){var p=oa[f];p.blockedOn===o&&(p.blockedOn=null)}for(;0<oa.length&&(f=oa[0],f.blockedOn===null);)T1(f),f.blockedOn===null&&oa.shift();if(f=(o.ownerDocument||o).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var b=f[p],I=f[p+1],P=b[jt]||null;if(typeof I=="function")P||A1(f);else if(P){var U=null;if(I&&I.hasAttribute("formAction")){if(b=I,P=I[jt]||null)U=P.formAction;else if(Tp(b)!==null)continue}else U=P.action;typeof U=="function"?f[p+1]=U:(f.splice(p,3),p-=3),A1(f)}}}function Ap(o){this._internalRoot=o}Pd.prototype.render=Ap.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(s(409));var f=c.current,p=Zn();y1(f,p,o,c,null,null)},Pd.prototype.unmount=Ap.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;y1(o.current,2,null,o,null,null),md(),c[zt]=null}};function Pd(o){this._internalRoot=o}Pd.prototype.unstable_scheduleHydration=function(o){if(o){var c=Ms();o={blockedOn:null,target:o,priority:c};for(var f=0;f<oa.length&&c!==0&&c<oa[f].priority;f++);oa.splice(f,0,o),f===0&&T1(o)}};var I1=e.version;if(I1!=="19.1.1")throw Error(s(527,I1,"19.1.1"));K.findDOMNode=function(o){var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(s(188)):(o=Object.keys(o).join(","),Error(s(268,o)));return o=u(c),o=o!==null?d(o):null,o=o===null?null:o.stateNode,o};var $L={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nd.isDisabled&&Nd.supportsFiber)try{W=Nd.inject($L),se=Nd}catch{}}return Ec.createRoot=function(o,c){if(!i(o))throw Error(s(299));var f=!1,p="",b=Vx,I=$x,P=Gx,U=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(b=c.onUncaughtError),c.onCaughtError!==void 0&&(I=c.onCaughtError),c.onRecoverableError!==void 0&&(P=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(U=c.unstable_transitionCallbacks)),c=p1(o,1,!1,null,null,f,p,b,I,P,U,null),o[zt]=c.current,ap(o),new Ap(c)},Ec.hydrateRoot=function(o,c,f){if(!i(o))throw Error(s(299));var p=!1,b="",I=Vx,P=$x,U=Gx,$=null,ie=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(b=f.identifierPrefix),f.onUncaughtError!==void 0&&(I=f.onUncaughtError),f.onCaughtError!==void 0&&(P=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&($=f.unstable_transitionCallbacks),f.formState!==void 0&&(ie=f.formState)),c=p1(o,1,!0,c,f??null,p,b,I,P,U,$,ie),c.context=g1(null),f=c.current,p=Zn(),p=ps(p),b=Hr(p),b.callback=null,zr(f,b,p),f=p,c.current.lanes=f,rt(c,f),Zi(c),o[zt]=c.current,ap(o),new Pd(c)},Ec.version="19.1.1",Ec}var M1;function WL(){if(M1)return wp.exports;M1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),wp.exports=XL(),wp.exports}var ZL=WL(),ou=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},JL={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},eD=class{#e=JL;#t=!1;setTimeoutProvider(n){this.#e=n}setTimeout(n,e){return this.#e.setTimeout(n,e)}clearTimeout(n){this.#e.clearTimeout(n)}setInterval(n,e){return this.#e.setInterval(n,e)}clearInterval(n){this.#e.clearInterval(n)}},ga=new eD;function tD(n){setTimeout(n,0)}var Ja=typeof window>"u"||"Deno"in globalThis;function En(){}function sD(n,e){return typeof n=="function"?n(e):n}function Rg(n){return typeof n=="number"&&n>=0&&n!==1/0}function LE(n,e){return Math.max(n+(e||0)-Date.now(),0)}function ya(n,e){return typeof n=="function"?n(e):n}function Ei(n,e){return typeof n=="function"?n(e):n}function U1(n,e){const{type:t="all",exact:s,fetchStatus:i,predicate:r,queryKey:a,stale:l}=n;if(a){if(s){if(e.queryHash!==N0(a,e.options))return!1}else if(!Gc(e.queryKey,a))return!1}if(t!=="all"){const u=e.isActive();if(t==="active"&&!u||t==="inactive"&&u)return!1}return!(typeof l=="boolean"&&e.isStale()!==l||i&&i!==e.state.fetchStatus||r&&!r(e))}function F1(n,e){const{exact:t,status:s,predicate:i,mutationKey:r}=n;if(r){if(!e.options.mutationKey)return!1;if(t){if($c(e.options.mutationKey)!==$c(r))return!1}else if(!Gc(e.options.mutationKey,r))return!1}return!(s&&e.state.status!==s||i&&!i(e))}function N0(n,e){return(e?.queryKeyHashFn||$c)(n)}function $c(n){return JSON.stringify(n,(e,t)=>Cg(t)?Object.keys(t).sort().reduce((s,i)=>(s[i]=t[i],s),{}):t)}function Gc(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>Gc(n[t],e[t])):!1}var nD=Object.prototype.hasOwnProperty;function DE(n,e){if(n===e)return n;const t=B1(n)&&B1(e);if(!t&&!(Cg(n)&&Cg(e)))return e;const i=(t?n:Object.keys(n)).length,r=t?e:Object.keys(e),a=r.length,l=t?new Array(a):{};let u=0;for(let d=0;d<a;d++){const h=t?d:r[d],m=n[h],g=e[h];if(m===g){l[h]=m,(t?d<i:nD.call(n,h))&&u++;continue}if(m===null||g===null||typeof m!="object"||typeof g!="object"){l[h]=g;continue}const v=DE(m,g);l[h]=v,v===m&&u++}return i===a&&u===i?n:l}function wg(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function B1(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function Cg(n){if(!j1(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!j1(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function j1(n){return Object.prototype.toString.call(n)==="[object Object]"}function iD(n){return new Promise(e=>{ga.setTimeout(e,n)})}function Lg(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?DE(n,e):e}function rD(n,e,t=0){const s=[...n,e];return t&&s.length>t?s.slice(1):s}function aD(n,e,t=0){const s=[e,...n];return t&&s.length>t?s.slice(0,-1):s}var k0=Symbol();function OE(n,e){return!n.queryFn&&e?.initialPromise?()=>e.initialPromise:!n.queryFn||n.queryFn===k0?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}function oD(n,e){return typeof n=="function"?n(...e):!!n}var lD=class extends ou{#e;#t;#s;constructor(){super(),this.#s=n=>{if(!Ja&&window.addEventListener){const e=()=>n();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#s=n,this.#t?.(),this.#t=n(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(e=>{e(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},M0=new lD;function Dg(){let n,e;const t=new Promise((i,r)=>{n=i,e=r});t.status="pending",t.catch(()=>{});function s(i){Object.assign(t,i),delete t.resolve,delete t.reject}return t.resolve=i=>{s({status:"fulfilled",value:i}),n(i)},t.reject=i=>{s({status:"rejected",reason:i}),e(i)},t}function cD(n){let e;if(n.then(t=>(e=t,t),En)?.catch(En),e!==void 0)return{data:e}}function _E(n){return n}function uD(n){return{mutationKey:n.options.mutationKey,state:n.state,...n.options.scope&&{scope:n.options.scope},...n.meta&&{meta:n.meta}}}function dD(n,e,t){return{dehydratedAt:Date.now(),state:{...n.state,...n.state.data!==void 0&&{data:e(n.state.data)}},queryKey:n.queryKey,queryHash:n.queryHash,...n.state.status==="pending"&&{promise:n.promise?.then(e).catch(s=>t(s)?Promise.reject(new Error("redacted")):Promise.reject(s))},...n.meta&&{meta:n.meta}}}function hD(n){return n.state.isPaused}function fD(n){return n.state.status==="success"}function mD(n){return!0}function pD(n,e={}){const t=e.shouldDehydrateMutation??n.getDefaultOptions().dehydrate?.shouldDehydrateMutation??hD,s=n.getMutationCache().getAll().flatMap(u=>t(u)?[uD(u)]:[]),i=e.shouldDehydrateQuery??n.getDefaultOptions().dehydrate?.shouldDehydrateQuery??fD,r=e.shouldRedactErrors??n.getDefaultOptions().dehydrate?.shouldRedactErrors??mD,a=e.serializeData??n.getDefaultOptions().dehydrate?.serializeData??_E,l=n.getQueryCache().getAll().flatMap(u=>i(u)?[dD(u,a,r)]:[]);return{mutations:s,queries:l}}function gD(n,e,t){if(typeof e!="object"||e===null)return;const s=n.getMutationCache(),i=n.getQueryCache(),r=t?.defaultOptions?.deserializeData??n.getDefaultOptions().hydrate?.deserializeData??_E,a=e.mutations||[],l=e.queries||[];a.forEach(({state:u,...d})=>{s.build(n,{...n.getDefaultOptions().hydrate?.mutations,...t?.defaultOptions?.mutations,...d},u)}),l.forEach(({queryKey:u,state:d,queryHash:h,meta:m,promise:g,dehydratedAt:v})=>{const S=g?cD(g):void 0,x=d.data===void 0?S?.data:d.data,T=x===void 0?x:r(x);let A=i.get(h);const E=A?.state.status==="pending",R=A?.state.fetchStatus==="fetching";if(A){const L=S&&v!==void 0&&v>A.state.dataUpdatedAt;if(d.dataUpdatedAt>A.state.dataUpdatedAt||L){const{fetchStatus:w,...D}=d;A.setState({...D,data:T})}}else A=i.build(n,{...n.getDefaultOptions().hydrate?.queries,...t?.defaultOptions?.queries,queryKey:u,queryHash:h,meta:m},{...d,data:T,fetchStatus:"idle",status:T!==void 0?"success":d.status});g&&!E&&!R&&(v===void 0||v>A.state.dataUpdatedAt)&&A.fetch(void 0,{initialPromise:Promise.resolve(g).then(r)})})}var yD=tD;function vD(){let n=[],e=0,t=l=>{l()},s=l=>{l()},i=yD;const r=l=>{e?n.push(l):i(()=>{t(l)})},a=()=>{const l=n;n=[],l.length&&i(()=>{s(()=>{l.forEach(u=>{t(u)})})})};return{batch:l=>{let u;e++;try{u=l()}finally{e--,e||a()}return u},batchCalls:l=>(...u)=>{r(()=>{l(...u)})},schedule:r,setNotifyFunction:l=>{t=l},setBatchNotifyFunction:l=>{s=l},setScheduler:l=>{i=l}}}var gn=vD(),xD=class extends ou{#e=!0;#t;#s;constructor(){super(),this.#s=n=>{if(!Ja&&window.addEventListener){const e=()=>n(!0),t=()=>n(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#s=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(t=>{t(n)}))}isOnline(){return this.#e}},wh=new xD;function SD(n){return Math.min(1e3*2**n,3e4)}function PE(n){return(n??"online")==="online"?wh.isOnline():!0}var Og=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function NE(n){let e=!1,t=0,s;const i=Dg(),r=()=>i.status!=="pending",a=x=>{if(!r()){const T=new Og(x);g(T),n.onCancel?.(T)}},l=()=>{e=!0},u=()=>{e=!1},d=()=>M0.isFocused()&&(n.networkMode==="always"||wh.isOnline())&&n.canRun(),h=()=>PE(n.networkMode)&&n.canRun(),m=x=>{r()||(s?.(),i.resolve(x))},g=x=>{r()||(s?.(),i.reject(x))},v=()=>new Promise(x=>{s=T=>{(r()||d())&&x(T)},n.onPause?.()}).then(()=>{s=void 0,r()||n.onContinue?.()}),S=()=>{if(r())return;let x;const T=t===0?n.initialPromise:void 0;try{x=T??n.fn()}catch(A){x=Promise.reject(A)}Promise.resolve(x).then(m).catch(A=>{if(r())return;const E=n.retry??(Ja?0:3),R=n.retryDelay??SD,L=typeof R=="function"?R(t,A):R,w=E===!0||typeof E=="number"&&t<E||typeof E=="function"&&E(t,A);if(e||!w){g(A);return}t++,n.onFail?.(t,A),iD(L).then(()=>d()?void 0:v()).then(()=>{e?g(A):S()})})};return{promise:i,status:()=>i.status,cancel:a,continue:()=>(s?.(),i),cancelRetry:l,continueRetry:u,canStart:h,start:()=>(h()?S():v().then(S),i)}}var kE=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Rg(this.gcTime)&&(this.#e=ga.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Ja?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ga.clearTimeout(this.#e),this.#e=void 0)}},bD=class extends kE{#e;#t;#s;#i;#n;#o;#a;constructor(n){super(),this.#a=!1,this.#o=n.defaultOptions,this.setOptions(n.options),this.observers=[],this.#i=n.client,this.#s=this.#i.getQueryCache(),this.queryKey=n.queryKey,this.queryHash=n.queryHash,this.#e=V1(this.options),this.state=n.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(n){if(this.options={...this.#o,...n},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=V1(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(n,e){const t=Lg(this.state.data,n,this.options);return this.#r({data:t,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),t}setState(n,e){this.#r({type:"setState",state:n,setStateOptions:e})}cancel(n){const e=this.#n?.promise;return this.#n?.cancel(n),e?e.then(En).catch(En):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(n=>Ei(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===k0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(n=>ya(n.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(n=0){return this.state.data===void 0?!0:n==="static"?!1:this.state.isInvalidated?!0:!LE(this.state.dataUpdatedAt,n)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(e=>e!==n),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#r({type:"invalidate"})}async fetch(n,e){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(n&&this.setOptions(n),!this.options.queryFn){const l=this.observers.find(u=>u.options.queryFn);l&&this.setOptions(l.options)}const t=new AbortController,s=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#a=!0,t.signal)})},i=()=>{const l=OE(this.options,e),d=(()=>{const h={client:this.#i,queryKey:this.queryKey,meta:this.meta};return s(h),h})();return this.#a=!1,this.options.persister?this.options.persister(l,d,this):l(d)},a=(()=>{const l={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:i};return s(l),l})();this.options.behavior?.onFetch(a,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#r({type:"fetch",meta:a.fetchOptions?.meta}),this.#n=NE({initialPromise:e?.initialPromise,fn:a.fetchFn,onCancel:l=>{l instanceof Og&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),t.abort()},onFail:(l,u)=>{this.#r({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#r({type:"pause"})},onContinue:()=>{this.#r({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const l=await this.#n.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#s.config.onSuccess?.(l,this),this.#s.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof Og){if(l.silent)return this.#n.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#r({type:"error",error:l}),this.#s.config.onError?.(l,this),this.#s.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#r(n){const e=t=>{switch(n.type){case"failed":return{...t,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...ME(t.data,this.options),fetchMeta:n.meta??null};case"success":const s={...t,data:n.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=n.manual?s:void 0,s;case"error":const i=n.error;return{...t,error:i,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...n.state}}};this.state=e(this.state),gn.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:n})})}};function ME(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:PE(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function V1(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,s=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var UE=class extends ou{constructor(n,e){super(),this.options=e,this.#e=n,this.#r=null,this.#a=Dg(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#s=void 0;#i=void 0;#n;#o;#a;#r;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),$1(this.#t,this.options)?this.#d():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _g(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _g(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#S(),this.#b(),this.#t.removeObserver(this)}setOptions(n){const e=this.options,t=this.#t;if(this.options=this.#e.defaultQueryOptions(n),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ei(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#T(),this.#t.setOptions(this.options),e._defaulted&&!wg(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const s=this.hasListeners();s&&G1(this.#t,t,this.options,e)&&this.#d(),this.updateResult(),s&&(this.#t!==t||Ei(this.options.enabled,this.#t)!==Ei(e.enabled,this.#t)||ya(this.options.staleTime,this.#t)!==ya(e.staleTime,this.#t))&&this.#g();const i=this.#y();s&&(this.#t!==t||Ei(this.options.enabled,this.#t)!==Ei(e.enabled,this.#t)||i!==this.#l)&&this.#v(i)}getOptimisticResult(n){const e=this.#e.getQueryCache().build(this.#e,n),t=this.createResult(e,n);return ED(this,t)&&(this.#i=t,this.#o=this.options,this.#n=this.#t.state),t}getCurrentResult(){return this.#i}trackResult(n,e){return new Proxy(n,{get:(t,s)=>(this.trackProp(s),e?.(s),s==="promise"&&!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(t,s))})}trackProp(n){this.#m.add(n)}getCurrentQuery(){return this.#t}refetch({...n}={}){return this.fetch({...n})}fetchOptimistic(n){const e=this.#e.defaultQueryOptions(n),t=this.#e.getQueryCache().build(this.#e,e);return t.fetch().then(()=>this.createResult(t,e))}fetch(n){return this.#d({...n,cancelRefetch:n.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(n){this.#T();let e=this.#t.fetch(this.options,n);return n?.throwOnError||(e=e.catch(En)),e}#g(){this.#S();const n=ya(this.options.staleTime,this.#t);if(Ja||this.#i.isStale||!Rg(n))return;const t=LE(this.#i.dataUpdatedAt,n)+1;this.#c=ga.setTimeout(()=>{this.#i.isStale||this.updateResult()},t)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(n){this.#b(),this.#l=n,!(Ja||Ei(this.options.enabled,this.#t)===!1||!Rg(this.#l)||this.#l===0)&&(this.#u=ga.setInterval(()=>{(this.options.refetchIntervalInBackground||M0.isFocused())&&this.#d()},this.#l))}#x(){this.#g(),this.#v(this.#y())}#S(){this.#c&&(ga.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(ga.clearInterval(this.#u),this.#u=void 0)}createResult(n,e){const t=this.#t,s=this.options,i=this.#i,r=this.#n,a=this.#o,u=n!==t?n.state:this.#s,{state:d}=n;let h={...d},m=!1,g;if(e._optimisticResults){const k=this.hasListeners(),N=!k&&$1(n,e),F=k&&G1(n,t,e,s);(N||F)&&(h={...h,...ME(d.data,n.options)}),e._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:v,errorUpdatedAt:S,status:x}=h;g=h.data;let T=!1;if(e.placeholderData!==void 0&&g===void 0&&x==="pending"){let k;i?.isPlaceholderData&&e.placeholderData===a?.placeholderData?(k=i.data,T=!0):k=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,k!==void 0&&(x="success",g=Lg(i?.data,k,e),m=!0)}if(e.select&&g!==void 0&&!T)if(i&&g===r?.data&&e.select===this.#p)g=this.#h;else try{this.#p=e.select,g=e.select(g),g=Lg(i?.data,g,e),this.#h=g,this.#r=null}catch(k){this.#r=k}this.#r&&(v=this.#r,g=this.#h,S=Date.now(),x="error");const A=h.fetchStatus==="fetching",E=x==="pending",R=x==="error",L=E&&A,w=g!==void 0,_={status:x,fetchStatus:h.fetchStatus,isPending:E,isSuccess:x==="success",isError:R,isInitialLoading:L,isLoading:L,data:g,dataUpdatedAt:h.dataUpdatedAt,error:v,errorUpdatedAt:S,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>u.dataUpdateCount||h.errorUpdateCount>u.errorUpdateCount,isFetching:A,isRefetching:A&&!E,isLoadingError:R&&!w,isPaused:h.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:R&&w,isStale:U0(n,e),refetch:this.refetch,promise:this.#a,isEnabled:Ei(e.enabled,n)!==!1};if(this.options.experimental_prefetchInRender){const k=V=>{_.status==="error"?V.reject(_.error):_.data!==void 0&&V.resolve(_.data)},N=()=>{const V=this.#a=_.promise=Dg();k(V)},F=this.#a;switch(F.status){case"pending":n.queryHash===t.queryHash&&k(F);break;case"fulfilled":(_.status==="error"||_.data!==F.value)&&N();break;case"rejected":(_.status!=="error"||_.error!==F.reason)&&N();break}}return _}updateResult(){const n=this.#i,e=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#f=this.#t),wg(e,n))return;this.#i=e;const t=()=>{if(!n)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!this.#m.size)return!0;const r=new Set(i??this.#m);return this.options.throwOnError&&r.add("error"),Object.keys(this.#i).some(a=>{const l=a;return this.#i[l]!==n[l]&&r.has(l)})};this.#E({listeners:t()})}#T(){const n=this.#e.getQueryCache().build(this.#e,this.options);if(n===this.#t)return;const e=this.#t;this.#t=n,this.#s=n.state,this.hasListeners()&&(e?.removeObserver(this),n.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#E(n){gn.batch(()=>{n.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function TD(n,e){return Ei(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function $1(n,e){return TD(n,e)||n.state.data!==void 0&&_g(n,e,e.refetchOnMount)}function _g(n,e,t){if(Ei(e.enabled,n)!==!1&&ya(e.staleTime,n)!=="static"){const s=typeof t=="function"?t(n):t;return s==="always"||s!==!1&&U0(n,e)}return!1}function G1(n,e,t,s){return(n!==e||Ei(s.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&U0(n,t)}function U0(n,e){return Ei(e.enabled,n)!==!1&&n.isStaleByTime(ya(e.staleTime,n))}function ED(n,e){return!wg(n.getCurrentResult(),e)}function Ch(n){return{onFetch:(e,t)=>{const s=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,r=e.state.data?.pages||[],a=e.state.data?.pageParams||[];let l={pages:[],pageParams:[]},u=0;const d=async()=>{let h=!1;const m=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?h=!0:e.signal.addEventListener("abort",()=>{h=!0}),e.signal)})},g=OE(e.options,e.fetchOptions),v=async(S,x,T)=>{if(h)return Promise.reject();if(x==null&&S.pages.length)return Promise.resolve(S);const E=(()=>{const D={client:e.client,queryKey:e.queryKey,pageParam:x,direction:T?"backward":"forward",meta:e.options.meta};return m(D),D})(),R=await g(E),{maxPages:L}=e.options,w=T?aD:rD;return{pages:w(S.pages,R,L),pageParams:w(S.pageParams,x,L)}};if(i&&r.length){const S=i==="backward",x=S?FE:Pg,T={pages:r,pageParams:a},A=x(s,T);l=await v(T,A,S)}else{const S=n??r.length;do{const x=u===0?a[0]??s.initialPageParam:Pg(s,l);if(u>0&&x==null)break;l=await v(l,x),u++}while(u<S)}return l};e.options.persister?e.fetchFn=()=>e.options.persister?.(d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=d}}}function Pg(n,{pages:e,pageParams:t}){const s=e.length-1;return e.length>0?n.getNextPageParam(e[s],e,t[s],t):void 0}function FE(n,{pages:e,pageParams:t}){return e.length>0?n.getPreviousPageParam?.(e[0],e,t[0],t):void 0}function AD(n,e){return e?Pg(n,e)!=null:!1}function ID(n,e){return!e||!n.getPreviousPageParam?!1:FE(n,e)!=null}var RD=class extends UE{constructor(n,e){super(n,e)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(n){super.setOptions({...n,behavior:Ch()})}getOptimisticResult(n){return n.behavior=Ch(),super.getOptimisticResult(n)}fetchNextPage(n){return this.fetch({...n,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(n){return this.fetch({...n,meta:{fetchMore:{direction:"backward"}}})}createResult(n,e){const{state:t}=n,s=super.createResult(n,e),{isFetching:i,isRefetching:r,isError:a,isRefetchError:l}=s,u=t.fetchMeta?.fetchMore?.direction,d=a&&u==="forward",h=i&&u==="forward",m=a&&u==="backward",g=i&&u==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:AD(e,t.data),hasPreviousPage:ID(e,t.data),isFetchNextPageError:d,isFetchingNextPage:h,isFetchPreviousPageError:m,isFetchingPreviousPage:g,isRefetchError:l&&!d&&!m,isRefetching:r&&!h&&!g}}},wD=class extends kE{#e;#t;#s;#i;constructor(n){super(),this.#e=n.client,this.mutationId=n.mutationId,this.#s=n.mutationCache,this.#t=[],this.state=n.state||CD(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){this.#t.includes(n)||(this.#t.push(n),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){this.#t=this.#t.filter(e=>e!==n),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(n){const e=()=>{this.#n({type:"continue"})},t={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=NE({fn:()=>this.options.mutationFn?this.options.mutationFn(n,t):Promise.reject(new Error("No mutationFn found")),onFail:(r,a)=>{this.#n({type:"failed",failureCount:r,error:a})},onPause:()=>{this.#n({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const s=this.state.status==="pending",i=!this.#i.canStart();try{if(s)e();else{this.#n({type:"pending",variables:n,isPaused:i}),await this.#s.config.onMutate?.(n,this,t);const a=await this.options.onMutate?.(n,t);a!==this.state.context&&this.#n({type:"pending",context:a,variables:n,isPaused:i})}const r=await this.#i.start();return await this.#s.config.onSuccess?.(r,n,this.state.context,this,t),await this.options.onSuccess?.(r,n,this.state.context,t),await this.#s.config.onSettled?.(r,null,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(r,null,n,this.state.context,t),this.#n({type:"success",data:r}),r}catch(r){try{throw await this.#s.config.onError?.(r,n,this.state.context,this,t),await this.options.onError?.(r,n,this.state.context,t),await this.#s.config.onSettled?.(void 0,r,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(void 0,r,n,this.state.context,t),r}finally{this.#n({type:"error",error:r})}}finally{this.#s.runNext(this)}}#n(n){const e=t=>{switch(n.type){case"failed":return{...t,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...t,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:n.error,failureCount:t.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=e(this.state),gn.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(n)}),this.#s.notify({mutation:this,type:"updated",action:n})})}};function CD(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var LD=class extends ou{constructor(n={}){super(),this.config=n,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(n,e,t){const s=new wD({client:n,mutationCache:this,mutationId:++this.#s,options:n.defaultMutationOptions(e),state:t});return this.add(s),s}add(n){this.#e.add(n);const e=kd(n);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(n):this.#t.set(e,[n])}this.notify({type:"added",mutation:n})}remove(n){if(this.#e.delete(n)){const e=kd(n);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const s=t.indexOf(n);s!==-1&&t.splice(s,1)}else t[0]===n&&this.#t.delete(e)}}this.notify({type:"removed",mutation:n})}canRun(n){const e=kd(n);if(typeof e=="string"){const s=this.#t.get(e)?.find(i=>i.state.status==="pending");return!s||s===n}else return!0}runNext(n){const e=kd(n);return typeof e=="string"?this.#t.get(e)?.find(s=>s!==n&&s.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){gn.batch(()=>{this.#e.forEach(n=>{this.notify({type:"removed",mutation:n})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(n){const e={exact:!0,...n};return this.getAll().find(t=>F1(e,t))}findAll(n={}){return this.getAll().filter(e=>F1(n,e))}notify(n){gn.batch(()=>{this.listeners.forEach(e=>{e(n)})})}resumePausedMutations(){const n=this.getAll().filter(e=>e.state.isPaused);return gn.batch(()=>Promise.all(n.map(e=>e.continue().catch(En))))}};function kd(n){return n.options.scope?.id}var DD=class extends ou{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,e,t){const s=e.queryKey,i=e.queryHash??N0(s,e);let r=this.get(i);return r||(r=new bD({client:n,queryKey:s,queryHash:i,options:n.defaultQueryOptions(e),state:t,defaultOptions:n.getQueryDefaults(s)}),this.add(r)),r}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const e=this.#e.get(n.queryHash);e&&(n.destroy(),e===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){gn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const e={exact:!0,...n};return this.getAll().find(t=>U1(e,t))}findAll(n={}){const e=this.getAll();return Object.keys(n).length>0?e.filter(t=>U1(n,t)):e}notify(n){gn.batch(()=>{this.listeners.forEach(e=>{e(n)})})}onFocus(){gn.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){gn.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},OD=class{#e;#t;#s;#i;#n;#o;#a;#r;constructor(n={}){this.#e=n.queryCache||new DD,this.#t=n.mutationCache||new LD,this.#s=n.defaultOptions||{},this.#i=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=M0.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#r=wh.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#r?.(),this.#r=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=this.#e.build(this,e),s=t.state.data;return s===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(ya(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(s))}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:e,state:t})=>{const s=t.data;return[e,s]})}setQueryData(n,e,t){const s=this.defaultQueryOptions({queryKey:n}),r=this.#e.get(s.queryHash)?.state.data,a=sD(e,r);if(a!==void 0)return this.#e.build(this,s).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return gn.batch(()=>this.#e.findAll(n).map(({queryKey:s})=>[s,this.setQueryData(s,e,t)]))}getQueryState(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state}removeQueries(n){const e=this.#e;gn.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=this.#e;return gn.batch(()=>(t.findAll(n).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},s=gn.batch(()=>this.#e.findAll(n).map(i=>i.cancel(t)));return Promise.all(s).then(En).catch(En)}invalidateQueries(n,e={}){return gn.batch(()=>(this.#e.findAll(n).forEach(t=>{t.invalidate()}),n?.refetchType==="none"?Promise.resolve():this.refetchQueries({...n,type:n?.refetchType??n?.type??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},s=gn.batch(()=>this.#e.findAll(n).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let r=i.fetch(void 0,t);return t.throwOnError||(r=r.catch(En)),i.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(s).then(En)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(ya(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(En).catch(En)}fetchInfiniteQuery(n){return n.behavior=Ch(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(En).catch(En)}ensureInfiniteQueryData(n){return n.behavior=Ch(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return wh.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(n){this.#s=n}setQueryDefaults(n,e){this.#i.set($c(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...this.#i.values()],t={};return e.forEach(s=>{Gc(n,s.queryKey)&&Object.assign(t,s.defaultOptions)}),t}setMutationDefaults(n,e){this.#n.set($c(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...this.#n.values()],t={};return e.forEach(s=>{Gc(n,s.mutationKey)&&Object.assign(t,s.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...this.#s.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=N0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===k0&&(e.enabled=!1),e}defaultMutationOptions(n){return n?._defaulted?n:{...this.#s.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},BE=C.createContext(void 0),lu=n=>{const e=C.useContext(BE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},jE=({client:n,children:e})=>(C.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),y.jsx(BE.Provider,{value:n,children:e})),VE=C.createContext(!1),_D=()=>C.useContext(VE),PD=VE.Provider;function ND(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var kD=C.createContext(ND()),MD=()=>C.useContext(kD),UD=(n,e)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(e.isReset()||(n.retryOnMount=!1))},FD=n=>{C.useEffect(()=>{n.clearReset()},[n])},BD=({result:n,errorResetBoundary:e,throwOnError:t,query:s,suspense:i})=>n.isError&&!e.isReset()&&!n.isFetching&&s&&(i&&n.data===void 0||oD(t,[n.error,s])),jD=n=>{if(n.suspense){const t=i=>i==="static"?i:Math.max(i??1e3,1e3),s=n.staleTime;n.staleTime=typeof s=="function"?(...i)=>t(s(...i)):t(s),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3))}},VD=(n,e)=>n.isLoading&&n.isFetching&&!e,$D=(n,e)=>n?.suspense&&e.isPending,H1=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function $E(n,e,t){const s=_D(),i=MD(),r=lu(),a=r.defaultQueryOptions(n);r.getDefaultOptions().queries?._experimental_beforeQuery?.(a),a._optimisticResults=s?"isRestoring":"optimistic",jD(a),UD(a,i),FD(i);const l=!r.getQueryCache().get(a.queryHash),[u]=C.useState(()=>new e(r,a)),d=u.getOptimisticResult(a),h=!s&&n.subscribed!==!1;if(C.useSyncExternalStore(C.useCallback(m=>{const g=h?u.subscribe(gn.batchCalls(m)):En;return u.updateResult(),g},[u,h]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),C.useEffect(()=>{u.setOptions(a)},[a,u]),$D(a,d))throw H1(a,u,i);if(BD({result:d,errorResetBoundary:i,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw d.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(a,d),a.experimental_prefetchInRender&&!Ja&&VD(d,s)&&(l?H1(a,u,i):r.getQueryCache().get(a.queryHash)?.promise)?.catch(En).finally(()=>{u.updateResult()}),a.notifyOnChangeProps?d:u.trackResult(d)}function nn(n,e){return $E(n,UE)}function GE(n,e){return $E(n,RD)}var GD=["added","removed","updated"];function z1(n){return GD.includes(n)}async function HD({queryClient:n,persister:e,maxAge:t=1e3*60*60*24,buster:s="",hydrateOptions:i}){try{const r=await e.restoreClient();if(r)if(r.timestamp){const a=Date.now()-r.timestamp>t,l=r.buster!==s;if(a||l)return e.removeClient();gD(n,r.clientState,i)}else return e.removeClient()}catch(r){throw await e.removeClient(),r}}async function K1({queryClient:n,persister:e,buster:t="",dehydrateOptions:s}){const i={buster:t,timestamp:Date.now(),clientState:pD(n,s)};await e.persistClient(i)}function zD(n){const e=n.queryClient.getQueryCache().subscribe(s=>{z1(s.type)&&K1(n)}),t=n.queryClient.getMutationCache().subscribe(s=>{z1(s.type)&&K1(n)});return()=>{e(),t()}}var KD=({children:n,persistOptions:e,onSuccess:t,onError:s,...i})=>{const[r,a]=C.useState(!0),l=C.useRef({persistOptions:e,onSuccess:t,onError:s}),u=C.useRef(!1);return C.useEffect(()=>{l.current={persistOptions:e,onSuccess:t,onError:s}}),C.useEffect(()=>{const d={...l.current.persistOptions,queryClient:i.client};return u.current||(u.current=!0,HD(d).then(()=>l.current.onSuccess?.()).catch(()=>l.current.onError?.()).finally(()=>{a(!1)})),r?void 0:zD(d)},[i.client,r]),y.jsx(jE,{...i,children:y.jsx(PD,{value:r,children:n})})};/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Y1="popstate";function YD(n={}){function e(s,i){let{pathname:r,search:a,hash:l}=s.location;return Ng("",{pathname:r,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(s,i){return typeof i=="string"?i:Hc(i)}return QD(e,t,null,n)}function xs(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function wi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qD(){return Math.random().toString(36).substring(2,10)}function q1(n,e){return{usr:n.state,key:n.key,idx:e}}function Ng(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?ml(e):e,state:t,key:e&&e.key||s||qD()}}function Hc({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function ml(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function QD(n,e,t,s={}){let{window:i=document.defaultView,v5Compat:r=!1}=s,a=i.history,l="POP",u=null,d=h();d==null&&(d=0,a.replaceState({...a.state,idx:d},""));function h(){return(a.state||{idx:null}).idx}function m(){l="POP";let T=h(),A=T==null?null:T-d;d=T,u&&u({action:l,location:x.location,delta:A})}function g(T,A){l="PUSH";let E=Ng(x.location,T,A);d=h()+1;let R=q1(E,d),L=x.createHref(E);try{a.pushState(R,"",L)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;i.location.assign(L)}r&&u&&u({action:l,location:x.location,delta:1})}function v(T,A){l="REPLACE";let E=Ng(x.location,T,A);d=h();let R=q1(E,d),L=x.createHref(E);a.replaceState(R,"",L),r&&u&&u({action:l,location:x.location,delta:0})}function S(T){return XD(T)}let x={get action(){return l},get location(){return n(i,a)},listen(T){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(Y1,m),u=T,()=>{i.removeEventListener(Y1,m),u=null}},createHref(T){return e(i,T)},createURL:S,encodeLocation(T){let A=S(T);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:g,replace:v,go(T){return a.go(T)}};return x}function XD(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),xs(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:Hc(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function HE(n,e,t="/"){return WD(n,e,t,!1)}function WD(n,e,t,s){let i=typeof e=="string"?ml(e):e,r=Ur(i.pathname||"/",t);if(r==null)return null;let a=zE(n);ZD(a);let l=null;for(let u=0;l==null&&u<a.length;++u){let d=cO(r);l=oO(a[u],d,s)}return l}function zE(n,e=[],t=[],s="",i=!1){let r=(a,l,u=i,d)=>{let h={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(s)&&u)return;xs(h.relativePath.startsWith(s),`Absolute route path "${h.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(s.length)}let m=Mr([s,h.relativePath]),g=t.concat(h);a.children&&a.children.length>0&&(xs(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),zE(a.children,e,g,m,u)),!(a.path==null&&!a.index)&&e.push({path:m,score:rO(m,a.index),routesMeta:g})};return n.forEach((a,l)=>{if(a.path===""||!a.path?.includes("?"))r(a,l);else for(let u of KE(a.path))r(a,l,!0,u)}),e}function KE(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let a=KE(s.join("/")),l=[];return l.push(...a.map(u=>u===""?r:[r,u].join("/"))),i&&l.push(...a),l.map(u=>n.startsWith("/")&&u===""?"/":u)}function ZD(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:aO(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var JD=/^:[\w-]+$/,eO=3,tO=2,sO=1,nO=10,iO=-2,Q1=n=>n==="*";function rO(n,e){let t=n.split("/"),s=t.length;return t.some(Q1)&&(s+=iO),e&&(s+=tO),t.filter(i=>!Q1(i)).reduce((i,r)=>i+(JD.test(r)?eO:r===""?sO:nO),s)}function aO(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function oO(n,e,t=!1){let{routesMeta:s}=n,i={},r="/",a=[];for(let l=0;l<s.length;++l){let u=s[l],d=l===s.length-1,h=r==="/"?e:e.slice(r.length)||"/",m=Lh({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),g=u.route;if(!m&&d&&t&&!s[s.length-1].route.index&&(m=Lh({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},h)),!m)return null;Object.assign(i,m.params),a.push({params:i,pathname:Mr([r,m.pathname]),pathnameBase:fO(Mr([r,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(r=Mr([r,m.pathnameBase]))}return a}function Lh(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=lO(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:s.reduce((d,{paramName:h,isOptional:m},g)=>{if(h==="*"){let S=l[g]||"";a=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const v=l[g];return m&&!v?d[h]=void 0:d[h]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:r,pathnameBase:a,pattern:n}}function lO(n,e=!1,t=!0){wi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,u)=>(s.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function cO(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ur(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function uO(n,e="/"){let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?ml(n):n;return{pathname:t?t.startsWith("/")?t:dO(t,e):e,search:mO(s),hash:pO(i)}}function dO(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Op(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hO(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function F0(n){let e=hO(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function B0(n,e,t,s=!1){let i;typeof n=="string"?i=ml(n):(i={...n},xs(!i.pathname||!i.pathname.includes("?"),Op("?","pathname","search",i)),xs(!i.pathname||!i.pathname.includes("#"),Op("#","pathname","hash",i)),xs(!i.search||!i.search.includes("#"),Op("#","search","hash",i)));let r=n===""||i.pathname==="",a=r?"/":i.pathname,l;if(a==null)l=t;else{let m=e.length-1;if(!s&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),m-=1;i.pathname=g.join("/")}l=m>=0?e[m]:"/"}let u=uO(i,l),d=a&&a!=="/"&&a.endsWith("/"),h=(r||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}var Mr=n=>n.join("/").replace(/\/\/+/g,"/"),fO=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),mO=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,pO=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function gO(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var YE=["POST","PUT","PATCH","DELETE"];new Set(YE);var yO=["GET",...YE];new Set(yO);var pl=C.createContext(null);pl.displayName="DataRouter";var Jh=C.createContext(null);Jh.displayName="DataRouterState";C.createContext(!1);var qE=C.createContext({isTransitioning:!1});qE.displayName="ViewTransition";var vO=C.createContext(new Map);vO.displayName="Fetchers";var xO=C.createContext(null);xO.displayName="Await";var Gi=C.createContext(null);Gi.displayName="Navigation";var gl=C.createContext(null);gl.displayName="Location";var Hi=C.createContext({outlet:null,matches:[],isDataRoute:!1});Hi.displayName="Route";var j0=C.createContext(null);j0.displayName="RouteError";function SO(n,{relative:e}={}){xs(yl(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=C.useContext(Gi),{hash:i,pathname:r,search:a}=cu(n,{relative:e}),l=r;return t!=="/"&&(l=r==="/"?t:Mr([t,r])),s.createHref({pathname:l,search:a,hash:i})}function yl(){return C.useContext(gl)!=null}function xn(){return xs(yl(),"useLocation() may be used only in the context of a <Router> component."),C.useContext(gl).location}function bO(){return C.useContext(gl).navigationType}var QE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function XE(n){C.useContext(Gi).static||C.useLayoutEffect(n)}function Ea(){let{isDataRoute:n}=C.useContext(Hi);return n?NO():TO()}function TO(){xs(yl(),"useNavigate() may be used only in the context of a <Router> component.");let n=C.useContext(pl),{basename:e,navigator:t}=C.useContext(Gi),{matches:s}=C.useContext(Hi),{pathname:i}=xn(),r=JSON.stringify(F0(s)),a=C.useRef(!1);return XE(()=>{a.current=!0}),C.useCallback((u,d={})=>{if(wi(a.current,QE),!a.current)return;if(typeof u=="number"){t.go(u);return}let h=B0(u,JSON.parse(r),i,d.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Mr([e,h.pathname])),(d.replace?t.replace:t.push)(h,d.state,d)},[e,t,r,i,n])}C.createContext(null);function no(){let{matches:n}=C.useContext(Hi),e=n[n.length-1];return e?e.params:{}}function cu(n,{relative:e}={}){let{matches:t}=C.useContext(Hi),{pathname:s}=xn(),i=JSON.stringify(F0(t));return C.useMemo(()=>B0(n,JSON.parse(i),s,e==="path"),[n,i,s,e])}function EO(n,e){return WE(n,e)}function WE(n,e,t,s,i){xs(yl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=C.useContext(Gi),{matches:a}=C.useContext(Hi),l=a[a.length-1],u=l?l.params:{},d=l?l.pathname:"/",h=l?l.pathnameBase:"/",m=l&&l.route;{let E=m&&m.path||"";ZE(d,!m||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let g=xn(),v;if(e){let E=typeof e=="string"?ml(e):e;xs(h==="/"||E.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${E.pathname}" was given in the \`location\` prop.`),v=E}else v=g;let S=v.pathname||"/",x=S;if(h!=="/"){let E=h.replace(/^\//,"").split("/");x="/"+S.replace(/^\//,"").split("/").slice(E.length).join("/")}let T=HE(n,{pathname:x});wi(m||T!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),wi(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=CO(T&&T.map(E=>Object.assign({},E,{params:Object.assign({},u,E.params),pathname:Mr([h,r.encodeLocation?r.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?h:Mr([h,r.encodeLocation?r.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),a,t,s,i);return e&&A?C.createElement(gl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},A):A}function AO(){let n=PO(),e=gO(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},r={padding:"2px 4px",backgroundColor:s},a=null;return console.error("Error handled by React Router default ErrorBoundary:",n),a=C.createElement(C.Fragment,null,C.createElement("p",null," Hey developer "),C.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",C.createElement("code",{style:r},"ErrorBoundary")," or"," ",C.createElement("code",{style:r},"errorElement")," prop on your route.")),C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),t?C.createElement("pre",{style:i},t):null,a)}var IO=C.createElement(AO,null),RO=class extends C.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?C.createElement(Hi.Provider,{value:this.props.routeContext},C.createElement(j0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function wO({routeContext:n,match:e,children:t}){let s=C.useContext(pl);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(Hi.Provider,{value:n},t)}function CO(n,e=[],t=null,s=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let r=n,a=t?.errors;if(a!=null){let d=r.findIndex(h=>h.route.id&&a?.[h.route.id]!==void 0);xs(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),r=r.slice(0,Math.min(r.length,d+1))}let l=!1,u=-1;if(t)for(let d=0;d<r.length;d++){let h=r[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:m,errors:g}=t,v=h.route.loader&&!m.hasOwnProperty(h.route.id)&&(!g||g[h.route.id]===void 0);if(h.route.lazy||v){l=!0,u>=0?r=r.slice(0,u+1):r=[r[0]];break}}}return r.reduceRight((d,h,m)=>{let g,v=!1,S=null,x=null;t&&(g=a&&h.route.id?a[h.route.id]:void 0,S=h.route.errorElement||IO,l&&(u<0&&m===0?(ZE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,x=null):u===m&&(v=!0,x=h.route.hydrateFallbackElement||null)));let T=e.concat(r.slice(0,m+1)),A=()=>{let E;return g?E=S:v?E=x:h.route.Component?E=C.createElement(h.route.Component,null):h.route.element?E=h.route.element:E=d,C.createElement(wO,{match:h,routeContext:{outlet:d,matches:T,isDataRoute:t!=null},children:E})};return t&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?C.createElement(RO,{location:t.location,revalidation:t.revalidation,component:S,error:g,children:A(),routeContext:{outlet:null,matches:T,isDataRoute:!0},unstable_onError:s}):A()},null)}function V0(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function LO(n){let e=C.useContext(pl);return xs(e,V0(n)),e}function DO(n){let e=C.useContext(Jh);return xs(e,V0(n)),e}function OO(n){let e=C.useContext(Hi);return xs(e,V0(n)),e}function $0(n){let e=OO(n),t=e.matches[e.matches.length-1];return xs(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function _O(){return $0("useRouteId")}function PO(){let n=C.useContext(j0),e=DO("useRouteError"),t=$0("useRouteError");return n!==void 0?n:e.errors?.[t]}function NO(){let{router:n}=LO("useNavigate"),e=$0("useNavigate"),t=C.useRef(!1);return XE(()=>{t.current=!0}),C.useCallback(async(i,r={})=>{wi(t.current,QE),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...r}))},[n,e])}var X1={};function ZE(n,e,t){!e&&!X1[n]&&(X1[n]=!0,wi(!1,t))}C.memo(kO);function kO({routes:n,future:e,state:t,unstable_onError:s}){return WE(n,void 0,t,s,e)}function kg({to:n,replace:e,state:t,relative:s}){xs(yl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=C.useContext(Gi);wi(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=C.useContext(Hi),{pathname:a}=xn(),l=Ea(),u=B0(n,F0(r),a,s==="path"),d=JSON.stringify(u);return C.useEffect(()=>{l(JSON.parse(d),{replace:e,state:t,relative:s})},[l,d,s,e,t]),null}function rs(n){xs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function MO({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:i,static:r=!1}){xs(!yl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),l=C.useMemo(()=>({basename:a,navigator:i,static:r,future:{}}),[a,i,r]);typeof t=="string"&&(t=ml(t));let{pathname:u="/",search:d="",hash:h="",state:m=null,key:g="default"}=t,v=C.useMemo(()=>{let S=Ur(u,a);return S==null?null:{location:{pathname:S,search:d,hash:h,state:m,key:g},navigationType:s}},[a,u,d,h,m,g,s]);return wi(v!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:C.createElement(Gi.Provider,{value:l},C.createElement(gl.Provider,{children:e,value:v}))}function Mg({children:n,location:e}){return EO(Ug(n),e)}function Ug(n,e=[]){let t=[];return C.Children.forEach(n,(s,i)=>{if(!C.isValidElement(s))return;let r=[...e,i];if(s.type===C.Fragment){t.push.apply(t,Ug(s.props.children,r));return}xs(s.type===rs,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xs(!s.props.index||!s.props.children,"An index route cannot have child routes.");let a={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=Ug(s.props.children,r)),t.push(a)}),t}var ch="get",uh="application/x-www-form-urlencoded";function ef(n){return n!=null&&typeof n.tagName=="string"}function UO(n){return ef(n)&&n.tagName.toLowerCase()==="button"}function FO(n){return ef(n)&&n.tagName.toLowerCase()==="form"}function BO(n){return ef(n)&&n.tagName.toLowerCase()==="input"}function jO(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function VO(n,e){return n.button===0&&(!e||e==="_self")&&!jO(n)}function Fg(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let s=n[t];return e.concat(Array.isArray(s)?s.map(i=>[t,i]):[[t,s]])},[]))}function $O(n,e){let t=Fg(n);return e&&e.forEach((s,i)=>{t.has(i)||e.getAll(i).forEach(r=>{t.append(i,r)})}),t}var Md=null;function GO(){if(Md===null)try{new FormData(document.createElement("form"),0),Md=!1}catch{Md=!0}return Md}var HO=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _p(n){return n!=null&&!HO.has(n)?(wi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${uh}"`),null):n}function zO(n,e){let t,s,i,r,a;if(FO(n)){let l=n.getAttribute("action");s=l?Ur(l,e):null,t=n.getAttribute("method")||ch,i=_p(n.getAttribute("enctype"))||uh,r=new FormData(n)}else if(UO(n)||BO(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||l.getAttribute("action");if(s=u?Ur(u,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||ch,i=_p(n.getAttribute("formenctype"))||_p(l.getAttribute("enctype"))||uh,r=new FormData(l,n),!GO()){let{name:d,type:h,value:m}=n;if(h==="image"){let g=d?`${d}.`:"";r.append(`${g}x`,"0"),r.append(`${g}y`,"0")}else d&&r.append(d,m)}}else{if(ef(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=ch,s=null,i=uh,a=n}return r&&i==="text/plain"&&(a=r,r=void 0),{action:s,method:t.toLowerCase(),encType:i,formData:r,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function G0(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function KO(n,e,t){let s=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Ur(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function YO(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function qO(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function QO(n,e,t){let s=await Promise.all(n.map(async i=>{let r=e.routes[i.route.id];if(r){let a=await YO(r,t);return a.links?a.links():[]}return[]}));return JO(s.flat(1).filter(qO).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function W1(n,e,t,s,i,r){let a=(u,d)=>t[d]?u.route.id!==t[d].route.id:!0,l=(u,d)=>t[d].pathname!==u.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==u.params["*"];return r==="assets"?e.filter((u,d)=>a(u,d)||l(u,d)):r==="data"?e.filter((u,d)=>{let h=s.routes[u.route.id];if(!h||!h.hasLoader)return!1;if(a(u,d)||l(u,d))return!0;if(u.route.shouldRevalidate){let m=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function XO(n,e,{includeHydrateFallback:t}={}){return WO(n.map(s=>{let i=e.routes[s.route.id];if(!i)return[];let r=[i.module];return i.clientActionModule&&(r=r.concat(i.clientActionModule)),i.clientLoaderModule&&(r=r.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(r=r.concat(i.hydrateFallbackModule)),i.imports&&(r=r.concat(i.imports)),r}).flat(1))}function WO(n){return[...new Set(n)]}function ZO(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function JO(n,e){let t=new Set;return new Set(e),n.reduce((s,i)=>{let r=JSON.stringify(ZO(i));return t.has(r)||(t.add(r),s.push({key:r,link:i})),s},[])}function JE(){let n=C.useContext(pl);return G0(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function e_(){let n=C.useContext(Jh);return G0(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var H0=C.createContext(void 0);H0.displayName="FrameworkContext";function eA(){let n=C.useContext(H0);return G0(n,"You must render this element inside a <HydratedRouter> element"),n}function t_(n,e){let t=C.useContext(H0),[s,i]=C.useState(!1),[r,a]=C.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:d,onMouseLeave:h,onTouchStart:m}=e,g=C.useRef(null);C.useEffect(()=>{if(n==="render"&&a(!0),n==="viewport"){let x=A=>{A.forEach(E=>{a(E.isIntersecting)})},T=new IntersectionObserver(x,{threshold:.5});return g.current&&T.observe(g.current),()=>{T.disconnect()}}},[n]),C.useEffect(()=>{if(s){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[s]);let v=()=>{i(!0)},S=()=>{i(!1),a(!1)};return t?n!=="intent"?[r,g,{}]:[r,g,{onFocus:Ac(l,v),onBlur:Ac(u,S),onMouseEnter:Ac(d,v),onMouseLeave:Ac(h,S),onTouchStart:Ac(m,v)}]:[!1,g,{}]}function Ac(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function s_({page:n,...e}){let{router:t}=JE(),s=C.useMemo(()=>HE(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?C.createElement(i_,{page:n,matches:s,...e}):null}function n_(n){let{manifest:e,routeModules:t}=eA(),[s,i]=C.useState([]);return C.useEffect(()=>{let r=!1;return QO(n,e,t).then(a=>{r||i(a)}),()=>{r=!0}},[n,e,t]),s}function i_({page:n,matches:e,...t}){let s=xn(),{manifest:i,routeModules:r}=eA(),{basename:a}=JE(),{loaderData:l,matches:u}=e_(),d=C.useMemo(()=>W1(n,e,u,i,s,"data"),[n,e,u,i,s]),h=C.useMemo(()=>W1(n,e,u,i,s,"assets"),[n,e,u,i,s]),m=C.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let S=new Set,x=!1;if(e.forEach(A=>{let E=i.routes[A.route.id];!E||!E.hasLoader||(!d.some(R=>R.route.id===A.route.id)&&A.route.id in l&&r[A.route.id]?.shouldRevalidate||E.hasClientLoader?x=!0:S.add(A.route.id))}),S.size===0)return[];let T=KO(n,a,"data");return x&&S.size>0&&T.searchParams.set("_routes",e.filter(A=>S.has(A.route.id)).map(A=>A.route.id).join(",")),[T.pathname+T.search]},[a,l,s,i,d,e,n,r]),g=C.useMemo(()=>XO(h,i),[h,i]),v=n_(h);return C.createElement(C.Fragment,null,m.map(S=>C.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...t})),g.map(S=>C.createElement("link",{key:S,rel:"modulepreload",href:S,...t})),v.map(({key:S,link:x})=>C.createElement("link",{key:S,nonce:t.nonce,...x})))}function r_(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var tA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{tA&&(window.__reactRouterVersion="7.9.1")}catch{}function a_({basename:n,children:e,window:t}){let s=C.useRef();s.current==null&&(s.current=YD({window:t,v5Compat:!0}));let i=s.current,[r,a]=C.useState({action:i.action,location:i.location}),l=C.useCallback(u=>{C.startTransition(()=>a(u))},[a]);return C.useLayoutEffect(()=>i.listen(l),[i,l]),C.createElement(MO,{basename:n,children:e,location:r.location,navigationType:r.action,navigator:i})}var sA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sn=C.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:i,reloadDocument:r,replace:a,state:l,target:u,to:d,preventScrollReset:h,viewTransition:m,...g},v){let{basename:S}=C.useContext(Gi),x=typeof d=="string"&&sA.test(d),T,A=!1;if(typeof d=="string"&&x&&(T=d,tA))try{let N=new URL(window.location.href),F=d.startsWith("//")?new URL(N.protocol+d):new URL(d),V=Ur(F.pathname,S);F.origin===N.origin&&V!=null?d=V+F.search+F.hash:A=!0}catch{wi(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=SO(d,{relative:i}),[R,L,w]=t_(s,g),D=c_(d,{replace:a,state:l,target:u,preventScrollReset:h,relative:i,viewTransition:m});function _(N){e&&e(N),N.defaultPrevented||D(N)}let k=C.createElement("a",{...g,...w,href:T||E,onClick:A||r?e:_,ref:r_(v,L),target:u,"data-discover":!x&&t==="render"?"true":void 0});return R&&!x?C.createElement(C.Fragment,null,k,C.createElement(s_,{page:E})):k});sn.displayName="Link";var ei=C.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:i=!1,style:r,to:a,viewTransition:l,children:u,...d},h){let m=cu(a,{relative:d.relative}),g=xn(),v=C.useContext(Jh),{navigator:S,basename:x}=C.useContext(Gi),T=v!=null&&p_(m)&&l===!0,A=S.encodeLocation?S.encodeLocation(m).pathname:m.pathname,E=g.pathname,R=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(E=E.toLowerCase(),R=R?R.toLowerCase():null,A=A.toLowerCase()),R&&x&&(R=Ur(R,x)||R);const L=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let w=E===A||!i&&E.startsWith(A)&&E.charAt(L)==="/",D=R!=null&&(R===A||!i&&R.startsWith(A)&&R.charAt(A.length)==="/"),_={isActive:w,isPending:D,isTransitioning:T},k=w?e:void 0,N;typeof s=="function"?N=s(_):N=[s,w?"active":null,D?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let F=typeof r=="function"?r(_):r;return C.createElement(sn,{...d,"aria-current":k,className:N,ref:h,style:F,to:a,viewTransition:l},typeof u=="function"?u(_):u)});ei.displayName="NavLink";var o_=C.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:i,state:r,method:a=ch,action:l,onSubmit:u,relative:d,preventScrollReset:h,viewTransition:m,...g},v)=>{let S=f_(),x=m_(l,{relative:d}),T=a.toLowerCase()==="get"?"get":"post",A=typeof l=="string"&&sA.test(l),E=R=>{if(u&&u(R),R.defaultPrevented)return;R.preventDefault();let L=R.nativeEvent.submitter,w=L?.getAttribute("formmethod")||a;S(L||R.currentTarget,{fetcherKey:e,method:w,navigate:t,replace:i,state:r,relative:d,preventScrollReset:h,viewTransition:m})};return C.createElement("form",{ref:v,method:T,action:x,onSubmit:s?u:E,...g,"data-discover":!A&&n==="render"?"true":void 0})});o_.displayName="Form";function l_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nA(n){let e=C.useContext(pl);return xs(e,l_(n)),e}function c_(n,{target:e,replace:t,state:s,preventScrollReset:i,relative:r,viewTransition:a}={}){let l=Ea(),u=xn(),d=cu(n,{relative:r});return C.useCallback(h=>{if(VO(h,e)){h.preventDefault();let m=t!==void 0?t:Hc(u)===Hc(d);l(n,{replace:m,state:s,preventScrollReset:i,relative:r,viewTransition:a})}},[u,l,d,t,s,e,n,i,r,a])}function u_(n){wi(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=C.useRef(Fg(n)),t=C.useRef(!1),s=xn(),i=C.useMemo(()=>$O(s.search,t.current?null:e.current),[s.search]),r=Ea(),a=C.useCallback((l,u)=>{const d=Fg(typeof l=="function"?l(new URLSearchParams(i)):l);t.current=!0,r("?"+d,u)},[r,i]);return[i,a]}var d_=0,h_=()=>`__${String(++d_)}__`;function f_(){let{router:n}=nA("useSubmit"),{basename:e}=C.useContext(Gi),t=_O();return C.useCallback(async(s,i={})=>{let{action:r,method:a,encType:l,formData:u,body:d}=zO(s,e);if(i.navigate===!1){let h=i.fetcherKey||h_();await n.fetch(h,t,i.action||r,{preventScrollReset:i.preventScrollReset,formData:u,body:d,formMethod:i.method||a,formEncType:i.encType||l,flushSync:i.flushSync})}else await n.navigate(i.action||r,{preventScrollReset:i.preventScrollReset,formData:u,body:d,formMethod:i.method||a,formEncType:i.encType||l,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function m_(n,{relative:e}={}){let{basename:t}=C.useContext(Gi),s=C.useContext(Hi);xs(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),r={...cu(n||".",{relative:e})},a=xn();if(n==null){r.search=a.search;let l=new URLSearchParams(r.search),u=l.getAll("index");if(u.some(h=>h==="")){l.delete("index"),u.filter(m=>m).forEach(m=>l.append("index",m));let h=l.toString();r.search=h?`?${h}`:""}}return(!n||n===".")&&i.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Mr([t,r.pathname])),Hc(r)}function p_(n,{relative:e}={}){let t=C.useContext(qE);xs(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=nA("useViewTransitionState"),i=cu(n,{relative:e});if(!t.isTransitioning)return!1;let r=Ur(t.currentLocation.pathname,s)||t.currentLocation.pathname,a=Ur(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Lh(i.pathname,a)!=null||Lh(i.pathname,r)!=null}var el=CE();const g_=_0(el),iA=C.createContext({}),di=()=>C.useContext(iA),y_=()=>di().dropdownNode;function Pp(){}function v_({storage:n,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:t=1e3,serialize:s=JSON.stringify,deserialize:i=JSON.parse,retry:r}){if(n){const a=l=>{try{n.setItem(e,s(l));return}catch(u){return u}};return{persistClient:x_(l=>{let u=l,d=a(u),h=0;for(;d&&u;)h++,u=r?.({persistedClient:u,error:d,errorCount:h}),u&&(d=a(u))},t),restoreClient:()=>{const l=n.getItem(e);if(l)return i(l)},removeClient:()=>{n.removeItem(e)}}}return{persistClient:Pp,restoreClient:Pp,removeClient:Pp}}function x_(n,e=100){let t=null,s;return function(...i){s=i,t===null&&(t=ga.setTimeout(()=>{n(...s),t=null},e))}}const Bg=new OD({defaultOptions:{queries:{staleTime:1e3*60*5}}}),zc=v_({storage:window.localStorage});class S_ extends Se.Component{state={hasError:!1,error:null,showDetails:!1};static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error(e,t)}toggleDetails=()=>{this.setState(({showDetails:e})=>({showDetails:!e}))};reloadPage=async()=>{Bg.clear(),await zc.removeClient(),navigator.onLine&&(await Promise.all((await navigator.serviceWorker?.getRegistrations()||[]).map(e=>e.unregister())),await Promise.all((await window.caches?.keys()||[]).map(e=>window.caches.delete(e)))),window.location.reload()};render(){const{hasError:e,error:t,showDetails:s}=this.state;return e?y.jsxs("div",{className:"error-page",children:[y.jsx("div",{className:"error_header",children:y.jsx("div",{className:"logo"})}),y.jsxs("div",{className:"error-content",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"title",children:"Something went wrong"}),y.jsxs("div",{className:"description",children:["Try clearing cache and refreshing. If that fails, reveal the error details below and report them on"," ",y.jsx("a",{href:"https://github.com/Stannnnn/jelly-app/issues",target:"_blank",rel:"noopener noreferrer",className:"textlink",children:"GitHub."})," ","Consider removing sensitive info (like IP or URL) before sharing."]}),y.jsxs("div",{className:"error-actions noSelect",children:[y.jsx("button",{onClick:this.toggleDetails,className:"btn-details",children:s?"Hide Details":"Show Error"}),y.jsx("button",{onClick:this.reloadPage,className:"btn-reload",children:"Clear & Refresh"})]})]}),y.jsx("pre",{className:`error-details ${s&&t?"visible":"hidden"}`,children:t?.stack||t?.toString()})]}),y.jsxs("div",{className:"disclaimer",children:["Jelly Music App - Version ","0.4.6"]})]}):this.props.children}}function Z1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function b_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z1(Object(t),!0).forEach(function(s){T_(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Z1(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function T_(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function jg(){return jg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},jg.apply(this,arguments)}function E_(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function A_(n,e){if(n==null)return{};var t=E_(n,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}var I_=["aria-label","aria-labelledby","tabIndex","className","fill","size","verticalAlign","id","title","style"],R_={small:16,medium:32,large:64};function hr(n,e,t){var s=t(),i=Object.keys(s),r=Se.forwardRef(function(a,l){var u=a["aria-label"],d=a["aria-labelledby"],h=a.tabIndex,m=a.className,g=m===void 0?"":m,v=a.fill,S=v===void 0?"currentColor":v,x=a.size,T=x===void 0?16:x,A=a.verticalAlign,E=A===void 0?"text-bottom":A,R=a.id,L=a.title,w=a.style,D=A_(a,I_),_=R_[T]||T,k=w_(i,_),N=s[k].width,F=_*(N/k),V=s[k].path,H=u||d,J=H?"img":void 0;return Se.createElement("svg",jg({ref:l},D,{"aria-hidden":H?void 0:"true",tabIndex:h,focusable:h>=0?"true":"false","aria-label":u,"aria-labelledby":d,className:"".concat(e," ").concat(g).trim(),role:J,viewBox:"0 0 ".concat(N," ").concat(k),width:F,height:_,fill:S,id:R,display:"inline-block",overflow:"visible",style:b_({verticalAlign:E},w)}),L?Se.createElement("title",null,L):null,V)});return r.displayName=n,r}function w_(n,e){return n.map(function(t){return parseInt(t,10)}).reduce(function(t,s){return s<=e?s:t},n[0])}var tf=hr("ArrowLeftIcon","octicon octicon-arrow-left",function(){return{16:{width:16,path:Se.createElement("path",{d:"M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06Z"})},24:{width:24,path:Se.createElement("path",{d:"M10.78 19.03a.75.75 0 0 1-1.06 0l-6.25-6.25a.75.75 0 0 1 0-1.06l6.25-6.25a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L5.81 11.5h14.44a.75.75 0 0 1 0 1.5H5.81l4.97 4.97a.75.75 0 0 1 0 1.06Z"})}}}),z0=hr("BookmarkFillIcon","octicon octicon-bookmark-fill",function(){return{24:{width:24,path:Se.createElement("path",{d:"M6.69 2h10.56c.966 0 1.75.784 1.75 1.75v17.5a.75.75 0 0 1-1.218.585L12 17.21l-5.781 4.626A.75.75 0 0 1 5 21.253L4.94 3.756A1.748 1.748 0 0 1 6.69 2Z"})}}}),Ic=hr("CheckCircleFillIcon","octicon octicon-check-circle-fill",function(){return{12:{width:12,path:Se.createElement("path",{d:"M6 0a6 6 0 1 1 0 12A6 6 0 0 1 6 0Zm-.705 8.737L9.63 4.403 8.392 3.166 5.295 6.263l-1.7-1.702L2.356 5.8l2.938 2.938Z"})},16:{width:16,path:Se.createElement("path",{d:"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm3.78-9.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018L6.75 9.19 5.28 7.72a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l2 2a.75.75 0 0 0 1.06 0Z"})},24:{width:24,path:Se.createElement("path",{d:"M1 12C1 5.925 5.925 1 12 1s11 4.925 11 11-4.925 11-11 11S1 18.075 1 12Zm16.28-2.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018l-5.97 5.97-2.47-2.47a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l3 3a.75.75 0 0 0 1.06 0Z"})}}}),Np=hr("ChevronDownIcon","octicon octicon-chevron-down",function(){return{12:{width:12,path:Se.createElement("path",{d:"M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-3.2 3.2c-.2.2-.4.3-.6.3Z"})},16:{width:16,path:Se.createElement("path",{d:"M12.78 5.22a.749.749 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.06 0L3.22 6.28a.749.749 0 1 1 1.06-1.06L8 8.939l3.72-3.719a.749.749 0 0 1 1.06 0Z"})},24:{width:24,path:Se.createElement("path",{d:"M5.22 8.22a.749.749 0 0 0 0 1.06l6.25 6.25a.749.749 0 0 0 1.06 0l6.25-6.25a.749.749 0 1 0-1.06-1.06L12 13.939 6.28 8.22a.749.749 0 0 0-1.06 0Z"})}}}),kp=hr("ChevronRightIcon","octicon octicon-chevron-right",function(){return{12:{width:12,path:Se.createElement("path",{d:"M4.7 10c-.2 0-.4-.1-.5-.2-.3-.3-.3-.8 0-1.1L6.9 6 4.2 3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l3.3 3.2c.3.3.3.8 0 1.1L5.3 9.7c-.2.2-.4.3-.6.3Z"})},16:{width:16,path:Se.createElement("path",{d:"M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z"})},24:{width:24,path:Se.createElement("path",{d:"M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"})}}}),C_=hr("GearIcon","octicon octicon-gear",function(){return{16:{width:16,path:Se.createElement("path",{d:"M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.038.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.038-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19.162.346.353.677.573.989.02.03.085.076.195.046l1.102-.303c.56-.153 1.113-.008 1.53.27.161.107.328.204.501.29.447.222.85.629.997 1.189l.289 1.105c.029.109.101.143.137.146a6.6 6.6 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.105c.147-.561.549-.967.998-1.189.173-.086.34-.183.5-.29.417-.278.97-.423 1.529-.27l1.103.303c.109.029.175-.016.195-.045.22-.313.411-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 0-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53-.27a4.44 4.44 0 0 0-.501-.29c-.447-.222-.85-.629-.997-1.189l-.289-1.105c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM9.5 8a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"})},24:{width:24,path:Se.createElement(Se.Fragment,null,Se.createElement("path",{d:"M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Zm-1.5 0a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"}),Se.createElement("path",{d:"M12 1c.266 0 .532.009.797.028.763.055 1.345.617 1.512 1.304l.352 1.45c.019.078.09.171.225.221.247.089.49.19.728.302.13.061.246.044.315.002l1.275-.776c.603-.368 1.411-.353 1.99.147.402.349.78.726 1.128 1.129.501.578.515 1.386.147 1.99l-.776 1.274c-.042.069-.058.185.002.315.112.238.213.481.303.728.048.135.142.205.22.225l1.45.352c.687.167 1.249.749 1.303 1.512.038.531.038 1.063 0 1.594-.054.763-.616 1.345-1.303 1.512l-1.45.352c-.078.019-.171.09-.221.225-.089.248-.19.491-.302.728-.061.13-.044.246-.002.315l.776 1.275c.368.603.353 1.411-.147 1.99-.349.402-.726.78-1.129 1.128-.578.501-1.386.515-1.99.147l-1.274-.776c-.069-.042-.185-.058-.314.002a8.606 8.606 0 0 1-.729.303c-.135.048-.205.142-.225.22l-.352 1.45c-.167.687-.749 1.249-1.512 1.303-.531.038-1.063.038-1.594 0-.763-.054-1.345-.616-1.512-1.303l-.352-1.45c-.019-.078-.09-.171-.225-.221a8.138 8.138 0 0 1-.728-.302c-.13-.061-.246-.044-.315-.002l-1.275.776c-.603.368-1.411.353-1.99-.147-.402-.349-.78-.726-1.128-1.129-.501-.578-.515-1.386-.147-1.99l.776-1.274c.042-.069.058-.185-.002-.314a8.606 8.606 0 0 1-.303-.729c-.048-.135-.142-.205-.22-.225l-1.45-.352c-.687-.167-1.249-.749-1.304-1.512a11.158 11.158 0 0 1 0-1.594c.055-.763.617-1.345 1.304-1.512l1.45-.352c.078-.019.171-.09.221-.225.089-.248.19-.491.302-.728.061-.13.044-.246.002-.315l-.776-1.275c-.368-.603-.353-1.411.147-1.99.349-.402.726-.78 1.129-1.128.578-.501 1.386-.515 1.99-.147l1.274.776c.069.042.185.058.315-.002.238-.112.481-.213.728-.303.135-.048.205-.142.225-.22l.352-1.45c.167-.687.749-1.249 1.512-1.304C11.466 1.01 11.732 1 12 1Zm-.69 1.525c-.055.004-.135.05-.161.161l-.353 1.45a1.832 1.832 0 0 1-1.172 1.277 7.147 7.147 0 0 0-.6.249 1.833 1.833 0 0 1-1.734-.074l-1.274-.776c-.098-.06-.186-.036-.228 0a9.774 9.774 0 0 0-.976.976c-.036.042-.06.131 0 .228l.776 1.274c.314.529.342 1.18.074 1.734a7.147 7.147 0 0 0-.249.6 1.831 1.831 0 0 1-1.278 1.173l-1.45.351c-.11.027-.156.107-.16.162a9.63 9.63 0 0 0 0 1.38c.004.055.05.135.161.161l1.45.353a1.832 1.832 0 0 1 1.277 1.172c.074.204.157.404.249.6.268.553.24 1.204-.074 1.733l-.776 1.275c-.06.098-.036.186 0 .228.301.348.628.675.976.976.042.036.131.06.228 0l1.274-.776a1.83 1.83 0 0 1 1.734-.075c.196.093.396.176.6.25a1.831 1.831 0 0 1 1.173 1.278l.351 1.45c.027.11.107.156.162.16a9.63 9.63 0 0 0 1.38 0c.055-.004.135-.05.161-.161l.353-1.45a1.834 1.834 0 0 1 1.172-1.278 6.82 6.82 0 0 0 .6-.248 1.831 1.831 0 0 1 1.733.074l1.275.776c.098.06.186.036.228 0 .348-.301.675-.628.976-.976.036-.042.06-.131 0-.228l-.776-1.275a1.834 1.834 0 0 1-.075-1.733c.093-.196.176-.396.25-.6a1.831 1.831 0 0 1 1.278-1.173l1.45-.351c.11-.027.156-.107.16-.162a9.63 9.63 0 0 0 0-1.38c-.004-.055-.05-.135-.161-.161l-1.45-.353c-.626-.152-1.08-.625-1.278-1.172a6.576 6.576 0 0 0-.248-.6 1.833 1.833 0 0 1 .074-1.734l.776-1.274c.06-.098.036-.186 0-.228a9.774 9.774 0 0 0-.976-.976c-.042-.036-.131-.06-.228 0l-1.275.776a1.831 1.831 0 0 1-1.733.074 6.88 6.88 0 0 0-.6-.249 1.835 1.835 0 0 1-1.173-1.278l-.351-1.45c-.027-.11-.107-.156-.162-.16a9.63 9.63 0 0 0-1.38 0Z"}))}}}),uu=hr("HeartIcon","octicon octicon-heart",function(){return{16:{width:16,path:Se.createElement("path",{d:"m8 14.25.345.666a.75.75 0 0 1-.69 0l-.008-.004-.018-.01a7.152 7.152 0 0 1-.31-.17 22.055 22.055 0 0 1-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.066 22.066 0 0 1-3.744 2.584l-.018.01-.006.003h-.002ZM4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.58 20.58 0 0 0 8 13.393a20.58 20.58 0 0 0 3.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 0 1-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5Z"})},24:{width:24,path:Se.createElement("path",{d:"m12 20.703.343.667a.748.748 0 0 1-.686 0l-.003-.002-.007-.003-.025-.013a31.138 31.138 0 0 1-5.233-3.576C3.8 15.573 1 12.332 1 8.514v-.001C1 5.053 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.148 31.148 0 0 1-5.233 3.576l-.025.013-.007.003-.002.001ZM6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.655 29.655 0 0 0 4.566 3.175l.073.041.073-.04c.271-.153.661-.38 1.13-.674.94-.588 2.19-1.441 3.436-2.502 2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.751.751 0 0 1-1.422 0C10.537 5.389 8.841 4 6.736 4Z"})}}}),ci=hr("HeartFillIcon","octicon octicon-heart-fill",function(){return{16:{width:16,path:Se.createElement("path",{d:"M7.655 14.916v-.001h-.002l-.006-.003-.018-.01a22.066 22.066 0 0 1-3.744-2.584C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.044 5.231-3.886 6.818a22.094 22.094 0 0 1-3.433 2.414 7.152 7.152 0 0 1-.31.17l-.018.01-.008.004a.75.75 0 0 1-.69 0Z"})},24:{width:24,path:Se.createElement("path",{d:"M14 20.408c-.492.308-.903.546-1.192.709-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0 16.709 16.709 0 0 1-.465-.252 31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513 1 5.052 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408Z"})}}}),L_=hr("XIcon","octicon octicon-x",function(){return{12:{width:12,path:Se.createElement("path",{d:"M2.22 2.22a.749.749 0 0 1 1.06 0L6 4.939 8.72 2.22a.749.749 0 1 1 1.06 1.06L7.061 6 9.78 8.72a.749.749 0 1 1-1.06 1.06L6 7.061 3.28 9.78a.749.749 0 1 1-1.06-1.06L4.939 6 2.22 3.28a.749.749 0 0 1 0-1.06Z"})},16:{width:16,path:Se.createElement("path",{d:"M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"})},24:{width:24,path:Se.createElement("path",{d:"M5.72 5.72a.75.75 0 0 1 1.06 0L12 10.94l5.22-5.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L13.06 12l5.22 5.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L12 13.06l-5.22 5.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L10.94 12 5.72 6.78a.75.75 0 0 1 0-1.06Z"})}}}),D_=hr("XCircleIcon","octicon octicon-x-circle",function(){return{16:{width:16,path:Se.createElement("path",{d:"M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"})},24:{width:24,path:Se.createElement(Se.Fragment,null,Se.createElement("path",{d:"M9.036 7.976a.75.75 0 0 0-1.06 1.06L10.939 12l-2.963 2.963a.75.75 0 1 0 1.06 1.06L12 13.06l2.963 2.964a.75.75 0 0 0 1.061-1.06L13.061 12l2.963-2.964a.75.75 0 1 0-1.06-1.06L12 10.939 9.036 7.976Z"}),Se.createElement("path",{d:"M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"}))}}});const rA=C.createContext({}),Li=()=>C.useContext(rA);var si=(n=>(n.Added="Added",n.Released="Released",n.Runtime="Runtime",n.Random="Random",n.Name="Name",n.None="",n.Inherit="Inherit",n))(si||{}),Ya=(n=>(n.Ascending="Ascending",n.Descending="Descending",n.None="",n))(Ya||{}),qa=(n=>(n.Tracks="Tracks",n.Albums="Albums",n.Artists="Artists",n.None="",n))(qa||{});const Vg={"/tracks":"Added","/albums":"Added","/genre":"Added","/favorites":"Added"},$g=n=>Object.values(si).map(e=>e.toLowerCase()).includes(n.toLowerCase()),Gg=n=>Object.values(Ya).map(e=>e.toLowerCase()).includes(n.toLowerCase()),Hg=n=>Object.values(qa).map(e=>e.toLowerCase()).includes(n.toLowerCase()),O_=n=>{if(!(localStorage.getItem("rememberFilters")==="on"))return;const t=localStorage.getItem(`rememberFilters_${n}`);if(t)try{const s=JSON.parse(t);return{sort:$g(s.sort)?s.sort:"",order:Gg(s.order)?s.order:"",kind:Hg(s.kind)?s.kind:""}}catch(s){console.error("Failed to parse saved filter:",s);return}},aA=n=>n.split("/").slice(0,2).join("/"),Rc=n=>{const e=aA(n),t=O_(e);if(!t)return n;const s=new URLSearchParams,i=Vg[n]||"",r=i==="Added"||i===""?"Descending":"Ascending",a="Tracks";i!==t.sort&&t.sort&&s.set("sort",t.sort),r!==t.order&&t.order&&s.set("order",t.order),a!==t.kind&&t.kind&&s.set("kind",t.kind);const l=s.toString();return l?`${n}?${l}`:n};function oA(n,e){return function(){return n.apply(e,arguments)}}const{toString:__}=Object.prototype,{getPrototypeOf:K0}=Object,{iterator:sf,toStringTag:lA}=Symbol,nf=(n=>e=>{const t=__.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),zi=n=>(n=n.toLowerCase(),e=>nf(e)===n),rf=n=>e=>typeof e===n,{isArray:vl}=Array,ul=rf("undefined");function du(n){return n!==null&&!ul(n)&&n.constructor!==null&&!ul(n.constructor)&&$n(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const cA=zi("ArrayBuffer");function P_(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&cA(n.buffer),e}const N_=rf("string"),$n=rf("function"),uA=rf("number"),hu=n=>n!==null&&typeof n=="object",k_=n=>n===!0||n===!1,dh=n=>{if(nf(n)!=="object")return!1;const e=K0(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(lA in n)&&!(sf in n)},M_=n=>{if(!hu(n)||du(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},U_=zi("Date"),F_=zi("File"),B_=zi("Blob"),j_=zi("FileList"),V_=n=>hu(n)&&$n(n.pipe),$_=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||$n(n.append)&&((e=nf(n))==="formdata"||e==="object"&&$n(n.toString)&&n.toString()==="[object FormData]"))},G_=zi("URLSearchParams"),[H_,z_,K_,Y_]=["ReadableStream","Request","Response","Headers"].map(zi),q_=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fu(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,i;if(typeof n!="object"&&(n=[n]),vl(n))for(s=0,i=n.length;s<i;s++)e.call(null,n[s],s,n);else{if(du(n))return;const r=t?Object.getOwnPropertyNames(n):Object.keys(n),a=r.length;let l;for(s=0;s<a;s++)l=r[s],e.call(null,n[l],l,n)}}function dA(n,e){if(du(n))return null;e=e.toLowerCase();const t=Object.keys(n);let s=t.length,i;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const Qa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hA=n=>!ul(n)&&n!==Qa;function zg(){const{caseless:n,skipUndefined:e}=hA(this)&&this||{},t={},s=(i,r)=>{const a=n&&dA(t,r)||r;dh(t[a])&&dh(i)?t[a]=zg(t[a],i):dh(i)?t[a]=zg({},i):vl(i)?t[a]=i.slice():(!e||!ul(i))&&(t[a]=i)};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&fu(arguments[i],s);return t}const Q_=(n,e,t,{allOwnKeys:s}={})=>(fu(e,(i,r)=>{t&&$n(i)?n[r]=oA(i,t):n[r]=i},{allOwnKeys:s}),n),X_=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),W_=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Z_=(n,e,t,s)=>{let i,r,a;const l={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),r=i.length;r-- >0;)a=i[r],(!s||s(a,n,e))&&!l[a]&&(e[a]=n[a],l[a]=!0);n=t!==!1&&K0(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},J_=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},eP=n=>{if(!n)return null;if(vl(n))return n;let e=n.length;if(!uA(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},tP=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&K0(Uint8Array)),sP=(n,e)=>{const s=(n&&n[sf]).call(n);let i;for(;(i=s.next())&&!i.done;){const r=i.value;e.call(n,r[0],r[1])}},nP=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},iP=zi("HTMLFormElement"),rP=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,i){return s.toUpperCase()+i}),J1=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),aP=zi("RegExp"),fA=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};fu(t,(i,r)=>{let a;(a=e(i,r,n))!==!1&&(s[r]=a||i)}),Object.defineProperties(n,s)},oP=n=>{fA(n,(e,t)=>{if($n(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if($n(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},lP=(n,e)=>{const t={},s=i=>{i.forEach(r=>{t[r]=!0})};return vl(n)?s(n):s(String(n).split(e)),t},cP=()=>{},uP=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function dP(n){return!!(n&&$n(n.append)&&n[lA]==="FormData"&&n[sf])}const hP=n=>{const e=new Array(10),t=(s,i)=>{if(hu(s)){if(e.indexOf(s)>=0)return;if(du(s))return s;if(!("toJSON"in s)){e[i]=s;const r=vl(s)?[]:{};return fu(s,(a,l)=>{const u=t(a,i+1);!ul(u)&&(r[l]=u)}),e[i]=void 0,r}}return s};return t(n,0)},fP=zi("AsyncFunction"),mP=n=>n&&(hu(n)||$n(n))&&$n(n.then)&&$n(n.catch),mA=((n,e)=>n?setImmediate:e?((t,s)=>(Qa.addEventListener("message",({source:i,data:r})=>{i===Qa&&r===t&&s.length&&s.shift()()},!1),i=>{s.push(i),Qa.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",$n(Qa.postMessage)),pP=typeof queueMicrotask<"u"?queueMicrotask.bind(Qa):typeof process<"u"&&process.nextTick||mA,gP=n=>n!=null&&$n(n[sf]),ue={isArray:vl,isArrayBuffer:cA,isBuffer:du,isFormData:$_,isArrayBufferView:P_,isString:N_,isNumber:uA,isBoolean:k_,isObject:hu,isPlainObject:dh,isEmptyObject:M_,isReadableStream:H_,isRequest:z_,isResponse:K_,isHeaders:Y_,isUndefined:ul,isDate:U_,isFile:F_,isBlob:B_,isRegExp:aP,isFunction:$n,isStream:V_,isURLSearchParams:G_,isTypedArray:tP,isFileList:j_,forEach:fu,merge:zg,extend:Q_,trim:q_,stripBOM:X_,inherits:W_,toFlatObject:Z_,kindOf:nf,kindOfTest:zi,endsWith:J_,toArray:eP,forEachEntry:sP,matchAll:nP,isHTMLForm:iP,hasOwnProperty:J1,hasOwnProp:J1,reduceDescriptors:fA,freezeMethods:oP,toObjectSet:lP,toCamelCase:rP,noop:cP,toFiniteNumber:uP,findKey:dA,global:Qa,isContextDefined:hA,isSpecCompliantForm:dP,toJSONObject:hP,isAsyncFn:fP,isThenable:mP,setImmediate:mA,asap:pP,isIterable:gP};function pt(n,e,t,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}ue.inherits(pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ue.toJSONObject(this.config),code:this.code,status:this.status}}});const pA=pt.prototype,gA={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{gA[n]={value:n}});Object.defineProperties(pt,gA);Object.defineProperty(pA,"isAxiosError",{value:!0});pt.from=(n,e,t,s,i,r)=>{const a=Object.create(pA);ue.toFlatObject(n,a,function(h){return h!==Error.prototype},d=>d!=="isAxiosError");const l=n&&n.message?n.message:"Error",u=e==null&&n?n.code:e;return pt.call(a,l,u,t,s,i),n&&a.cause==null&&Object.defineProperty(a,"cause",{value:n,configurable:!0}),a.name=n&&n.name||"Error",r&&Object.assign(a,r),a};const yP=null;function Kg(n){return ue.isPlainObject(n)||ue.isArray(n)}function yA(n){return ue.endsWith(n,"[]")?n.slice(0,-2):n}function eb(n,e,t){return n?n.concat(e).map(function(i,r){return i=yA(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}function vP(n){return ue.isArray(n)&&!n.some(Kg)}const xP=ue.toFlatObject(ue,{},null,function(e){return/^is[A-Z]/.test(e)});function af(n,e,t){if(!ue.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=ue.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,T){return!ue.isUndefined(T[x])});const s=t.metaTokens,i=t.visitor||h,r=t.dots,a=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&ue.isSpecCompliantForm(e);if(!ue.isFunction(i))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(ue.isDate(S))return S.toISOString();if(ue.isBoolean(S))return S.toString();if(!u&&ue.isBlob(S))throw new pt("Blob is not supported. Use a Buffer instead.");return ue.isArrayBuffer(S)||ue.isTypedArray(S)?u&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function h(S,x,T){let A=S;if(S&&!T&&typeof S=="object"){if(ue.endsWith(x,"{}"))x=s?x:x.slice(0,-2),S=JSON.stringify(S);else if(ue.isArray(S)&&vP(S)||(ue.isFileList(S)||ue.endsWith(x,"[]"))&&(A=ue.toArray(S)))return x=yA(x),A.forEach(function(R,L){!(ue.isUndefined(R)||R===null)&&e.append(a===!0?eb([x],L,r):a===null?x:x+"[]",d(R))}),!1}return Kg(S)?!0:(e.append(eb(T,x,r),d(S)),!1)}const m=[],g=Object.assign(xP,{defaultVisitor:h,convertValue:d,isVisitable:Kg});function v(S,x){if(!ue.isUndefined(S)){if(m.indexOf(S)!==-1)throw Error("Circular reference detected in "+x.join("."));m.push(S),ue.forEach(S,function(A,E){(!(ue.isUndefined(A)||A===null)&&i.call(e,A,ue.isString(E)?E.trim():E,x,g))===!0&&v(A,x?x.concat(E):[E])}),m.pop()}}if(!ue.isObject(n))throw new TypeError("data must be an object");return v(n),e}function tb(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Y0(n,e){this._pairs=[],n&&af(n,this,e)}const vA=Y0.prototype;vA.append=function(e,t){this._pairs.push([e,t])};vA.toString=function(e){const t=e?function(s){return e.call(this,s,tb)}:tb;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function SP(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function xA(n,e,t){if(!e)return n;const s=t&&t.encode||SP;ue.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let r;if(i?r=i(e,t):r=ue.isURLSearchParams(e)?e.toString():new Y0(e,t).toString(s),r){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}class sb{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ue.forEach(this.handlers,function(s){s!==null&&e(s)})}}const SA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bP=typeof URLSearchParams<"u"?URLSearchParams:Y0,TP=typeof FormData<"u"?FormData:null,EP=typeof Blob<"u"?Blob:null,AP={isBrowser:!0,classes:{URLSearchParams:bP,FormData:TP,Blob:EP},protocols:["http","https","file","blob","url","data"]},q0=typeof window<"u"&&typeof document<"u",Yg=typeof navigator=="object"&&navigator||void 0,IP=q0&&(!Yg||["ReactNative","NativeScript","NS"].indexOf(Yg.product)<0),RP=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wP=q0&&window.location.href||"http://localhost",CP=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:q0,hasStandardBrowserEnv:IP,hasStandardBrowserWebWorkerEnv:RP,navigator:Yg,origin:wP},Symbol.toStringTag,{value:"Module"})),An={...CP,...AP};function LP(n,e){return af(n,new An.classes.URLSearchParams,{visitor:function(t,s,i,r){return An.isNode&&ue.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function DP(n){return ue.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function OP(n){const e={},t=Object.keys(n);let s;const i=t.length;let r;for(s=0;s<i;s++)r=t[s],e[r]=n[r];return e}function bA(n){function e(t,s,i,r){let a=t[r++];if(a==="__proto__")return!0;const l=Number.isFinite(+a),u=r>=t.length;return a=!a&&ue.isArray(i)?i.length:a,u?(ue.hasOwnProp(i,a)?i[a]=[i[a],s]:i[a]=s,!l):((!i[a]||!ue.isObject(i[a]))&&(i[a]=[]),e(t,s,i[a],r)&&ue.isArray(i[a])&&(i[a]=OP(i[a])),!l)}if(ue.isFormData(n)&&ue.isFunction(n.entries)){const t={};return ue.forEachEntry(n,(s,i)=>{e(DP(s),i,t,0)}),t}return null}function _P(n,e,t){if(ue.isString(n))try{return(e||JSON.parse)(n),ue.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const mu={transitional:SA,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",i=s.indexOf("application/json")>-1,r=ue.isObject(e);if(r&&ue.isHTMLForm(e)&&(e=new FormData(e)),ue.isFormData(e))return i?JSON.stringify(bA(e)):e;if(ue.isArrayBuffer(e)||ue.isBuffer(e)||ue.isStream(e)||ue.isFile(e)||ue.isBlob(e)||ue.isReadableStream(e))return e;if(ue.isArrayBufferView(e))return e.buffer;if(ue.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return LP(e,this.formSerializer).toString();if((l=ue.isFileList(e))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return af(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),_P(e)):e}],transformResponse:[function(e){const t=this.transitional||mu.transitional,s=t&&t.forcedJSONParsing,i=this.responseType==="json";if(ue.isResponse(e)||ue.isReadableStream(e))return e;if(e&&ue.isString(e)&&(s&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(l){if(a)throw l.name==="SyntaxError"?pt.from(l,pt.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:An.classes.FormData,Blob:An.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ue.forEach(["delete","get","head","post","put","patch"],n=>{mu.headers[n]={}});const PP=ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),NP=n=>{const e={};let t,s,i;return n&&n.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),s=a.substring(i+1).trim(),!(!t||e[t]&&PP[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},nb=Symbol("internals");function wc(n){return n&&String(n).trim().toLowerCase()}function hh(n){return n===!1||n==null?n:ue.isArray(n)?n.map(hh):String(n)}function kP(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const MP=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Mp(n,e,t,s,i){if(ue.isFunction(s))return s.call(this,e,t);if(i&&(e=t),!!ue.isString(e)){if(ue.isString(s))return e.indexOf(s)!==-1;if(ue.isRegExp(s))return s.test(e)}}function UP(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function FP(n,e){const t=ue.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(i,r,a){return this[s].call(this,e,i,r,a)},configurable:!0})})}let Gn=class{constructor(e){e&&this.set(e)}set(e,t,s){const i=this;function r(l,u,d){const h=wc(u);if(!h)throw new Error("header name must be a non-empty string");const m=ue.findKey(i,h);(!m||i[m]===void 0||d===!0||d===void 0&&i[m]!==!1)&&(i[m||u]=hh(l))}const a=(l,u)=>ue.forEach(l,(d,h)=>r(d,h,u));if(ue.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(ue.isString(e)&&(e=e.trim())&&!MP(e))a(NP(e),t);else if(ue.isObject(e)&&ue.isIterable(e)){let l={},u,d;for(const h of e){if(!ue.isArray(h))throw TypeError("Object iterator must return a key-value pair");l[d=h[0]]=(u=l[d])?ue.isArray(u)?[...u,h[1]]:[u,h[1]]:h[1]}a(l,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=wc(e),e){const s=ue.findKey(this,e);if(s){const i=this[s];if(!t)return i;if(t===!0)return kP(i);if(ue.isFunction(t))return t.call(this,i,s);if(ue.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=wc(e),e){const s=ue.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Mp(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let i=!1;function r(a){if(a=wc(a),a){const l=ue.findKey(s,a);l&&(!t||Mp(s,s[l],l,t))&&(delete s[l],i=!0)}}return ue.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let s=t.length,i=!1;for(;s--;){const r=t[s];(!e||Mp(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}normalize(e){const t=this,s={};return ue.forEach(this,(i,r)=>{const a=ue.findKey(s,r);if(a){t[a]=hh(i),delete t[r];return}const l=e?UP(r):String(r).trim();l!==r&&delete t[r],t[l]=hh(i),s[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ue.forEach(this,(s,i)=>{s!=null&&s!==!1&&(t[i]=e&&ue.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(i=>s.set(i)),s}static accessor(e){const s=(this[nb]=this[nb]={accessors:{}}).accessors,i=this.prototype;function r(a){const l=wc(a);s[l]||(FP(i,a),s[l]=!0)}return ue.isArray(e)?e.forEach(r):r(e),this}};Gn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ue.reduceDescriptors(Gn.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});ue.freezeMethods(Gn);function Up(n,e){const t=this||mu,s=e||t,i=Gn.from(s.headers);let r=s.data;return ue.forEach(n,function(l){r=l.call(t,r,i.normalize(),e?e.status:void 0)}),i.normalize(),r}function TA(n){return!!(n&&n.__CANCEL__)}function xl(n,e,t){pt.call(this,n??"canceled",pt.ERR_CANCELED,e,t),this.name="CanceledError"}ue.inherits(xl,pt,{__CANCEL__:!0});function EA(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new pt("Request failed with status code "+t.status,[pt.ERR_BAD_REQUEST,pt.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function BP(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function jP(n,e){n=n||10;const t=new Array(n),s=new Array(n);let i=0,r=0,a;return e=e!==void 0?e:1e3,function(u){const d=Date.now(),h=s[r];a||(a=d),t[i]=u,s[i]=d;let m=r,g=0;for(;m!==i;)g+=t[m++],m=m%n;if(i=(i+1)%n,i===r&&(r=(r+1)%n),d-a<e)return;const v=h&&d-h;return v?Math.round(g*1e3/v):void 0}}function VP(n,e){let t=0,s=1e3/e,i,r;const a=(d,h=Date.now())=>{t=h,i=null,r&&(clearTimeout(r),r=null),n(...d)};return[(...d)=>{const h=Date.now(),m=h-t;m>=s?a(d,h):(i=d,r||(r=setTimeout(()=>{r=null,a(i)},s-m)))},()=>i&&a(i)]}const Dh=(n,e,t=3)=>{let s=0;const i=jP(50,250);return VP(r=>{const a=r.loaded,l=r.lengthComputable?r.total:void 0,u=a-s,d=i(u),h=a<=l;s=a;const m={loaded:a,total:l,progress:l?a/l:void 0,bytes:u,rate:d||void 0,estimated:d&&l&&h?(l-a)/d:void 0,event:r,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(m)},t)},ib=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},rb=n=>(...e)=>ue.asap(()=>n(...e)),$P=An.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,An.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(An.origin),An.navigator&&/(msie|trident)/i.test(An.navigator.userAgent)):()=>!0,GP=An.hasStandardBrowserEnv?{write(n,e,t,s,i,r){const a=[n+"="+encodeURIComponent(e)];ue.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),ue.isString(s)&&a.push("path="+s),ue.isString(i)&&a.push("domain="+i),r===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function HP(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zP(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function AA(n,e,t){let s=!HP(e);return n&&(s||t==!1)?zP(n,e):e}const ab=n=>n instanceof Gn?{...n}:n;function eo(n,e){e=e||{};const t={};function s(d,h,m,g){return ue.isPlainObject(d)&&ue.isPlainObject(h)?ue.merge.call({caseless:g},d,h):ue.isPlainObject(h)?ue.merge({},h):ue.isArray(h)?h.slice():h}function i(d,h,m,g){if(ue.isUndefined(h)){if(!ue.isUndefined(d))return s(void 0,d,m,g)}else return s(d,h,m,g)}function r(d,h){if(!ue.isUndefined(h))return s(void 0,h)}function a(d,h){if(ue.isUndefined(h)){if(!ue.isUndefined(d))return s(void 0,d)}else return s(void 0,h)}function l(d,h,m){if(m in e)return s(d,h);if(m in n)return s(void 0,d)}const u={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(d,h,m)=>i(ab(d),ab(h),m,!0)};return ue.forEach(Object.keys({...n,...e}),function(h){const m=u[h]||i,g=m(n[h],e[h],h);ue.isUndefined(g)&&m!==l||(t[h]=g)}),t}const IA=n=>{const e=eo({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:r,headers:a,auth:l}=e;if(e.headers=a=Gn.from(a),e.url=xA(AA(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),ue.isFormData(t)){if(An.hasStandardBrowserEnv||An.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(ue.isFunction(t.getHeaders)){const u=t.getHeaders(),d=["content-type","content-length"];Object.entries(u).forEach(([h,m])=>{d.includes(h.toLowerCase())&&a.set(h,m)})}}if(An.hasStandardBrowserEnv&&(s&&ue.isFunction(s)&&(s=s(e)),s||s!==!1&&$P(e.url))){const u=i&&r&&GP.read(r);u&&a.set(i,u)}return e},KP=typeof XMLHttpRequest<"u",YP=KP&&function(n){return new Promise(function(t,s){const i=IA(n);let r=i.data;const a=Gn.from(i.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:d}=i,h,m,g,v,S;function x(){v&&v(),S&&S(),i.cancelToken&&i.cancelToken.unsubscribe(h),i.signal&&i.signal.removeEventListener("abort",h)}let T=new XMLHttpRequest;T.open(i.method.toUpperCase(),i.url,!0),T.timeout=i.timeout;function A(){if(!T)return;const R=Gn.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),w={data:!l||l==="text"||l==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:R,config:n,request:T};EA(function(_){t(_),x()},function(_){s(_),x()},w),T=null}"onloadend"in T?T.onloadend=A:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(A)},T.onabort=function(){T&&(s(new pt("Request aborted",pt.ECONNABORTED,n,T)),T=null)},T.onerror=function(L){const w=L&&L.message?L.message:"Network Error",D=new pt(w,pt.ERR_NETWORK,n,T);D.event=L||null,s(D),T=null},T.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const w=i.transitional||SA;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),s(new pt(L,w.clarifyTimeoutError?pt.ETIMEDOUT:pt.ECONNABORTED,n,T)),T=null},r===void 0&&a.setContentType(null),"setRequestHeader"in T&&ue.forEach(a.toJSON(),function(L,w){T.setRequestHeader(w,L)}),ue.isUndefined(i.withCredentials)||(T.withCredentials=!!i.withCredentials),l&&l!=="json"&&(T.responseType=i.responseType),d&&([g,S]=Dh(d,!0),T.addEventListener("progress",g)),u&&T.upload&&([m,v]=Dh(u),T.upload.addEventListener("progress",m),T.upload.addEventListener("loadend",v)),(i.cancelToken||i.signal)&&(h=R=>{T&&(s(!R||R.type?new xl(null,n,T):R),T.abort(),T=null)},i.cancelToken&&i.cancelToken.subscribe(h),i.signal&&(i.signal.aborted?h():i.signal.addEventListener("abort",h)));const E=BP(i.url);if(E&&An.protocols.indexOf(E)===-1){s(new pt("Unsupported protocol "+E+":",pt.ERR_BAD_REQUEST,n));return}T.send(r||null)})},qP=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,i;const r=function(d){if(!i){i=!0,l();const h=d instanceof Error?d:this.reason;s.abort(h instanceof pt?h:new xl(h instanceof Error?h.message:h))}};let a=e&&setTimeout(()=>{a=null,r(new pt(`timeout ${e} of ms exceeded`,pt.ETIMEDOUT))},e);const l=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(r):d.removeEventListener("abort",r)}),n=null)};n.forEach(d=>d.addEventListener("abort",r));const{signal:u}=s;return u.unsubscribe=()=>ue.asap(l),u}},QP=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let s=0,i;for(;s<t;)i=s+e,yield n.slice(s,i),s=i},XP=async function*(n,e){for await(const t of WP(n))yield*QP(t,e)},WP=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},ob=(n,e,t,s)=>{const i=XP(n,e);let r=0,a,l=u=>{a||(a=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:d,value:h}=await i.next();if(d){l(),u.close();return}let m=h.byteLength;if(t){let g=r+=m;t(g)}u.enqueue(new Uint8Array(h))}catch(d){throw l(d),d}},cancel(u){return l(u),i.return()}},{highWaterMark:2})},lb=64*1024,{isFunction:Ud}=ue,ZP=(({Request:n,Response:e})=>({Request:n,Response:e}))(ue.global),{ReadableStream:cb,TextEncoder:ub}=ue.global,db=(n,...e)=>{try{return!!n(...e)}catch{return!1}},JP=n=>{n=ue.merge.call({skipUndefined:!0},ZP,n);const{fetch:e,Request:t,Response:s}=n,i=e?Ud(e):typeof fetch=="function",r=Ud(t),a=Ud(s);if(!i)return!1;const l=i&&Ud(cb),u=i&&(typeof ub=="function"?(S=>x=>S.encode(x))(new ub):async S=>new Uint8Array(await new t(S).arrayBuffer())),d=r&&l&&db(()=>{let S=!1;const x=new t(An.origin,{body:new cb,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!x}),h=a&&l&&db(()=>ue.isReadableStream(new s("").body)),m={stream:h&&(S=>S.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!m[S]&&(m[S]=(x,T)=>{let A=x&&x[S];if(A)return A.call(x);throw new pt(`Response type '${S}' is not supported`,pt.ERR_NOT_SUPPORT,T)})});const g=async S=>{if(S==null)return 0;if(ue.isBlob(S))return S.size;if(ue.isSpecCompliantForm(S))return(await new t(An.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(ue.isArrayBufferView(S)||ue.isArrayBuffer(S))return S.byteLength;if(ue.isURLSearchParams(S)&&(S=S+""),ue.isString(S))return(await u(S)).byteLength},v=async(S,x)=>{const T=ue.toFiniteNumber(S.getContentLength());return T??g(x)};return async S=>{let{url:x,method:T,data:A,signal:E,cancelToken:R,timeout:L,onDownloadProgress:w,onUploadProgress:D,responseType:_,headers:k,withCredentials:N="same-origin",fetchOptions:F}=IA(S),V=e||fetch;_=_?(_+"").toLowerCase():"text";let H=qP([E,R&&R.toAbortSignal()],L),J=null;const X=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let Q;try{if(D&&d&&T!=="get"&&T!=="head"&&(Q=await v(k,A))!==0){let M=new t(x,{method:"POST",body:A,duplex:"half"}),z;if(ue.isFormData(A)&&(z=M.headers.get("content-type"))&&k.setContentType(z),M.body){const[G,de]=ib(Q,Dh(rb(D)));A=ob(M.body,lb,G,de)}}ue.isString(N)||(N=N?"include":"omit");const j=r&&"credentials"in t.prototype,K={...F,signal:H,method:T.toUpperCase(),headers:k.normalize().toJSON(),body:A,duplex:"half",credentials:j?N:void 0};J=r&&new t(x,K);let Y=await(r?V(J,F):V(x,K));const re=h&&(_==="stream"||_==="response");if(h&&(w||re&&X)){const M={};["status","statusText","headers"].forEach(Te=>{M[Te]=Y[Te]});const z=ue.toFiniteNumber(Y.headers.get("content-length")),[G,de]=w&&ib(z,Dh(rb(w),!0))||[];Y=new s(ob(Y.body,lb,G,()=>{de&&de(),X&&X()}),M)}_=_||"text";let B=await m[ue.findKey(m,_)||"text"](Y,S);return!re&&X&&X(),await new Promise((M,z)=>{EA(M,z,{data:B,headers:Gn.from(Y.headers),status:Y.status,statusText:Y.statusText,config:S,request:J})})}catch(j){throw X&&X(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new pt("Network Error",pt.ERR_NETWORK,S,J),{cause:j.cause||j}):pt.from(j,j&&j.code,S,J)}}},e2=new Map,RA=n=>{let e=n?n.env:{};const{fetch:t,Request:s,Response:i}=e,r=[s,i,t];let a=r.length,l=a,u,d,h=e2;for(;l--;)u=r[l],d=h.get(u),d===void 0&&h.set(u,d=l?new Map:JP(e)),h=d;return d};RA();const qg={http:yP,xhr:YP,fetch:{get:RA}};ue.forEach(qg,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const hb=n=>`- ${n}`,t2=n=>ue.isFunction(n)||n===null||n===!1,wA={getAdapter:(n,e)=>{n=ue.isArray(n)?n:[n];const{length:t}=n;let s,i;const r={};for(let a=0;a<t;a++){s=n[a];let l;if(i=s,!t2(s)&&(i=qg[(l=String(s)).toLowerCase()],i===void 0))throw new pt(`Unknown adapter '${l}'`);if(i&&(ue.isFunction(i)||(i=i.get(e))))break;r[l||"#"+a]=i}if(!i){const a=Object.entries(r).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let l=t?a.length>1?`since :
`+a.map(hb).join(`
`):" "+hb(a[0]):"as no adapter specified";throw new pt("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return i},adapters:qg};function Fp(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new xl(null,n)}function fb(n){return Fp(n),n.headers=Gn.from(n.headers),n.data=Up.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),wA.getAdapter(n.adapter||mu.adapter,n)(n).then(function(s){return Fp(n),s.data=Up.call(n,n.transformResponse,s),s.headers=Gn.from(s.headers),s},function(s){return TA(s)||(Fp(n),s&&s.response&&(s.response.data=Up.call(n,n.transformResponse,s.response),s.response.headers=Gn.from(s.response.headers))),Promise.reject(s)})}const CA="1.12.2",of={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{of[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const mb={};of.transitional=function(e,t,s){function i(r,a){return"[Axios v"+CA+"] Transitional option '"+r+"'"+a+(s?". "+s:"")}return(r,a,l)=>{if(e===!1)throw new pt(i(a," has been removed"+(t?" in "+t:"")),pt.ERR_DEPRECATED);return t&&!mb[a]&&(mb[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,a,l):!0}};of.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function s2(n,e,t){if(typeof n!="object")throw new pt("options must be an object",pt.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let i=s.length;for(;i-- >0;){const r=s[i],a=e[r];if(a){const l=n[r],u=l===void 0||a(l,r,n);if(u!==!0)throw new pt("option "+r+" must be "+u,pt.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new pt("Unknown option "+r,pt.ERR_BAD_OPTION)}}const fh={assertOptions:s2,validators:of},Ji=fh.validators;let Wa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new sb,response:new sb}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=eo(this.defaults,t);const{transitional:s,paramsSerializer:i,headers:r}=t;s!==void 0&&fh.assertOptions(s,{silentJSONParsing:Ji.transitional(Ji.boolean),forcedJSONParsing:Ji.transitional(Ji.boolean),clarifyTimeoutError:Ji.transitional(Ji.boolean)},!1),i!=null&&(ue.isFunction(i)?t.paramsSerializer={serialize:i}:fh.assertOptions(i,{encode:Ji.function,serialize:Ji.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fh.assertOptions(t,{baseUrl:Ji.spelling("baseURL"),withXsrfToken:Ji.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&ue.merge(r.common,r[t.method]);r&&ue.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),t.headers=Gn.concat(a,r);const l=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(t)===!1||(u=u&&x.synchronous,l.unshift(x.fulfilled,x.rejected))});const d=[];this.interceptors.response.forEach(function(x){d.push(x.fulfilled,x.rejected)});let h,m=0,g;if(!u){const S=[fb.bind(this),void 0];for(S.unshift(...l),S.push(...d),g=S.length,h=Promise.resolve(t);m<g;)h=h.then(S[m++],S[m++]);return h}g=l.length;let v=t;for(;m<g;){const S=l[m++],x=l[m++];try{v=S(v)}catch(T){x.call(this,T);break}}try{h=fb.call(this,v)}catch(S){return Promise.reject(S)}for(m=0,g=d.length;m<g;)h=h.then(d[m++],d[m++]);return h}getUri(e){e=eo(this.defaults,e);const t=AA(e.baseURL,e.url,e.allowAbsoluteUrls);return xA(t,e.params,e.paramsSerializer)}};ue.forEach(["delete","get","head","options"],function(e){Wa.prototype[e]=function(t,s){return this.request(eo(s||{},{method:e,url:t,data:(s||{}).data}))}});ue.forEach(["post","put","patch"],function(e){function t(s){return function(r,a,l){return this.request(eo(l||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}Wa.prototype[e]=t(),Wa.prototype[e+"Form"]=t(!0)});let n2=class LA{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(i=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](i);s._listeners=null}),this.promise.then=i=>{let r;const a=new Promise(l=>{s.subscribe(l),r=l}).then(i);return a.cancel=function(){s.unsubscribe(r)},a},e(function(r,a,l){s.reason||(s.reason=new xl(r,a,l),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new LA(function(i){e=i}),cancel:e}}};function i2(n){return function(t){return n.apply(null,t)}}function r2(n){return ue.isObject(n)&&n.isAxiosError===!0}const Qg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qg).forEach(([n,e])=>{Qg[e]=n});function DA(n){const e=new Wa(n),t=oA(Wa.prototype.request,e);return ue.extend(t,Wa.prototype,e,{allOwnKeys:!0}),ue.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return DA(eo(n,i))},t}const ve=DA(mu);ve.Axios=Wa;ve.CanceledError=xl;ve.CancelToken=n2;ve.isCancel=TA;ve.VERSION=CA;ve.toFormData=af;ve.AxiosError=pt;ve.Cancel=ve.CanceledError;ve.all=function(e){return Promise.all(e)};ve.spread=i2;ve.isAxiosError=r2;ve.mergeConfig=eo;ve.AxiosHeaders=Gn;ve.formToJSON=n=>bA(ue.isHTMLForm(n)?new FormData(n):n);ve.getAdapter=wA.getAdapter;ve.HttpStatusCode=Qg;ve.default=ve;const{Axios:EB,AxiosError:a2,CanceledError:AB,isCancel:IB,CancelToken:RB,VERSION:wB,all:CB,Cancel:LB,isAxiosError:DB,spread:OB,toFormData:_B,AxiosHeaders:PB,HttpStatusCode:NB,formToJSON:kB,getAdapter:MB,mergeConfig:UB}=ve,Ie="http://localhost".replace(/\/+$/,"");class Di{constructor(e,t=Ie,s=ve){var i;this.basePath=t,this.axios=s,e&&(this.configuration=e,this.basePath=(i=e.basePath)!==null&&i!==void 0?i:t)}}class o2 extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}const Re={},we="https://example.com",Pe=function(n,e,t){if(t==null)throw new o2(e,`Required parameter ${e} was null or undefined when calling ${n}.`)},Ne=async function(n,e,t){if(t&&t.apiKey){const s=typeof t.apiKey=="function"?await t.apiKey(e):await t.apiKey;n[e]=s}};function Xg(n,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(s=>Xg(n,s,t)):Object.keys(e).forEach(s=>Xg(n,e[s],`${t}${t!==""?".":""}${s}`)):n.has(t)?n.append(t,e):n.set(t,e))}const Ce=function(n,...e){const t=new URLSearchParams(n.search);Xg(t,e),n.search=t.toString()},Ns=function(n,e,t){const s=typeof n!="string";return(s&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):s)?JSON.stringify(n!==void 0?n:{}):n||""},Le=function(n){return n.pathname+n.search+n.hash},De=function(n,e,t,s){return(i=e,r=t)=>{var a;const l={...n.options,url:(i.defaults.baseURL?"":(a=s?.basePath)!==null&&a!==void 0?a:r)+n.url};return i.request(l)}},l2=function(n){return{getAlbumArtists:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K={})=>{const Y="/Artists/AlbumArtists",re=new URL(Y,we);let B;n&&(B=n.baseOptions);const M={method:"GET",...B,...K},z={},G={};await Ne(z,"Authorization",n),e!==void 0&&(G.minCommunityRating=e),t!==void 0&&(G.startIndex=t),s!==void 0&&(G.limit=s),i!==void 0&&(G.searchTerm=i),r!==void 0&&(G.parentId=r),a&&(G.fields=a),l&&(G.excludeItemTypes=l),u&&(G.includeItemTypes=u),d&&(G.filters=d),h!==void 0&&(G.isFavorite=h),m&&(G.mediaTypes=m),g&&(G.genres=g),v&&(G.genreIds=v),S&&(G.officialRatings=S),x&&(G.tags=x),T&&(G.years=T),A!==void 0&&(G.enableUserData=A),E!==void 0&&(G.imageTypeLimit=E),R&&(G.enableImageTypes=R),L!==void 0&&(G.person=L),w&&(G.personIds=w),D&&(G.personTypes=D),_&&(G.studios=_),k&&(G.studioIds=k),N!==void 0&&(G.userId=N),F!==void 0&&(G.nameStartsWithOrGreater=F),V!==void 0&&(G.nameStartsWith=V),H!==void 0&&(G.nameLessThan=H),J&&(G.sortBy=J),X&&(G.sortOrder=X),Q!==void 0&&(G.enableImages=Q),j!==void 0&&(G.enableTotalRecordCount=j),Ce(re,G);let de=B&&B.headers?B.headers:{};return M.headers={...z,...de,...K.headers},{url:Le(re),options:M}},getArtistByName:async(e,t,s={})=>{Pe("getArtistByName","name",e);const i="/Artists/{name}".replace("{name}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getArtists:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K={})=>{const Y="/Artists",re=new URL(Y,we);let B;n&&(B=n.baseOptions);const M={method:"GET",...B,...K},z={},G={};await Ne(z,"Authorization",n),e!==void 0&&(G.minCommunityRating=e),t!==void 0&&(G.startIndex=t),s!==void 0&&(G.limit=s),i!==void 0&&(G.searchTerm=i),r!==void 0&&(G.parentId=r),a&&(G.fields=a),l&&(G.excludeItemTypes=l),u&&(G.includeItemTypes=u),d&&(G.filters=d),h!==void 0&&(G.isFavorite=h),m&&(G.mediaTypes=m),g&&(G.genres=g),v&&(G.genreIds=v),S&&(G.officialRatings=S),x&&(G.tags=x),T&&(G.years=T),A!==void 0&&(G.enableUserData=A),E!==void 0&&(G.imageTypeLimit=E),R&&(G.enableImageTypes=R),L!==void 0&&(G.person=L),w&&(G.personIds=w),D&&(G.personTypes=D),_&&(G.studios=_),k&&(G.studioIds=k),N!==void 0&&(G.userId=N),F!==void 0&&(G.nameStartsWithOrGreater=F),V!==void 0&&(G.nameStartsWith=V),H!==void 0&&(G.nameLessThan=H),J&&(G.sortBy=J),X&&(G.sortOrder=X),Q!==void 0&&(G.enableImages=Q),j!==void 0&&(G.enableTotalRecordCount=j),Ce(re,G);let de=B&&B.headers?B.headers:{};return M.headers={...z,...de,...K.headers},{url:Le(re),options:M}}}},Bp=function(n){const e=l2(n);return{async getAlbumArtists(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y){var re,B,M;const z=await e.getAlbumArtists(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y),G=(re=n?.serverIndex)!==null&&re!==void 0?re:0,de=(M=(B=Re["ArtistsApi.getAlbumArtists"])===null||B===void 0?void 0:B[G])===null||M===void 0?void 0:M.url;return(Te,pe)=>De(z,ve,Ie,n)(Te,de||pe)},async getArtistByName(t,s,i){var r,a,l;const u=await e.getArtistByName(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["ArtistsApi.getArtistByName"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getArtists(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y){var re,B,M;const z=await e.getArtists(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y),G=(re=n?.serverIndex)!==null&&re!==void 0?re:0,de=(M=(B=Re["ArtistsApi.getArtists"])===null||B===void 0?void 0:B[G])===null||M===void 0?void 0:M.url;return(Te,pe)=>De(z,ve,Ie,n)(Te,de||pe)}}};class Fd extends Di{getAlbumArtists(e={},t){return Bp(this.configuration).getAlbumArtists(e.minCommunityRating,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.genres,e.genreIds,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.studioIds,e.userId,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.sortBy,e.sortOrder,e.enableImages,e.enableTotalRecordCount,t).then(s=>s(this.axios,this.basePath))}getArtistByName(e,t){return Bp(this.configuration).getArtistByName(e.name,e.userId,t).then(s=>s(this.axios,this.basePath))}getArtists(e={},t){return Bp(this.configuration).getArtists(e.minCommunityRating,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.genres,e.genreIds,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.studioIds,e.userId,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.sortBy,e.sortOrder,e.enableImages,e.enableTotalRecordCount,t).then(s=>s(this.axios,this.basePath))}}const c2=function(n){return{getInstantMixFromAlbum:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromAlbum","itemId",e);const h="/Albums/{itemId}/InstantMix".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromArtists:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromArtists","itemId",e);const h="/Artists/{itemId}/InstantMix".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromArtists2:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromArtists2","id",e);const h="/Artists/InstantMix",m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),e!==void 0&&(x.id=e),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromItem:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromItem","itemId",e);const h="/Items/{itemId}/InstantMix".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromMusicGenreById:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromMusicGenreById","id",e);const h="/MusicGenres/InstantMix",m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),e!==void 0&&(x.id=e),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromMusicGenreByName:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromMusicGenreByName","name",e);const h="/MusicGenres/{name}/InstantMix".replace("{name}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromPlaylist:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromPlaylist","itemId",e);const h="/Playlists/{itemId}/InstantMix".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},getInstantMixFromSong:async(e,t,s,i,r,a,l,u,d={})=>{Pe("getInstantMixFromSong","itemId",e);const h="/Songs/{itemId}/InstantMix".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"GET",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.userId=t),s!==void 0&&(x.limit=s),i&&(x.fields=i),r!==void 0&&(x.enableImages=r),a!==void 0&&(x.enableUserData=a),l!==void 0&&(x.imageTypeLimit=l),u&&(x.enableImageTypes=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}}}},ca=function(n){const e=c2(n);return{async getInstantMixFromAlbum(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromAlbum(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromAlbum"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromArtists(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromArtists(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromArtists"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromArtists2(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromArtists2(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromArtists2"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromItem(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromItem(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromItem"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromMusicGenreById(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromMusicGenreById(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromMusicGenreById"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromMusicGenreByName(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromMusicGenreByName(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromMusicGenreByName"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromPlaylist(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromPlaylist(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromPlaylist"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async getInstantMixFromSong(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.getInstantMixFromSong(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["InstantMixApi.getInstantMixFromSong"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)}}};class u2 extends Di{getInstantMixFromAlbum(e,t){return ca(this.configuration).getInstantMixFromAlbum(e.itemId,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromArtists(e,t){return ca(this.configuration).getInstantMixFromArtists(e.itemId,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromArtists2(e,t){return ca(this.configuration).getInstantMixFromArtists2(e.id,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromItem(e,t){return ca(this.configuration).getInstantMixFromItem(e.itemId,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromMusicGenreById(e,t){return ca(this.configuration).getInstantMixFromMusicGenreById(e.id,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromMusicGenreByName(e,t){return ca(this.configuration).getInstantMixFromMusicGenreByName(e.name,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromPlaylist(e,t){return ca(this.configuration).getInstantMixFromPlaylist(e.itemId,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getInstantMixFromSong(e,t){return ca(this.configuration).getInstantMixFromSong(e.itemId,e.userId,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}}const d2=function(n){return{getItemUserData:async(e,t,s={})=>{Pe("getItemUserData","itemId",e);const i="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getItems:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y,re,B,M,z,G,de,Te,pe,Qe,ce,Oe,Ue,Ze,nt,Dt,Nt,Ot,ke,Je,ot,kt,vt,fe,ze,Ve,Fe,et,W,se,me,he,Ke,Be,ht,Mt,_t,It,Ss,ds,Vs,$s,dn,it,rt,ns,bs,Ts,ps,gs,Ms,Rs,St,Pt={})=>{const jt="/Items",zt=new URL(jt,we);let ws;n&&(ws=n.baseOptions);const Cs={method:"GET",...ws,...Pt},Qs={},Ee={};await Ne(Qs,"Authorization",n),e!==void 0&&(Ee.userId=e),t!==void 0&&(Ee.maxOfficialRating=t),s!==void 0&&(Ee.hasThemeSong=s),i!==void 0&&(Ee.hasThemeVideo=i),r!==void 0&&(Ee.hasSubtitles=r),a!==void 0&&(Ee.hasSpecialFeature=a),l!==void 0&&(Ee.hasTrailer=l),u!==void 0&&(Ee.adjacentTo=u),d!==void 0&&(Ee.indexNumber=d),h!==void 0&&(Ee.parentIndexNumber=h),m!==void 0&&(Ee.hasParentalRating=m),g!==void 0&&(Ee.isHd=g),v!==void 0&&(Ee.is4K=v),S&&(Ee.locationTypes=S),x&&(Ee.excludeLocationTypes=x),T!==void 0&&(Ee.isMissing=T),A!==void 0&&(Ee.isUnaired=A),E!==void 0&&(Ee.minCommunityRating=E),R!==void 0&&(Ee.minCriticRating=R),L!==void 0&&(Ee.minPremiereDate=L instanceof Date?L.toISOString():L),w!==void 0&&(Ee.minDateLastSaved=w instanceof Date?w.toISOString():w),D!==void 0&&(Ee.minDateLastSavedForUser=D instanceof Date?D.toISOString():D),_!==void 0&&(Ee.maxPremiereDate=_ instanceof Date?_.toISOString():_),k!==void 0&&(Ee.hasOverview=k),N!==void 0&&(Ee.hasImdbId=N),F!==void 0&&(Ee.hasTmdbId=F),V!==void 0&&(Ee.hasTvdbId=V),H!==void 0&&(Ee.isMovie=H),J!==void 0&&(Ee.isSeries=J),X!==void 0&&(Ee.isNews=X),Q!==void 0&&(Ee.isKids=Q),j!==void 0&&(Ee.isSports=j),K&&(Ee.excludeItemIds=K),Y!==void 0&&(Ee.startIndex=Y),re!==void 0&&(Ee.limit=re),B!==void 0&&(Ee.recursive=B),M!==void 0&&(Ee.searchTerm=M),z&&(Ee.sortOrder=z),G!==void 0&&(Ee.parentId=G),de&&(Ee.fields=de),Te&&(Ee.excludeItemTypes=Te),pe&&(Ee.includeItemTypes=pe),Qe&&(Ee.filters=Qe),ce!==void 0&&(Ee.isFavorite=ce),Oe&&(Ee.mediaTypes=Oe),Ue&&(Ee.imageTypes=Ue),Ze&&(Ee.sortBy=Ze),nt!==void 0&&(Ee.isPlayed=nt),Dt&&(Ee.genres=Dt),Nt&&(Ee.officialRatings=Nt),Ot&&(Ee.tags=Ot),ke&&(Ee.years=ke),Je!==void 0&&(Ee.enableUserData=Je),ot!==void 0&&(Ee.imageTypeLimit=ot),kt&&(Ee.enableImageTypes=kt),vt!==void 0&&(Ee.person=vt),fe&&(Ee.personIds=fe),ze&&(Ee.personTypes=ze),Ve&&(Ee.studios=Ve),Fe&&(Ee.artists=Fe),et&&(Ee.excludeArtistIds=et),W&&(Ee.artistIds=W),se&&(Ee.albumArtistIds=se),me&&(Ee.contributingArtistIds=me),he&&(Ee.albums=he),Ke&&(Ee.albumIds=Ke),Be&&(Ee.ids=Be),ht&&(Ee.videoTypes=ht),Mt!==void 0&&(Ee.minOfficialRating=Mt),_t!==void 0&&(Ee.isLocked=_t),It!==void 0&&(Ee.isPlaceHolder=It),Ss!==void 0&&(Ee.hasOfficialRating=Ss),ds!==void 0&&(Ee.collapseBoxSetItems=ds),Vs!==void 0&&(Ee.minWidth=Vs),$s!==void 0&&(Ee.minHeight=$s),dn!==void 0&&(Ee.maxWidth=dn),it!==void 0&&(Ee.maxHeight=it),rt!==void 0&&(Ee.is3D=rt),ns&&(Ee.seriesStatus=ns),bs!==void 0&&(Ee.nameStartsWithOrGreater=bs),Ts!==void 0&&(Ee.nameStartsWith=Ts),ps!==void 0&&(Ee.nameLessThan=ps),gs&&(Ee.studioIds=gs),Ms&&(Ee.genreIds=Ms),Rs!==void 0&&(Ee.enableTotalRecordCount=Rs),St!==void 0&&(Ee.enableImages=St),Ce(zt,Ee);let rn=ws&&ws.headers?ws.headers:{};return Cs.headers={...Qs,...rn,...Pt.headers},{url:Le(zt),options:Cs}},getResumeItems:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T={})=>{const A="/UserItems/Resume",E=new URL(A,we);let R;n&&(R=n.baseOptions);const L={method:"GET",...R,...T},w={},D={};await Ne(w,"Authorization",n),e!==void 0&&(D.userId=e),t!==void 0&&(D.startIndex=t),s!==void 0&&(D.limit=s),i!==void 0&&(D.searchTerm=i),r!==void 0&&(D.parentId=r),a&&(D.fields=a),l&&(D.mediaTypes=l),u!==void 0&&(D.enableUserData=u),d!==void 0&&(D.imageTypeLimit=d),h&&(D.enableImageTypes=h),m&&(D.excludeItemTypes=m),g&&(D.includeItemTypes=g),v!==void 0&&(D.enableTotalRecordCount=v),S!==void 0&&(D.enableImages=S),x!==void 0&&(D.excludeActiveSessions=x),Ce(E,D);let _=R&&R.headers?R.headers:{};return L.headers={...w,..._,...T.headers},{url:Le(E),options:L}},updateItemUserData:async(e,t,s,i={})=>{Pe("updateItemUserData","itemId",e),Pe("updateItemUserData","updateUserItemDataDto",t);const r="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),s!==void 0&&(h.userId=s),d["Content-Type"]="application/json",Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},u.data=Ns(t,u,n),{url:Le(a),options:u}}}},Bd=function(n){const e=d2(n);return{async getItemUserData(t,s,i){var r,a,l;const u=await e.getItemUserData(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["ItemsApi.getItemUserData"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getItems(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y,re,B,M,z,G,de,Te,pe,Qe,ce,Oe,Ue,Ze,nt,Dt,Nt,Ot,ke,Je,ot,kt,vt,fe,ze,Ve,Fe,et,W,se,me,he,Ke,Be,ht,Mt,_t,It,Ss,ds,Vs,$s,dn,it,rt,ns,bs,Ts,ps,gs,Ms,Rs,St,Pt,jt){var zt,ws,Cs;const Qs=await e.getItems(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L,w,D,_,k,N,F,V,H,J,X,Q,j,K,Y,re,B,M,z,G,de,Te,pe,Qe,ce,Oe,Ue,Ze,nt,Dt,Nt,Ot,ke,Je,ot,kt,vt,fe,ze,Ve,Fe,et,W,se,me,he,Ke,Be,ht,Mt,_t,It,Ss,ds,Vs,$s,dn,it,rt,ns,bs,Ts,ps,gs,Ms,Rs,St,Pt,jt),Ee=(zt=n?.serverIndex)!==null&&zt!==void 0?zt:0,rn=(Cs=(ws=Re["ItemsApi.getItems"])===null||ws===void 0?void 0:ws[Ee])===null||Cs===void 0?void 0:Cs.url;return(wa,Ki)=>De(Qs,ve,Ie,n)(wa,rn||Ki)},async getResumeItems(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A){var E,R,L;const w=await e.getResumeItems(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A),D=(E=n?.serverIndex)!==null&&E!==void 0?E:0,_=(L=(R=Re["ItemsApi.getResumeItems"])===null||R===void 0?void 0:R[D])===null||L===void 0?void 0:L.url;return(k,N)=>De(w,ve,Ie,n)(k,_||N)},async updateItemUserData(t,s,i,r){var a,l,u;const d=await e.updateItemUserData(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["ItemsApi.updateItemUserData"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)}}};class us extends Di{getItemUserData(e,t){return Bd(this.configuration).getItemUserData(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItems(e={},t){return Bd(this.configuration).getItems(e.userId,e.maxOfficialRating,e.hasThemeSong,e.hasThemeVideo,e.hasSubtitles,e.hasSpecialFeature,e.hasTrailer,e.adjacentTo,e.indexNumber,e.parentIndexNumber,e.hasParentalRating,e.isHd,e.is4K,e.locationTypes,e.excludeLocationTypes,e.isMissing,e.isUnaired,e.minCommunityRating,e.minCriticRating,e.minPremiereDate,e.minDateLastSaved,e.minDateLastSavedForUser,e.maxPremiereDate,e.hasOverview,e.hasImdbId,e.hasTmdbId,e.hasTvdbId,e.isMovie,e.isSeries,e.isNews,e.isKids,e.isSports,e.excludeItemIds,e.startIndex,e.limit,e.recursive,e.searchTerm,e.sortOrder,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.imageTypes,e.sortBy,e.isPlayed,e.genres,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.artists,e.excludeArtistIds,e.artistIds,e.albumArtistIds,e.contributingArtistIds,e.albums,e.albumIds,e.ids,e.videoTypes,e.minOfficialRating,e.isLocked,e.isPlaceHolder,e.hasOfficialRating,e.collapseBoxSetItems,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.is3D,e.seriesStatus,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.studioIds,e.genreIds,e.enableTotalRecordCount,e.enableImages,t).then(s=>s(this.axios,this.basePath))}getResumeItems(e={},t){return Bd(this.configuration).getResumeItems(e.userId,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.mediaTypes,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.excludeItemTypes,e.includeItemTypes,e.enableTotalRecordCount,e.enableImages,e.excludeActiveSessions,t).then(s=>s(this.axios,this.basePath))}updateItemUserData(e,t){return Bd(this.configuration).updateItemUserData(e.itemId,e.updateUserItemDataDto,e.userId,t).then(s=>s(this.axios,this.basePath))}}const h2=function(n){return{deleteLyrics:async(e,t={})=>{Pe("deleteLyrics","itemId",e);const s="/Audio/{itemId}/Lyrics".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"DELETE",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},downloadRemoteLyrics:async(e,t,s={})=>{Pe("downloadRemoteLyrics","itemId",e),Pe("downloadRemoteLyrics","lyricId",t);const i="/Audio/{itemId}/RemoteSearch/Lyrics/{lyricId}".replace("{itemId}",encodeURIComponent(String(e))).replace("{lyricId}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getLyrics:async(e,t={})=>{Pe("getLyrics","itemId",e);const s="/Audio/{itemId}/Lyrics".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getRemoteLyrics:async(e,t={})=>{Pe("getRemoteLyrics","lyricId",e);const s="/Providers/Lyrics/{lyricId}".replace("{lyricId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},searchRemoteLyrics:async(e,t={})=>{Pe("searchRemoteLyrics","itemId",e);const s="/Audio/{itemId}/RemoteSearch/Lyrics".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},uploadLyrics:async(e,t,s,i={})=>{Pe("uploadLyrics","itemId",e),Pe("uploadLyrics","fileName",t);const r="/Audio/{itemId}/Lyrics".replace("{itemId}",encodeURIComponent(String(e))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),t!==void 0&&(h.fileName=t),d["Content-Type"]="text/plain",Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},u.data=Ns(s,u,n),{url:Le(a),options:u}}}},zo=function(n){const e=h2(n);return{async deleteLyrics(t,s){var i,r,a;const l=await e.deleteLyrics(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["LyricsApi.deleteLyrics"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async downloadRemoteLyrics(t,s,i){var r,a,l;const u=await e.downloadRemoteLyrics(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["LyricsApi.downloadRemoteLyrics"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getLyrics(t,s){var i,r,a;const l=await e.getLyrics(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["LyricsApi.getLyrics"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getRemoteLyrics(t,s){var i,r,a;const l=await e.getRemoteLyrics(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["LyricsApi.getRemoteLyrics"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async searchRemoteLyrics(t,s){var i,r,a;const l=await e.searchRemoteLyrics(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["LyricsApi.searchRemoteLyrics"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async uploadLyrics(t,s,i,r){var a,l,u;const d=await e.uploadLyrics(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["LyricsApi.uploadLyrics"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)}}};class f2 extends Di{deleteLyrics(e,t){return zo(this.configuration).deleteLyrics(e.itemId,t).then(s=>s(this.axios,this.basePath))}downloadRemoteLyrics(e,t){return zo(this.configuration).downloadRemoteLyrics(e.itemId,e.lyricId,t).then(s=>s(this.axios,this.basePath))}getLyrics(e,t){return zo(this.configuration).getLyrics(e.itemId,t).then(s=>s(this.axios,this.basePath))}getRemoteLyrics(e,t){return zo(this.configuration).getRemoteLyrics(e.lyricId,t).then(s=>s(this.axios,this.basePath))}searchRemoteLyrics(e,t){return zo(this.configuration).searchRemoteLyrics(e.itemId,t).then(s=>s(this.axios,this.basePath))}uploadLyrics(e,t){return zo(this.configuration).uploadLyrics(e.itemId,e.fileName,e.body,t).then(s=>s(this.axios,this.basePath))}}const m2=function(n){return{closeLiveStream:async(e,t={})=>{Pe("closeLiveStream","liveStreamId",e);const s="/LiveStreams/Close",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),e!==void 0&&(u.liveStreamId=e),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getBitrateTestBytes:async(e,t={})=>{const s="/Playback/BitrateTest",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),e!==void 0&&(u.size=e),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getPlaybackInfo:async(e,t,s={})=>{Pe("getPlaybackInfo","itemId",e);const i="/Items/{itemId}/PlaybackInfo".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getPostedPlaybackInfo:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A={})=>{Pe("getPostedPlaybackInfo","itemId",e);const E="/Items/{itemId}/PlaybackInfo".replace("{itemId}",encodeURIComponent(String(e))),R=new URL(E,we);let L;n&&(L=n.baseOptions);const w={method:"POST",...L,...A},D={},_={};await Ne(D,"Authorization",n),t!==void 0&&(_.userId=t),s!==void 0&&(_.maxStreamingBitrate=s),i!==void 0&&(_.startTimeTicks=i),r!==void 0&&(_.audioStreamIndex=r),a!==void 0&&(_.subtitleStreamIndex=a),l!==void 0&&(_.maxAudioChannels=l),u!==void 0&&(_.mediaSourceId=u),d!==void 0&&(_.liveStreamId=d),h!==void 0&&(_.autoOpenLiveStream=h),m!==void 0&&(_.enableDirectPlay=m),g!==void 0&&(_.enableDirectStream=g),v!==void 0&&(_.enableTranscoding=v),S!==void 0&&(_.allowVideoStreamCopy=S),x!==void 0&&(_.allowAudioStreamCopy=x),D["Content-Type"]="application/json",Ce(R,_);let k=L&&L.headers?L.headers:{};return w.headers={...D,...k,...A.headers},w.data=Ns(T,w,n),{url:Le(R),options:w}},openLiveStream:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S={})=>{const x="/LiveStreams/Open",T=new URL(x,we);let A;n&&(A=n.baseOptions);const E={method:"POST",...A,...S},R={},L={};await Ne(R,"Authorization",n),e!==void 0&&(L.openToken=e),t!==void 0&&(L.userId=t),s!==void 0&&(L.playSessionId=s),i!==void 0&&(L.maxStreamingBitrate=i),r!==void 0&&(L.startTimeTicks=r),a!==void 0&&(L.audioStreamIndex=a),l!==void 0&&(L.subtitleStreamIndex=l),u!==void 0&&(L.maxAudioChannels=u),d!==void 0&&(L.itemId=d),h!==void 0&&(L.enableDirectPlay=h),m!==void 0&&(L.enableDirectStream=m),g!==void 0&&(L.alwaysBurnInSubtitleWhenTranscoding=g),R["Content-Type"]="application/json",Ce(T,L);let w=A&&A.headers?A.headers:{};return E.headers={...R,...w,...S.headers},E.data=Ns(v,E,n),{url:Le(T),options:E}}}},Cc=function(n){const e=m2(n);return{async closeLiveStream(t,s){var i,r,a;const l=await e.closeLiveStream(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["MediaInfoApi.closeLiveStream"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getBitrateTestBytes(t,s){var i,r,a;const l=await e.getBitrateTestBytes(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["MediaInfoApi.getBitrateTestBytes"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getPlaybackInfo(t,s,i){var r,a,l;const u=await e.getPlaybackInfo(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["MediaInfoApi.getPlaybackInfo"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getPostedPlaybackInfo(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E){var R,L,w;const D=await e.getPostedPlaybackInfo(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E),_=(R=n?.serverIndex)!==null&&R!==void 0?R:0,k=(w=(L=Re["MediaInfoApi.getPostedPlaybackInfo"])===null||L===void 0?void 0:L[_])===null||w===void 0?void 0:w.url;return(N,F)=>De(D,ve,Ie,n)(N,k||F)},async openLiveStream(t,s,i,r,a,l,u,d,h,m,g,v,S,x){var T,A,E;const R=await e.openLiveStream(t,s,i,r,a,l,u,d,h,m,g,v,S,x),L=(T=n?.serverIndex)!==null&&T!==void 0?T:0,w=(E=(A=Re["MediaInfoApi.openLiveStream"])===null||A===void 0?void 0:A[L])===null||E===void 0?void 0:E.url;return(D,_)=>De(R,ve,Ie,n)(D,w||_)}}};class p2 extends Di{closeLiveStream(e,t){return Cc(this.configuration).closeLiveStream(e.liveStreamId,t).then(s=>s(this.axios,this.basePath))}getBitrateTestBytes(e={},t){return Cc(this.configuration).getBitrateTestBytes(e.size,t).then(s=>s(this.axios,this.basePath))}getPlaybackInfo(e,t){return Cc(this.configuration).getPlaybackInfo(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getPostedPlaybackInfo(e,t){return Cc(this.configuration).getPostedPlaybackInfo(e.itemId,e.userId,e.maxStreamingBitrate,e.startTimeTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.maxAudioChannels,e.mediaSourceId,e.liveStreamId,e.autoOpenLiveStream,e.enableDirectPlay,e.enableDirectStream,e.enableTranscoding,e.allowVideoStreamCopy,e.allowAudioStreamCopy,e.playbackInfoDto,t).then(s=>s(this.axios,this.basePath))}openLiveStream(e={},t){return Cc(this.configuration).openLiveStream(e.openToken,e.userId,e.playSessionId,e.maxStreamingBitrate,e.startTimeTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.maxAudioChannels,e.itemId,e.enableDirectPlay,e.enableDirectStream,e.alwaysBurnInSubtitleWhenTranscoding,e.openLiveStreamDto,t).then(s=>s(this.axios,this.basePath))}}const g2=function(n){return{getMusicGenre:async(e,t,s={})=>{Pe("getMusicGenre","genreName",e);const i="/MusicGenres/{genreName}".replace("{genreName}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getMusicGenres:async(e,t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R={})=>{const L="/MusicGenres",w=new URL(L,we);let D;n&&(D=n.baseOptions);const _={method:"GET",...D,...R},k={},N={};await Ne(k,"Authorization",n),e!==void 0&&(N.startIndex=e),t!==void 0&&(N.limit=t),s!==void 0&&(N.searchTerm=s),i!==void 0&&(N.parentId=i),r&&(N.fields=r),a&&(N.excludeItemTypes=a),l&&(N.includeItemTypes=l),u!==void 0&&(N.isFavorite=u),d!==void 0&&(N.imageTypeLimit=d),h&&(N.enableImageTypes=h),m!==void 0&&(N.userId=m),g!==void 0&&(N.nameStartsWithOrGreater=g),v!==void 0&&(N.nameStartsWith=v),S!==void 0&&(N.nameLessThan=S),x&&(N.sortBy=x),T&&(N.sortOrder=T),A!==void 0&&(N.enableImages=A),E!==void 0&&(N.enableTotalRecordCount=E),Ce(w,N);let F=D&&D.headers?D.headers:{};return _.headers={...k,...F,...R.headers},{url:Le(w),options:_}}}},pb=function(n){const e=g2(n);return{async getMusicGenre(t,s,i){var r,a,l;const u=await e.getMusicGenre(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["MusicGenresApi.getMusicGenre"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getMusicGenres(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L){var w,D,_;const k=await e.getMusicGenres(t,s,i,r,a,l,u,d,h,m,g,v,S,x,T,A,E,R,L),N=(w=n?.serverIndex)!==null&&w!==void 0?w:0,F=(_=(D=Re["MusicGenresApi.getMusicGenres"])===null||D===void 0?void 0:D[N])===null||_===void 0?void 0:_.url;return(V,H)=>De(k,ve,Ie,n)(V,F||H)}}};class jd extends Di{getMusicGenre(e,t){return pb(this.configuration).getMusicGenre(e.genreName,e.userId,t).then(s=>s(this.axios,this.basePath))}getMusicGenres(e={},t){return pb(this.configuration).getMusicGenres(e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.isFavorite,e.imageTypeLimit,e.enableImageTypes,e.userId,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.sortBy,e.sortOrder,e.enableImages,e.enableTotalRecordCount,t).then(s=>s(this.axios,this.basePath))}}const y2=function(n){return{addItemToPlaylist:async(e,t,s,i={})=>{Pe("addItemToPlaylist","playlistId",e);const r="/Playlists/{playlistId}/Items".replace("{playlistId}",encodeURIComponent(String(e))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),t&&(h.ids=t),s!==void 0&&(h.userId=s),Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},{url:Le(a),options:u}},createPlaylist:async(e,t,s,i,r,a={})=>{const l="/Playlists",u=new URL(l,we);let d;n&&(d=n.baseOptions);const h={method:"POST",...d,...a},m={},g={};await Ne(m,"Authorization",n),e!==void 0&&(g.name=e),t&&(g.ids=t),s!==void 0&&(g.userId=s),i!==void 0&&(g.mediaType=i),m["Content-Type"]="application/json",Ce(u,g);let v=d&&d.headers?d.headers:{};return h.headers={...m,...v,...a.headers},h.data=Ns(r,h,n),{url:Le(u),options:h}},getPlaylist:async(e,t={})=>{Pe("getPlaylist","playlistId",e);const s="/Playlists/{playlistId}".replace("{playlistId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getPlaylistItems:async(e,t,s,i,r,a,l,u,d,h={})=>{Pe("getPlaylistItems","playlistId",e);const m="/Playlists/{playlistId}/Items".replace("{playlistId}",encodeURIComponent(String(e))),g=new URL(m,we);let v;n&&(v=n.baseOptions);const S={method:"GET",...v,...h},x={},T={};await Ne(x,"Authorization",n),t!==void 0&&(T.userId=t),s!==void 0&&(T.startIndex=s),i!==void 0&&(T.limit=i),r&&(T.fields=r),a!==void 0&&(T.enableImages=a),l!==void 0&&(T.enableUserData=l),u!==void 0&&(T.imageTypeLimit=u),d&&(T.enableImageTypes=d),Ce(g,T);let A=v&&v.headers?v.headers:{};return S.headers={...x,...A,...h.headers},{url:Le(g),options:S}},getPlaylistUser:async(e,t,s={})=>{Pe("getPlaylistUser","playlistId",e),Pe("getPlaylistUser","userId",t);const i="/Playlists/{playlistId}/Users/{userId}".replace("{playlistId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getPlaylistUsers:async(e,t={})=>{Pe("getPlaylistUsers","playlistId",e);const s="/Playlists/{playlistId}/Users".replace("{playlistId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},moveItem:async(e,t,s,i={})=>{Pe("moveItem","playlistId",e),Pe("moveItem","itemId",t),Pe("moveItem","newIndex",s);const r="/Playlists/{playlistId}/Items/{itemId}/Move/{newIndex}".replace("{playlistId}",encodeURIComponent(String(e))).replace("{itemId}",encodeURIComponent(String(t))).replace("{newIndex}",encodeURIComponent(String(s))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},{url:Le(a),options:u}},removeItemFromPlaylist:async(e,t,s={})=>{Pe("removeItemFromPlaylist","playlistId",e);const i="/Playlists/{playlistId}/Items".replace("{playlistId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),t&&(d.entryIds=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},removeUserFromPlaylist:async(e,t,s={})=>{Pe("removeUserFromPlaylist","playlistId",e),Pe("removeUserFromPlaylist","userId",t);const i="/Playlists/{playlistId}/Users/{userId}".replace("{playlistId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},updatePlaylist:async(e,t,s={})=>{Pe("updatePlaylist","playlistId",e),Pe("updatePlaylist","updatePlaylistDto",t);const i="/Playlists/{playlistId}".replace("{playlistId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(t,l,n),{url:Le(r),options:l}},updatePlaylistUser:async(e,t,s,i={})=>{Pe("updatePlaylistUser","playlistId",e),Pe("updatePlaylistUser","userId",t),Pe("updatePlaylistUser","updatePlaylistUserDto",s);const r="/Playlists/{playlistId}/Users/{userId}".replace("{playlistId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),d["Content-Type"]="application/json",Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},u.data=Ns(s,u,n),{url:Le(a),options:u}}}},Mi=function(n){const e=y2(n);return{async addItemToPlaylist(t,s,i,r){var a,l,u;const d=await e.addItemToPlaylist(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["PlaylistsApi.addItemToPlaylist"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)},async createPlaylist(t,s,i,r,a,l){var u,d,h;const m=await e.createPlaylist(t,s,i,r,a,l),g=(u=n?.serverIndex)!==null&&u!==void 0?u:0,v=(h=(d=Re["PlaylistsApi.createPlaylist"])===null||d===void 0?void 0:d[g])===null||h===void 0?void 0:h.url;return(S,x)=>De(m,ve,Ie,n)(S,v||x)},async getPlaylist(t,s){var i,r,a;const l=await e.getPlaylist(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaylistsApi.getPlaylist"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getPlaylistItems(t,s,i,r,a,l,u,d,h,m){var g,v,S;const x=await e.getPlaylistItems(t,s,i,r,a,l,u,d,h,m),T=(g=n?.serverIndex)!==null&&g!==void 0?g:0,A=(S=(v=Re["PlaylistsApi.getPlaylistItems"])===null||v===void 0?void 0:v[T])===null||S===void 0?void 0:S.url;return(E,R)=>De(x,ve,Ie,n)(E,A||R)},async getPlaylistUser(t,s,i){var r,a,l;const u=await e.getPlaylistUser(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["PlaylistsApi.getPlaylistUser"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getPlaylistUsers(t,s){var i,r,a;const l=await e.getPlaylistUsers(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaylistsApi.getPlaylistUsers"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async moveItem(t,s,i,r){var a,l,u;const d=await e.moveItem(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["PlaylistsApi.moveItem"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)},async removeItemFromPlaylist(t,s,i){var r,a,l;const u=await e.removeItemFromPlaylist(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["PlaylistsApi.removeItemFromPlaylist"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async removeUserFromPlaylist(t,s,i){var r,a,l;const u=await e.removeUserFromPlaylist(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["PlaylistsApi.removeUserFromPlaylist"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updatePlaylist(t,s,i){var r,a,l;const u=await e.updatePlaylist(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["PlaylistsApi.updatePlaylist"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updatePlaylistUser(t,s,i,r){var a,l,u;const d=await e.updatePlaylistUser(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["PlaylistsApi.updatePlaylistUser"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)}}};class Lc extends Di{addItemToPlaylist(e,t){return Mi(this.configuration).addItemToPlaylist(e.playlistId,e.ids,e.userId,t).then(s=>s(this.axios,this.basePath))}createPlaylist(e={},t){return Mi(this.configuration).createPlaylist(e.name,e.ids,e.userId,e.mediaType,e.createPlaylistDto,t).then(s=>s(this.axios,this.basePath))}getPlaylist(e,t){return Mi(this.configuration).getPlaylist(e.playlistId,t).then(s=>s(this.axios,this.basePath))}getPlaylistItems(e,t){return Mi(this.configuration).getPlaylistItems(e.playlistId,e.userId,e.startIndex,e.limit,e.fields,e.enableImages,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,t).then(s=>s(this.axios,this.basePath))}getPlaylistUser(e,t){return Mi(this.configuration).getPlaylistUser(e.playlistId,e.userId,t).then(s=>s(this.axios,this.basePath))}getPlaylistUsers(e,t){return Mi(this.configuration).getPlaylistUsers(e.playlistId,t).then(s=>s(this.axios,this.basePath))}moveItem(e,t){return Mi(this.configuration).moveItem(e.playlistId,e.itemId,e.newIndex,t).then(s=>s(this.axios,this.basePath))}removeItemFromPlaylist(e,t){return Mi(this.configuration).removeItemFromPlaylist(e.playlistId,e.entryIds,t).then(s=>s(this.axios,this.basePath))}removeUserFromPlaylist(e,t){return Mi(this.configuration).removeUserFromPlaylist(e.playlistId,e.userId,t).then(s=>s(this.axios,this.basePath))}updatePlaylist(e,t){return Mi(this.configuration).updatePlaylist(e.playlistId,e.updatePlaylistDto,t).then(s=>s(this.axios,this.basePath))}updatePlaylistUser(e,t){return Mi(this.configuration).updatePlaylistUser(e.playlistId,e.userId,e.updatePlaylistUserDto,t).then(s=>s(this.axios,this.basePath))}}const v2=function(n){return{markPlayedItem:async(e,t,s,i={})=>{Pe("markPlayedItem","itemId",e);const r="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),t!==void 0&&(h.userId=t),s!==void 0&&(h.datePlayed=s instanceof Date?s.toISOString():s),Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},{url:Le(a),options:u}},markUnplayedItem:async(e,t,s={})=>{Pe("markUnplayedItem","itemId",e);const i="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},onPlaybackProgress:async(e,t,s,i,r,a,l,u,d,h,m,g,v={})=>{Pe("onPlaybackProgress","itemId",e);const S="/PlayingItems/{itemId}/Progress".replace("{itemId}",encodeURIComponent(String(e))),x=new URL(S,we);let T;n&&(T=n.baseOptions);const A={method:"POST",...T,...v},E={},R={};await Ne(E,"Authorization",n),t!==void 0&&(R.mediaSourceId=t),s!==void 0&&(R.positionTicks=s),i!==void 0&&(R.audioStreamIndex=i),r!==void 0&&(R.subtitleStreamIndex=r),a!==void 0&&(R.volumeLevel=a),l!==void 0&&(R.playMethod=l),u!==void 0&&(R.liveStreamId=u),d!==void 0&&(R.playSessionId=d),h!==void 0&&(R.repeatMode=h),m!==void 0&&(R.isPaused=m),g!==void 0&&(R.isMuted=g),Ce(x,R);let L=T&&T.headers?T.headers:{};return A.headers={...E,...L,...v.headers},{url:Le(x),options:A}},onPlaybackStart:async(e,t,s,i,r,a,l,u,d={})=>{Pe("onPlaybackStart","itemId",e);const h="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"POST",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.mediaSourceId=t),s!==void 0&&(x.audioStreamIndex=s),i!==void 0&&(x.subtitleStreamIndex=i),r!==void 0&&(x.playMethod=r),a!==void 0&&(x.liveStreamId=a),l!==void 0&&(x.playSessionId=l),u!==void 0&&(x.canSeek=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},onPlaybackStopped:async(e,t,s,i,r,a,l={})=>{Pe("onPlaybackStopped","itemId",e);const u="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(u,we);let h;n&&(h=n.baseOptions);const m={method:"DELETE",...h,...l},g={},v={};await Ne(g,"Authorization",n),t!==void 0&&(v.mediaSourceId=t),s!==void 0&&(v.nextMediaType=s),i!==void 0&&(v.positionTicks=i),r!==void 0&&(v.liveStreamId=r),a!==void 0&&(v.playSessionId=a),Ce(d,v);let S=h&&h.headers?h.headers:{};return m.headers={...g,...S,...l.headers},{url:Le(d),options:m}},pingPlaybackSession:async(e,t={})=>{Pe("pingPlaybackSession","playSessionId",e);const s="/Sessions/Playing/Ping",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),e!==void 0&&(u.playSessionId=e),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},reportPlaybackProgress:async(e,t={})=>{const s="/Sessions/Playing/Progress",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},reportPlaybackStart:async(e,t={})=>{const s="/Sessions/Playing",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},reportPlaybackStopped:async(e,t={})=>{const s="/Sessions/Playing/Stopped",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}}}},Dr=function(n){const e=v2(n);return{async markPlayedItem(t,s,i,r){var a,l,u;const d=await e.markPlayedItem(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["PlaystateApi.markPlayedItem"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)},async markUnplayedItem(t,s,i){var r,a,l;const u=await e.markUnplayedItem(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["PlaystateApi.markUnplayedItem"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async onPlaybackProgress(t,s,i,r,a,l,u,d,h,m,g,v,S){var x,T,A;const E=await e.onPlaybackProgress(t,s,i,r,a,l,u,d,h,m,g,v,S),R=(x=n?.serverIndex)!==null&&x!==void 0?x:0,L=(A=(T=Re["PlaystateApi.onPlaybackProgress"])===null||T===void 0?void 0:T[R])===null||A===void 0?void 0:A.url;return(w,D)=>De(E,ve,Ie,n)(w,L||D)},async onPlaybackStart(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.onPlaybackStart(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["PlaystateApi.onPlaybackStart"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async onPlaybackStopped(t,s,i,r,a,l,u){var d,h,m;const g=await e.onPlaybackStopped(t,s,i,r,a,l,u),v=(d=n?.serverIndex)!==null&&d!==void 0?d:0,S=(m=(h=Re["PlaystateApi.onPlaybackStopped"])===null||h===void 0?void 0:h[v])===null||m===void 0?void 0:m.url;return(x,T)=>De(g,ve,Ie,n)(x,S||T)},async pingPlaybackSession(t,s){var i,r,a;const l=await e.pingPlaybackSession(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaystateApi.pingPlaybackSession"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async reportPlaybackProgress(t,s){var i,r,a;const l=await e.reportPlaybackProgress(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaystateApi.reportPlaybackProgress"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async reportPlaybackStart(t,s){var i,r,a;const l=await e.reportPlaybackStart(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaystateApi.reportPlaybackStart"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async reportPlaybackStopped(t,s){var i,r,a;const l=await e.reportPlaybackStopped(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["PlaystateApi.reportPlaybackStopped"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)}}};class jp extends Di{markPlayedItem(e,t){return Dr(this.configuration).markPlayedItem(e.itemId,e.userId,e.datePlayed,t).then(s=>s(this.axios,this.basePath))}markUnplayedItem(e,t){return Dr(this.configuration).markUnplayedItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}onPlaybackProgress(e,t){return Dr(this.configuration).onPlaybackProgress(e.itemId,e.mediaSourceId,e.positionTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.volumeLevel,e.playMethod,e.liveStreamId,e.playSessionId,e.repeatMode,e.isPaused,e.isMuted,t).then(s=>s(this.axios,this.basePath))}onPlaybackStart(e,t){return Dr(this.configuration).onPlaybackStart(e.itemId,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.playMethod,e.liveStreamId,e.playSessionId,e.canSeek,t).then(s=>s(this.axios,this.basePath))}onPlaybackStopped(e,t){return Dr(this.configuration).onPlaybackStopped(e.itemId,e.mediaSourceId,e.nextMediaType,e.positionTicks,e.liveStreamId,e.playSessionId,t).then(s=>s(this.axios,this.basePath))}pingPlaybackSession(e,t){return Dr(this.configuration).pingPlaybackSession(e.playSessionId,t).then(s=>s(this.axios,this.basePath))}reportPlaybackProgress(e={},t){return Dr(this.configuration).reportPlaybackProgress(e.playbackProgressInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStart(e={},t){return Dr(this.configuration).reportPlaybackStart(e.playbackStartInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStopped(e={},t){return Dr(this.configuration).reportPlaybackStopped(e.playbackStopInfo,t).then(s=>s(this.axios,this.basePath))}}const x2=function(n){return{addUserToSession:async(e,t,s={})=>{Pe("addUserToSession","sessionId",e),Pe("addUserToSession","userId",t);const i="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},displayContent:async(e,t,s,i,r={})=>{Pe("displayContent","sessionId",e),Pe("displayContent","itemType",t),Pe("displayContent","itemId",s),Pe("displayContent","itemName",i);const a="/Sessions/{sessionId}/Viewing".replace("{sessionId}",encodeURIComponent(String(e))),l=new URL(a,we);let u;n&&(u=n.baseOptions);const d={method:"POST",...u,...r},h={},m={};await Ne(h,"Authorization",n),t!==void 0&&(m.itemType=t),s!==void 0&&(m.itemId=s),i!==void 0&&(m.itemName=i),Ce(l,m);let g=u&&u.headers?u.headers:{};return d.headers={...h,...g,...r.headers},{url:Le(l),options:d}},getAuthProviders:async(e={})=>{const t="/Auth/Providers",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getPasswordResetProviders:async(e={})=>{const t="/Auth/PasswordResetProviders",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getSessions:async(e,t,s,i={})=>{const r="/Sessions",a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"GET",...l,...i},d={},h={};await Ne(d,"Authorization",n),e!==void 0&&(h.controllableByUserId=e),t!==void 0&&(h.deviceId=t),s!==void 0&&(h.activeWithinSeconds=s),Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},{url:Le(a),options:u}},play:async(e,t,s,i,r,a,l,u,d={})=>{Pe("play","sessionId",e),Pe("play","playCommand",t),Pe("play","itemIds",s);const h="/Sessions/{sessionId}/Playing".replace("{sessionId}",encodeURIComponent(String(e))),m=new URL(h,we);let g;n&&(g=n.baseOptions);const v={method:"POST",...g,...d},S={},x={};await Ne(S,"Authorization",n),t!==void 0&&(x.playCommand=t),s&&(x.itemIds=s),i!==void 0&&(x.startPositionTicks=i),r!==void 0&&(x.mediaSourceId=r),a!==void 0&&(x.audioStreamIndex=a),l!==void 0&&(x.subtitleStreamIndex=l),u!==void 0&&(x.startIndex=u),Ce(m,x);let T=g&&g.headers?g.headers:{};return v.headers={...S,...T,...d.headers},{url:Le(m),options:v}},postCapabilities:async(e,t,s,i,r,a={})=>{const l="/Sessions/Capabilities",u=new URL(l,we);let d;n&&(d=n.baseOptions);const h={method:"POST",...d,...a},m={},g={};await Ne(m,"Authorization",n),e!==void 0&&(g.id=e),t&&(g.playableMediaTypes=t),s&&(g.supportedCommands=s),i!==void 0&&(g.supportsMediaControl=i),r!==void 0&&(g.supportsPersistentIdentifier=r),Ce(u,g);let v=d&&d.headers?d.headers:{};return h.headers={...m,...v,...a.headers},{url:Le(u),options:h}},postFullCapabilities:async(e,t,s={})=>{Pe("postFullCapabilities","clientCapabilitiesDto",e);const i="/Sessions/Capabilities/Full",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.id=t),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(e,l,n),{url:Le(r),options:l}},removeUserFromSession:async(e,t,s={})=>{Pe("removeUserFromSession","sessionId",e),Pe("removeUserFromSession","userId",t);const i="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},reportSessionEnded:async(e={})=>{const t="/Sessions/Logout",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},reportViewing:async(e,t,s={})=>{Pe("reportViewing","itemId",e);const i="/Sessions/Viewing",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.sessionId=t),e!==void 0&&(d.itemId=e),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},sendFullGeneralCommand:async(e,t,s={})=>{Pe("sendFullGeneralCommand","sessionId",e),Pe("sendFullGeneralCommand","generalCommand",t);const i="/Sessions/{sessionId}/Command".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(t,l,n),{url:Le(r),options:l}},sendGeneralCommand:async(e,t,s={})=>{Pe("sendGeneralCommand","sessionId",e),Pe("sendGeneralCommand","command",t);const i="/Sessions/{sessionId}/Command/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},sendMessageCommand:async(e,t,s={})=>{Pe("sendMessageCommand","sessionId",e),Pe("sendMessageCommand","messageCommand",t);const i="/Sessions/{sessionId}/Message".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(t,l,n),{url:Le(r),options:l}},sendPlaystateCommand:async(e,t,s,i,r={})=>{Pe("sendPlaystateCommand","sessionId",e),Pe("sendPlaystateCommand","command",t);const a="/Sessions/{sessionId}/Playing/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),l=new URL(a,we);let u;n&&(u=n.baseOptions);const d={method:"POST",...u,...r},h={},m={};await Ne(h,"Authorization",n),s!==void 0&&(m.seekPositionTicks=s),i!==void 0&&(m.controllingUserId=i),Ce(l,m);let g=u&&u.headers?u.headers:{};return d.headers={...h,...g,...r.headers},{url:Le(l),options:d}},sendSystemCommand:async(e,t,s={})=>{Pe("sendSystemCommand","sessionId",e),Pe("sendSystemCommand","command",t);const i="/Sessions/{sessionId}/System/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}}}},Tn=function(n){const e=x2(n);return{async addUserToSession(t,s,i){var r,a,l;const u=await e.addUserToSession(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.addUserToSession"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async displayContent(t,s,i,r,a){var l,u,d;const h=await e.displayContent(t,s,i,r,a),m=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(u=Re["SessionApi.displayContent"])===null||u===void 0?void 0:u[m])===null||d===void 0?void 0:d.url;return(v,S)=>De(h,ve,Ie,n)(v,g||S)},async getAuthProviders(t){var s,i,r;const a=await e.getAuthProviders(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SessionApi.getAuthProviders"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getPasswordResetProviders(t){var s,i,r;const a=await e.getPasswordResetProviders(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SessionApi.getPasswordResetProviders"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getSessions(t,s,i,r){var a,l,u;const d=await e.getSessions(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["SessionApi.getSessions"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)},async play(t,s,i,r,a,l,u,d,h){var m,g,v;const S=await e.play(t,s,i,r,a,l,u,d,h),x=(m=n?.serverIndex)!==null&&m!==void 0?m:0,T=(v=(g=Re["SessionApi.play"])===null||g===void 0?void 0:g[x])===null||v===void 0?void 0:v.url;return(A,E)=>De(S,ve,Ie,n)(A,T||E)},async postCapabilities(t,s,i,r,a,l){var u,d,h;const m=await e.postCapabilities(t,s,i,r,a,l),g=(u=n?.serverIndex)!==null&&u!==void 0?u:0,v=(h=(d=Re["SessionApi.postCapabilities"])===null||d===void 0?void 0:d[g])===null||h===void 0?void 0:h.url;return(S,x)=>De(m,ve,Ie,n)(S,v||x)},async postFullCapabilities(t,s,i){var r,a,l;const u=await e.postFullCapabilities(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.postFullCapabilities"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async removeUserFromSession(t,s,i){var r,a,l;const u=await e.removeUserFromSession(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.removeUserFromSession"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async reportSessionEnded(t){var s,i,r;const a=await e.reportSessionEnded(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SessionApi.reportSessionEnded"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async reportViewing(t,s,i){var r,a,l;const u=await e.reportViewing(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.reportViewing"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async sendFullGeneralCommand(t,s,i){var r,a,l;const u=await e.sendFullGeneralCommand(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.sendFullGeneralCommand"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async sendGeneralCommand(t,s,i){var r,a,l;const u=await e.sendGeneralCommand(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.sendGeneralCommand"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async sendMessageCommand(t,s,i){var r,a,l;const u=await e.sendMessageCommand(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.sendMessageCommand"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async sendPlaystateCommand(t,s,i,r,a){var l,u,d;const h=await e.sendPlaystateCommand(t,s,i,r,a),m=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(u=Re["SessionApi.sendPlaystateCommand"])===null||u===void 0?void 0:u[m])===null||d===void 0?void 0:d.url;return(v,S)=>De(h,ve,Ie,n)(v,g||S)},async sendSystemCommand(t,s,i){var r,a,l;const u=await e.sendSystemCommand(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["SessionApi.sendSystemCommand"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)}}};class OA extends Di{addUserToSession(e,t){return Tn(this.configuration).addUserToSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}displayContent(e,t){return Tn(this.configuration).displayContent(e.sessionId,e.itemType,e.itemId,e.itemName,t).then(s=>s(this.axios,this.basePath))}getAuthProviders(e){return Tn(this.configuration).getAuthProviders(e).then(t=>t(this.axios,this.basePath))}getPasswordResetProviders(e){return Tn(this.configuration).getPasswordResetProviders(e).then(t=>t(this.axios,this.basePath))}getSessions(e={},t){return Tn(this.configuration).getSessions(e.controllableByUserId,e.deviceId,e.activeWithinSeconds,t).then(s=>s(this.axios,this.basePath))}play(e,t){return Tn(this.configuration).play(e.sessionId,e.playCommand,e.itemIds,e.startPositionTicks,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.startIndex,t).then(s=>s(this.axios,this.basePath))}postCapabilities(e={},t){return Tn(this.configuration).postCapabilities(e.id,e.playableMediaTypes,e.supportedCommands,e.supportsMediaControl,e.supportsPersistentIdentifier,t).then(s=>s(this.axios,this.basePath))}postFullCapabilities(e,t){return Tn(this.configuration).postFullCapabilities(e.clientCapabilitiesDto,e.id,t).then(s=>s(this.axios,this.basePath))}removeUserFromSession(e,t){return Tn(this.configuration).removeUserFromSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}reportSessionEnded(e){return Tn(this.configuration).reportSessionEnded(e).then(t=>t(this.axios,this.basePath))}reportViewing(e,t){return Tn(this.configuration).reportViewing(e.itemId,e.sessionId,t).then(s=>s(this.axios,this.basePath))}sendFullGeneralCommand(e,t){return Tn(this.configuration).sendFullGeneralCommand(e.sessionId,e.generalCommand,t).then(s=>s(this.axios,this.basePath))}sendGeneralCommand(e,t){return Tn(this.configuration).sendGeneralCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}sendMessageCommand(e,t){return Tn(this.configuration).sendMessageCommand(e.sessionId,e.messageCommand,t).then(s=>s(this.axios,this.basePath))}sendPlaystateCommand(e,t){return Tn(this.configuration).sendPlaystateCommand(e.sessionId,e.command,e.seekPositionTicks,e.controllingUserId,t).then(s=>s(this.axios,this.basePath))}sendSystemCommand(e,t){return Tn(this.configuration).sendSystemCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}}const S2=function(n){return{getEndpointInfo:async(e={})=>{const t="/System/Endpoint",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getLogFile:async(e,t={})=>{Pe("getLogFile","name",e);const s="/System/Logs/Log",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),e!==void 0&&(u.name=e),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={};Ce(s,{});let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getPublicSystemInfo:async(e={})=>{const t="/System/Info/Public",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={};Ce(s,{});let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getServerLogs:async(e={})=>{const t="/System/Logs",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getSystemInfo:async(e={})=>{const t="/System/Info",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getWakeOnLanInfo:async(e={})=>{const t="/System/WakeOnLanInfo",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},postPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},a={};Ce(s,{});let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},restartApplication:async(e={})=>{const t="/System/Restart",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},shutdownApplication:async(e={})=>{const t="/System/Shutdown",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}}}},er=function(n){const e=S2(n);return{async getEndpointInfo(t){var s,i,r;const a=await e.getEndpointInfo(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getEndpointInfo"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getLogFile(t,s){var i,r,a;const l=await e.getLogFile(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["SystemApi.getLogFile"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getPingSystem(t){var s,i,r;const a=await e.getPingSystem(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getPingSystem"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getPublicSystemInfo(t){var s,i,r;const a=await e.getPublicSystemInfo(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getPublicSystemInfo"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getServerLogs(t){var s,i,r;const a=await e.getServerLogs(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getServerLogs"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getSystemInfo(t){var s,i,r;const a=await e.getSystemInfo(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getSystemInfo"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getWakeOnLanInfo(t){var s,i,r;const a=await e.getWakeOnLanInfo(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.getWakeOnLanInfo"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async postPingSystem(t){var s,i,r;const a=await e.postPingSystem(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.postPingSystem"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async restartApplication(t){var s,i,r;const a=await e.restartApplication(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.restartApplication"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async shutdownApplication(t){var s,i,r;const a=await e.shutdownApplication(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["SystemApi.shutdownApplication"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)}}};class _A extends Di{getEndpointInfo(e){return er(this.configuration).getEndpointInfo(e).then(t=>t(this.axios,this.basePath))}getLogFile(e,t){return er(this.configuration).getLogFile(e.name,t).then(s=>s(this.axios,this.basePath))}getPingSystem(e){return er(this.configuration).getPingSystem(e).then(t=>t(this.axios,this.basePath))}getPublicSystemInfo(e){return er(this.configuration).getPublicSystemInfo(e).then(t=>t(this.axios,this.basePath))}getServerLogs(e){return er(this.configuration).getServerLogs(e).then(t=>t(this.axios,this.basePath))}getSystemInfo(e){return er(this.configuration).getSystemInfo(e).then(t=>t(this.axios,this.basePath))}getWakeOnLanInfo(e){return er(this.configuration).getWakeOnLanInfo(e).then(t=>t(this.axios,this.basePath))}postPingSystem(e){return er(this.configuration).postPingSystem(e).then(t=>t(this.axios,this.basePath))}restartApplication(e){return er(this.configuration).restartApplication(e).then(t=>t(this.axios,this.basePath))}shutdownApplication(e){return er(this.configuration).shutdownApplication(e).then(t=>t(this.axios,this.basePath))}}const b2=function(n){return{authenticateUserByName:async(e,t={})=>{Pe("authenticateUserByName","authenticateUserByName",e);const s="/Users/AuthenticateByName",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},authenticateWithQuickConnect:async(e,t={})=>{Pe("authenticateWithQuickConnect","quickConnectDto",e);const s="/Users/AuthenticateWithQuickConnect",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},createUserByName:async(e,t={})=>{Pe("createUserByName","createUserByName",e);const s="/Users/New",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};await Ne(l,"Authorization",n),l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},deleteUser:async(e,t={})=>{Pe("deleteUser","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"DELETE",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},forgotPassword:async(e,t={})=>{Pe("forgotPassword","forgotPasswordDto",e);const s="/Users/ForgotPassword",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},forgotPasswordPin:async(e,t={})=>{Pe("forgotPasswordPin","forgotPasswordPinDto",e);const s="/Users/ForgotPassword/Pin",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"POST",...r,...t},l={},u={};l["Content-Type"]="application/json",Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},a.data=Ns(e,a,n),{url:Le(i),options:a}},getCurrentUser:async(e={})=>{const t="/Users/Me",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={},l={};await Ne(a,"Authorization",n),Ce(s,l);let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getPublicUsers:async(e={})=>{const t="/Users/Public",s=new URL(t,we);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},a={};Ce(s,{});let u=i&&i.headers?i.headers:{};return r.headers={...a,...u,...e.headers},{url:Le(s),options:r}},getUserById:async(e,t={})=>{Pe("getUserById","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getUsers:async(e,t,s={})=>{const i="/Users",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),e!==void 0&&(d.isHidden=e),t!==void 0&&(d.isDisabled=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},updateUser:async(e,t,s={})=>{Pe("updateUser","userDto",e);const i="/Users",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(e,l,n),{url:Le(r),options:l}},updateUserConfiguration:async(e,t,s={})=>{Pe("updateUserConfiguration","userConfiguration",e);const i="/Users/Configuration",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(e,l,n),{url:Le(r),options:l}},updateUserPassword:async(e,t,s={})=>{Pe("updateUserPassword","updateUserPassword",e);const i="/Users/Password",r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(e,l,n),{url:Le(r),options:l}},updateUserPolicy:async(e,t,s={})=>{Pe("updateUserPolicy","userId",e),Pe("updateUserPolicy","userPolicy",t);const i="/Users/{userId}/Policy".replace("{userId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),u["Content-Type"]="application/json",Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},l.data=Ns(t,l,n),{url:Le(r),options:l}}}},Un=function(n){const e=b2(n);return{async authenticateUserByName(t,s){var i,r,a;const l=await e.authenticateUserByName(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.authenticateUserByName"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async authenticateWithQuickConnect(t,s){var i,r,a;const l=await e.authenticateWithQuickConnect(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.authenticateWithQuickConnect"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async createUserByName(t,s){var i,r,a;const l=await e.createUserByName(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.createUserByName"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async deleteUser(t,s){var i,r,a;const l=await e.deleteUser(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.deleteUser"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async forgotPassword(t,s){var i,r,a;const l=await e.forgotPassword(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.forgotPassword"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async forgotPasswordPin(t,s){var i,r,a;const l=await e.forgotPasswordPin(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.forgotPasswordPin"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getCurrentUser(t){var s,i,r;const a=await e.getCurrentUser(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["UserApi.getCurrentUser"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getPublicUsers(t){var s,i,r;const a=await e.getPublicUsers(t),l=(s=n?.serverIndex)!==null&&s!==void 0?s:0,u=(r=(i=Re["UserApi.getPublicUsers"])===null||i===void 0?void 0:i[l])===null||r===void 0?void 0:r.url;return(d,h)=>De(a,ve,Ie,n)(d,u||h)},async getUserById(t,s){var i,r,a;const l=await e.getUserById(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserApi.getUserById"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getUsers(t,s,i){var r,a,l;const u=await e.getUsers(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserApi.getUsers"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updateUser(t,s,i){var r,a,l;const u=await e.updateUser(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserApi.updateUser"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updateUserConfiguration(t,s,i){var r,a,l;const u=await e.updateUserConfiguration(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserApi.updateUserConfiguration"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updateUserPassword(t,s,i){var r,a,l;const u=await e.updateUserPassword(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserApi.updateUserPassword"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updateUserPolicy(t,s,i){var r,a,l;const u=await e.updateUserPolicy(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserApi.updateUserPolicy"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)}}};class PA extends Di{authenticateUserByName(e,t){return Un(this.configuration).authenticateUserByName(e.authenticateUserByName,t).then(s=>s(this.axios,this.basePath))}authenticateWithQuickConnect(e,t){return Un(this.configuration).authenticateWithQuickConnect(e.quickConnectDto,t).then(s=>s(this.axios,this.basePath))}createUserByName(e,t){return Un(this.configuration).createUserByName(e.createUserByName,t).then(s=>s(this.axios,this.basePath))}deleteUser(e,t){return Un(this.configuration).deleteUser(e.userId,t).then(s=>s(this.axios,this.basePath))}forgotPassword(e,t){return Un(this.configuration).forgotPassword(e.forgotPasswordDto,t).then(s=>s(this.axios,this.basePath))}forgotPasswordPin(e,t){return Un(this.configuration).forgotPasswordPin(e.forgotPasswordPinDto,t).then(s=>s(this.axios,this.basePath))}getCurrentUser(e){return Un(this.configuration).getCurrentUser(e).then(t=>t(this.axios,this.basePath))}getPublicUsers(e){return Un(this.configuration).getPublicUsers(e).then(t=>t(this.axios,this.basePath))}getUserById(e,t){return Un(this.configuration).getUserById(e.userId,t).then(s=>s(this.axios,this.basePath))}getUsers(e={},t){return Un(this.configuration).getUsers(e.isHidden,e.isDisabled,t).then(s=>s(this.axios,this.basePath))}updateUser(e,t){return Un(this.configuration).updateUser(e.userDto,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserConfiguration(e,t){return Un(this.configuration).updateUserConfiguration(e.userConfiguration,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPassword(e,t){return Un(this.configuration).updateUserPassword(e.updateUserPassword,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPolicy(e,t){return Un(this.configuration).updateUserPolicy(e.userId,e.userPolicy,t).then(s=>s(this.axios,this.basePath))}}const T2=function(n){return{deleteUserItemRating:async(e,t,s={})=>{Pe("deleteUserItemRating","itemId",e);const i="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getIntros:async(e,t,s={})=>{Pe("getIntros","itemId",e);const i="/Items/{itemId}/Intros".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getItem:async(e,t,s={})=>{Pe("getItem","itemId",e);const i="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getLatestMedia:async(e,t,s,i,r,a,l,u,d,h,m,g={})=>{const v="/Items/Latest",S=new URL(v,we);let x;n&&(x=n.baseOptions);const T={method:"GET",...x,...g},A={},E={};await Ne(A,"Authorization",n),e!==void 0&&(E.userId=e),t!==void 0&&(E.parentId=t),s&&(E.fields=s),i&&(E.includeItemTypes=i),r!==void 0&&(E.isPlayed=r),a!==void 0&&(E.enableImages=a),l!==void 0&&(E.imageTypeLimit=l),u&&(E.enableImageTypes=u),d!==void 0&&(E.enableUserData=d),h!==void 0&&(E.limit=h),m!==void 0&&(E.groupItems=m),Ce(S,E);let R=x&&x.headers?x.headers:{};return T.headers={...A,...R,...g.headers},{url:Le(S),options:T}},getLocalTrailers:async(e,t,s={})=>{Pe("getLocalTrailers","itemId",e);const i="/Items/{itemId}/LocalTrailers".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},getRootFolder:async(e,t={})=>{const s="/Items/Root",i=new URL(s,we);let r;n&&(r=n.baseOptions);const a={method:"GET",...r,...t},l={},u={};await Ne(l,"Authorization",n),e!==void 0&&(u.userId=e),Ce(i,u);let d=r&&r.headers?r.headers:{};return a.headers={...l,...d,...t.headers},{url:Le(i),options:a}},getSpecialFeatures:async(e,t,s={})=>{Pe("getSpecialFeatures","itemId",e);const i="/Items/{itemId}/SpecialFeatures".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"GET",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},markFavoriteItem:async(e,t,s={})=>{Pe("markFavoriteItem","itemId",e);const i="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"POST",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},unmarkFavoriteItem:async(e,t,s={})=>{Pe("unmarkFavoriteItem","itemId",e);const i="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,we);let a;n&&(a=n.baseOptions);const l={method:"DELETE",...a,...s},u={},d={};await Ne(u,"Authorization",n),t!==void 0&&(d.userId=t),Ce(r,d);let h=a&&a.headers?a.headers:{};return l.headers={...u,...h,...s.headers},{url:Le(r),options:l}},updateUserItemRating:async(e,t,s,i={})=>{Pe("updateUserItemRating","itemId",e);const r="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),a=new URL(r,we);let l;n&&(l=n.baseOptions);const u={method:"POST",...l,...i},d={},h={};await Ne(d,"Authorization",n),t!==void 0&&(h.userId=t),s!==void 0&&(h.likes=s),Ce(a,h);let m=l&&l.headers?l.headers:{};return u.headers={...d,...m,...i.headers},{url:Le(a),options:u}}}},tr=function(n){const e=T2(n);return{async deleteUserItemRating(t,s,i){var r,a,l;const u=await e.deleteUserItemRating(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.deleteUserItemRating"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getIntros(t,s,i){var r,a,l;const u=await e.getIntros(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.getIntros"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getItem(t,s,i){var r,a,l;const u=await e.getItem(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.getItem"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getLatestMedia(t,s,i,r,a,l,u,d,h,m,g,v){var S,x,T;const A=await e.getLatestMedia(t,s,i,r,a,l,u,d,h,m,g,v),E=(S=n?.serverIndex)!==null&&S!==void 0?S:0,R=(T=(x=Re["UserLibraryApi.getLatestMedia"])===null||x===void 0?void 0:x[E])===null||T===void 0?void 0:T.url;return(L,w)=>De(A,ve,Ie,n)(L,R||w)},async getLocalTrailers(t,s,i){var r,a,l;const u=await e.getLocalTrailers(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.getLocalTrailers"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async getRootFolder(t,s){var i,r,a;const l=await e.getRootFolder(t,s),u=(i=n?.serverIndex)!==null&&i!==void 0?i:0,d=(a=(r=Re["UserLibraryApi.getRootFolder"])===null||r===void 0?void 0:r[u])===null||a===void 0?void 0:a.url;return(h,m)=>De(l,ve,Ie,n)(h,d||m)},async getSpecialFeatures(t,s,i){var r,a,l;const u=await e.getSpecialFeatures(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.getSpecialFeatures"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async markFavoriteItem(t,s,i){var r,a,l;const u=await e.markFavoriteItem(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.markFavoriteItem"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async unmarkFavoriteItem(t,s,i){var r,a,l;const u=await e.unmarkFavoriteItem(t,s,i),d=(r=n?.serverIndex)!==null&&r!==void 0?r:0,h=(l=(a=Re["UserLibraryApi.unmarkFavoriteItem"])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l.url;return(m,g)=>De(u,ve,Ie,n)(m,h||g)},async updateUserItemRating(t,s,i,r){var a,l,u;const d=await e.updateUserItemRating(t,s,i,r),h=(a=n?.serverIndex)!==null&&a!==void 0?a:0,m=(u=(l=Re["UserLibraryApi.updateUserItemRating"])===null||l===void 0?void 0:l[h])===null||u===void 0?void 0:u.url;return(g,v)=>De(d,ve,Ie,n)(g,m||v)}}};class Ko extends Di{deleteUserItemRating(e,t){return tr(this.configuration).deleteUserItemRating(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getIntros(e,t){return tr(this.configuration).getIntros(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItem(e,t){return tr(this.configuration).getItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getLatestMedia(e={},t){return tr(this.configuration).getLatestMedia(e.userId,e.parentId,e.fields,e.includeItemTypes,e.isPlayed,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.limit,e.groupItems,t).then(s=>s(this.axios,this.basePath))}getLocalTrailers(e,t){return tr(this.configuration).getLocalTrailers(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getRootFolder(e={},t){return tr(this.configuration).getRootFolder(e.userId,t).then(s=>s(this.axios,this.basePath))}getSpecialFeatures(e,t){return tr(this.configuration).getSpecialFeatures(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}markFavoriteItem(e,t){return tr(this.configuration).markFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}unmarkFavoriteItem(e,t){return tr(this.configuration).unmarkFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserItemRating(e,t){return tr(this.configuration).updateUserItemRating(e.itemId,e.userId,e.likes,t).then(s=>s(this.axios,this.basePath))}}class E2{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const _e={AggregateFolder:"AggregateFolder",Audio:"Audio",AudioBook:"AudioBook",BasePluginFolder:"BasePluginFolder",Book:"Book",BoxSet:"BoxSet",Channel:"Channel",ChannelFolderItem:"ChannelFolderItem",CollectionFolder:"CollectionFolder",Episode:"Episode",Folder:"Folder",Genre:"Genre",ManualPlaylistsFolder:"ManualPlaylistsFolder",Movie:"Movie",LiveTvChannel:"LiveTvChannel",LiveTvProgram:"LiveTvProgram",MusicAlbum:"MusicAlbum",MusicArtist:"MusicArtist",MusicGenre:"MusicGenre",MusicVideo:"MusicVideo",Person:"Person",Photo:"Photo",PhotoAlbum:"PhotoAlbum",Playlist:"Playlist",PlaylistsFolder:"PlaylistsFolder",Program:"Program",Recording:"Recording",Season:"Season",Series:"Series",Studio:"Studio",Trailer:"Trailer",TvChannel:"TvChannel",TvProgram:"TvProgram",UserRootFolder:"UserRootFolder",UserView:"UserView",Video:"Video",Year:"Year"},Yo={IsPlayed:"IsPlayed",IsFavorite:"IsFavorite"},Bt={DateCreated:"DateCreated",DatePlayed:"DatePlayed",PremiereDate:"PremiereDate",SortName:"SortName",Name:"Name",Random:"Random",Runtime:"Runtime",ProductionYear:"ProductionYear",PlayCount:"PlayCount",IndexNumber:"IndexNumber"},gb={DirectStream:"DirectStream"},hs={Ascending:"Ascending",Descending:"Descending"},NA=C.createContext({}),ss=()=>C.useContext(NA),A2=()=>{const n=xn(),[e,t]=u_(),s=ss(),i=e.get("sort"),r=e.get("order"),a=e.get("kind"),l=i&&$g(i)?Object.values(si).find(E=>E.toLowerCase()===i.toLowerCase()):null,u=r&&Gg(r)?Object.values(Ya).find(E=>E.toLowerCase()===r.toLowerCase()):null,d=a&&Hg(a)?Object.values(qa).find(E=>E.toLowerCase()===a.toLowerCase()):null,h=Vg[n.pathname]||si.None,m=h===si.Added||h===si.None?Ya.Descending:Ya.Ascending,g=qa.Tracks,[v,S]=C.useState({sort:l||h,order:u||m,kind:d||g}),x=C.useCallback(E=>{const R=E(v);s.rememberFilters&&localStorage.setItem(`rememberFilters_${aA(n.pathname)}`,JSON.stringify(R));const L=new URLSearchParams;Vg[n.pathname]!==R.sort&&R.sort&&L.set("sort",R.sort),m!==R.order&&R.order&&L.set("order",R.order),g!==R.kind&&R.kind&&L.set("kind",R.kind),t(L),S(R)},[v,s.rememberFilters,n.pathname,m,g,t]);C.useEffect(()=>{const E=e.get("sort")||h,R=e.get("order")||m,L=e.get("kind")||g;S({sort:$g(E)?E:si.None,order:Gg(R)?R:Ya.None,kind:Hg(L)?L:qa.None})},[e,h,m,g]);const T=C.useMemo(()=>{let E;switch(v.sort){case si.Added:E=[Bt.DateCreated];break;case si.Released:E=[Bt.PremiereDate];break;case si.Runtime:E=[Bt.Runtime];break;case si.Random:E=[Bt.Random];break;case si.Name:E=[Bt.Name];break;case si.Inherit:E="Inherit";break;default:E=[Bt.DateCreated]}const R=v.order===Ya.Ascending?[hs.Ascending]:[hs.Descending];return{sortBy:E,sortOrder:R}},[v.order,v.sort]),A=C.useMemo(()=>{switch(v.kind){case qa.Artists:return _e.MusicArtist;case qa.Albums:return _e.MusicAlbum;default:return _e.Audio}},[v.kind]);return{filter:v,setFilter:x,jellySort:T,jellyItemKind:A}},I2=({children:n})=>{const e=A2();return y.jsx(rA.Provider,{value:e,children:n})},kA=C.createContext({}),Q0=()=>C.useContext(kA),MA=C.createContext({}),fr=()=>C.useContext(MA),UA=C.createContext({}),X0=()=>C.useContext(UA),W0=()=>{const e=ss().audioRef,[t,s]=C.useState(e.currentTime||0),[i,r]=C.useState(e.duration||0);return C.useEffect(()=>{if(!e)return;const a=()=>{s(e.currentTime),r(e.duration)};return e.addEventListener("timeupdate",a),e.addEventListener("loadedmetadata",a),()=>{e.removeEventListener("timeupdate",a),e.removeEventListener("loadedmetadata",a)}},[e]),{progress:t,duration:i}},Wg=(n,e)=>{if(n)return n;if(e.pathname.startsWith("/album/"))return"Album";if(e.pathname.startsWith("/artist/"))return e.pathname.includes("/tracks")?"Tracks":"Artist";if(e.pathname.startsWith("/genre/"))return"Genre";if(e.pathname.startsWith("/playlist/"))return"Playlist";if(e.pathname.startsWith("/search/"))return`Search results for '${decodeURIComponent(e.pathname.split("/search/")[1])}'`;if(e.pathname.startsWith("/instantmix/"))return"Instant Mix";switch(e.pathname){case"/":return"Home";case"/tracks":return"Tracks";case"/lyrics":return"Lyrics";case"/albums":return"Albums";case"/artists":return"Artists";case"/albumartists":return"Album Artists";case"/genres":return"Genres";case"/favorites":return"Favorites";case"/settings":return"Settings";case"/synced":return"Synced";case"/nowplaying":return"Now Playing";case"/nowplaying/lyrics":return"Now Playing / Lyrics";case"/recently":return"Recently Played";case"/frequently":return"Frequently Played";default:return"Home"}},FA=C.createContext({}),Yt=()=>C.useContext(FA);class mh extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.1328 15.7715",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.7715",opacity:"0",width:"16.1328",x:"0",y:"0"}),y.jsx("path",{d:"M15.7715 7.88086C15.7715 12.2266 12.2363 15.7617 7.88086 15.7617C3.53516 15.7617 0 12.2266 0 7.88086C0 3.53516 3.53516 0 7.88086 0C12.2363 0 15.7715 3.53516 15.7715 7.88086ZM4.75586 7.87109C4.75586 9.59961 6.15234 10.9961 7.88086 10.9961C9.61914 10.9961 11.0156 9.59961 11.0156 7.87109C11.0156 6.14258 9.61914 4.73633 7.88086 4.73633C6.15234 4.73633 4.75586 6.14258 4.75586 7.87109Z"}),y.jsx("circle",{className:"spindle-hole",cx:"7.88086",cy:"7.87109",r:"1.5"})]})})}}class BA extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 9.90234 15.9277",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.9277",opacity:"0",width:"9.90234",x:"0",y:"0"}),y.jsx("path",{d:"M9.54102 3.88672L9.54102 0.966797C9.54102 0.546875 9.19922 0.263672 8.7793 0.351562L4.75586 1.23047C4.22852 1.34766 3.94531 1.62109 3.94531 2.08008L3.94531 10.6738C3.99414 11.0254 3.82812 11.25 3.51562 11.3086L2.29492 11.5625C0.732422 11.8945 0 12.6953 0 13.8867C0 15.0879 0.927734 15.9277 2.22656 15.9277C3.36914 15.9277 5.08789 15.0781 5.08789 12.8125L5.08789 5.74219C5.08789 5.35156 5.15625 5.29297 5.49805 5.22461L9.10156 4.42383C9.36523 4.36523 9.54102 4.16016 9.54102 3.88672Z"})]})})}}class dl extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 38 48",role:"presentation",focusable:"false",width:e,height:t,className:s,children:y.jsx("path",{d:"M36.15 0c-.18.02-1.76.3-1.95.33l-19.7 3.7c-.58.13-1.03.32-1.37.6a2.1 2.1 0 0 0-.74 1.36c-.02.12-.05.36-.05.72v26.81c0 1.18-.9 2.16-2.1 2.38l-5.27.86A6 6 0 0 0 0 42.57C0 45.63 2.6 48 5.64 48c.37 0 .74-.04 1.11-.1l1.82-.36a7.13 7.13 0 0 0 5.8-7.08V17.25c0-1.22.4-1.54 1.42-1.78 0 0 17.52-3.52 18.37-3.68.22-.04.43-.07.61-.07.78 0 1.17.4 1.17 1.36v15.47c0 1.18-.89 2.16-2.1 2.39l-4.86.95c-3.1.55-5.35 2.97-5.35 5.77 0 3.04 2.8 5.4 6.08 5.4.4 0 .8-.03 1.2-.1l1.96-.35c4.23-1.2 5.13-5.07 5.13-7.75v-33C38 .74 37.41 0 36.36 0h-.2z"})})}}class Zg extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.1328 15.7715",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.7715",opacity:"0",width:"16.1328",x:"0",y:"0"}),y.jsx("path",{d:"M7.88086 15.7617C12.2363 15.7617 15.7715 12.2363 15.7715 7.88086C15.7715 3.52539 12.2363 0 7.88086 0C3.53516 0 0 3.52539 0 7.88086C0 12.2363 3.53516 15.7617 7.88086 15.7617ZM7.88086 14.2773C4.3457 14.2773 1.49414 11.416 1.49414 7.88086C1.49414 4.3457 4.3457 1.48438 7.88086 1.48438C11.416 1.48438 14.2773 4.3457 14.2773 7.88086C14.2773 11.416 11.416 14.2773 7.88086 14.2773ZM13.1445 12.959L13.1152 12.8613C12.7637 11.7188 10.7227 10.5078 7.88086 10.5078C5.03906 10.5078 3.00781 11.7188 2.65625 12.8613L2.62695 12.959C4.02344 14.3164 6.50391 15.0879 7.88086 15.0879C9.26758 15.0879 11.748 14.3164 13.1445 12.959ZM7.88086 9.21875C9.35547 9.23828 10.5176 7.97852 10.5176 6.32812C10.5176 4.77539 9.35547 3.49609 7.88086 3.49609C6.41602 3.49609 5.24414 4.77539 5.25391 6.32812C5.26367 7.97852 6.40625 9.19922 7.88086 9.21875Z"})]})})}}class jA extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.1523 15.9277",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.9277",opacity:"0",width:"16.1523",x:"0",y:"0"}),y.jsx("path",{d:"M0.585938 9.82422L7.33398 9.82422C7.66602 9.82422 7.91992 9.57031 7.91992 9.23828C7.91992 8.92578 7.65625 8.66211 7.33398 8.66211L0.585938 8.66211C0.263672 8.66211 0 8.92578 0 9.23828C0 9.57031 0.253906 9.82422 0.585938 9.82422Z"}),y.jsx("path",{d:"M0.585938 7.06055L7.33398 7.06055C7.66602 7.06055 7.91992 6.79688 7.91992 6.47461C7.91992 6.15234 7.65625 5.89844 7.33398 5.89844L0.585938 5.89844C0.263672 5.89844 0 6.15234 0 6.47461C0 6.79688 0.253906 7.06055 0.585938 7.06055Z"}),y.jsx("path",{d:"M0.585938 4.30664L7.33398 4.30664C7.65625 4.30664 7.91992 4.04297 7.91992 3.7207C7.91992 3.39844 7.65625 3.13477 7.33398 3.13477L0.585938 3.13477C0.263672 3.13477 0 3.39844 0 3.7207C0 4.04297 0.263672 4.30664 0.585938 4.30664Z"}),y.jsx("path",{d:"M15.791 3.88672L15.791 0.966797C15.791 0.546875 15.4492 0.263672 15.0391 0.351562L11.0059 1.23047C10.4785 1.34766 10.1953 1.62109 10.1953 2.08008L10.1953 10.6738C10.2441 11.0254 10.0781 11.25 9.77539 11.3086L8.55469 11.5625C6.98242 11.8945 6.25 12.6953 6.25 13.8867C6.25 15.0879 7.17773 15.9277 8.47656 15.9277C9.61914 15.9277 11.3477 15.0781 11.3477 12.8125L11.3477 5.74219C11.3477 5.35156 11.4062 5.29297 11.748 5.22461L15.3516 4.42383C15.625 4.36523 15.791 4.16016 15.791 3.88672Z"})]})})}}class R2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 15.4395 15.2246",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.2246",opacity:"0",width:"15.4395",x:"0",y:"0"}),y.jsx("path",{d:"M0 6.21094C0 9.63867 2.7832 12.4121 6.21094 12.4121C7.5293 12.4121 8.74023 12.002 9.74609 11.2988L13.3789 14.9414C13.584 15.1367 13.8379 15.2246 14.1016 15.2246C14.668 15.2246 15.0781 14.7949 15.0781 14.2285C15.0781 13.9551 14.9707 13.7109 14.8047 13.5254L11.1914 9.90234C11.9629 8.86719 12.4121 7.59766 12.4121 6.21094C12.4121 2.7832 9.63867 0 6.21094 0C2.7832 0 0 2.7832 0 6.21094ZM1.50391 6.21094C1.50391 3.60352 3.60352 1.50391 6.21094 1.50391C8.80859 1.50391 10.918 3.60352 10.918 6.21094C10.918 8.80859 8.80859 10.918 6.21094 10.918C3.60352 10.918 1.50391 8.80859 1.50391 6.21094Z"})]})})}}class w2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.1328 15.7715",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"15.7715",opacity:"0",width:"16.1328",x:"0",y:"0"}),y.jsx("path",{d:"M15.7715 7.88086C15.7715 12.2266 12.2363 15.7617 7.88086 15.7617C3.53516 15.7617 0 12.2266 0 7.88086C0 3.53516 3.53516 0 7.88086 0C12.2363 0 15.7715 3.53516 15.7715 7.88086ZM9.98047 4.80469L7.88086 6.88477L5.81055 4.81445C5.67383 4.6875 5.51758 4.61914 5.3125 4.61914C4.92188 4.61914 4.59961 4.92188 4.59961 5.33203C4.59961 5.51758 4.67773 5.69336 4.80469 5.83008L6.86523 7.89062L4.80469 9.95117C4.67773 10.0879 4.59961 10.2637 4.59961 10.4492C4.59961 10.8594 4.92188 11.1816 5.3125 11.1816C5.51758 11.1816 5.70312 11.1133 5.83008 10.9766L7.88086 8.90625L9.94141 10.9766C10.0684 11.1133 10.2539 11.1816 10.4492 11.1816C10.8594 11.1816 11.1816 10.8594 11.1816 10.4492C11.1816 10.2539 11.1133 10.0781 10.9668 9.94141L8.90625 7.89062L10.9766 5.82031C11.1328 5.67383 11.1914 5.50781 11.1914 5.3125C11.1914 4.91211 10.8691 4.59961 10.4688 4.59961C10.2832 4.59961 10.127 4.66797 9.98047 4.80469Z"})]})})}}class io extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12.1562 3",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"3",opacity:"0",width:"12.1562",x:"0",y:"0"}),y.jsx("circle",{cx:"10.5391",cy:"1.5",r:"1.3"}),y.jsx("circle",{cx:"5.875",cy:"1.5",r:"1.3"}),y.jsx("circle",{cx:"1.31094",cy:"1.5",r:"1.3"})]})})}}class C2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 20",width:e,height:t,className:s,children:[y.jsx("rect",{x:"2",y:"12",width:"2",height:"8",rx:"1",className:"bar bar1"}),y.jsx("rect",{x:"6",y:"10",width:"2",height:"10",rx:"1",className:"bar bar2"}),y.jsx("rect",{x:"10",y:"14",width:"2",height:"6",rx:"1",className:"bar bar3"}),y.jsx("rect",{x:"14",y:"11",width:"2",height:"9",rx:"1",className:"bar bar4"}),y.jsx("rect",{x:"18",y:"13",width:"2",height:"7",rx:"1",className:"bar bar5"}),y.jsx("rect",{x:"22",y:"12",width:"2",height:"8",rx:"1",className:"bar bar6"})]})}}class VA extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",width:e,height:t,className:s,children:[y.jsx("rect",{x:"1",y:"10",width:"3",height:"8",rx:"1.5",className:"bar bar1"}),y.jsx("rect",{x:"5",y:"9",width:"3",height:"9",rx:"1.5",className:"bar bar2"}),y.jsx("rect",{x:"9",y:"11",width:"3",height:"7",rx:"1.5",className:"bar bar3"}),y.jsx("rect",{x:"13",y:"10",width:"3",height:"8",rx:"1.5",className:"bar bar4"})]})}}class L2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",width:e,height:t,className:s,children:[y.jsx("rect",{x:"1",y:"8",width:"3",height:"6",rx:"1.5",className:"bar bar1"}),y.jsx("rect",{x:"5.5",y:"7",width:"3",height:"7",rx:"1.5",className:"bar bar2"}),y.jsx("rect",{x:"10",y:"9",width:"3",height:"5",rx:"1.5",className:"bar bar3"})]})}}class $A extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.0234 12.6172",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"12.6172",opacity:"0",width:"13.0234",x:"0",y:"0"}),y.jsx("path",{d:"M6.30469 12.6094C9.78906 12.6094 12.6172 9.78906 12.6172 6.30469C12.6172 2.82031 9.78906 0 6.30469 0C2.82812 0 0 2.82031 0 6.30469C0 9.78906 2.82812 12.6094 6.30469 12.6094ZM6.30469 11.4219C3.47656 11.4219 1.19531 9.13281 1.19531 6.30469C1.19531 3.47656 3.47656 1.1875 6.30469 1.1875C9.13281 1.1875 11.4219 3.47656 11.4219 6.30469C11.4219 9.13281 9.13281 11.4219 6.30469 11.4219Z"}),y.jsx("path",{d:"M6.30469 9.41406C6.45312 9.41406 6.57031 9.36719 6.71094 9.22656L8.71875 7.3125C8.82031 7.20312 8.88281 7.09375 8.88281 6.94531C8.88281 6.65625 8.66406 6.45312 8.375 6.45312C8.23438 6.45312 8.09375 6.50781 7.99219 6.61719L7.13281 7.55469L6.82031 7.89062L6.86719 6.96094L6.86719 3.73438C6.86719 3.44531 6.60938 3.19531 6.30469 3.19531C6.00781 3.19531 5.75 3.44531 5.75 3.73438L5.75 6.96094L5.79688 7.89062L5.47656 7.55469L4.61719 6.61719C4.52344 6.50781 4.36719 6.45312 4.23438 6.45312C3.94531 6.45312 3.73438 6.65625 3.73438 6.94531C3.73438 7.09375 3.78906 7.20312 3.89844 7.3125L5.89844 9.22656C6.04688 9.36719 6.16406 9.41406 6.30469 9.41406Z"})]})})}}class D2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.0234 12.6172",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"12.6172",opacity:"0",width:"13.0234",x:"0",y:"0"}),y.jsx("path",{d:"M12.6172 6.30469C12.6172 9.78125 9.78906 12.6094 6.30469 12.6094C2.82812 12.6094 0 9.78125 0 6.30469C0 2.82812 2.82812 0 6.30469 0C9.78906 0 12.6172 2.82812 12.6172 6.30469ZM5.73438 3.64062L5.73438 6.98438L5.78125 7.95312L5.45312 7.60156L4.5625 6.63281C4.46094 6.51562 4.30469 6.46094 4.16406 6.46094C3.85938 6.46094 3.64062 6.67188 3.64062 6.96875C3.64062 7.125 3.70312 7.24219 3.8125 7.35156L5.89844 9.33594C6.04688 9.48438 6.16406 9.53125 6.3125 9.53125C6.46875 9.53125 6.58594 9.48438 6.73438 9.33594L8.8125 7.35156C8.92969 7.24219 8.98438 7.125 8.98438 6.96875C8.98438 6.67188 8.75781 6.46094 8.46094 6.46094C8.32031 6.46094 8.16406 6.51562 8.07031 6.63281L7.17188 7.60156L6.85156 7.95312L6.89062 6.98438L6.89062 3.64062C6.89062 3.32812 6.63281 3.07812 6.3125 3.07812C6 3.07812 5.73438 3.32812 5.73438 3.64062Z"})]})})}}class O2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.0234 12.6172",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"12.6172",opacity:"0",width:"13.0234",x:"0",y:"0"}),y.jsx("path",{d:"M12.6172 6.30469C12.6172 9.78125 9.78906 12.6094 6.30469 12.6094C2.82812 12.6094 0 9.78125 0 6.30469C0 2.82812 2.82812 0 6.30469 0C9.78906 0 12.6172 2.82812 12.6172 6.30469ZM3.92969 5.70312C3.5 5.70312 3.22656 5.92188 3.22656 6.32031C3.22656 6.71094 3.51562 6.92188 3.92969 6.92188L8.69531 6.92188C9.10938 6.92188 9.38281 6.71094 9.38281 6.32031C9.38281 5.92188 9.125 5.70312 8.69531 5.70312Z"})]})})}}class yb extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 15.4834 11.9011",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"11.9011",opacity:"0",width:"15.4834",x:"0",y:"0"}),y.jsx("path",{className:"arrow up",d:"M11.7615 11.6415L14.8371 8.475C14.9816 8.32516 15.0771 8.09791 15.0771 7.90475C15.0771 7.4428 14.7523 7.12324 14.2956 7.12324C14.0787 7.12324 13.8987 7.19816 13.7542 7.34765L12.5485 8.6051L11.9198 9.3617L11.9624 8.13288L11.9624 0.79319C11.9624 0.339051 11.6326 0.00919333 11.1784 0.00919333C10.7243 0.00919333 10.3891 0.339051 10.3891 0.79319L10.3891 8.13288L10.4371 9.3617L9.80302 8.6051L8.59741 7.34765C8.45823 7.19816 8.27288 7.12324 8.05593 7.12324C7.59931 7.12324 7.27975 7.4428 7.27975 7.90475C7.27975 8.09791 7.36993 8.32516 7.51978 8.475L10.5901 11.6415C10.9178 11.9849 11.4337 11.9902 11.7615 11.6415Z"}),y.jsx("path",{className:"arrow down",d:"M3.31567 0.262005L0.24003 3.42607C0.0955153 3.57591 0 3.79783 0 3.99631C0 4.45827 0.324889 4.77783 0.781512 4.77783C0.998465 4.77783 1.17848 4.70291 1.32299 4.55342L2.5286 3.29597L3.15733 2.53404L3.10938 3.76818L3.10938 11.1079C3.10938 11.5698 3.44456 11.8997 3.8987 11.8997C4.35284 11.8997 4.68802 11.5698 4.68802 11.1079L4.68802 3.76818L4.64007 2.53404L5.2688 3.29597L6.47441 4.55342C6.61892 4.70291 6.79893 4.77783 7.01589 4.77783C7.47251 4.77783 7.7974 4.45827 7.7974 3.99631C7.7974 3.79783 7.70188 3.57591 7.55737 3.42607L4.48706 0.262005C4.15932-0.0760251 3.6434-0.0813533 3.31567 0.262005Z"})]})})}}class GA extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14.0234 13.6328",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"13.6328",opacity:"0",width:"14.0234",x:"0",y:"0"}),y.jsx("path",{d:"M3.92188 13.6328C4.26562 13.6328 4.5 13.4531 4.92188 13.0703L7.01562 11.1953L10.6875 11.1953C12.6094 11.1953 13.6172 10.1562 13.6172 8.26562L13.6172 3.71875C13.6172 1.82812 12.6094 0.789062 10.6875 0.789062L2.92969 0.789062C1.00781 0.789062 0 1.82812 0 3.71875L0 8.26562C0 10.1562 1.00781 11.1953 2.92969 11.1953L3.15625 11.1953L3.15625 12.75C3.15625 13.2891 3.42969 13.6328 3.92188 13.6328ZM4.21094 12.3516L4.21094 10.5938C4.21094 10.2109 4.07031 10.0703 3.6875 10.0703L2.92969 10.0703C1.67188 10.0703 1.125 9.46875 1.125 8.26562L1.125 3.71875C1.125 2.52344 1.67188 1.92188 2.92969 1.92188L10.6875 1.92188C11.9453 1.92188 12.4922 2.52344 12.4922 3.71875L12.4922 8.26562C12.4922 9.46875 11.9453 10.0703 10.6875 10.0703L6.95312 10.0703C6.57812 10.0703 6.38281 10.125 6.13281 10.3906Z"}),y.jsx("path",{d:"M3.84375 5.32812C3.84375 6.03125 4.28125 6.57812 4.97656 6.57812C5.22656 6.57812 5.47656 6.54688 5.63281 6.35156L5.67969 6.35156C5.45312 6.83594 5.02344 7.14062 4.60156 7.25C4.36719 7.3125 4.29688 7.42188 4.29688 7.57031C4.29688 7.73438 4.42969 7.86719 4.60938 7.86719C5.25781 7.86719 6.49219 7.11719 6.49219 5.55469C6.49219 4.72656 5.96094 4.07812 5.14844 4.07812C4.40625 4.07812 3.84375 4.58594 3.84375 5.32812ZM7.13281 5.32812C7.13281 6.03125 7.5625 6.57812 8.26562 6.57812C8.50781 6.57812 8.76562 6.54688 8.92188 6.35156L8.96875 6.35156C8.74219 6.83594 8.30469 7.14062 7.89062 7.25C7.65625 7.3125 7.58594 7.42188 7.58594 7.57031C7.58594 7.73438 7.71094 7.86719 7.89844 7.86719C8.54688 7.86719 9.77344 7.11719 9.77344 5.55469C9.77344 4.72656 9.25 4.07812 8.4375 4.07812C7.69531 4.07812 7.13281 4.58594 7.13281 5.32812Z"})]})})}}class _2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.3765 9.58136",width:e,height:t,className:s,children:y.jsxs("g",{children:[y.jsx("rect",{height:"9.58136",opacity:"0",width:"13.3765",x:"0",y:"0"}),y.jsx("path",{d:"M3.99477 9.32711L12.2707 9.32711C12.6578 9.32711 12.9702 9.00258 12.9702 8.62052C12.9702 8.22568 12.6602 7.91393 12.2707 7.91393L3.99477 7.91393C3.60774 7.91393 3.3006 8.23065 3.3006 8.62052C3.3006 8.99762 3.61023 9.32711 3.99477 9.32711Z"}),y.jsx("path",{d:"M0.96084 9.58136C1.48778 9.58136 1.92168 9.14746 1.92168 8.62052C1.92168 8.08826 1.48778 7.65968 0.96084 7.65968C0.433905 7.65968 0 8.08826 0 8.62052C0 9.14746 0.433905 9.58136 0.96084 9.58136Z"}),y.jsx("path",{d:"M3.99477 5.49869L12.2707 5.49869C12.6578 5.49869 12.9702 5.17416 12.9702 4.7921C12.9702 4.40259 12.6602 4.08551 12.2707 4.08551L3.99477 4.08551C3.60774 4.08551 3.3006 4.40756 3.3006 4.7921C3.3006 5.1692 3.61023 5.49869 3.99477 5.49869Z"}),y.jsx("path",{d:"M0.96084 5.75294C1.48778 5.75294 1.92168 5.31904 1.92168 4.7921C1.92168 4.26517 1.48778 3.83126 0.96084 3.83126C0.433905 3.83126 0 4.26517 0 4.7921C0 5.31904 0.433905 5.75294 0.96084 5.75294Z"}),y.jsx("path",{d:"M3.99477 1.67027L12.2707 1.67027C12.6578 1.67027 12.9702 1.34575 12.9702 0.963684C12.9702 0.57417 12.6602 0.257093 12.2707 0.257093L3.99477 0.257093C3.60774 0.257093 3.3006 0.579139 3.3006 0.963684C3.3006 1.34078 3.61023 1.67027 3.99477 1.67027Z"}),y.jsx("path",{d:"M0.96084 1.92452C1.48778 1.92452 1.92168 1.49062 1.92168 0.963684C1.92168 0.436749 1.48778 0.00284386 0.96084 0.00284386C0.433905 0.00284386 0 0.436749 0 0.963684C0 1.49062 0.433905 1.92452 0.96084 1.92452Z"})]})})}}class P2 extends C.Component{static defaultProps={width:"100%",height:"100%"};render(){const{width:e,height:t,className:s}=this.props;return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"87.48 32.45 93.07 93.16",width:e,height:t,className:s,children:y.jsx("path",{d:"M91.969 71.954c2.587 0 4.443-1.953 4.443-4.54v-4.102l-.977-17.041 12.842 13.525 15.04 15.137c.83.879 1.903 1.27 3.075 1.27 2.784 0 4.834-1.807 4.834-4.542 0-1.318-.44-2.49-1.318-3.369L114.82 53.253l-13.525-12.842 17.09.977h4.052c2.588 0 4.59-1.807 4.59-4.443 0-2.637-1.953-4.492-4.59-4.492h-27.1c-4.98 0-7.86 2.88-7.86 7.86v27.1c0 2.54 1.904 4.541 4.492 4.541Zm53.564 53.663h27.1c4.98 0 7.91-2.881 7.91-7.862v-27.1c0-2.538-1.905-4.54-4.54-4.54-2.54 0-4.445 1.953-4.445 4.54v4.102l1.026 17.041-12.89-13.525-14.991-15.137c-.83-.879-1.953-1.27-3.125-1.27-2.734 0-4.834 1.807-4.834 4.542 0 1.318.488 2.49 1.367 3.369l15.04 15.039 13.573 12.842-17.09-.977h-4.101c-2.588 0-4.59 1.807-4.59 4.443 0 2.637 2.002 4.493 4.59 4.493Z"})})}}const yn=({item:n,type:e,width:t,height:s,imageProps:i})=>{const r=Yt(),[a,l]=C.useState(!1),u=r.getImageUrl(n,e,{width:t,height:s}),d=n.downloadedImageUrl||u;return C.useEffect(()=>{l(!1)},[d]),y.jsxs(y.Fragment,{children:[!a&&d&&y.jsx("img",{...i,src:d,alt:n.Name,className:"thumbnail",loading:"lazy",onError:()=>l(!0)}),(a||!d)&&y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(dl,{width:"50%",height:"50%"})})]})};function N2({topLeftCornerRadius:n,topRightCornerRadius:e,bottomRightCornerRadius:t,bottomLeftCornerRadius:s,width:i,height:r}){const a={topLeft:-1,topRight:-1,bottomLeft:-1,bottomRight:-1},l={topLeft:n,topRight:e,bottomLeft:s,bottomRight:t};return Object.entries(l).sort(([,u],[,d])=>d-u).forEach(([u,d])=>{const h=u,m=k2[h],g=Math.min(...m.map(v=>{const S=l[v.corner];if(d===0&&S===0)return 0;const x=a[v.corner],T=v.side==="top"||v.side==="bottom"?i:r;return x>=0?T-a[v.corner]:d/(d+S)*T}));a[h]=g,l[h]=Math.min(d,g)}),{topLeft:{radius:l.topLeft,roundingAndSmoothingBudget:a.topLeft},topRight:{radius:l.topRight,roundingAndSmoothingBudget:a.topRight},bottomLeft:{radius:l.bottomLeft,roundingAndSmoothingBudget:a.bottomLeft},bottomRight:{radius:l.bottomRight,roundingAndSmoothingBudget:a.bottomRight}}}var k2={topLeft:[{corner:"topRight",side:"top"},{corner:"bottomLeft",side:"left"}],topRight:[{corner:"topLeft",side:"top"},{corner:"bottomRight",side:"right"}],bottomLeft:[{corner:"bottomRight",side:"bottom"},{corner:"topLeft",side:"left"}],bottomRight:[{corner:"bottomLeft",side:"bottom"},{corner:"topRight",side:"right"}]};function Dc({cornerRadius:n,cornerSmoothing:e,preserveSmoothing:t,roundingAndSmoothingBudget:s}){let i=(1+e)*n;if(!t){const S=s/n-1;e=Math.min(e,S),i=Math.min(i,s)}const r=90*(1-e),a=Math.sin(Vd(r/2))*n*Math.sqrt(2),l=(90-r)/2,u=n*Math.tan(Vd(l/2)),d=45*e,h=u*Math.cos(Vd(d)),m=h*Math.tan(Vd(d));let g=(i-a-h-m)/3,v=2*g;if(t&&i>s){const S=s-m-a-h,x=S/6,T=S-x;g=Math.min(g,T),v=S-g,i=Math.min(i,s)}return{a:v,b:g,c:h,d:m,p:i,arcSectionLength:a,cornerRadius:n}}function vb({width:n,height:e,topLeftPathParams:t,topRightPathParams:s,bottomLeftPathParams:i,bottomRightPathParams:r}){return`
    M ${n-s.p} 0
    ${M2(s)}
    L ${n} ${e-r.p}
    ${U2(r)}
    L ${i.p} ${e}
    ${F2(i)}
    L 0 ${t.p}
    ${B2(t)}
    Z
  `.replace(/[\t\s\n]+/g," ").trim()}function M2({cornerRadius:n,a:e,b:t,c:s,d:i,p:r,arcSectionLength:a}){return n?va`
    c ${e} 0 ${e+t} 0 ${e+t+s} ${i}
    a ${n} ${n} 0 0 1 ${a} ${a}
    c ${i} ${s}
        ${i} ${t+s}
        ${i} ${e+t+s}`:va`l ${r} 0`}function U2({cornerRadius:n,a:e,b:t,c:s,d:i,p:r,arcSectionLength:a}){return n?va`
    c 0 ${e}
      0 ${e+t}
      ${-i} ${e+t+s}
    a ${n} ${n} 0 0 1 -${a} ${a}
    c ${-s} ${i}
      ${-(t+s)} ${i}
      ${-(e+t+s)} ${i}`:va`l 0 ${r}`}function F2({cornerRadius:n,a:e,b:t,c:s,d:i,p:r,arcSectionLength:a}){return n?va`
    c ${-e} 0
      ${-(e+t)} 0
      ${-(e+t+s)} ${-i}
    a ${n} ${n} 0 0 1 -${a} -${a}
    c ${-i} ${-s}
      ${-i} ${-(t+s)}
      ${-i} ${-(e+t+s)}`:va`l ${-r} 0`}function B2({cornerRadius:n,a:e,b:t,c:s,d:i,p:r,arcSectionLength:a}){return n?va`
    c 0 ${-e}
      0 ${-(e+t)}
      ${i} ${-(e+t+s)}
    a ${n} ${n} 0 0 1 ${a} -${a}
    c ${s} ${-i}
      ${t+s} ${-i}
      ${e+t+s} ${-i}`:va`l 0 ${-r}`}function Vd(n){return n*Math.PI/180}function va(n,...e){return n.reduce((t,s,i)=>{const r=e[i];return typeof r=="number"?t+s+r.toFixed(4):t+s+(r??"")},"")}function j2({cornerRadius:n=0,topLeftCornerRadius:e,topRightCornerRadius:t,bottomRightCornerRadius:s,bottomLeftCornerRadius:i,cornerSmoothing:r,width:a,height:l,preserveSmoothing:u=!1}){if(e=e??n,t=t??n,i=i??n,s=s??n,e===t&&t===s&&s===i&&i===e){const v=Math.min(a,l)/2,S=Math.min(e,v),x=Dc({cornerRadius:S,cornerSmoothing:r,preserveSmoothing:u,roundingAndSmoothingBudget:v});return vb({width:a,height:l,topLeftPathParams:x,topRightPathParams:x,bottomLeftPathParams:x,bottomRightPathParams:x})}const{topLeft:d,topRight:h,bottomLeft:m,bottomRight:g}=N2({topLeftCornerRadius:e,topRightCornerRadius:t,bottomRightCornerRadius:s,bottomLeftCornerRadius:i,width:a,height:l});return vb({width:a,height:l,topLeftPathParams:Dc({cornerSmoothing:r,preserveSmoothing:u,cornerRadius:d.radius,roundingAndSmoothingBudget:d.roundingAndSmoothingBudget}),topRightPathParams:Dc({cornerSmoothing:r,preserveSmoothing:u,cornerRadius:h.radius,roundingAndSmoothingBudget:h.roundingAndSmoothingBudget}),bottomRightPathParams:Dc({cornerSmoothing:r,preserveSmoothing:u,cornerRadius:g.radius,roundingAndSmoothingBudget:g.roundingAndSmoothingBudget}),bottomLeftPathParams:Dc({cornerSmoothing:r,preserveSmoothing:u,cornerRadius:m.radius,roundingAndSmoothingBudget:m.roundingAndSmoothingBudget})})}const Vp=new Map,V2=(n,e,t,s)=>{const i=`${n}-${e}-${t}-${s}`;if(!Vp.has(i)){const r=j2({width:n,height:e,cornerRadius:t,cornerSmoothing:s});Vp.set(i,r)}return Vp.get(i)},Ln=({width:n,height:e,cornerRadius:t,cornerSmoothing:s=.8,useSquircle:i=!0,isResponsive:r=!1,className:a,children:l})=>{const[u,d]=C.useState({width:n,height:e}),h=C.useRef(null),m=C.useMemo(()=>{if(t!==void 0)return t;const v=Math.min(u.width,u.height);return v<=40||v<=46?6:v<=100?8:v*.08},[t,u.width,u.height]),g=C.useMemo(()=>i?V2(u.width,u.height,m,s):null,[u.width,u.height,m,s,i]);return C.useEffect(()=>{const v=h.current;if(!r||!v)return;const S=new ResizeObserver(x=>{const{width:T,height:A}=x[0].contentRect;d({width:Math.round(T),height:Math.round(A)})});return S.observe(v),()=>{v&&S.unobserve(v)}},[r]),y.jsx("div",{ref:h,className:a,style:{width:r?"100%":`${n}px`,height:r?"100%":`${e}px`,clipPath:g?`path('${g}')`:void 0,borderRadius:g?void 0:`${m}px`,overflow:"hidden"},children:l})},Ks=n=>y.jsx(I2,{children:y.jsx($2,{...n})},n.content?.name),$2=({content:n,filterType:e})=>{const t=ss(),{pageTitle:s}=fr(),{goBack:i}=Q0(),r=xn(),{toggleSidenav:a}=X0(),{filter:l,setFilter:u}=Li(),{currentTrack:d}=ss();C.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[r.pathname]);const h=C.useMemo(()=>y.jsxs("div",{className:"main_header",children:[y.jsxs("div",{className:"primary",children:[y.jsx("div",{onClick:i,className:"return_icon",title:"Back",children:y.jsx(tf,{size:16})}),y.jsx("div",{className:"container",children:y.jsxs("div",{className:"page_title",children:[y.jsx("div",{className:"text",title:Wg(s,r),children:Wg(s,r)}),r.pathname.startsWith("/album/")&&s&&y.jsx("div",{className:"page-icon album",title:"Album",children:y.jsx(mh,{width:16,height:16})}),s&&(r.pathname.match(/^\/artist\/[^/]+\/tracks$/)?y.jsx("div",{className:"page-icon artist-tracks",title:"Tracks",children:y.jsx(dl,{width:12,height:12})}):r.pathname.startsWith("/artist/")?y.jsx("div",{className:"page-icon artist",title:"Artist",children:y.jsx(Zg,{width:16,height:16})}):null),r.pathname.startsWith("/genre/")&&s&&y.jsx("div",{className:"page-icon genre",title:"Genre",children:y.jsx(z0,{size:16})}),r.pathname.startsWith("/playlist/")&&s&&y.jsx("div",{className:"page-icon playlist",title:"Playlist",children:y.jsx(jA,{width:12,height:12})})]})})]}),y.jsxs("div",{className:"secondary noSelect",children:[(e==="mediaItems"||e==="mediaItemsPlaylist")&&y.jsxs("div",{className:"sorting",children:[y.jsxs("div",{className:"filter",children:[y.jsxs("select",{onChange:v=>u(S=>({...S,sort:v.target.value})),value:l.sort,children:[y.jsx("option",{value:"Added",children:"Added"}),y.jsx("option",{value:"Released",children:"Released"}),y.jsx("option",{value:"Runtime",children:"Runtime"}),y.jsx("option",{value:"Random",children:"Random"}),y.jsx("option",{value:"Name",children:"Name"}),e==="mediaItemsPlaylist"&&y.jsx("option",{value:"Inherit",children:"Inherit"})]}),y.jsx("div",{className:"icon",children:y.jsx(Np,{size:12})})]}),l.sort!=="Inherit"&&y.jsx("div",{className:"sort",onClick:()=>{u(v=>({...v,order:v.order==="Ascending"?"Descending":"Ascending"}))},title:l.order==="Ascending"?"Ascending":"Descending",children:y.jsx("div",{className:"icon"+(l.order==="Ascending"?" active":""),children:y.jsx(yb,{width:12,height:12})})})]}),(e==="favorites"||e==="kind")&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"sorting links",children:y.jsxs("div",{className:"filter",children:[y.jsxs("div",{className:"responsive-icon",children:[l.kind==="Tracks"&&y.jsx(BA,{width:"12",height:"12",className:"track"}),l.kind==="Albums"&&y.jsx(mh,{width:"14",height:"14",className:"album"}),l.kind==="Artists"&&y.jsx(Zg,{width:"14",height:"14",className:"artist"})]}),y.jsxs("select",{onChange:v=>u(S=>({...S,kind:v.target.value})),value:l.kind,children:[y.jsx("option",{value:"Tracks",children:"Tracks"}),y.jsx("option",{value:"Albums",children:"Albums"}),y.jsx("option",{value:"Artists",children:"Artists"})]}),y.jsx("div",{className:"icon",children:y.jsx(Np,{size:12})})]})}),e==="favorites"&&y.jsxs("div",{className:"sorting",children:[y.jsxs("div",{className:"filter",children:[y.jsxs("select",{onChange:v=>u(S=>({...S,sort:v.target.value})),value:l.sort,children:[y.jsx("option",{value:"Added",children:"Added"}),y.jsx("option",{value:"Released",children:"Released"}),y.jsx("option",{value:"Runtime",children:"Runtime"}),y.jsx("option",{value:"Random",children:"Random"}),y.jsx("option",{value:"Name",children:"Name"})]}),y.jsx("div",{className:"icon",children:y.jsx(Np,{size:12})})]}),y.jsx("div",{className:"sort",onClick:()=>{u(v=>({...v,order:v.order==="Ascending"?"Descending":"Ascending"}))},title:l.order==="Ascending"?"Ascending":"Descending",children:y.jsx("div",{className:"icon"+(l.order==="Ascending"?" active":""),children:y.jsx(yb,{width:12,height:12})})})]})]}),y.jsxs("div",{className:"sidenav_toggle",onClick:a,children:[y.jsx("div",{className:"bar"}),y.jsx("div",{className:"bar"})]})]})]}),[l.kind,l.order,l.sort,e,r,s,i,u,a]),m=C.useMemo(()=>y.jsx("div",{className:"main_content",children:y.jsx(n,{})}),[n]),g=C.useMemo(()=>y.jsx("div",{className:"main_footer",children:y.jsxs("div",{className:t.isPlaying?"playback playing":t.currentTrack?"playback paused":"playback",children:[y.jsx(Z0,{}),y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"track-info",children:[y.jsxs("div",{className:"track-name",children:[y.jsx("div",{className:"text",title:t.currentTrack?.Name||"No Track Played",children:t.currentTrack?.Name?y.jsx(sn,{to:"/queue",children:t.currentTrack.Name}):"No Track Played"}),t.currentTrack?.UserData?.IsFavorite&&y.jsx("span",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:12})})]}),y.jsx("div",{className:"artist",title:t.currentTrack?.Artists?.join(", ")||t.currentTrack?.AlbumArtist||"No Artist",children:t.currentTrack&&t.currentTrack.ArtistItems&&t.currentTrack.ArtistItems.length>0?(()=>{const v=t.currentTrack.ArtistItems;return v.map((S,x)=>y.jsxs("span",{children:[y.jsx(sn,{to:`/artist/${S.Id}`,className:"text",children:S.Name}),x<v.length-1&&", "]},S.Id))})():t.currentTrack?.Artists?.join(", ")||t.currentTrack?.AlbumArtist||"No Artist"}),y.jsxs("div",{className:"album",children:[t.currentTrack?.Album?y.jsx(sn,{to:`/album/${t.currentTrack.AlbumId}`,className:"text",title:t.currentTrack.Album,children:t.currentTrack.Album}):y.jsx("div",{className:"text",children:"No Album"}),y.jsx("div",{className:"album-icon",title:"Album",children:y.jsx(mh,{width:12,height:12})})]})]}),y.jsxs("div",{className:"controls",children:[y.jsxs("div",{className:"knobs",children:[y.jsx("div",{className:`shuffle ${t.shuffle?"active":""}`,onClick:t.toggleShuffle,title:"Shuffle",children:y.jsx("div",{className:"shuffle-icon"})}),y.jsxs("div",{className:"primary",children:[y.jsx("div",{className:"previous",onClick:t.previousTrack,title:"Previous",children:y.jsx("div",{className:"previous-icon"})}),y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"play",onClick:t.togglePlayPause,title:"Play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",onClick:t.togglePlayPause,title:"Pause",children:y.jsx("div",{className:"pause-icon"})})]}),y.jsx("div",{className:"next",onClick:t.nextTrack,title:"Next",children:y.jsx("div",{className:"next-icon"})})]}),y.jsx("div",{className:`repeat ${t.repeat==="off"?"":"active"}`,onClick:t.toggleRepeat,title:"Repeat",children:y.jsx("div",{className:`repeat-icon${t.repeat==="one"?"-one":""}`})})]}),y.jsx(G2,{})]}),y.jsx(sn,{to:"/nowplaying",className:"artwork noSelect",title:"Now Playing",children:y.jsxs(Ln,{width:50,height:50,cornerRadius:8,className:"thumbnail",children:[d&&y.jsx(yn,{item:d,type:"Primary",width:50,height:50}),!d&&y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(dl,{width:"50%",height:"50%"})}),y.jsx("div",{className:"overlay",children:y.jsx(P2,{width:14,height:14,className:"icon"})})]})})]})]})}),[d,t.currentTrack,t.isPlaying,t.nextTrack,t.previousTrack,t.repeat,t.shuffle,t.togglePlayPause,t.toggleRepeat,t.toggleShuffle]);return y.jsxs("main",{className:"main",children:[h,m,g]})},Z0=()=>{const n=ss(),e=n.audioRef,t=C.useRef(null),s=C.useRef(null),i=C.useRef(!1),r=C.useCallback(()=>e?.duration||0,[e]),a=C.useCallback(()=>{if(!e)return 0;const h=r(),m=e.currentTime||0;return h>0?m/h*100:0},[e,r]),l=C.useCallback(()=>{i.current||(t.current?.style.setProperty("--transition-duration","0s"),t.current?.style.setProperty("--progress-width",`${a()}%`),n.isPlaying&&e?.currentTime&&(t.current?.offsetWidth,t.current?.style.setProperty("--transition-duration",`${r()-e.currentTime}s`),t.current?.style.setProperty("--progress-width","100%")))},[e?.currentTime,r,a,n.isPlaying]),u=C.useCallback(()=>e&&e.buffered.length>0?e.buffered.end(e.buffered.length-1)/(e.duration||1)*100:0,[e]);C.useEffect(()=>{e&&(t.current?.style.setProperty("--progress-width",`${a()}%`),t.current?.style.setProperty("--transition-duration",`${r()}s`))},[e,r,a]),C.useEffect(()=>{e&&(n.isPlaying?l():(t.current?.style.setProperty("--progress-width",`${a()}%`),t.current?.style.setProperty("--transition-duration","0s")))},[e,e?.src,a,n.isPlaying,l]),C.useEffect(()=>{if(!e)return;const h=()=>{e.duration&&l()},m=()=>{t.current?.style.setProperty("--buffered-width",`${u()}%`)},g=()=>{t.current?.style.setProperty("--buffered-width","0%"),t.current?.style.setProperty("--progress-width","0%"),t.current?.style.setProperty("--transition-duration","0s"),t.current?.offsetWidth},v=()=>{t.current?.style.setProperty("--progress-width",`${a()}%`),t.current?.style.setProperty("--transition-duration",`${r()}s`)},S=()=>{i.current=!0,t.current?.classList.add("loading"),t.current?.style.setProperty("--transition-duration","0s"),t.current?.style.setProperty("--progress-width",`${a()}%`)},x=()=>{i.current=!1,t.current?.classList.remove("loading"),l()};return e.addEventListener("timeupdate",h),e.addEventListener("emptied",g),e.addEventListener("progress",m),e.addEventListener("loadedmetadata",v),e.addEventListener("waiting",S),e.addEventListener("playing",x),()=>{e.removeEventListener("timeupdate",h),e.removeEventListener("emptied",g),e.removeEventListener("progress",m),e.removeEventListener("loadedmetadata",v),e.removeEventListener("waiting",S),e.removeEventListener("playing",x)}},[e,u,r,a,l]);const d=h=>{if(h.preventDefault(),!e||!t.current||!s.current)return;const m=s.current.getBoundingClientRect(),v=Math.min(Math.max((h.touches[0].clientX-m.left)/m.width,0),1)*r();e.currentTime=v,t.current.value=v.toString(),l()};return y.jsx("div",{className:"progress",ref:s,onTouchMove:d,children:y.jsx("input",{ref:t,type:"range",id:"track-progress",name:"track-progress",step:"0.01",min:"0",max:e?.duration||0,style:{"--progress-width":`${a()}%`,"--buffered-width":`${u()}%`,"--transition-duration":`${r()}s`},onChange:h=>{if(!e)return;const m=parseFloat(h.currentTarget.value);e.currentTime=m,l()}})})},G2=C.memo(()=>{const n=ss(),e=W0();return y.jsxs("div",{className:"duration noSelect",children:[y.jsx("div",{className:"current",children:n.formatTime(e.progress)}),y.jsx("div",{className:"divider",children:"/"}),y.jsx("div",{className:"total",children:n.formatTime(e.duration)})]})}),HA=C.createContext({}),pu=()=>C.useContext(HA),$p=(n,e)=>{if(n.offlineState==="downloaded"){const t=e.filter(s=>s.offlineState!=="downloaded");if(t.length){for(const s of t)s.offlineState="downloading";window.addToDownloads(t)}}},xb=async(n,e)=>{if(n?await window.audioStorage.hasTrack(n):!1){const s=e.filter(i=>i.offlineState!=="downloaded");if(s.length){for(const i of s)i.offlineState="downloading";window.addToDownloads(s)}}},zA=C.createContext({}),J0=()=>C.useContext(zA),KA=()=>{const n=Yt(),{data:e,isFetching:t,isPending:s,error:i}=nn({queryKey:["playlists"],queryFn:async()=>await n.getAllPlaylists()});return{playlists:e||[],loading:t||s,error:i?i.message:null}},YA=C.createContext({}),Sl=()=>C.useContext(YA),H2=n=>{const e=Yt(),t=Sl(),[s,i]=C.useState(n);C.useEffect(()=>{const u=setTimeout(()=>{i(n)},200);return()=>clearTimeout(u)},[n]);const{data:r,isFetching:a,error:l}=nn({queryKey:["search",s],queryFn:async()=>{if(!s||!e.auth.serverUrl||!e.auth.token||!e.auth.userId)return[];if(navigator.onLine){const[u,d,h]=await Promise.all([e.searchArtists(s,20),e.searchItems(s,40),e.searchGenres(s,20)]),m=u.slice(0,4),g=d.filter(A=>A.Type==="Audio").slice(0,6),v=d.filter(A=>A.Type==="MusicAlbum").slice(0,4),S=d.filter(A=>A.Type==="Playlist").slice(0,4),x=h.slice(0,4);return[...g,...m,...v,...S,...x]}else return await t.searchOfflineItems(s,10)}});return{searchResults:r||[],searchLoading:a,searchError:l?l.message:null,searchAttempted:n.length>0}},qA=n=>{if(n===0)return"0 B";const e=["B","KB","MB","GB","TB"],t=Math.floor(Math.log(n)/Math.log(1024));return`${(n/Math.pow(1024,t)).toFixed(t===0?0:1)} ${e[t]}`},tl=()=>y.jsx("div",{className:"inline-loader",children:y.jsxs("svg",{className:"loading",children:[y.jsx("circle",{cx:"6",cy:"6",r:"6"}),y.jsx("circle",{cx:"6",cy:"6",r:"6"})]})}),z2=n=>{const e=ss(),t=Ea(),s=C.useRef(null),{showSidenav:i,closeSidenav:r}=X0(),{playlists:a,loading:l,error:u}=KA(),{disabled:d,setDisabled:h}=J0(),[m,g]=C.useState(new URLSearchParams(location.search).get("search")||""),{searchResults:v,searchLoading:S,searchError:x,searchAttempted:T}=H2(m),A=di(),{storageStats:E,queueCount:R}=pu(),L=N=>{const F=parseFloat(N.target.value);e.setVolume(F)},w=N=>{N.stopPropagation();const F=N.deltaY>0?-.02:.02,V=Math.max(0,Math.min(1,e.volume+F));e.setVolume(V)},D=N=>{g(N.target.value)},_=()=>{g("")},k=N=>{N&&(N.Id===e.currentTrack?.Id?e.togglePlayPause():e.setCurrentPlaylistSimple({playlist:[N],title:"Sidenav Track",disableUrl:!0})&&e.playTrack(0),r())};return C.useEffect(()=>{const N=setTimeout(()=>{const F=new URLSearchParams(location.search);m?F.set("search",m):F.delete("search");const V=F.toString(),H=V?`?${V}`:location.pathname;t(H,{replace:!0})},200);return()=>clearTimeout(N)},[m,t]),C.useEffect(()=>{const N=F=>{(F.ctrlKey||F.metaKey)&&F.key==="k"&&(F.preventDefault(),s.current?.focus())};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[]),y.jsx("aside",{className:"sidenav",children:y.jsxs("div",{className:"sidenav_wrapper"+(i?" active":"")+(d?" lockscroll":""),children:[y.jsx("div",{className:"sidenav_header",children:y.jsx(ei,{to:"/",onClick:r,className:"logo"})}),y.jsxs("nav",{className:"sidenav_content",children:[y.jsxs("ul",{className:"links noSelect",children:[y.jsx("li",{children:y.jsx(ei,{to:"/",onClick:r,children:"Home"})}),y.jsx("li",{children:y.jsx(ei,{to:Rc("/tracks"),onClick:r,children:"Tracks"})}),y.jsx("li",{children:y.jsx(ei,{to:Rc("/albums"),onClick:r,children:"Albums"})}),y.jsx("li",{children:y.jsx(ei,{to:Rc("/artists"),onClick:r,children:"Artists"})}),y.jsx("li",{children:y.jsx(ei,{to:Rc("/favorites"),onClick:r,children:"Favorites"})})]}),y.jsxs("div",{className:"search",children:[y.jsx("div",{className:"search_header",children:y.jsxs("div",{className:`input_container ${m?"active":""}`,children:[y.jsx("div",{className:"search-icon noSelect",children:y.jsx(R2,{width:13,height:13})}),y.jsx("input",{type:"search",placeholder:"Search",value:m,onChange:D,ref:s}),!S&&y.jsx("div",{className:"search-clear",onClick:_,children:y.jsx(w2,{width:13,height:13})}),S&&y.jsx("div",{className:"search-loading noSelect",children:y.jsx(tl,{})})]})}),y.jsx("div",{className:"search_results",children:m&&y.jsxs(y.Fragment,{children:[x&&y.jsx("div",{className:"indicator error",children:x}),!S&&T&&!x&&v.length===0&&y.jsxs("div",{className:"empty",children:["Search for ",y.jsxs("span",{className:"keyword",children:["'",m,"'"]})," yields no results"]}),!S&&!x&&v.length>0&&y.jsxs("div",{className:"results noSelect",children:[v.map(N=>{const F=A.selectedItem?.Id===N.Id&&A.isOpen,V=[N.Type==="Audio"&&e.currentTrack?.Id===N.Id?e.isPlaying?"playing":"paused":"",F?"active":""].filter(Boolean).join(" ");return N.Type==="Audio"?y.jsx("div",{onClick:()=>k(N),className:`result ${V}`,onContextMenu:H=>A.onContextMenu(H,{item:N}),onTouchStart:H=>A.onTouchStart(H,{item:N}),onTouchMove:A.onTouchClear,onTouchEnd:A.onTouchClear,children:y.jsxs("div",{className:"type song",children:[y.jsxs("div",{className:"icon",title:"Track",children:[y.jsx("div",{className:"song-icon",children:y.jsx(BA,{width:14,height:14})}),y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"pause-icon"}),y.jsx("div",{className:"play-state-animation",children:y.jsx(L2,{width:14,height:14,className:"sound-bars"})})]}),y.jsxs("div",{className:"text",children:[N.Name," ",y.jsxs("span",{className:"artist",children:["(",N.ArtistItems?.[0]?.Name||N.Artists?.[0]||"Unknown Artist",")"]})]})]})},`${N.Type}-${N.Id}`):y.jsxs(ei,{to:`/${N.Type===_e.MusicArtist?"artist":N.Type===_e.MusicAlbum?"album":N.Type===_e.MusicGenre?"genre":N.Type?.toLowerCase()}/${N.Type===_e.MusicGenre?encodeURIComponent(N.Name):N.Id}`,onClick:r,className:`result ${V}`,...N.Type!==_e.MusicGenre&&{onContextMenu:H=>A.onContextMenu(H,{item:N}),onTouchStart:H=>A.onTouchStart(H,{item:N}),onTouchMove:A.onTouchClear,onTouchEnd:A.onTouchClear},children:[N.Type===_e.MusicArtist&&y.jsxs("div",{className:"type artist",children:[y.jsx("div",{className:"icon",title:"Artist",children:y.jsx(Zg,{width:14,height:14})}),y.jsx("div",{className:"text",children:N.Name})]}),N.Type===_e.MusicAlbum&&y.jsxs("div",{className:"type album",children:[y.jsx("div",{className:"icon",title:"Album",children:y.jsx(mh,{width:14,height:14})}),y.jsx("div",{className:"text",children:N.Name})]}),N.Type===_e.Playlist&&y.jsxs("div",{className:"type playlist",children:[y.jsx("div",{className:"icon",title:"Playlist",children:y.jsx(jA,{width:14,height:14})}),y.jsx("div",{className:"text",children:N.Name})]}),N.Type===_e.MusicGenre&&y.jsxs("div",{className:"type genre",children:[y.jsx("div",{className:"icon",title:"Genre",children:y.jsx(z0,{size:14})}),y.jsx("div",{className:"text",children:N.Name})]})]},`${N.Type}-${N.Id}`)}),y.jsx("div",{className:"additional",children:y.jsx(ei,{to:`/search/${encodeURIComponent(m)}`,onClick:r,className:"textlink",children:"See more results"})})]})]})})]}),!m&&y.jsxs("div",{className:"playlists",children:[l&&a.length===0&&y.jsx("div",{className:"indicator loading",children:"Loading playlists..."}),u&&y.jsx("div",{className:"indicator error",children:u}),!l&&!u&&a.length===0&&y.jsx("div",{className:"indicator info",children:"No playlists found"}),y.jsx("div",{className:"container noSelect",children:a.map(N=>y.jsx(ei,{to:Rc(`/playlist/${N.Id}`),onClick:r,className:({isActive:F})=>F?"playlist active":"playlist",children:N.Name},N.Id))})]})]}),y.jsxs("div",{className:"sidenav_footer",children:[y.jsxs("div",{className:"volume",children:[y.jsxs("div",{className:"indicator",children:["Volume: ",(e.volume*100).toFixed(0),"%"]}),y.jsx("div",{className:"control",children:y.jsx("input",{type:"range",id:"volume",name:"volume",min:"0",max:"1",step:"0.02",value:e.volume,onChange:L,onWheel:w,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)})})]}),y.jsxs("div",{className:"account",children:[y.jsxs("div",{className:"status",children:[y.jsx("div",{className:"indicator",children:"Connected"}),y.jsx("div",{className:"username",title:n.username,children:n.username})]}),y.jsxs("div",{className:"actions",children:[(e.currentTrackLyrics?.Lyrics?.length||0)>0&&y.jsx(ei,{to:"/lyrics",className:"icon lyrics",title:"Lyrics",children:y.jsx(GA,{width:16,height:16})}),(E.trackCount>0||R>0)&&y.jsx(ei,{to:"/synced",className:`icon synced ${R>0?"active-sync":""}`,onClick:r,title:`Synced - ${E.trackCount} Track${E.trackCount===1?"":"s"}${R>0?` (${R} track${R===1?"":"s"} in queue)`:""} / ${qA(E.trackCount===0?0:E?.indexedDB||0)} Used`,children:y.jsx($A,{width:16,height:16})}),y.jsx(ei,{to:"/settings",className:"icon settings",onClick:r,title:"Settings",children:y.jsx(C_,{size:16})})]})]})]})]})})},K2=()=>{const n="OfflineAudioDB",e="tracks",s=C.useRef(!1),i=C.useRef(new Promise((x,T)=>{const A=indexedDB.open(n,4);A.onupgradeneeded=E=>{const R=A.result,L=E.oldVersion;if(R.objectStoreNames.contains(e)){if(L<2&&A.transaction.objectStore(e).createIndex("by_kind","mediaItem.Type",{unique:!1}),L<3&&A.transaction.objectStore(e).createIndex("by_containerId","containerId",{unique:!1}),L<4){const w=A.transaction.objectStore(e);w.createIndex("by_kind_timestamp",["mediaItem.Type","timestamp"],{unique:!1});const D=w.openCursor();D.onsuccess=_=>{const k=_.target.result;if(k){const N=k.value;N.timestamp||(N.timestamp=Date.now(),w.put(N,k.primaryKey)),k.continue()}}}}else{const w=R.createObjectStore(e);w.createIndex("by_kind","mediaItem.Type",{unique:!1}),w.createIndex("by_containerId","containerId",{unique:!1}),w.createIndex("by_kind_timestamp",["mediaItem.Type","timestamp"],{unique:!1})}},A.onsuccess=()=>{s.current=!0,x(A.result)},A.onerror=()=>{console.error("IndexedDB error:",A.error),T(A.error)}})),r=C.useCallback(async(x,T)=>{if(!i.current)throw new Error("Database not initialized");const E=(await i.current).transaction(e,"readwrite");return E.objectStore(e).put(T,x),new Promise((R,L)=>{E.oncomplete=()=>R(),E.onerror=()=>L(E.error),E.onabort=()=>L(E.error)})},[]),a=C.useCallback(async x=>{if(!i.current)throw new Error("Database not initialized");const A=(await i.current).transaction(e,"readwrite"),E=A.objectStore(e),R=E.get(x);return R.onsuccess=()=>{const L=R.result;if(E.delete(x),L?.type==="container"&&x){const w=E.index("by_containerId"),D=IDBKeyRange.only(x),_=w.openCursor(D);_.onsuccess=k=>{const N=k.target.result;N&&(E.delete(N.primaryKey),N.continue())}}},R.onerror=()=>{console.error("Error fetching record for deletion:",R.error)},new Promise((L,w)=>{A.oncomplete=()=>L(),A.onerror=()=>w(A.error),A.onabort=()=>w(A.error)})},[]),l=C.useCallback(async x=>{if(!i.current)throw new Error("Database not initialized");const E=(await i.current).transaction(e,"readonly").objectStore(e).get(x);return new Promise((R,L)=>{E.onsuccess=()=>R(E.result||null),E.onerror=()=>L(E.error)})},[]),u=C.useCallback(async x=>await l(x)!==null,[l]),d=C.useCallback(async x=>{const T=await l(x);return T?.type==="song"?{type:"song",url:URL.createObjectURL(T.blob)}:T?.type==="m3u8"?{type:"m3u8",url:URL.createObjectURL(T.playlist)}:void 0},[l]),h=C.useCallback(async()=>{try{if(!i.current)throw new Error("Database not initialized");const E=(await i.current).transaction(e,"readonly").objectStore(e).index("by_kind"),R=IDBKeyRange.only(_e.Audio),L=E.count(R);return await new Promise((D,_)=>{L.onsuccess=()=>D(L.result),L.onerror=()=>_(L.error)})}catch(x){throw console.error("Failed to get storage stats:",x),x}},[]),m=C.useCallback(async()=>{if(!i.current)throw new Error("Database not initialized");const T=(await i.current).transaction(e,"readwrite");return T.objectStore(e).clear(),new Promise((A,E)=>{T.oncomplete=()=>A(),T.onerror=()=>E(T.error),T.onabort=()=>E(T.error)})},[]),S={saveTrack:r,removeTrack:a,getTrack:l,hasTrack:u,getPlayableUrl:d,getTrackCount:h,clearAllDownloads:m,getPageFromIndexedDb:async(x,T,A)=>{if(!i.current)throw new Error("Database not initialized");const w=(await i.current).transaction(e,"readonly").objectStore(e).index("by_kind_timestamp"),D=[T,0],_=[T,Number.MAX_SAFE_INTEGER],k=IDBKeyRange.bound(D,_),N="prev";return new Promise((F,V)=>{const H=[];let J=0;const X=x*A,Q=w.openCursor(k,N);Q.onerror=()=>{V(Q.error)},Q.onsuccess=j=>{const K=j.target.result;if(!K){F(H);return}if(J<X){const re=X-J;try{K.advance(re),J+=re}catch(B){console.error("Failed to skip ahead in cursor:",B),J++,K.continue()}return}const Y=K.value;Y.mediaItem&&(Y.type==="song"&&Y.mediaItem&&Y.mediaSources&&(Y.mediaItem.MediaSources=Y.mediaSources),Y.thumbnail&&(Y.mediaItem.downloadedImageUrl=URL.createObjectURL(Y.thumbnail)),H.push(Y.mediaItem)),H.length<A?K.continue():F(H)}})},searchOfflineItems:async(x,T=50)=>{if(!i.current)throw new Error("Database not initialized");if(!x.trim())return[];const L=(await i.current).transaction(e,"readonly").objectStore(e).index("by_kind"),w=IDBKeyRange.only(_e.Audio);return new Promise((D,_)=>{const k=[],N=x.toLowerCase(),F=L.openCursor(w);F.onerror=()=>{_(F.error)},F.onsuccess=V=>{const H=V.target.result;if(!H){D(k);return}const J=H.value;J.mediaItem&&J.mediaItem.Name&&J.mediaItem.Name.toLowerCase().includes(N)&&(J.type==="song"&&J.mediaSources&&(J.mediaItem.MediaSources=J.mediaSources),J.thumbnail&&(J.mediaItem.downloadedImageUrl=URL.createObjectURL(J.thumbnail)),k.push(J.mediaItem)),k.length<T?H.continue():D(k)}})},isInitialized:()=>s.current};return window.audioStorage=S,S},Y2=({children:n})=>{const e=K2();return y.jsx(YA.Provider,{value:e,children:n})};var ey=(function(){function n(){this.listeners={}}var e=n.prototype;return e.on=function(s,i){this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(i)},e.off=function(s,i){if(!this.listeners[s])return!1;var r=this.listeners[s].indexOf(i);return this.listeners[s]=this.listeners[s].slice(0),this.listeners[s].splice(r,1),r>-1},e.trigger=function(s){var i=this.listeners[s];if(i)if(arguments.length===2)for(var r=i.length,a=0;a<r;++a)i[a].call(this,arguments[1]);else for(var l=Array.prototype.slice.call(arguments,1),u=i.length,d=0;d<u;++d)i[d].apply(this,l)},e.dispose=function(){this.listeners={}},e.pipe=function(s){this.on("data",function(i){s.push(i)})},n})();function nl(){return nl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},nl.apply(null,arguments)}var Gp,Sb;function q2(){if(Sb)return Gp;Sb=1;var n;return typeof window<"u"?n=window:typeof R1<"u"?n=R1:typeof self<"u"?n=self:n={},Gp=n,Gp}var Q2=q2();const bb=_0(Q2);var X2=function(e){return bb.atob?bb.atob(e):Buffer.from(e,"base64").toString("binary")};function W2(n){for(var e=X2(n),t=new Uint8Array(e.length),s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}/*! @name m3u8-parser @version 7.2.0 @license Apache-2.0 */class Z2 extends ey{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const J2="	",Hp=function(n){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(n||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},eN=function(){const t="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+t+")")},wn=function(n){const e={};if(!n)return e;const t=n.split(eN());let s=t.length,i;for(;s--;)t[s]!==""&&(i=/([^=]*)=(.*)/.exec(t[s]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),e[i[0]]=i[1]);return e},Tb=n=>{const e=n.split("x"),t={};return e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),t};class tN extends ey{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,s;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((r,a)=>{const l=a(e);return l===e?r:r.concat([l])},[e]).forEach(r=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,r))return;if(r.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:r.slice(1)});return}if(r=r.replace("\r",""),t=/^#EXTM3U/.exec(r),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(r),t){s={type:"tag",tagType:"inf"},t[1]&&(s.duration=parseFloat(t[1])),t[2]&&(s.title=t[2]),this.trigger("data",s);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(r),t){s={type:"tag",tagType:"targetduration"},t[1]&&(s.duration=parseInt(t[1],10)),this.trigger("data",s);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(r),t){s={type:"tag",tagType:"version"},t[1]&&(s.version=parseInt(t[1],10)),this.trigger("data",s);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(r),t){s={type:"tag",tagType:"media-sequence"},t[1]&&(s.number=parseInt(t[1],10)),this.trigger("data",s);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(r),t){s={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(s.number=parseInt(t[1],10)),this.trigger("data",s);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(r),t){s={type:"tag",tagType:"playlist-type"},t[1]&&(s.playlistType=t[1]),this.trigger("data",s);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(r),t){s=nl(Hp(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",s);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(r),t){s={type:"tag",tagType:"allow-cache"},t[1]&&(s.allowed=!/NO/.test(t[1])),this.trigger("data",s);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(r),t){if(s={type:"tag",tagType:"map"},t[1]){const a=wn(t[1]);a.URI&&(s.uri=a.URI),a.BYTERANGE&&(s.byterange=Hp(a.BYTERANGE))}this.trigger("data",s);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(r),t){s={type:"tag",tagType:"stream-inf"},t[1]&&(s.attributes=wn(t[1]),s.attributes.RESOLUTION&&(s.attributes.RESOLUTION=Tb(s.attributes.RESOLUTION)),s.attributes.BANDWIDTH&&(s.attributes.BANDWIDTH=parseInt(s.attributes.BANDWIDTH,10)),s.attributes["FRAME-RATE"]&&(s.attributes["FRAME-RATE"]=parseFloat(s.attributes["FRAME-RATE"])),s.attributes["PROGRAM-ID"]&&(s.attributes["PROGRAM-ID"]=parseInt(s.attributes["PROGRAM-ID"],10))),this.trigger("data",s);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(r),t){s={type:"tag",tagType:"media"},t[1]&&(s.attributes=wn(t[1])),this.trigger("data",s);return}if(t=/^#EXT-X-ENDLIST/.exec(r),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(r),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(r),t){s={type:"tag",tagType:"program-date-time"},t[1]&&(s.dateTimeString=t[1],s.dateTimeObject=new Date(t[1])),this.trigger("data",s);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(r),t){s={type:"tag",tagType:"key"},t[1]&&(s.attributes=wn(t[1]),s.attributes.IV&&(s.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(s.attributes.IV=s.attributes.IV.substring(2)),s.attributes.IV=s.attributes.IV.match(/.{8}/g),s.attributes.IV[0]=parseInt(s.attributes.IV[0],16),s.attributes.IV[1]=parseInt(s.attributes.IV[1],16),s.attributes.IV[2]=parseInt(s.attributes.IV[2],16),s.attributes.IV[3]=parseInt(s.attributes.IV[3],16),s.attributes.IV=new Uint32Array(s.attributes.IV))),this.trigger("data",s);return}if(t=/^#EXT-X-START:(.*)$/.exec(r),t){s={type:"tag",tagType:"start"},t[1]&&(s.attributes=wn(t[1]),s.attributes["TIME-OFFSET"]=parseFloat(s.attributes["TIME-OFFSET"]),s.attributes.PRECISE=/YES/.test(s.attributes.PRECISE)),this.trigger("data",s);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(r),t){s={type:"tag",tagType:"cue-out-cont"},t[1]?s.data=t[1]:s.data="",this.trigger("data",s);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(r),t){s={type:"tag",tagType:"cue-out"},t[1]?s.data=t[1]:s.data="",this.trigger("data",s);return}if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(r),t){s={type:"tag",tagType:"cue-in"},t[1]?s.data=t[1]:s.data="",this.trigger("data",s);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"skip"},s.attributes=wn(t[1]),s.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(s.attributes["SKIPPED-SEGMENTS"]=parseInt(s.attributes["SKIPPED-SEGMENTS"],10)),s.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(s.attributes["RECENTLY-REMOVED-DATERANGES"]=s.attributes["RECENTLY-REMOVED-DATERANGES"].split(J2)),this.trigger("data",s);return}if(t=/^#EXT-X-PART:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"part"},s.attributes=wn(t[1]),["DURATION"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=parseFloat(s.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=/YES/.test(s.attributes[a]))}),s.attributes.hasOwnProperty("BYTERANGE")&&(s.attributes.byterange=Hp(s.attributes.BYTERANGE)),this.trigger("data",s);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"server-control"},s.attributes=wn(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=parseFloat(s.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=/YES/.test(s.attributes[a]))}),this.trigger("data",s);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"part-inf"},s.attributes=wn(t[1]),["PART-TARGET"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=parseFloat(s.attributes[a]))}),this.trigger("data",s);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"preload-hint"},s.attributes=wn(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(s.attributes.hasOwnProperty(a)){s.attributes[a]=parseInt(s.attributes[a],10);const l=a==="BYTERANGE-LENGTH"?"length":"offset";s.attributes.byterange=s.attributes.byterange||{},s.attributes.byterange[l]=s.attributes[a],delete s.attributes[a]}}),this.trigger("data",s);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"rendition-report"},s.attributes=wn(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){s.attributes.hasOwnProperty(a)&&(s.attributes[a]=parseInt(s.attributes[a],10))}),this.trigger("data",s);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(r),t&&t[1]){s={type:"tag",tagType:"daterange"},s.attributes=wn(t[1]),["ID","CLASS"].forEach(function(l){s.attributes.hasOwnProperty(l)&&(s.attributes[l]=String(s.attributes[l]))}),["START-DATE","END-DATE"].forEach(function(l){s.attributes.hasOwnProperty(l)&&(s.attributes[l]=new Date(s.attributes[l]))}),["DURATION","PLANNED-DURATION"].forEach(function(l){s.attributes.hasOwnProperty(l)&&(s.attributes[l]=parseFloat(s.attributes[l]))}),["END-ON-NEXT"].forEach(function(l){s.attributes.hasOwnProperty(l)&&(s.attributes[l]=/YES/i.test(s.attributes[l]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(l){s.attributes.hasOwnProperty(l)&&(s.attributes[l]=s.attributes[l].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const l in s.attributes){if(!a.test(l))continue;const u=/[0-9A-Fa-f]{6}/g.test(s.attributes[l]),d=/^\d+(\.\d+)?$/.test(s.attributes[l]);s.attributes[l]=u?s.attributes[l].toString(16):d?parseFloat(s.attributes[l]):String(s.attributes[l])}this.trigger("data",s);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(r),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(r),t){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(r),t){s={type:"tag",tagType:"content-steering"},s.attributes=wn(t[1]),this.trigger("data",s);return}if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(r),t){s={type:"tag",tagType:"i-frame-playlist"},s.attributes=wn(t[1]),s.attributes.URI&&(s.uri=s.attributes.URI),s.attributes.BANDWIDTH&&(s.attributes.BANDWIDTH=parseInt(s.attributes.BANDWIDTH,10)),s.attributes.RESOLUTION&&(s.attributes.RESOLUTION=Tb(s.attributes.RESOLUTION)),s.attributes["AVERAGE-BANDWIDTH"]&&(s.attributes["AVERAGE-BANDWIDTH"]=parseInt(s.attributes["AVERAGE-BANDWIDTH"],10)),s.attributes["FRAME-RATE"]&&(s.attributes["FRAME-RATE"]=parseFloat(s.attributes["FRAME-RATE"])),this.trigger("data",s);return}if(t=/^#EXT-X-DEFINE:(.*)$/.exec(r),t){s={type:"tag",tagType:"define"},s.attributes=wn(t[1]),this.trigger("data",s);return}this.trigger("data",{type:"tag",data:r.slice(4)})})}addParser({expression:e,customType:t,dataParser:s,segment:i}){typeof s!="function"&&(s=r=>r),this.customParsers.push(r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:s(r),customType:t,segment:i}),!0})}addTagMapper({expression:e,map:t}){const s=i=>e.test(i)?t(i):i;this.tagMappers.push(s)}}const sN=n=>n.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),ua=function(n){const e={};return Object.keys(n).forEach(function(t){e[sN(t)]=n[t]}),e},zp=function(n){const{serverControl:e,targetDuration:t,partTargetDuration:s}=n;if(!e)return;const i="#EXT-X-SERVER-CONTROL",r="holdBack",a="partHoldBack",l=t&&t*3,u=s&&s*2;t&&!e.hasOwnProperty(r)&&(e[r]=l,this.trigger("info",{message:`${i} defaulting HOLD-BACK to targetDuration * 3 (${l}).`})),l&&e[r]<l&&(this.trigger("warn",{message:`${i} clamping HOLD-BACK (${e[r]}) to targetDuration * 3 (${l})`}),e[r]=l),s&&!e.hasOwnProperty(a)&&(e[a]=s*3,this.trigger("info",{message:`${i} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),s&&e[a]<u&&(this.trigger("warn",{message:`${i} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${u}).`}),e[a]=u)};class nN extends ey{constructor(e={}){super(),this.lineStream=new Z2,this.parseStream=new tN,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,s=[];let i={},r,a,l=!1;const u=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let m=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let g=0,v=0;const S={};this.on("end",()=>{i.uri||!i.parts&&!i.preloadHints||(!i.map&&r&&(i.map=r),!i.key&&a&&(i.key=a),!i.timeline&&typeof m=="number"&&(i.timeline=m),this.manifest.preloadSegment=i)}),this.parseStream.on("data",function(x){let T,A;if(t.manifest.definitions){for(const E in t.manifest.definitions)if(x.uri&&(x.uri=x.uri.replace(`{$${E}}`,t.manifest.definitions[E])),x.attributes)for(const R in x.attributes)typeof x.attributes[R]=="string"&&(x.attributes[R]=x.attributes[R].replace(`{$${E}}`,t.manifest.definitions[E]))}({tag(){({version(){x.version&&(this.manifest.version=x.version)},"allow-cache"(){this.manifest.allowCache=x.allowed,"allowed"in x||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const E={};"length"in x&&(i.byterange=E,E.length=x.length,"offset"in x||(x.offset=g)),"offset"in x&&(i.byterange=E,E.offset=x.offset),g=E.offset+E.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),x.title&&(i.title=x.title),x.duration>0&&(i.duration=x.duration),x.duration===0&&(i.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key(){if(!x.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(x.attributes.METHOD==="NONE"){a=null;return}if(!x.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(x.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:x.attributes};return}if(x.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:x.attributes.URI};return}if(x.attributes.KEYFORMAT===h){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(x.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(x.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),x.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(x.attributes.KEYID&&x.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:x.attributes.KEYFORMAT,keyId:x.attributes.KEYID.substring(2)},pssh:W2(x.attributes.URI.split(",")[1])};return}x.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),a={method:x.attributes.METHOD||"AES-128",uri:x.attributes.URI},typeof x.attributes.IV<"u"&&(a.iv=x.attributes.IV)},"media-sequence"(){if(!isFinite(x.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+x.number});return}this.manifest.mediaSequence=x.number},"discontinuity-sequence"(){if(!isFinite(x.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+x.number});return}this.manifest.discontinuitySequence=x.number,m=x.number},"playlist-type"(){if(!/VOD|EVENT/.test(x.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+x.playlist});return}this.manifest.playlistType=x.playlistType},map(){r={},x.uri&&(r.uri=x.uri),x.byterange&&(r.byterange=x.byterange),a&&(r.key=a)},"stream-inf"(){if(this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||d,!x.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}i.attributes||(i.attributes={}),nl(i.attributes,x.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,!(x.attributes&&x.attributes.TYPE&&x.attributes["GROUP-ID"]&&x.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const E=this.manifest.mediaGroups[x.attributes.TYPE];E[x.attributes["GROUP-ID"]]=E[x.attributes["GROUP-ID"]]||{},T=E[x.attributes["GROUP-ID"]],A={default:/yes/i.test(x.attributes.DEFAULT)},A.default?A.autoselect=!0:A.autoselect=/yes/i.test(x.attributes.AUTOSELECT),x.attributes.LANGUAGE&&(A.language=x.attributes.LANGUAGE),x.attributes.URI&&(A.uri=x.attributes.URI),x.attributes["INSTREAM-ID"]&&(A.instreamId=x.attributes["INSTREAM-ID"]),x.attributes.CHARACTERISTICS&&(A.characteristics=x.attributes.CHARACTERISTICS),x.attributes.FORCED&&(A.forced=/yes/i.test(x.attributes.FORCED)),T[x.attributes.NAME]=A},discontinuity(){m+=1,i.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=x.dateTimeString,this.manifest.dateTimeObject=x.dateTimeObject),i.dateTimeString=x.dateTimeString,i.dateTimeObject=x.dateTimeObject;const{lastProgramDateTime:E}=this;this.lastProgramDateTime=new Date(x.dateTimeString).getTime(),E===null&&this.manifest.segments.reduceRight((R,L)=>(L.programDateTime=R-L.duration*1e3,L.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(x.duration)||x.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+x.duration});return}this.manifest.targetDuration=x.duration,zp.call(this,this.manifest)},start(){if(!x.attributes||isNaN(x.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:x.attributes["TIME-OFFSET"],precise:x.attributes.PRECISE}},"cue-out"(){i.cueOut=x.data},"cue-out-cont"(){i.cueOutCont=x.data},"cue-in"(){i.cueIn=x.data},skip(){this.manifest.skip=ua(x.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",x.attributes,["SKIPPED-SEGMENTS"])},part(){l=!0;const E=this.manifest.segments.length,R=ua(x.attributes);i.parts=i.parts||[],i.parts.push(R),R.byterange&&(R.byterange.hasOwnProperty("offset")||(R.byterange.offset=v),v=R.byterange.offset+R.byterange.length);const L=i.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${L} for segment #${E}`,x.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((w,D)=>{w.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${D} lacks required attribute(s): LAST-PART`})})},"server-control"(){const E=this.manifest.serverControl=ua(x.attributes);E.hasOwnProperty("canBlockReload")||(E.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),zp.call(this,this.manifest),E.canSkipDateranges&&!E.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const E=this.manifest.segments.length,R=ua(x.attributes),L=R.type&&R.type==="PART";i.preloadHints=i.preloadHints||[],i.preloadHints.push(R),R.byterange&&(R.byterange.hasOwnProperty("offset")||(R.byterange.offset=L?v:0,L&&(v=R.byterange.offset+R.byterange.length)));const w=i.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${w} for segment #${E}`,x.attributes,["TYPE","URI"]),!!R.type)for(let D=0;D<i.preloadHints.length-1;D++){const _=i.preloadHints[D];_.type&&_.type===R.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${w} for segment #${E} has the same TYPE ${R.type} as preload hint #${D}`})}},"rendition-report"(){const E=ua(x.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(E);const R=this.manifest.renditionReports.length-1,L=["LAST-MSN","URI"];l&&L.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${R}`,x.attributes,L)},"part-inf"(){this.manifest.partInf=ua(x.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",x.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),zp.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(ua(x.attributes));const E=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${E}`,x.attributes,["ID","START-DATE"]);const R=this.manifest.dateRanges[E];R.endDate&&R.startDate&&new Date(R.endDate)<new Date(R.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),R.duration&&R.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),R.plannedDuration&&R.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const L=!!R.endOnNext;if(L&&!R.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),L&&(R.duration||R.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),R.duration&&R.endDate){const D=R.startDate.getTime()+R.duration*1e3;this.manifest.dateRanges[E].endDate=new Date(D)}if(!S[R.id])S[R.id]=R;else{for(const D in S[R.id])if(R[D]&&JSON.stringify(S[R.id][D])!==JSON.stringify(R[D])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const w=this.manifest.dateRanges.findIndex(D=>D.id===R.id);this.manifest.dateRanges[w]=nl(this.manifest.dateRanges[w],R),S[R.id]=nl(S[R.id],R),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=ua(x.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",x.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const E=(R,L)=>{if(R in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${R}`});return}this.manifest.definitions[R]=L};if("QUERYPARAM"in x.attributes){if("NAME"in x.attributes||"IMPORT"in x.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}const R=this.params.get(x.attributes.QUERYPARAM);if(!R){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${x.attributes.QUERYPARAM}`});return}E(x.attributes.QUERYPARAM,decodeURIComponent(R));return}if("NAME"in x.attributes){if("IMPORT"in x.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in x.attributes)||typeof x.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${x.attributes.NAME}`});return}E(x.attributes.NAME,x.attributes.VALUE);return}if("IMPORT"in x.attributes){if(!this.mainDefinitions[x.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${x.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}E(x.attributes.IMPORT,this.mainDefinitions[x.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:x.attributes,uri:x.uri,timeline:m}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",x.attributes,["BANDWIDTH","URI"])}}[x.tagType]||u).call(t)},uri(){i.uri=x.uri,s.push(i),this.manifest.targetDuration&&!("duration"in i)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),i.duration=this.manifest.targetDuration),a&&(i.key=a),i.timeline=m,r&&(i.map=r),v=0,this.lastProgramDateTime!==null&&(i.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=i.duration*1e3),i={}},comment(){},custom(){x.segment?(i.custom=i.custom||{},i.custom[x.customType]=x.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[x.customType]=x.data)}})[x.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,s){const i=[];s.forEach(function(r){t.hasOwnProperty(r)||i.push(r)}),i.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${i.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}const Jg=n=>"pages"in n&&!!n.pages,ty=n=>"Id"in n&&!!n.Id,iN=n=>typeof n=="object",ph=(n,e,t)=>{if(!n)return n;if(Array.isArray(n))return n.map(s=>ph(s,e,t));if(iN(n)){if(ty(n)&&e.includes(n.Id))return t(n);if(Jg(n))return{...n,pages:n.pages.map(i=>ph(i,e,t))};const s={};for(const i in n)s[i]=ph(n[i],e,t);return s}return n},sy=()=>{const n=lu(),e=(t,s)=>{const i=n.getQueryCache().findAll();for(const r of i){const a=r.state.data;a&&n.setQueryData(r.queryKey,ph(a,t,s))}};return{patchMediaItem:(t,s)=>e([t],s),patchMediaItems:e,prependItemsToQueryData:(t,s)=>{const i=n.getQueryCache().findAll();for(const r of i){const a=r.state.data;if(a&&r.queryKey.slice(0,t.length).join(",")===t.join(","))if(Jg(a)){const[l,...u]=a.pages;r.setData({...a,pages:[[...s,...l],...u]})}else r.setData([...s,...a])}},removeItemFromQueryData:(t,s)=>{const i=n.getQueryCache().findAll();for(const r of i){const a=r.state.data;a&&r.queryKey.slice(0,t.length).join(",")===t.join(",")&&(Jg(a)?r.setData({...a,pages:a.pages.map(l=>l.filter(u=>u.Id!==s))}):r.setData(a.filter(l=>l.Id!==s)))}}}},Eb="mediaTaskQueue",rN=()=>{const n=Yt(),e=ss(),t=Sl(),{patchMediaItem:s,patchMediaItems:i,prependItemsToQueryData:r,removeItemFromQueryData:a}=sy(),[l,u]=C.useState({usage:0,indexedDB:0,trackCount:0}),d=C.useCallback(async()=>{try{const E=await t.getTrackCount(),R=await navigator.storage?.estimate();u({usage:R?.usage||0,indexedDB:R?.usageDetails?.indexedDB||0,trackCount:E})}catch(E){console.error("Failed to load storage stats:",E)}},[t]);C.useEffect(()=>{d()},[d]);const[h,m]=C.useState(()=>{try{const E=localStorage.getItem(Eb);return E?JSON.parse(E):[]}catch(E){return console.error("Failed to load media task queue:",E),[]}}),g=C.useRef(!1),v=C.useRef(null);C.useEffect(()=>{try{localStorage.setItem(Eb,JSON.stringify(h))}catch(E){console.error("Failed to save media task queue:",E)}},[h]);const S=(E,R)=>{const L=R?.Id;i(E.map(w=>w.Id),w=>({...w,offlineState:"downloading"})),L&&s(L,w=>({...w,offlineState:"downloading"})),m(w=>{const D=w.filter(k=>!E.some(N=>N.Id===k.mediaItem.Id)),_=E.map(k=>({mediaItem:k,action:"download",containerId:L}));return L&&_.push({mediaItem:R,action:"download"}),_.length?[...D,..._]:D})},x=(E,R)=>{const L=R?.Id;i(E.map(w=>w.Id),w=>({...w,offlineState:"deleting"})),L&&s(L,w=>({...w,offlineState:"deleting"})),m(w=>{const D=w.filter(k=>!E.some(N=>N.Id===k.mediaItem.Id)),_=E.map(k=>({mediaItem:k,action:"remove",containerId:L}));return L&&_.push({mediaItem:R,action:"remove"}),_.length?[...D,..._]:D})},T=C.useCallback(()=>{v.current&&(v.current.abort("clearQueue"),v.current=null),h.forEach(({mediaItem:E})=>{s(E.Id,R=>({...R,offlineState:R.offlineState==="downloading"?void 0:R.offlineState==="deleting"?"downloaded":R.offlineState}))}),m([])},[h,s]);C.useEffect(()=>{(async()=>{if(g.current)return;const R=h[0];if(!R)return;g.current=!0,v.current=new AbortController;const L=v.current.signal,{mediaItem:w,action:D}=R;try{if(D==="download")if(await t.hasTrack(w.Id))s(w.Id,k=>({...k,offlineState:"downloaded"}));else{if(w.offlineState="downloaded",w.Type===_e.Audio){const k=[128e3,192e3,256e3,32e4].includes(e.bitrate),N=n.getStreamUrl(w.Id,e.bitrate);if(k){const[{playlist:F,ts:V},H]=await Promise.all([QA(N,L),Kp(n,w,L)]);await t.saveTrack(w.Id,{type:"m3u8",timestamp:Date.now(),mediaItem:w,bitrate:e.bitrate,playlist:F,ts:V,containerId:R.containerId,thumbnail:H})}else{const[F,V,H]=await Promise.all([fetch(N,{signal:L}),n.getTrackInfo(w.Id),Kp(n,w,L)]);if(!F.ok)throw new Error(`HTTP ${F.status}`);if(!V)throw new Error(`Track info not found for ${w.Id}`);const J=await F.blob();await t.saveTrack(w.Id,{type:"song",timestamp:Date.now(),bitrate:e.bitrate,mediaItem:w,blob:J,containerId:R.containerId,mediaSources:V.MediaSources,thumbnail:H})}}else{const k=await Kp(n,w,L);await t.saveTrack(w.Id,{type:"container",timestamp:Date.now(),bitrate:e.bitrate,mediaItem:w,thumbnail:k})}r(["downloads",w.Type||""],[w]),s(w.Id,k=>({...k,offlineState:"downloaded"}))}else D==="remove"&&(await t.removeTrack(w.Id),a(["downloads",w.Type||""],w.Id),s(w.Id,_=>({..._,offlineState:void 0})));d()}catch(_){console.error(`Task failed for ${D} id=${w.Id}`,_),D==="download"?s(w.Id,k=>({...k,offlineState:void 0})):D==="remove"&&s(w.Id,k=>({...k,offlineState:"downloaded"}))}finally{v.current=null,m(_=>_.slice(1)),g.current=!1}})()},[n,t,s,e.bitrate,r,h,d,a]),window.addToDownloads=S,window.getDownloadState=E=>{const R=h.find(L=>L.mediaItem.Id===E);if(R)return R.action==="download"?"downloading":"deleting"};const A=E=>{m(R=>{const L=R.find(D=>D.mediaItem.Id===E);return L?(R[0]?.mediaItem.Id===E&&v.current&&(v.current.abort("removeFromQueue"),v.current=null,g.current=!1),L.action==="download"?s(E,D=>({...D,offlineState:void 0})):L.action==="remove"&&s(E,D=>({...D,offlineState:"downloaded"})),R.filter(D=>D.mediaItem.Id!==E)):R})};return{addToDownloads:S,removeFromDownloads:x,storageStats:l,refreshStorageStats:d,queueCount:h.length,clearQueue:T,queue:h,removeFromQueue:A}},aN=({children:n})=>{const e=rN();return y.jsx(HA.Provider,{value:e,children:n})},QA=async(n,e)=>{const t=await(await fetch(n,{signal:e})).text(),s=new nN;s.push(t),s.end();const i=n.replace(/\/[^/]+$/,"/"),r=new Blob([t],{type:"application/vnd.apple.mpegurl"});if(s.manifest.playlists&&s.manifest.playlists.length>0){const u=s.manifest.playlists[0].uri,d=new URL(u,i).toString();return await QA(d,e)}const a=s.manifest.segments;if(!a||a.length===0)throw new Error("No segments found in media playlist");const l=[];for(const{uri:u}of a){const d=new URL(u,i).toString(),h=await fetch(d,{signal:e});if(!h.ok)throw new Error(`Segment error ${h.status}`);l.push(await h.blob())}return{playlist:r,ts:l}},Kp=async(n,e,t)=>{try{const s=n.getImageUrl(e,"Primary",{width:360,height:360});if(!s)return;const i=await fetch(s,{signal:t});return i.ok?await i.blob():void 0}catch(s){console.warn("Failed to download thumbnail for",e.Id,s);return}};var Bn;(function(n){n[n.GREAT=2]="GREAT",n[n.GOOD=1]="GOOD",n[n.OK=0]="OK",n[n.BAD=-1]="BAD"})(Bn||(Bn={}));const Oh="http:",_h="https:",oN=80,lN=443;function cN(n){if(n=n.trim(),/^data:/i.test(n))throw new Error("data URLs are not supported");if(/^view-source:/i.test(n))throw new Error("`view-source:` is not supported as it is a non-standard protocol");if(!n.startsWith("//")&&/^\.*\//.test(n)||(n=n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,Oh)),!/^https?:/i.test(n))throw new Error("only http or https protocols are supported");const s=new URL(n);if(s.hash="",s.pathname){const i=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let r=0,a="";for(;;){const u=i.exec(s.pathname);if(!u)break;const d=u[0],h=u.index,m=s.pathname.slice(r,h);a+=m.replace(/\/{2,}/g,"/"),a+=d,r=h+d.length}const l=s.pathname.slice(r,s.pathname.length);a+=l.replace(/\/{2,}/g,"/"),s.pathname=a}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}return s.hostname&&(s.hostname=s.hostname.replace(/\.$/,"")),s.search="",s.pathname=s.pathname.replace(/\/$/,""),n=s.toString(),n}function $d(n){return new URL(n.toString())}function XA(n){if(n===Oh)return oN;if(n===_h)return lN;throw new Error("Unsupported protocol")}function uN(n,e){const t=e.port||XA(e.protocol);return n.toLowerCase().startsWith(`${e.protocol}//${e.hostname.toLowerCase()}:${t}`)}function WA(n){return!n.port||n.port===XA(n.protocol).toString()}function dN(n){if(!n?.trim())throw new Error("Input is required");return new URL(cN(n))}const e0=8096,ZA=8920;function Ab(n){let e=0;return n.protocol===_h?e+=5:e-=5,n.port===e0.toString()?e+=2:n.port===ZA.toString()&&(e-=1),WA(n)&&(e+=3),e}function hN(n){const e=[];try{const t=dN(n);if(uN(n,t))return[t.toString()];if(e.push(t),t.protocol===Oh){const s=$d(t);s.protocol=_h,e.push(s)}return e.filter(WA).forEach(s=>{if(s.protocol===Oh){const i=$d(s);i.port=e0.toString(),e.push(i)}else if(s.protocol===_h){let i=$d(s);i.port=e0.toString(),e.push(i),i=$d(s),i.port=ZA.toString(),e.push(i)}}),e.sort((s,i)=>Ab(i)-Ab(s)),e.map(s=>s.toString())}catch(t){return console.warn(t),[]}}class bl{}class fN extends bl{constructor(e){super(),this.productName=e}}class mN extends bl{constructor(e){super(),this.responseTime=e}}class pN extends bl{constructor(e){super(),this.error=e}}class Ib extends bl{}class gN extends bl{constructor(e){super(),this.version=e}}class yN extends bl{constructor(e){super(),this.version=e}}function vN(n){return new _A(n.configuration,void 0,n.axiosInstance)}function Rb(n){const e=n.split(".").map(Number);if(e.length===3&&e.every(t=>t>=0))return e}function wb(n,e){const t=Rb(n),s=Rb(e);if(!t||!s)throw new TypeError("Version doesn't match a numeric-only semver format");const[i,r,a]=t,[l,u,d]=s;return i<l||i===l&&r<u||i===l&&r===u&&a<d}const xN="10.10.0",SN="10.9.0",bN="Jellyfin Server",TN=3e3,EN=5e3;function AN(n,e=Bn.GREAT){return n.length>0?Math.min(...n):e}function IN(n){var e,t,s;const i=[],r=[];!(!((e=n.response)===null||e===void 0)&&e.data)||n.error?(i.push(new pN(n.error)),r.push(Bn.BAD)):n.response.data.ProductName!==bN&&(i.push(new fN(n.response.data.ProductName)),r.push(Bn.BAD));const a=(t=n.response)===null||t===void 0?void 0:t.data.Version;try{a?wb(a,SN)?(i.push(new yN(a)),r.push(Bn.OK)):wb(a,xN)&&(i.push(new gN(a)),r.push(Bn.GOOD)):(i.push(new Ib),r.push(Bn.BAD))}catch(l){l instanceof TypeError&&(i.push(new Ib),r.push(Bn.BAD))}return n.responseTime>TN&&(i.push(new mN(n.responseTime)),r.push(Bn.GOOD)),{address:n.address,responseTime:n.responseTime,score:AN(r),issues:i,systemInfo:(s=n.response)===null||s===void 0?void 0:s.data}}class RN{constructor(e){this.jellyfin=e}async fetchRecommendedServerInfo(e){const t=this.jellyfin.createApi(e),s=Date.now();return vN(t).getPublicSystemInfo({timeout:EN}).then(i=>({address:e,response:i,responseTime:Date.now()-s})).catch(i=>({address:e,error:i,responseTime:Date.now()-s})).then(i=>IN(i))}async discover(e,t=Bn.BAD){return(await Promise.all(e.map(s=>this.fetchRecommendedServerInfo(s)))).filter(s=>s.score>=t)}}class wN{constructor(e){this.jellyfin=e,this.recommendedServerDiscovery=new RN(this.jellyfin)}findBestServer(e){let t=e.find(s=>s.score===Bn.GREAT);return t||(t=e.find(s=>s.score===Bn.GOOD)),t||(t=e.find(s=>s.score===Bn.OK)),t}getAddressCandidates(e){return hN(e)}async getRecommendedServers(e,t){return this.recommendedServerDiscovery.discover(e,t)}async getRecommendedServerCandidates(e,t){return this.getRecommendedServers(this.getAddressCandidates(e),t)}}function CN(n,e,t=""){return[`MediaBrowser Client="${encodeURIComponent(n.name)}"`,`Device="${encodeURIComponent(e.name)}"`,`DeviceId="${encodeURIComponent(e.id)}"`,`Version="${encodeURIComponent(n.version)}"`,`Token="${encodeURIComponent(t)}"`].join(", ")}function LN(n){return new OA(n.configuration,void 0,n.axiosInstance)}function DN(n){return new PA(n.configuration,void 0,n.axiosInstance)}const ON="Authorization";class _N{constructor(e,t,s,i="",r=ve){this.basePath=e.endsWith("/")?e.slice(0,-1):e,this.clientInfo=t,this.deviceInfo=s,this.accessToken=i,this.axiosInstance=r}get configuration(){return new E2({basePath:this.basePath,apiKey:this.authorizationHeader})}authenticateUserByName(e,t){return DN(this).authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}},{headers:{[ON]:this.authorizationHeader}}).then(s=>(this.accessToken=s.data.AccessToken||"",s))}logout(){return LN(this).reportSessionEnded().then(e=>(this.accessToken="",e))}get authorizationHeader(){return CN(this.clientInfo,this.deviceInfo,this.accessToken)}}class PN{constructor(e){this.clientInfo=e.clientInfo,this.deviceInfo=e.deviceInfo,this.discovery=new wN(this)}createApi(e,t,s){return new _N(e,this.clientInfo,this.deviceInfo,t,s)}}class ro extends Error{constructor(e,t){super(e),this.response=t,this.response=t}}const NN=()=>{const n=localStorage.getItem("deviceId");if(n)return n;const e=Math.random().toString(36).substring(2)+Date.now().toString(36);return localStorage.setItem("deviceId",e),e},t0=NN(),s0=async(n,e,t)=>{try{const s=await fetch(`${n}/Users/AuthenticateByName`,{method:"POST",headers:{"X-Emby-Authorization":`MediaBrowser Client="Jelly Music App", Device="Web", DeviceId="${t0}", Version="0.4.6"`,"Content-Type":"application/json"},body:JSON.stringify({Username:e,Pw:t}),signal:AbortSignal.timeout(2e4)});if(!s.ok)throw new ro(`HTTP error! status: ${s.status}`,s);const i=await s.json();return{token:i.AccessToken,userId:i.User.Id,username:i.User.Name}}catch(s){throw new Error("Login failed: "+s.message)}},xt=2e3,kN=({serverUrl:n,userId:e,token:t})=>{const s=new PN({clientInfo:{name:"Jelly Music App",version:"0.4.6"},deviceInfo:{name:"Web",id:t0}}),i=async W=>{const se=W.Id?await window.audioStorage.hasTrack(W.Id):!1,me=W.Id?window.getDownloadState(W.Id):void 0;return{...W,Id:W.Id||"",Name:W.Name||"",offlineState:me||(se?"downloaded":void 0)}},r=async W=>await Promise.all((W||[]).map(i)),a=async(W,se)=>{const me=`JMA_CUSTOM_${W.toUpperCase()}`;return await i({Id:me,Name:se||me})},l=s.createApi(n,t),u=async(W,se=40)=>{const he=await new us(l.configuration).getItems({userId:e,searchTerm:W,includeItemTypes:[_e.MusicAlbum,_e.Playlist,_e.Audio],recursive:!0,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(he.data.Items)},d=async(W,se=20)=>{const he=await new Fd(l.configuration).getArtists({userId:e,searchTerm:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(he.data.Items)},h=async(W,se=50)=>{const he=await new us(l.configuration).getItems({userId:e,searchTerm:W,includeItemTypes:[_e.MusicAlbum],recursive:!0,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(he.data.Items)},m=async(W,se=50)=>{const he=await new us(l.configuration).getItems({userId:e,searchTerm:W,includeItemTypes:[_e.Playlist],recursive:!0,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(he.data.Items)},g=async(W,se=20)=>{const he=await new jd(l.configuration).getMusicGenres({userId:e,searchTerm:W,includeItemTypes:[_e.Audio],limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(he.data.Items)},v=async()=>{const se=await new us(l.configuration).getItems({userId:e,sortBy:[Bt.DatePlayed],sortOrder:[hs.Descending],includeItemTypes:[_e.Audio],recursive:!0,limit:Math.min(12,xt)},{signal:AbortSignal.timeout(2e4)});return await r(se.data.Items)},S=async()=>{const se=await new us(l.configuration).getItems({userId:e,sortBy:[Bt.PlayCount],sortOrder:[hs.Descending],includeItemTypes:[_e.Audio],recursive:!0,limit:Math.min(12,xt)},{signal:AbortSignal.timeout(2e4)});return await r(se.data.Items)},x=async()=>{const se=await new us(l.configuration).getItems({userId:e,sortBy:[Bt.DateCreated],sortOrder:[hs.Descending],includeItemTypes:[_e.MusicAlbum],recursive:!0,limit:Math.min(12,xt)},{signal:AbortSignal.timeout(2e4)});return await r(se.data.Items)},T=async()=>{const se=await new jd(l.configuration).getMusicGenres({userId:e,sortBy:[Bt.DateCreated],sortOrder:[hs.Descending],includeItemTypes:[_e.Audio],limit:Math.min(12,xt)},{signal:AbortSignal.timeout(2e4)});return await r(se.data.Items)},A=async(W,se,me=[Bt.DatePlayed],he=[hs.Descending])=>{const Be=await new us(l.configuration).getItems({userId:e,sortBy:me,sortOrder:he,includeItemTypes:[_e.Audio],filters:[Yo.IsPlayed],recursive:!0,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},E=async(W,se,me=[Bt.PlayCount],he=[hs.Descending])=>{const Be=await new us(l.configuration).getItems({userId:e,sortBy:me,sortOrder:he,includeItemTypes:[_e.Audio],filters:[Yo.IsPlayed],recursive:!0,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},R=async(W=0,se=40,me=[Bt.DateCreated],he=[hs.Descending])=>{const Be=await new us(l.configuration).getItems({userId:e,sortBy:me,sortOrder:he,includeItemTypes:[_e.MusicAlbum],recursive:!0,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},L=async(W=0,se=40,me=[Bt.DateCreated],he=[hs.Descending])=>{const Be=await new Fd(l.configuration).getArtists({userId:e,sortBy:me,sortOrder:he,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},w=async(W=0,se=40,me=[Bt.DateCreated],he=[hs.Descending])=>{const Be=await new Fd(l.configuration).getAlbumArtists({userId:e,sortBy:me,sortOrder:he,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},D=async(W=0,se=40,me=[Bt.SortName],he=[hs.Ascending])=>{const Be=await new jd(l.configuration).getMusicGenres({userId:e,sortBy:me,sortOrder:he,includeItemTypes:[_e.Audio],startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},_=async(W=0,se=40,me=[Bt.DateCreated],he=[hs.Descending])=>{const Be=await new us(l.configuration).getItems({userId:e,sortBy:me,sortOrder:he,includeItemTypes:[_e.Audio],recursive:!0,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)});return await r(Be.data.Items)},k=async W=>{const me=await new u2(l.configuration).getInstantMixFromItem({userId:e,itemId:W,limit:xt},{signal:AbortSignal.timeout(2e4)});return await r(me.data.Items)},N=async(W=0,se=40,me=[Bt.DateCreated],he=[hs.Descending],Ke=_e.Audio)=>{if(Ke===_e.MusicArtist){const It=await new Fd(l.configuration).getArtists({userId:e,isFavorite:!0,startIndex:W,limit:Math.min(se,xt),sortBy:me,sortOrder:he},{signal:AbortSignal.timeout(2e4)});return await r(It.data.Items)}const ht=await new us(l.configuration).getItems({userId:e,filters:[Yo.IsFavorite],includeItemTypes:[Ke],recursive:!0,sortBy:me,sortOrder:he,startIndex:W,limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)}),Mt=await r(ht.data.Items);return xb("JMA_CUSTOM_FAVORITES",Mt),Mt},F=async W=>{const se=new Ko(l.configuration),me=new us(l.configuration),[he,Ke]=await Promise.all([se.getItem({userId:e,itemId:W},{signal:AbortSignal.timeout(2e4)}),me.getItems({userId:e,parentId:W,includeItemTypes:[_e.Audio],sortBy:[Bt.IndexNumber],sortOrder:[hs.Ascending],limit:xt},{signal:AbortSignal.timeout(2e4)})]),Be=await i(he.data),ht=await r(Ke.data.Items);return $p(Be,ht),{album:Be,tracks:ht}},V=async(W,se=5)=>{const me=new Ko(l.configuration),he=new us(l.configuration),[Ke,Be]=await Promise.all([me.getItem({userId:e,itemId:W},{signal:AbortSignal.timeout(2e4)}),he.getItems({userId:e,artistIds:[W],includeItemTypes:[_e.Audio],recursive:!0,sortBy:[Bt.PlayCount,Bt.SortName],sortOrder:[hs.Descending,hs.Ascending],limit:Math.min(se,xt)},{signal:AbortSignal.timeout(2e4)})]),ht=await i(Ke.data),Mt=await r(Be.data.Items);return $p(ht,Mt),{artist:ht,tracks:Mt}},H=async(W,se)=>{const me=new us(l.configuration),[he,Ke,Be,ht]=await Promise.all([me.getItems({userId:e,artistIds:[W],includeItemTypes:[_e.Audio],recursive:!0,limit:0},{signal:AbortSignal.timeout(2e4)}),me.getItems({userId:e,artistIds:[W],includeItemTypes:[_e.Audio],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)}),me.getItems({userId:e,artistIds:[W],includeItemTypes:[_e.MusicAlbum],recursive:!0,sortBy:[Bt.PremiereDate,Bt.ProductionYear,Bt.SortName],sortOrder:[hs.Descending],limit:xt},{signal:AbortSignal.timeout(2e4)}),me.getItems({userId:e,contributingArtistIds:[W],includeItemTypes:[_e.MusicAlbum],recursive:!0,sortBy:[Bt.PremiereDate,Bt.ProductionYear,Bt.SortName],sortOrder:[hs.Descending],limit:xt},{signal:AbortSignal.timeout(2e4)})]),Mt=he.data.TotalRecordCount||0,_t=(await r(Ke.data.Items)).reduce((rt,ns)=>rt+(ns.RunTimeTicks||0),0),It=await r(Be.data.Items),Ss=await r(ht.data.Items),ds=new Map;It.forEach(rt=>ds.set(rt.Id,rt)),Ss.forEach(rt=>ds.set(rt.Id,rt));const Vs=Array.from(ds.values()),$s=[],dn=[];Vs.forEach(rt=>{(rt.AlbumArtists?.[0]?.Name||rt.AlbumArtist||"Unknown Artist")===se?$s.push(rt):dn.push(rt)});const it=$s.length+dn.length;return{albums:$s,appearsInAlbums:dn,totalTrackCount:Mt,totalPlaytime:_t,totalAlbumCount:it}},J=async(W,se=0,me=40,he=[Bt.PlayCount,Bt.SortName],Ke=[hs.Descending,hs.Ascending])=>{const ht=await new us(l.configuration).getItems({userId:e,artistIds:[W],includeItemTypes:[_e.Audio],sortBy:he,sortOrder:Ke,recursive:!0,startIndex:se,limit:Math.min(me,xt)},{signal:AbortSignal.timeout(2e4)});return{Items:await r(ht.data.Items),TotalRecordCount:ht.data.TotalRecordCount||0}},X=async W=>{const se=new us(l.configuration),me=await se.getItems({userId:e,includeItemTypes:[_e.Playlist],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)}),he=await r(me.data.Items),Ke=[],Be=5;if(he?.length)for(let ht=0;ht<he.length;ht+=Be){const _t=he.slice(ht,ht+Be).map(async Ss=>{let ds=0;const Vs=100;for(;;){const $s=await se.getItems({userId:e,parentId:Ss.Id,includeItemTypes:[_e.Audio],startIndex:ds,limit:Math.min(Vs,xt)},{signal:AbortSignal.timeout(2e4)});if((await r($s.data.Items)).some(rt=>rt.ArtistItems?.some(ns=>ns.Id===W)))return Ss;if(ds+Vs>=($s.data.TotalRecordCount||0))break;ds+=Vs}return null}),It=await Promise.all(_t);Ke.push(...It.filter(Ss=>Ss!==null))}return Ke},Q=async(W,se=0,me=40,he=[Bt.DateCreated],Ke=[hs.Descending])=>{const Be=new us(l.configuration),[ht,Mt]=await Promise.all([et(W),Be.getItems({userId:e,sortBy:he,sortOrder:Ke,includeItemTypes:[_e.Audio],recursive:!0,genres:[W],startIndex:se,limit:Math.min(me,xt)},{signal:AbortSignal.timeout(2e4)})]),_t=await r(Mt.data.Items);return $p(ht,_t),_t},j=async W=>{const me=await new Ko(l.configuration).getItem({userId:e,itemId:W},{signal:AbortSignal.timeout(2e4)});return await i(me.data)},K=async W=>{const se=new us(l.configuration),he=(await se.getItems({userId:e,parentId:W,includeItemTypes:[_e.Audio],recursive:!0,limit:0},{signal:AbortSignal.timeout(2e4)})).data.TotalRecordCount||0;let Ke=0,Be=0;if(he>0){const ht=await se.getItems({userId:e,parentId:W,includeItemTypes:[_e.Audio],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)}),Mt=await r(ht.data.Items);Ke=Mt.reduce((_t,It)=>_t+(It.RunTimeTicks||0),0),Be=Mt.reduce((_t,It)=>_t+(It.UserData?.PlayCount||0),0)}return{totalTrackCount:he,totalPlaytime:Ke,totalPlays:Be}},Y=async(W=_e.Audio)=>{const se=new us(l.configuration),he=(await se.getItems({userId:e,filters:[Yo.IsFavorite],includeItemTypes:[W],recursive:!0,limit:0},{signal:AbortSignal.timeout(2e4)})).data.TotalRecordCount||0;let Ke=0,Be=0;if(he>0){const ht=await se.getItems({userId:e,filters:[Yo.IsFavorite],includeItemTypes:[W],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)}),Mt=await r(ht.data.Items);Ke=Mt.reduce((_t,It)=>_t+(It.RunTimeTicks||0),0),Be=Mt.reduce((_t,It)=>_t+(It.UserData?.PlayCount||0),0)}return{totalTrackCount:he,totalPlaytime:Ke,totalPlays:Be}},re=async W=>{const se=new us(l.configuration),he=(await se.getItems({userId:e,includeItemTypes:[_e.Audio],recursive:!0,genres:[W],limit:0},{signal:AbortSignal.timeout(2e4)})).data.TotalRecordCount||0;let Ke=0,Be=0;if(he>0){const ht=await se.getItems({userId:e,includeItemTypes:[_e.Audio],recursive:!0,genres:[W],limit:xt},{signal:AbortSignal.timeout(2e4)}),Mt=await r(ht.data.Items);Ke=Mt.reduce((_t,It)=>_t+(It.RunTimeTicks||0),0),Be=Mt.reduce((_t,It)=>_t+(It.UserData?.PlayCount||0),0)}return{totalTrackCount:he,totalPlaytime:Ke,totalPlays:Be}},B=async W=>{const me=await new us(l.configuration).getItems({userId:e,parentId:W,includeItemTypes:[_e.Audio],sortBy:[Bt.DateCreated],sortOrder:[hs.Descending],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)});return await r(me.data.Items)},M=async(W,se=0,me=40,he=[Bt.DateCreated],Ke=[hs.Descending])=>{const Be=new us(l.configuration),ht=new Lc(l.configuration),Mt=he==="Inherit"?await ht.getPlaylistItems({userId:e,playlistId:W,startIndex:se,limit:Math.min(me,xt)},{signal:AbortSignal.timeout(2e4)}):await Be.getItems({userId:e,parentId:W,includeItemTypes:[_e.Audio],sortBy:he,sortOrder:Ke,startIndex:se,limit:Math.min(me,xt)},{signal:AbortSignal.timeout(2e4)}),_t=await r(Mt.data.Items);return xb(W,_t),_t},z=async()=>{const se=await new us(l.configuration).getItems({sortBy:[Bt.SortName],sortOrder:[hs.Ascending],userId:e,includeItemTypes:[_e.Playlist],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)});return await r(se.data.Items)},G=async W=>(await new f2(l.configuration).getLyrics({itemId:W})).data,de=async W=>{const me=await new us(l.configuration).getItems({userId:e,artistIds:[W],includeItemTypes:[_e.Audio],recursive:!0,limit:xt},{signal:AbortSignal.timeout(2e4)});return await r(me.data.Items)},Te=async()=>(await new PA(l.configuration).getUserById({userId:e})).data,pe=async()=>(await new OA(l.configuration).getSessions({})).data.find(he=>he.UserId===e)?.RemoteEndPoint||null,Qe=async()=>{const W=performance.now();return await new _A(l.configuration).getPingSystem({}),Math.round(performance.now()-W)},ce=async()=>(await new us(l.configuration).getItems({userId:e,recursive:!0,includeItemTypes:[_e.Audio],filters:[Yo.IsPlayed],limit:xt})).data.TotalRecordCount||null,Oe=async W=>{const me=await new us(l.configuration).getItems({userId:e,searchTerm:W,includeItemTypes:[_e.Audio],recursive:!0,limit:Math.min(10,xt)});return await r(me.data.Items)},Ue=async(W,se)=>{await new jp(l.configuration).reportPlaybackStart({playbackStartInfo:{ItemId:W,PlayMethod:gb.DirectStream,PositionTicks:0,IsPaused:!1,CanSeek:!0,MediaSourceId:W,AudioStreamIndex:1}},{signal:se})};let Ze=new AbortController;const nt=async(W,se,me)=>{Ze&&(Ze.abort(),Ze=new AbortController),await new jp(l.configuration).reportPlaybackProgress({playbackProgressInfo:{ItemId:W,PositionTicks:Math.floor(se*1e7),IsPaused:me,PlayMethod:gb.DirectStream,MediaSourceId:W,AudioStreamIndex:1}},{signal:Ze.signal})},Dt=async(W,se,me)=>{await new jp(l.configuration).reportPlaybackStopped({playbackStopInfo:{ItemId:W,PositionTicks:Math.floor(se*1e7),MediaSourceId:W}},{signal:me})},Nt=(W,se,me)=>{if(W.ImageTags?.[se])return`${n}/Items/${W.Id}/Images/${se}?tag=${W.ImageTags[se]}&quality=100&fillWidth=${me.width}&fillHeight=${me.height}&format=webp&api_key=${t}`;if(W.AlbumId)return`${n}/Items/${W.AlbumId}/Images/${se}?quality=100&fillWidth=${me.width}&fillHeight=${me.height}&format=webp&api_key=${t}`},Ot=(W,se)=>`${n}/Audio/${W}/universal?UserId=${e}&api_key=${t}&Container=opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg&TranscodingContainer=ts&TranscodingProtocol=hls&AudioCodec=aac&MaxStreamingBitrate=${se||14e7}&StartTimeTicks=0&EnableRedirection=true&EnableRemoteMedia=false`,ke=async W=>await new Ko(l.configuration).markFavoriteItem({itemId:W,userId:e},{signal:AbortSignal.timeout(2e4)}),Je=async W=>await new Ko(l.configuration).unmarkFavoriteItem({itemId:W,userId:e},{signal:AbortSignal.timeout(2e4)}),ot=async(W,se)=>(await new Lc(l.configuration).updatePlaylist({playlistId:W,updatePlaylistDto:{Ids:se}},{signal:AbortSignal.timeout(2e4)})).data,kt=async(W,se)=>(await new Lc(l.configuration).removeItemFromPlaylist({playlistId:W,entryIds:[se]},{signal:AbortSignal.timeout(2e4)})).data,vt=async W=>(await new Lc(l.configuration).createPlaylist({createPlaylistDto:{Name:W,IsPublic:!1},name:W},{signal:AbortSignal.timeout(2e4)})).data,fe=async(W,se)=>(await new Lc(l.configuration).updatePlaylist({playlistId:W,updatePlaylistDto:{Name:se,IsPublic:!1}})).data,ze=async W=>{const se=await fetch(`${n}/Items/${W}`,{method:"DELETE",headers:{"X-Emby-Authorization":`MediaBrowser Client="Jelly Music App", Device="Web", DeviceId="${t0}", Version="0.4.6"`,"Content-Type":"application/json","X-Emby-Token":t},signal:AbortSignal.timeout(2e4)});if(!se.ok)throw new ro(`HTTP error! status: ${se.status}`,se);return se.ok},Ve=async W=>(await new p2(l.configuration).getPlaybackInfo({userId:e,itemId:W},{signal:AbortSignal.timeout(2e4)})).data,Fe=async W=>{const me=await new Ko(l.configuration).getItem({userId:e,itemId:W},{signal:AbortSignal.timeout(2e4)});return i(me.data)},et=async W=>{const se=new jd(l.configuration);try{const he=await se.getMusicGenre({userId:e,genreName:W},{signal:AbortSignal.timeout(2e4)});if(he.data)return await i(he.data)}catch(he){console.error("Failed to get genre by name, trying search fallback:",he)}const me=await g(W,1);if(me.length>0)return me[0];throw new Error(`Genre "${W}" not found`)};return{loginToJellyfin:s0,searchItems:u,searchArtists:d,searchAlbumsDetailed:h,searchPlaylistsDetailed:m,searchGenres:g,getRecentlyPlayed:v,getFrequentlyPlayed:S,getRecentlyAdded:x,getAllAlbums:R,getAllArtists:L,getAllAlbumArtists:w,getAllGenres:D,getAllTracks:_,getFavoriteTracks:N,getFavoritesTotals:Y,getAlbumDetails:F,getArtistDetails:V,getArtistStats:H,getArtistTracks:J,getPlaylistsFeaturingArtist:X,getGenreTracks:Q,getGenreTotals:re,getPlaylist:j,getPlaylistTotals:K,getPlaylistAllTracks:B,getPlaylistTracks:M,getAllPlaylists:z,getTrackLyrics:G,fetchAllTracks:de,fetchRecentlyPlayed:A,fetchFrequentlyPlayed:E,fetchUserInfo:Te,fetchClientIp:pe,measureLatency:Qe,fetchPlayCount:ce,fetchSongs:Oe,reportPlaybackStart:Ue,reportPlaybackProgress:nt,reportPlaybackStopped:Dt,getImageUrl:Nt,getStreamUrl:Ot,addToFavorites:ke,removeFromFavorites:Je,getInstantMixFromSong:k,addToPlaylist:ot,removeFromPlaylist:kt,createPlaylist:vt,renamePlaylist:fe,deletePlaylist:ze,getTrackInfo:Ve,getMediaItem:Fe,createCustomContainerMediaItem:a,getRecentGenres:T,getGenreByName:et}},Tl=()=>{const n=Yt(),{patchMediaItem:e,prependItemsToQueryData:t,removeItemFromQueryData:s}=sy();return{addToFavorites:async i=>{const r=await n.addToFavorites(i.Id);t(["favorites",i.Type||""],[i]),e(i.Id,a=>({...a,UserData:r.data}))},removeFromFavorites:async i=>{const r=await n.removeFromFavorites(i.Id);s(["favorites",i.Type||""],i.Id),e(i.Id,a=>({...a,UserData:r.data}))}}},MN=()=>{const n=Yt(),{prependItemsToQueryData:e,removeItemFromQueryData:t,patchMediaItem:s}=sy();return{addToPlaylist:async(i,r)=>{await n.addToPlaylist(r,[i.Id]),e(["playlistTracks",r],[i])},addItemsToPlaylist:async(i,r)=>{await n.addToPlaylist(r,i.map(a=>a.Id)),e(["playlistTracks",r],i)},removeFromPlaylist:async(i,r)=>{await n.removeFromPlaylist(r,i.Id),t(["playlistTracks",r],i.Id)},createPlaylist:async i=>{const r=await n.createPlaylist(i),a=await n.getPlaylist(r.Id);return e(["playlists"],[a]),a},renamePlaylist:async(i,r)=>{await n.renamePlaylist(i,r),s(i,a=>({...a,Name:r}))},deletePlaylist:async i=>{await n.deletePlaylist(i),t(["playlists"],i)}}},_s=({className:n="",onClick:e,onMouseEnter:t,children:s,disabled:i=!1,...r})=>{const[a,l]=C.useState(!1),u=C.useCallback(async h=>{if(!(i||a||!e)){l(!0);try{await e(h)}finally{l(!1)}}},[i,a,e]),d=`dropdown-item${n?` ${n}`:""}${i?" disabled":""}`;return y.jsxs("div",{className:d,onClick:u,onMouseEnter:t,...r,children:[s,a&&y.jsx(tl,{})]})},UN=()=>{const[n,e]=C.useState(!1),[t,s]=C.useState({x:0,y:0}),[i,r]=C.useState(),[a,l]=C.useState({isOpen:!1,type:"",flipX:!1,flipY:!1,width:0,height:0,top:0,measured:!1,triggerRect:null}),[u,d]=C.useState(!1),{setDisabled:h}=J0(),[m,g]=C.useState(),v=Ea(),S=Yt(),x=ss(),{playlists:T}=KA(),{addToFavorites:A,removeFromFavorites:E}=Tl(),{addToDownloads:R,removeFromDownloads:L}=pu(),{addItemsToPlaylist:w,removeFromPlaylist:D,createPlaylist:_,deletePlaylist:k,renamePlaylist:N}=MN(),F=C.useRef(null),V=C.useRef(null),[H,J]=C.useState(""),[X,Q]=C.useState(""),[j,K]=C.useState(!1),[Y,re]=C.useState(!1);C.useEffect(()=>{const fe=()=>{const ze="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<=480;d(ze),n&&document.activeElement?.tagName!=="INPUT"&&(e(!1),l({isOpen:!1,type:"",flipX:!1,flipY:!1,width:0,height:0,top:0,measured:!1,triggerRect:null}),s({x:0,y:0}),h(!1))};return window.addEventListener("resize",fe),()=>window.removeEventListener("resize",fe)},[n,h]);const B=C.useCallback(()=>{l(fe=>({...fe,isOpen:!1,type:"",measured:!1,triggerRect:null}))},[]);C.useEffect(()=>{let fe;return n||(fe=setTimeout(()=>{s({x:0,y:0})},200)),()=>{clearTimeout(fe)}},[n]);const M=C.useCallback(()=>{e(!1),h(!1)},[h]),z=C.useCallback(fe=>J(fe.target.value),[]),G=C.useCallback(fe=>Q(fe.target.value),[]),de=C.useCallback(async(fe,ze)=>fe.Type===_e.MusicAlbum?(await S.getAlbumDetails(fe.Id)).tracks:fe.Type===_e.MusicArtist?(await S.getArtistDetails(fe.Id)).tracks:fe.Type===_e.Playlist?await S.getPlaylistAllTracks(fe.Id):fe.Type===_e.MusicGenre?await S.getGenreTracks(fe.Name,0,xt):ze==="favorites"?await S.getFavoriteTracks(0,xt):[fe],[S]),Te=C.useCallback(async fe=>{if(i)if(fe.key==="Enter"&&H.trim()){const ze=await _(H.trim());await w(await de(i.item,i.customContainer),ze.Id),J(""),M()}else fe.key==="Escape"&&J("")},[w,M,i,_,de,H]),pe=C.useCallback(async fe=>{i&&(fe.key==="Enter"&&X.trim()?(await N(i.item.Id,X.trim()),Q(""),M()):fe.key==="Escape"&&Q(""))},[M,i,N,X]),Qe=C.useCallback(async fe=>{if(!(!i||j)&&(fe.stopPropagation(),H.trim())){K(!0);try{const ze=await _(H.trim());await w(await de(i.item,i.customContainer),ze.Id),J(""),M()}finally{K(!1)}}},[w,M,i,_,de,H,j]),ce=C.useCallback(async fe=>{if(!(!i||Y)&&(fe.stopPropagation(),X.trim())){re(!0);try{await N(i.item.Id,X.trim()),Q(""),M()}finally{re(!1)}}},[M,i,N,X,Y]);C.useEffect(()=>{const fe=ze=>{ze.key==="Escape"&&M()};return document.addEventListener("keydown",fe),()=>document.removeEventListener("keydown",fe)},[M]),C.useEffect(()=>{const fe=ze=>{if(!n)return;(ze.composedPath?.()||[]).some(et=>et===F.current||et instanceof HTMLElement&&(et.closest(".dropdown")!==null||et.closest(".sub-dropdown")!==null))||M()};return document.addEventListener("pointerdown",fe,!0),()=>{document.removeEventListener("pointerdown",fe,!0)}},[M,n]);const Oe=C.useCallback((fe,ze)=>{const Ve=ze.currentTarget.getBoundingClientRect();l({isOpen:!0,type:fe,flipX:!1,flipY:!1,width:0,height:0,top:0,measured:!1,triggerRect:Ve}),fe==="rename-playlist"&&i?.item.Name&&Q(i.item.Name)},[i?.item.Name]);C.useLayoutEffect(()=>{if(!a.isOpen||a.measured||!a.triggerRect)return;const fe=V.current?.querySelector(".dropdown-menu");if(!fe)return;const{width:ze,height:Ve}=fe.getBoundingClientRect(),Fe=a.triggerRect,et=20,W=window.innerWidth,se=window.innerHeight,me=Fe.left+Fe.width+ze+et>W&&Fe.left-ze-et<0?!1:Fe.left+Fe.width+ze+et>W,he=Fe.top+Ve+et>se;let Ke=he?-Ve+Fe.height:0;Fe.top+Ke<et?Ke=-Fe.top+et:Fe.top+Ke+Ve+et>se&&(Ke=se-Ve-Fe.top-et),l(Be=>({...Be,width:ze,height:Ve,flipX:me,flipY:he,top:Ke,measured:!0}))},[a.isOpen,a.measured,a.triggerRect]),C.useEffect(()=>{const fe="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<=480;d(fe)},[]);const Ue=C.useCallback((fe,ze,Ve,Fe,et)=>{let W=Ve,se=Fe;if(u)W=0,se=window.innerHeight;else if(et){const me=fe.currentTarget.closest(".more");if(me){const he=me.getBoundingClientRect();W=he.left-window.pageXOffset-142,se=he.bottom+window.pageYOffset+8}}else{const Be=window.innerWidth,ht=window.innerHeight+window.pageYOffset;W=Ve+210+20>Be?Be-210-20:Ve,se=Fe+250+20>ht?ht-250-20:Fe,se=Fe<20?20:se,W=Ve<20?20:W}e(!0),u&&h(!0),s({x:W,y:se}),r(ze),l({isOpen:!1,type:"",flipX:!1,flipY:!1,top:0,width:0,height:0,measured:!1,triggerRect:null})},[u,h]),Ze=C.useCallback(async fe=>{if(!i)return;const ze=(x.currentTrackIndex??-1)+1;await x.updateCurrentPlaylist(async Ve=>{let Fe=0;for(let se=0;se<Ve.length;se++){const me=Ve[se];for(let he=0;he<me.length;he++){if(Fe===ze){const Ke=await de(fe,i.customContainer),Be=x.markAsManuallyAdded(Ke);return[...Ve.slice(0,se),[...me.slice(0,he),...Be,...me.slice(he)],...Ve.slice(se+1)]}Fe++}}if(ze>=Fe){const se=await de(fe,i.customContainer),me=x.markAsManuallyAdded(se);return[...Ve.slice(0,Ve.length-1),[...Ve[Ve.length-1],...me]]}const et=await de(fe,i.customContainer),W=x.markAsManuallyAdded(et);return[[...Ve[0]?.slice(0,1)||[],...W,...Ve[0]?.slice(1)||[]],...Ve.slice(1)]}),x.currentTrackIndex===-1&&x.playTrack(0),M()},[M,i,de,x]),nt=C.useCallback(async fe=>{if(!i)return;const ze=await de(fe,i.customContainer),Ve=x.markAsManuallyAdded(ze);await x.updateCurrentPlaylist(async Fe=>[...Fe.slice(0,Fe.length-1),[...Fe[Fe.length-1]||[],...Ve]]),x.currentTrackIndex===-1&&x.playTrack(0),M()},[M,i,de,x]),Dt=C.useCallback(async fe=>{await x.updateCurrentPlaylist(async ze=>ze.map(Ve=>Ve.filter(Fe=>Fe.queueId!==fe.queueId))),M()},[M,x]),Nt=C.useCallback(fe=>{M(),fe.AlbumId&&v(`/album/${fe.AlbumId}`)},[M,v]),Ot=C.useCallback(fe=>{M(),fe&&v(`/artist/${fe}`)},[M,v]),ke=C.useMemo(()=>({next:y.jsx(_s,{className:"play-next",onClick:async()=>i&&await Ze(i.item),onMouseEnter:B,children:y.jsx("span",{children:"Play next"})}),add_to_queue:y.jsx(_s,{className:"add-queue",onClick:async()=>i&&await nt(i.item),onMouseEnter:B,children:y.jsx("span",{children:"Add to queue"})}),remove_from_queue:y.jsx(_s,{className:"remove-queue has-removable",onClick:async()=>i&&await Dt(i.item),onMouseEnter:B,children:y.jsx("span",{children:"Remove from queue"})}),instant_mix:y.jsx(_s,{className:"instant-mix",onClick:async()=>{i&&(M(),v("/instantmix/"+i.item.Id))},onMouseEnter:B,children:y.jsx("span",{children:"Go to instant mix"})}),delete_playlist:y.jsx(_s,{className:"delete-playlist has-removable",onClick:async()=>{i&&(M(),i?.item.Id&&confirm("Are you sure you want to delete this playlist?")&&await k(i.item.Id))},onMouseEnter:B,children:y.jsx("span",{children:"Delete playlist"})}),rename_playlist:y.jsxs("div",{className:`dropdown-item rename-playlist has-sub-menu${a.isOpen&&a.type==="rename-playlist"?" active":""}`,onMouseEnter:u?void 0:fe=>Oe("rename-playlist",fe),onClick:u?fe=>Oe("rename-playlist",fe):void 0,children:[y.jsx("span",{children:"Rename playlist"}),y.jsx(kp,{size:12,className:"icon"}),!u&&a.isOpen&&a.type==="rename-playlist"&&y.jsx("div",{ref:V,className:`sub-dropdown${a.flipX?" flip-x":""}${a.flipY?" flip-y":""}`,style:!a.measured||!a.triggerRect?{visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"}:{position:"absolute",top:`${a.top}px`,left:a.flipX?"auto":"100%",right:a.flipX?"100%":"auto"},children:y.jsx("div",{className:"dropdown-menu",children:y.jsx(_s,{children:y.jsxs("div",{className:"playlist-input-container",children:[y.jsx("input",{value:X,onChange:G,onKeyDown:pe,onClick:fe=>fe.stopPropagation(),placeholder:"Rename playlist...",className:`playlist-input${X.trim()?" has-text":""}`,disabled:Y}),Y&&y.jsx(tl,{}),!Y&&y.jsx("button",{className:"create-btn",onClick:ce,children:"Rename"})]})})})})]}),view_artists:y.jsxs("div",{className:`dropdown-item view-artists has-sub-menu${a.isOpen&&a.type==="view-artists"?" active":""}`,onMouseEnter:u?void 0:fe=>Oe("view-artists",fe),onClick:u?fe=>Oe("view-artists",fe):void 0,children:[y.jsx("span",{children:"View artists"}),y.jsx(kp,{size:12,className:"icon"}),!u&&a.isOpen&&a.type==="view-artists"&&y.jsx("div",{ref:V,className:"sub-dropdown"+(a.flipX?" flip-x":"")+(a.flipY?" flip-y":""),style:!a.measured||!a.triggerRect?{visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"}:{position:"absolute",top:`${a.top}px`,left:a.flipX?"auto":"100%",right:a.flipX?"100%":"auto"},children:y.jsx("div",{className:"dropdown-menu",children:i?.item.ArtistItems?.map(fe=>y.jsx(_s,{onClick:()=>Ot(fe.Id),children:fe.Name||"Unknown Artist"},fe.Id))})})]}),view_artist:y.jsx(_s,{className:"view-artist",onClick:()=>Ot(i?.item.ArtistItems?.[0].Id),onMouseEnter:B,children:y.jsx("span",{children:"View artist"})}),view_album:y.jsx(_s,{className:"view-album",onClick:()=>i&&Nt(i.item),onMouseEnter:B,children:y.jsx("span",{children:"View album"})}),add_to_favorite:y.jsx(_s,{className:"add-favorite",onClick:async()=>{i&&(M(),await A(i.item))},onMouseEnter:B,children:y.jsx("span",{children:"Add to favorites"})}),remove_from_favorite:y.jsx(_s,{className:"remove-favorite has-removable",onClick:async()=>{i&&(M(),await E(i.item))},onMouseEnter:B,children:y.jsx("span",{children:"Remove from favorites"})}),add_to_playlist:y.jsxs("div",{className:`dropdown-item add-playlist has-sub-menu${a.isOpen&&a.type==="add-playlist"?" active":""}`,onMouseEnter:u?void 0:fe=>Oe("add-playlist",fe),onClick:u?fe=>Oe("add-playlist",fe):void 0,children:[y.jsx("span",{children:"Add to playlist"}),y.jsx(kp,{size:12,className:"icon"}),!u&&a.isOpen&&a.type==="add-playlist"&&y.jsx("div",{ref:V,className:`sub-dropdown${a.flipX?" flip-x":""}${a.flipY?" flip-y":""}`,style:!a.measured||!a.triggerRect?{visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"}:{position:"absolute",top:`${a.top}px`,left:a.flipX?"auto":"100%",right:a.flipX?"100%":"auto"},children:y.jsxs("div",{className:"dropdown-menu",children:[y.jsx(_s,{children:y.jsxs("div",{className:"playlist-input-container",children:[y.jsx("input",{value:H,onChange:z,onKeyDown:Te,onClick:fe=>fe.stopPropagation(),placeholder:"New...",className:`playlist-input${H.trim()?" has-text":""}`,disabled:j}),j&&y.jsx(tl,{}),!j&&y.jsx("button",{className:"create-btn",onClick:Qe,children:"Create"})]})}),T.length>0&&y.jsx("div",{className:"dropdown-separator"}),T.map(fe=>y.jsx(_s,{onClick:async()=>{i&&(M(),await w(await de(i.item,i.customContainer),fe.Id))},children:fe.Name},fe.Id))]})})]}),remove_from_playlist:i?.playlistId?y.jsx(_s,{className:"remove-playlist has-removable",onClick:async()=>{i&&(M(),await D(i.item,i.playlistId))},onMouseEnter:B,children:y.jsx("span",{children:"Remove from playlist"})}):null,download_song:i?.item.offlineState==="downloaded"?y.jsx(_s,{className:"remove-song has-removable",onClick:async()=>{if(!i)return;M();const fe=i.customContainer?await S.createCustomContainerMediaItem(i.customContainer):i.item.Type===_e.Audio?void 0:i.item;L(await de(i.item,i.customContainer),fe)},onMouseEnter:B,children:y.jsx("span",{children:"Unsync from cache"})}):i?.item.offlineState==="deleting"?y.jsx(_s,{className:"disabled",onMouseEnter:B,disabled:!0,children:y.jsx("span",{children:"Unsyncing..."})}):i?.item.offlineState?y.jsx(_s,{className:"disabled",onMouseEnter:B,disabled:!0,children:y.jsx("span",{children:"Syncing..."})}):y.jsx(_s,{onClick:async()=>{if(!i)return;M();const fe=i.customContainer?await S.createCustomContainerMediaItem(i.customContainer):i.item.Type===_e.Audio?void 0:i.item;R(await de(i.item,i.customContainer),fe)},onMouseEnter:B,children:y.jsx("span",{children:"Sync to cache"})})}),[w,R,A,S,M,B,i,k,de,nt,Qe,z,Te,Ze,Dt,ce,G,pe,Nt,Ot,j,Y,u,v,Oe,H,T,L,E,D,X,a.flipX,a.flipY,a.isOpen,a.measured,a.top,a.triggerRect,a.type]),Je=C.useMemo(()=>{const fe=()=>{let Ve=[];return a.type==="view-artists"?Ve=i?.item.ArtistItems?.map(Fe=>y.jsx(_s,{onClick:()=>{Ot(Fe.Id)},children:Fe.Name||"Unknown Artist"},Fe.Id))||[]:a.type==="add-playlist"?Ve=[y.jsx(_s,{children:y.jsxs("div",{className:"playlist-input-container",children:[y.jsx("input",{value:H,onChange:z,onKeyDown:Te,onClick:Fe=>Fe.stopPropagation(),placeholder:"New...",className:`playlist-input${H.trim()?" has-text":""}`,disabled:j}),j&&y.jsx(tl,{}),!j&&y.jsx("button",{className:"create-btn",onClick:Qe,children:"Create"})]})},"playlist-input-item"),...T.length>0?[y.jsx("div",{className:"dropdown-separator"},"playlist-separator")]:[],...T.map(Fe=>y.jsx(_s,{onClick:async()=>{i&&(M(),await w(await de(i.item,i.customContainer),Fe.Id))},children:Fe.Name},Fe.Id))]:a.type==="rename-playlist"&&(Ve=[y.jsx(_s,{children:y.jsxs("div",{className:"playlist-input-container",children:[y.jsx("input",{value:X,onChange:G,onKeyDown:pe,onClick:Fe=>Fe.stopPropagation(),placeholder:"Rename playlist...",className:`playlist-input${X.trim()?" has-text":""}`,disabled:Y}),Y&&y.jsx(tl,{}),!Y&&y.jsx("button",{className:"create-btn",onClick:ce,children:"Rename"})]})},"rename-playlist-input-item")]),Ve},ze=()=>{const Fe=[[{isVisible:!m?.next&&(i?.item.Type===_e.Audio||i?.item.Type===_e.MusicAlbum||i?.item.Type===_e.MusicArtist||i?.item.Type===_e.MusicGenre||i?.customContainer==="favorites"),node:ke.next},{isVisible:!m?.add_to_queue&&(i?.item.Type===_e.Audio||i?.item.Type===_e.MusicAlbum||i?.item.Type===_e.MusicArtist||i?.item.Type===_e.MusicGenre||i?.customContainer==="favorites"),node:ke.add_to_queue},{isVisible:!!m?.add_to_queue&&!m?.remove_from_queue&&(i?.item.Type===_e.Audio||i?.item.Type===_e.MusicAlbum||i?.item.Type===_e.MusicArtist||i?.item.Type===_e.MusicGenre||i?.customContainer==="favorites"),node:ke.remove_from_queue},{isVisible:!m?.instant_mix,node:ke.instant_mix}],[{isVisible:!m?.view_artists&&(i?.item.ArtistItems?.length||0)>1,node:ke.view_artists},{isVisible:!m?.view_artist&&i?.item.ArtistItems?.length===1,node:ke.view_artist},{isVisible:!!(!m?.view_album&&i?.item.Type!==_e.MusicAlbum&&i?.item.AlbumId),node:ke.view_album}],[{isVisible:!m?.add_to_favorite&&!i?.item.UserData?.IsFavorite,node:ke.add_to_favorite},{isVisible:!!(!m?.remove_from_favorite&&i?.item.UserData?.IsFavorite),node:ke.remove_from_favorite},{isVisible:!m?.remove_from_playlist&&i?.item.Type===_e.Audio,node:ke.remove_from_playlist},{isVisible:!m?.add_to_playlist&&(i?.item.Type===_e.Audio||i?.item.Type===_e.MusicAlbum||i?.item.Type===_e.MusicArtist||i?.item.Type===_e.MusicGenre||i?.customContainer==="favorites"),node:ke.add_to_playlist},{isVisible:!m?.rename_playlist&&i?.item.Type===_e.Playlist,node:ke.rename_playlist},{isVisible:!m?.delete_playlist&&i?.item.Type===_e.Playlist,node:ke.delete_playlist}],[{isVisible:!m?.download_song&&(i?.item.Type===_e.Audio||i?.item.Type===_e.MusicAlbum||i?.item.Type===_e.MusicArtist||i?.item.Type===_e.Playlist||i?.item.Type===_e.MusicGenre||!!i?.customContainer),node:ke.download_song}]].map(et=>et.filter(W=>W.isVisible)).filter(et=>et.length>0);return Fe.map((et,W)=>y.jsxs(C.Fragment,{children:[et.map((se,me)=>se.isVisible?y.jsx(C.Fragment,{children:se.node},me):null),W!==Fe.length-1&&y.jsx("div",{className:"dropdown-separator"})]},W))};return y.jsx("div",{className:"dropdown noSelect"+(n?" active":""),style:{top:`${t.y}px`,left:`${t.x}px`,bottom:"auto"},ref:F,children:y.jsxs("div",{className:"dropdown-menu",children:[u&&i&&y.jsxs("div",{className:"dropdown-header",children:[y.jsxs("div",{className:`container ${i.item.Type===_e.Audio?"track":i.item.Type===_e.MusicAlbum?"album":i.item.Type===_e.MusicArtist?"artist":i.item.Type===_e.Playlist?"playlist":i.item.Type===_e.MusicGenre?"genre":"unknown"}`,children:[y.jsxs(Ln,{width:36,height:36,cornerRadius:6,className:"thumbnail",useSquircle:i.item.Type!==_e.MusicArtist,children:[i.item&&y.jsxs(y.Fragment,{children:[i.item.Id==="JMA_CUSTOM_FAVORITES"&&y.jsx("div",{className:"art",children:y.jsx(ci,{size:16})}),i.item.Id!=="JMA_CUSTOM_FAVORITES"&&y.jsx(yn,{"data-fav":i.item.Id,item:i.item,type:"Primary",width:36,height:36})]}),!i.item&&y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(dl,{width:"50%",height:"50%"})})]}),y.jsxs("div",{className:"info",children:[y.jsxs("div",{className:"title",children:[y.jsx("div",{className:"text",title:i.item.Name||"Unknown",children:i.item.Name||"Unknown"}),i.item.UserData?.IsFavorite&&y.jsx("span",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:12})})]}),i.item.Type!==_e.MusicArtist&&i.item.Type!==_e.MusicGenre&&i.item.Id!=="JMA_CUSTOM_FAVORITES"&&y.jsx("div",{className:"desc",children:i.item.Type===_e.Audio?i.item.Artists?.join(", ")||"Unknown Artist":i.item.Type===_e.MusicAlbum?i.item.AlbumArtist||"Unknown Artist":i.item.Type===_e.Playlist?`${i.item.ChildCount||0} Track${i.item.ChildCount===1?"":"s"}`:"Unknown"})]})]}),y.jsxs("div",{className:"actions",children:[a.isOpen&&y.jsx("div",{className:"back icon",onClick:B,children:y.jsx(tf,{size:16})}),y.jsx("div",{className:"close icon",onClick:M,children:y.jsx(L_,{size:16})})]})]}),u&&a.isOpen?y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"dropdown-separator"}),fe()]}):ze()]})})},[w,M,B,i,de,Qe,z,Te,ce,G,pe,Ot,m?.add_to_favorite,m?.add_to_playlist,m?.add_to_queue,m?.delete_playlist,m?.download_song,m?.instant_mix,m?.next,m?.remove_from_favorite,m?.remove_from_playlist,m?.remove_from_queue,m?.rename_playlist,m?.view_album,m?.view_artist,m?.view_artists,j,n,Y,u,ke.add_to_favorite,ke.add_to_playlist,ke.add_to_queue,ke.delete_playlist,ke.download_song,ke.instant_mix,ke.next,ke.remove_from_favorite,ke.remove_from_playlist,ke.remove_from_queue,ke.rename_playlist,ke.view_album,ke.view_artist,ke.view_artists,H,T,t.x,t.y,X,a.isOpen,a.type]),ot=C.useRef(null),kt=C.useCallback(()=>{ot.current!==null&&(clearTimeout(ot.current),ot.current=null)},[]),vt=C.useCallback((fe,ze,Ve=!1,Fe={})=>{fe.target.closest(".draggable")||(fe.preventDefault(),kt(),ot.current=window.setTimeout(()=>{const et=fe.touches[0],W=et.clientX,se=et.clientY+window.pageYOffset;Ue(fe,ze,W,se,Ve),g(Fe)},400))},[kt,Ue]);return{isOpen:n,position:t,selectedItem:i?.item,menuItems:ke,subDropdown:a,isTouchDevice:u,closeDropdown:M,openSubDropdown:Oe,closeSubDropdown:B,onContextMenu:(fe,ze,Ve=!1,Fe={})=>{if(fe.target.closest(".draggable"))return;fe.preventDefault();const et=fe.clientX,W=fe.clientY+window.pageYOffset;Ue(fe,ze,et,W,Ve),g(Fe)},onTouchStart:vt,onTouchClear:kt,dropdownNode:Je}},FN=({children:n})=>{const e=UN();return y.jsx(iA.Provider,{value:e,children:n})},BN=()=>{const n=Ea(),e=xn(),t=bO(),s=e.pathname+e.search,[i,r]=C.useState(0);return C.useEffect(()=>{t==="PUSH"?r(l=>l+1):t==="POP"&&r(l=>Math.max(l-1,0))},[s,t]),{goBack:()=>{i>0?n(-1):n("/",{replace:!0})}}},jN=({children:n})=>{const e=BN();return y.jsx(kA.Provider,{value:e,children:n})},VN=n=>{const[e]=C.useState(kN(n));return{...e,auth:n}},$N=({children:n,auth:e})=>{const t=VN(e);return y.jsx(FA.Provider,{value:t,children:n})},GN=()=>{const[n,e]=C.useState("");return{pageTitle:n,setPageTitle:e}},HN=({children:n})=>{const e=GN();return y.jsx(MA.Provider,{value:e,children:n})},je=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},zN=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=KN},KN=Number.MAX_SAFE_INTEGER||9007199254740991;let qe=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),te=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),O=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var wt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},$e={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class qo{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class YN{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new qo(e),this.fast_=new qo(t),this.defaultTTFB_=i,this.ttfb_=new qo(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new qo(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new qo(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new qo(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,i=e/1e3,r=s/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function qN(n,e,t){return(e=XN(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ts(){return ts=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},ts.apply(null,arguments)}function Cb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function Xt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cb(Object(t),!0).forEach(function(s){qN(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Cb(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function QN(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function XN(n){var e=QN(n,"string");return typeof e=="symbol"?e:e+""}class Oi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=fa,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const fa=function(){},WN={trace:fa,debug:fa,log:fa,warn:fa,info:fa,error:fa};function n0(){return ts({},WN)}function ZN(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):fa}function Lb(n,e,t){return e[n]?e[n].bind(e):ZN(n,t)}const i0=n0();function JN(n,e,t){const s=n0();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(r=>{s[r]=Lb(r,n,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.12`)}catch{return n0()}i.forEach(r=>{i0[r]=Lb(r,n)})}else ts(i0,s);return s}const Wt=i0;function xa(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ek(n){return typeof self<"u"&&n===self.ManagedMediaSource}function JA(n,e){const t=Object.keys(n),s=Object.keys(e),i=t.length,r=s.length;return!i||!r||i===r&&!t.some(a=>s.indexOf(a)===-1)}function oi(n,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(n);if(e){const h=d.indexOf("\0");return h!==-1?d.substring(0,h):d}return d.replace(/\0/g,"")}const t=n.length;let s,i,r,a="",l=0;for(;l<t;){if(s=n[l++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:i=n[l++],a+=String.fromCharCode((s&31)<<6|i&63);break;case 14:i=n[l++],r=n[l++],a+=String.fromCharCode((s&15)<<12|(i&63)<<6|(r&63)<<0);break}}return a}function jn(n){let e="";for(let t=0;t<n.length;t++){let s=n[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function eI(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function tk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yp={exports:{}},Db;function sk(){return Db||(Db=1,(function(n,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(u,d,h){if(h=h||{},u=u.trim(),d=d.trim(),!d){if(!h.alwaysNormalize)return u;var m=l.parseURL(u);if(!m)throw new Error("Error trying to parse base URL.");return m.path=l.normalizePath(m.path),l.buildURLFromParts(m)}var g=l.parseURL(d);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return h.alwaysNormalize?(g.path=l.normalizePath(g.path),l.buildURLFromParts(g)):d;var v=l.parseURL(u);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var S=i.exec(v.path);v.netLoc=S[1],v.path=S[2]}v.netLoc&&!v.path&&(v.path="/");var x={scheme:v.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(x.netLoc=v.netLoc,g.path[0]!=="/"))if(!g.path)x.path=v.path,g.params||(x.params=v.params,g.query||(x.query=v.query));else{var T=v.path,A=T.substring(0,T.lastIndexOf("/")+1)+g.path;x.path=l.normalizePath(A)}return x.path===null&&(x.path=h.alwaysNormalize?l.normalizePath(g.path):g.path),l.buildURLFromParts(x)},parseURL:function(u){var d=s.exec(u);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(r,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};n.exports=l})()})(Yp)),Yp.exports}var ny=sk();class iy{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var as={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class tI{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,ik(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;s.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[as.AUDIO]:null,[as.VIDEO]:null,[as.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new iy),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ny.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[as.AUDIO]=null,e[as.VIDEO]=null,e[as.AUDIOVIDEO]=null}}function Ys(n){return n.sn!=="initSegment"}class qp extends tI{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(je(e)&&je(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const s=Object.keys(this.levelkeys);if(s.length===1){const i=this._decryptdata=this.levelkeys[s[0]]||null;if(i)return i.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=je(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),i=s.length;if(i>1||i===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!je(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ys(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,i,r,a=!1){const{elementaryStreams:l}=this,u=l[e];if(!u){l[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:a};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,s),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,r)}}class nk extends tI{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function sI(n,e){const t=Object.getPrototypeOf(n);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||sI(t,e)}}function ik(n,e){const t=sI(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Ob=Math.pow(2,32)-1,rk=[].push,nI={video:1,audio:2,id3:3,text:4};function Zs(n){return String.fromCharCode.apply(null,n)}function iI(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ut(n,e){const t=rI(n,e);return t<0?4294967296+t:t}function _b(n,e){let t=ut(n,e);return t*=Math.pow(2,32),t+=ut(n,e+4),t}function rI(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function ak(n){const e=n.byteLength;for(let t=0;t<e;){const s=ut(n,t);if(s>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=s>1?t+s:e}return!1}function Et(n,e){const t=[];if(!e.length)return t;const s=n.byteLength;for(let i=0;i<s;){const r=ut(n,i),a=Zs(n.subarray(i+4,i+8)),l=r>1?i+r:s;if(a===e[0])if(e.length===1)t.push(n.subarray(i+8,l));else{const u=Et(n.subarray(i+8,l),e.slice(1));u.length&&rk.apply(t,u)}i=l}return t}function ok(n){const e=[],t=n[0];let s=8;const i=ut(n,s);s+=4;let r=0,a=0;t===0?(r=ut(n,s),a=ut(n,s+4),s+=8):(r=_b(n,s),a=_b(n,s+8),s+=16),s+=2;let l=n.length+a;const u=iI(n,s);s+=2;for(let d=0;d<u;d++){let h=s;const m=ut(n,h);h+=4;const g=m&2147483647;if((m&2147483648)>>>31===1)return Wt.warn("SIDX has hierarchical references (not supported)"),null;const S=ut(n,h);h+=4,e.push({referenceSize:g,subsegmentDuration:S,info:{duration:S/i,start:l,end:l+g-1}}),l+=g,h+=4,s=h}return{earliestPresentationTime:r,timescale:i,version:t,referencesCount:u,references:e}}function aI(n){const e=[],t=Et(n,["moov","trak"]);for(let i=0;i<t.length;i++){const r=t[i],a=Et(r,["tkhd"])[0];if(a){let l=a[0];const u=ut(a,l===0?12:20),d=Et(r,["mdia","mdhd"])[0];if(d){l=d[0];const h=ut(d,l===0?12:20),m=Et(r,["mdia","hdlr"])[0];if(m){const g=Zs(m.subarray(8,12)),v={soun:as.AUDIO,vide:as.VIDEO}[g],S=Et(r,["mdia","minf","stbl","stsd"])[0],x=lk(S);v?(e[u]={timescale:h,type:v,stsd:x},e[v]=Xt({timescale:h,id:u},x)):e[u]={timescale:h,type:g,stsd:x}}}}}return Et(n,["moov","mvex","trex"]).forEach(i=>{const r=ut(i,4),a=e[r];a&&(a.default={duration:ut(i,12),flags:ut(i,20)})}),e}function lk(n){const e=n.subarray(8),t=e.subarray(86),s=Zs(e.subarray(4,8));let i=s,r;const a=s==="enca"||s==="encv";if(a){const d=Et(e,[s])[0].subarray(s==="enca"?28:78);Et(d,["sinf"]).forEach(m=>{const g=Et(m,["schm"])[0];if(g){const v=Zs(g.subarray(4,8));if(v==="cbcs"||v==="cenc"){const S=Et(m,["frma"])[0];S&&(i=Zs(S))}}})}const l=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=Et(t,["avcC"])[0];u&&u.length>3&&(i+="."+Hd(u[1])+Hd(u[2])+Hd(u[3]),r=Gd(l==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=Et(e,[s])[0],d=Et(u.subarray(28),["esds"])[0];if(d&&d.length>7){let h=4;if(d[h++]!==3)break;h=Qp(d,h),h+=2;const m=d[h++];if(m&128&&(h+=2),m&64&&(h+=d[h++]),d[h++]!==4)break;h=Qp(d,h);const g=d[h++];if(g===64)i+="."+Hd(g);else break;if(h+=12,d[h++]!==5)break;h=Qp(d,h);const v=d[h++];let S=(v&248)>>3;S===31&&(S+=1+((v&7)<<3)+((d[h]&224)>>5)),i+="."+S}break}case"hvc1":case"hev1":{const u=Et(t,["hvcC"])[0];if(u&&u.length>12){const d=u[1],h=["","A","B","C"][d>>6],m=d&31,g=ut(u,2),v=(d&32)>>5?"H":"L",S=u[12],x=u.subarray(6,12);i+="."+h+m,i+="."+ck(g).toString(16).toUpperCase(),i+="."+v+S;let T="";for(let A=x.length;A--;){const E=x[A];(E||T)&&(T="."+E.toString(16).toUpperCase()+T)}i+=T}r=Gd(l=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Gd(i,t)||i;break}case"vp09":{const u=Et(t,["vpcC"])[0];if(u&&u.length>6){const d=u[4],h=u[5],m=u[6]>>4&15;i+="."+ir(d)+"."+ir(h)+"."+ir(m)}break}case"av01":{const u=Et(t,["av1C"])[0];if(u&&u.length>2){const d=u[1]>>>5,h=u[1]&31,m=u[2]>>>7?"H":"M",g=(u[2]&64)>>6,v=(u[2]&32)>>5,S=d===2&&g?v?12:10:g?10:8,x=(u[2]&16)>>4,T=(u[2]&8)>>3,A=(u[2]&4)>>2,E=u[2]&3;i+="."+d+"."+ir(h)+m+"."+ir(S)+"."+x+"."+T+A+E+"."+ir(1)+"."+ir(1)+"."+ir(1)+"."+0,r=Gd("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:r}}function Gd(n,e){const t=Et(e,["dvvC"]),s=t.length?t[0]:Et(e,["dvcC"])[0];if(s){const i=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return n+"."+ir(i)+"."+ir(r)}}function ck(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Qp(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Hd(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function ir(n){return(n<10?"0":"")+n}function uk(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Et(n,["moov","trak"]).forEach(i=>{const a=Et(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let l=Et(a,["enca"]);const u=l.length>0;u||(l=Et(a,["encv"])),l.forEach(d=>{const h=u?d.subarray(28):d.subarray(78);Et(h,["sinf"]).forEach(g=>{const v=oI(g);if(v){const S=v.subarray(8,24);S.some(x=>x!==0)||(Wt.log(`[eme] Patching keyId in 'enc${u?"a":"v"}>sinf>>tenc' box: ${jn(S)} -> ${jn(t)}`),v.set(t,8))}})})})}function oI(n){const e=Et(n,["schm"])[0];if(e){const t=Zs(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Et(n,["schi","tenc"])[0]}return null}function dk(n,e,t){const s={},i=Et(n,["moof","traf"]);for(let r=0;r<i.length;r++){const a=i[r],l=Et(a,["tfhd"])[0],u=ut(l,4),d=e[u];if(!d)continue;s[u]||(s[u]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const h=s[u],m=Et(a,["tfdt"])[0];if(m){const R=m[0];let L=ut(m,4);R===1&&(L===Ob?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=Ob+1,L+=ut(m,8))),je(L)&&(!je(h.start)||L<h.start)&&(h.start=L)}const g=d.default,v=ut(l,0)|g?.flags;let S=g?.duration||0;v&8&&(v&2?S=ut(l,12):S=ut(l,8));const x=Et(a,["trun"]);let T=h.start||0,A=0,E=S;for(let R=0;R<x.length;R++){const L=x[R],w=ut(L,4),D=h.sampleCount;h.sampleCount+=w;const _=L[3]&1,k=L[3]&4,N=L[2]&1,F=L[2]&2,V=L[2]&4,H=L[2]&8;let J=8,X=w;for(_&&(J+=4),k&&w&&(!(L[J+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=D),J+=4,N?(E=ut(L,J),J+=4):E=S,F&&(J+=4),H&&(J+=4),T+=E,A+=E,X--);X--;)N?(E=ut(L,J),J+=4):E=S,F&&(J+=4),V&&(L[J+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(X+1),h.keyFrameStart=T),J+=4),H&&(J+=4),T+=E,A+=E;!A&&S&&(A+=S*w)}h.duration+=A}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,a=0;const l=Et(n,["sidx"]);for(let u=0;u<l.length;u++){const d=ok(l[u]);if(d!=null&&d.references){r=Math.min(r,d.earliestPresentationTime/d.timescale);const h=d.references.reduce((m,g)=>m+g.info.duration||0,0);a=Math.max(a,h+d.earliestPresentationTime/d.timescale)}}a&&je(a)&&Object.keys(s).forEach(u=>{s[u].duration||(s[u].duration=a*s[u].timescale-s[u].start)})}return s}function hk(n){const e={valid:null,remainder:null},t=Et(n,["moof"]);if(t.length<2)return e.remainder=n,e;const s=t[t.length-1];return e.valid=n.slice(0,s.byteOffset-8),e.remainder=n.slice(s.byteOffset-8),e}function Ci(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Pb(n,e){const t=[],s=e.samples,i=e.timescale,r=e.id;let a=!1;return Et(s,["moof"]).map(u=>{const d=u.byteOffset-8;Et(u,["traf"]).map(m=>{const g=Et(m,["tfdt"]).map(v=>{const S=v[0];let x=ut(v,4);return S===1&&(x*=Math.pow(2,32),x+=ut(v,8)),x/i})[0];return g!==void 0&&(n=g),Et(m,["tfhd"]).map(v=>{const S=ut(v,4),x=ut(v,0)&16777215,T=(x&1)!==0,A=(x&2)!==0,E=(x&8)!==0;let R=0;const L=(x&16)!==0;let w=0;const D=(x&32)!==0;let _=8;S===r&&(T&&(_+=8),A&&(_+=4),E&&(R=ut(v,_),_+=4),L&&(w=ut(v,_),_+=4),D&&(_+=4),e.type==="video"&&(a=lf(e.codec)),Et(m,["trun"]).map(k=>{const N=k[0],F=ut(k,0)&16777215,V=(F&1)!==0;let H=0;const J=(F&4)!==0,X=(F&256)!==0;let Q=0;const j=(F&512)!==0;let K=0;const Y=(F&1024)!==0,re=(F&2048)!==0;let B=0;const M=ut(k,4);let z=8;V&&(H=ut(k,z),z+=4),J&&(z+=4);let G=H+d;for(let de=0;de<M;de++){if(X?(Q=ut(k,z),z+=4):Q=R,j?(K=ut(k,z),z+=4):K=w,Y&&(z+=4),re&&(N===0?B=ut(k,z):B=rI(k,z),z+=4),e.type===as.VIDEO){let Te=0;for(;Te<K;){const pe=ut(s,G);if(G+=4,fk(a,s[G])){const Qe=s.subarray(G,G+pe);ry(Qe,a?2:1,n+B/i,t)}G+=pe,Te+=pe+4}}n+=Q/i}}))})})}),t}function lf(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function fk(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ry(n,e,t,s){const i=lI(n);let r=0;r+=e;let a=0,l=0,u=0;for(;r<i.length;){a=0;do{if(r>=i.length)break;u=i[r++],a+=u}while(u===255);l=0;do{if(r>=i.length)break;u=i[r++],l+=u}while(u===255);const d=i.length-r;let h=r;if(l<d)r+=l;else if(l>d){Wt.error(`Malformed SEI payload. ${l} is too small, only ${d} bytes left to parse.`);break}if(a===4){if(i[h++]===181){const g=iI(i,h);if(h+=2,g===49){const v=ut(i,h);if(h+=4,v===1195456820){const S=i[h++];if(S===3){const x=i[h++],T=31&x,A=64&x,E=A?2+T*3:0,R=new Uint8Array(E);if(A){R[0]=x;for(let L=1;L<E;L++)R[L]=i[h++]}s.push({type:S,payloadType:a,pts:t,bytes:R})}}}}}else if(a===5&&l>16){const m=[];for(let S=0;S<16;S++){const x=i[h++].toString(16);m.push(x.length==1?"0"+x:x),(S===3||S===5||S===7||S===9)&&m.push("-")}const g=l-16,v=new Uint8Array(g);for(let S=0;S<g;S++)v[S]=i[h++];s.push({payloadType:a,pts:t,uuid:m.join(""),userData:oi(v),userDataBytes:v})}}}function lI(n){const e=n.byteLength,t=[];let s=1;for(;s<e-2;)n[s]===0&&n[s+1]===0&&n[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return n;const i=e-t.length,r=new Uint8Array(i);let a=0;for(s=0;s<i;a++,s++)a===t[0]&&(a++,t.shift()),r[s]=n[a];return r}function mk(n){const e=n[0];let t="",s="",i=0,r=0,a=0,l=0,u=0,d=0;if(e===0){for(;Zs(n.subarray(d,d+1))!=="\0";)t+=Zs(n.subarray(d,d+1)),d+=1;for(t+=Zs(n.subarray(d,d+1)),d+=1;Zs(n.subarray(d,d+1))!=="\0";)s+=Zs(n.subarray(d,d+1)),d+=1;s+=Zs(n.subarray(d,d+1)),d+=1,i=ut(n,12),r=ut(n,16),l=ut(n,20),u=ut(n,24),d=28}else if(e===1){d+=4,i=ut(n,d),d+=4;const m=ut(n,d);d+=4;const g=ut(n,d);for(d+=4,a=2**32*m+g,zN(a)||(a=Number.MAX_SAFE_INTEGER,Wt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=ut(n,d),d+=4,u=ut(n,d),d+=4;Zs(n.subarray(d,d+1))!=="\0";)t+=Zs(n.subarray(d,d+1)),d+=1;for(t+=Zs(n.subarray(d,d+1)),d+=1;Zs(n.subarray(d,d+1))!=="\0";)s+=Zs(n.subarray(d,d+1)),d+=1;s+=Zs(n.subarray(d,d+1)),d+=1}const h=n.subarray(d,n.byteLength);return{schemeIdUri:t,value:s,timeScale:i,presentationTime:a,presentationTimeDelta:r,eventDuration:l,id:u,payload:h}}function pk(n,...e){const t=e.length;let s=8,i=t;for(;i--;)s+=e[i].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(n,4),i=0,s=8;i<t;i++)r.set(e[i],s),s+=e[i].byteLength;return r}function gk(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let s,i;s=0,i=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),pk([112,115,115,104],new Uint8Array([s,0,0,0]),n,r,i,a,t)}function yk(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let s=0;for(;s+32<t;){const i=new DataView(n,s),r=vk(i);e.push(r),s+=r.size}}return e}function vk(n){const e=n.getUint32(0),t=n.byteOffset,s=n.byteLength;if(s<e)return{offset:t,size:s};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const r=n.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const a=n.buffer,l=jn(new Uint8Array(a,t+12,16));let u=null,d=null,h=0;if(r===0)h=28;else{const g=n.getUint32(28);if(!g||s<32+g*16)return{offset:t,size:e};u=[];for(let v=0;v<g;v++)u.push(new Uint8Array(a,t+32+v*16,16));h=32+g*16}if(!h)return{offset:t,size:e};const m=n.getUint32(h);return e-32<m?{offset:t,size:e}:(d=new Uint8Array(a,t+h+4,m),{version:r,systemId:l,kids:u,data:d,offset:t,size:e})}const cI=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),hl={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ay(n,e){const t=hl[e];return!!t&&!!t[n.slice(0,4)]}function Kc(n,e,t=!0){return!n.split(",").some(s=>!oy(s,e,t))}function oy(n,e,t=!0){var s;const i=xa(t);return(s=i?.isTypeSupported(Yc(n,e)))!=null?s:!1}function Yc(n,e){return`${e}/mp4;codecs=${n}`}function Nb(n){if(n){const e=n.substring(0,4);return hl.video[e]}return 2}function Ph(n){const e=cI();return n.split(",").reduce((t,s)=>{const r=e&&lf(s)?9:hl.video[s];return r?(r*2+t)/(t?3:2):(hl.audio[s]+t)/(t?2:1)},0)}const Xp={};function xk(n,e=!0){if(Xp[n])return Xp[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var s;if(oy(t[i],"audio",e))return Xp[n]=t[i],t[i];if(t[i]==="mp3"&&(s=xa(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return n}const Sk=/flac|opus|mp4a\.40\.34/i;function Nh(n,e=!0){return n.replace(Sk,t=>xk(t.toLowerCase(),e))}function bk(n,e){const t=[];if(n){const s=n.split(",");for(let i=0;i<s.length;i++)ay(s[i],"video")||t.push(s[i])}return e&&t.push(e),t.join(",")}function gh(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(kb(n,"audio")||kb(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let s=t.length;s--;)if(t[s].substring(0,4)===n.substring(0,4))return t[s]}return t[0]}}return e||n}function kb(n,e){return ay(n,e)&&oy(n,e)}function Tk(n){const e=n.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Ek(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return n}function Mb(n){const e=xa(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function r0(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Ak={supported:!0,powerEfficient:!0,smooth:!0},Ik={supported:!1,smooth:!1,powerEfficient:!1},uI={supported:!0,configurations:[],decodingInfoResults:[Ak]};function dI(n,e){return{supported:!1,configurations:e,decodingInfoResults:[Ik],error:n}}function Rk(n,e,t,s,i,r){const a=n.videoCodec,l=n.audioCodec?n.audioGroups:null,u=r?.audioCodec,d=r?.channels,h=d?parseInt(d):u?1/0:2;let m=null;if(l!=null&&l.length)try{l.length===1&&l[0]?m=e.groups[l[0]].channels:m=l.reduce((g,v)=>{if(v){const S=e.groups[v];if(!S)throw new Error(`Audio track group ${v} not found`);Object.keys(S.channels).forEach(x=>{g[x]=(g[x]||0)+S.channels[x]})}return g},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(g=>lf(g))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(s,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!m&&je(h)&&Object.keys(m).some(g=>parseInt(g)>h)}function hI(n,e,t,s={}){const i=n.videoCodec;if(!i&&!n.audioCodec||!t)return Promise.resolve(uI);const r=[],a=wk(n),l=a.length,u=Ck(n,e,l>0),d=u.length;for(let h=l||1*d||1;h--;){const m={type:"media-source"};if(l&&(m.video=a[h%l]),d){m.audio=u[h%d];const g=m.audio.bitrate;m.video&&g&&(m.video.bitrate-=g)}r.push(m)}if(i){const h=navigator.userAgent;if(i.split(",").some(m=>lf(m))&&cI())return Promise.resolve(dI(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),r))}return Promise.all(r.map(h=>{const m=Dk(h);return s[m]||(s[m]=t.decodingInfo(h))})).then(h=>({supported:!h.some(m=>!m.supported),configurations:r,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:r,decodingInfoResults:[],error:h}))}function wk(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),s=fI(n),i=n.width||640,r=n.height||480,a=n.frameRate||30,l=n.videoRange.toLowerCase();return t?t.map(u=>{const d={contentType:Yc(Ek(u),"video"),width:i,height:r,bitrate:s,framerate:a};return l!=="sdr"&&(d.transferFunction=l),d}):[]}function Ck(n,e,t){var s;const i=(s=n.audioCodec)==null?void 0:s.split(","),r=fI(n);return i&&n.audioGroups?n.audioGroups.reduce((a,l)=>{var u;const d=l?(u=e.groups[l])==null?void 0:u.tracks:null;return d?d.reduce((h,m)=>{if(m.groupId===l){const g=parseFloat(m.channels||"");i.forEach(v=>{const S={contentType:Yc(v,"audio"),bitrate:t?Lk(v,r):r};g&&(S.channels=""+g),h.push(S)})}return h},a):a},[]):[]}function Lk(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function fI(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Dk(n){let e="";const{audio:t,video:s}=n;if(s){const i=r0(s.contentType);e+=`${i}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const i=r0(t.contentType);e+=`${s?"_":""}${i}_c${t.channels}`}return e}const a0=["NONE","TYPE-0","TYPE-1",null];function Ok(n){return a0.indexOf(n)>-1}const kh=["SDR","PQ","HLG"];function _k(n){return!!n&&kh.indexOf(n)>-1}var yh={No:"",Yes:"YES",v2:"v2"};function Ub(n){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=n,i=s<e/2;return e&&i?t?yh.v2:yh.Yes:yh.No}class Fb{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class qc{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Bb(this._audioGroups,e)}hasSubtitleGroup(e){return Bb(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Bb(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Pk(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Nk(n,e){let t=!1,s=[];if(n&&(t=n!=="SDR",s=[n]),e){s=e.allowedVideoRanges||kh.slice(0);const i=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&Pk(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const kk=n=>{const e=new WeakSet;return(t,s)=>{if(n&&(s=n(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},os=(n,e)=>JSON.stringify(n,kk(e));function Mk(n,e,t,s,i){const r=Object.keys(n),a=s?.channels,l=s?.audioCodec,u=i?.videoCodec,d=a&&parseInt(a)===2;let h=!1,m=!1,g=1/0,v=1/0,S=1/0,x=1/0,T=0,A=[];const{preferHDR:E,allowedVideoRanges:R}=Nk(e,i);for(let k=r.length;k--;){const N=n[r[k]];h||(h=N.channels[2]>0),g=Math.min(g,N.minHeight),v=Math.min(v,N.minFramerate),S=Math.min(S,N.minBitrate),R.filter(V=>N.videoRanges[V]>0).length>0&&(m=!0)}g=je(g)?g:0,v=je(v)?v:0;const L=Math.max(1080,g),w=Math.max(30,v);S=je(S)?S:t,t=Math.max(S,t),m||(e=void 0);const D=r.length>1;return{codecSet:r.reduce((k,N)=>{const F=n[N];if(N===k)return k;if(A=m?R.filter(V=>F.videoRanges[V]>0):[],D){if(F.minBitrate>t)return sr(N,`min bitrate of ${F.minBitrate} > current estimate of ${t}`),k;if(!F.hasDefaultAudio)return sr(N,"no renditions with default or auto-select sound found"),k;if(l&&N.indexOf(l.substring(0,4))%5!==0)return sr(N,`audio codec preference "${l}" not found`),k;if(a&&!d){if(!F.channels[a])return sr(N,`no renditions with ${a} channel sound found (channels options: ${Object.keys(F.channels)})`),k}else if((!l||d)&&h&&F.channels[2]===0)return sr(N,"no renditions with stereo sound found"),k;if(F.minHeight>L)return sr(N,`min resolution of ${F.minHeight} > maximum of ${L}`),k;if(F.minFramerate>w)return sr(N,`min framerate of ${F.minFramerate} > maximum of ${w}`),k;if(!A.some(V=>F.videoRanges[V]>0))return sr(N,`no variants with VIDEO-RANGE of ${os(A)} found`),k;if(u&&N.indexOf(u.substring(0,4))%5!==0)return sr(N,`video codec preference "${u}" not found`),k;if(F.maxScore<T)return sr(N,`max score of ${F.maxScore} < selected max of ${T}`),k}return k&&(Ph(N)>=Ph(k)||F.fragmentError>n[k].fragmentError)?k:(x=F.minIndex,T=F.maxScore,N)},void 0),videoRanges:A,preferHDR:E,minFramerate:v,minBitrate:S,minIndex:x}}function sr(n,e){Wt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function mI(n){return n.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Uk(n,e,t,s){return n.slice(t,s+1).reduce((i,r,a)=>{if(!r.codecSet)return i;const l=r.audioGroups;let u=i[r.codecSet];u||(i[r.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,r.bitrate);const d=Math.min(r.height,r.width);return u.minHeight=Math.min(u.minHeight,d),u.minFramerate=Math.min(u.minFramerate,r.frameRate),u.minIndex=Math.min(u.minIndex,a),u.maxScore=Math.max(u.maxScore,r.score),u.fragmentError+=r.fragmentError,u.videoRanges[r.videoRange]=(u.videoRanges[r.videoRange]||0)+1,l&&l.forEach(h=>{if(!h)return;const m=e.groups[h];m&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(g=>{u.channels[g]=(u.channels[g]||0)+m.channels[g]}))}),i},{})}function jb(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}=n;return{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}}function or(n,e,t){if("attrs"in n){const s=e.indexOf(n);if(s!==-1)return s}for(let s=0;s<e.length;s++){const i=e[s];if(Za(n,i,t))return s}return-1}function Za(n,e,t){const{groupId:s,name:i,lang:r,assocLang:a,default:l}=n,u=n.forced;return(s===void 0||e.groupId===s)&&(i===void 0||e.name===i)&&(r===void 0||Fk(r,e.lang))&&(r===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(u===void 0||e.forced===u)&&(!("characteristics"in n)||Bk(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function Fk(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function Bk(n,e=""){const t=n.split(","),s=e.split(",");return t.length===s.length&&!t.some(i=>s.indexOf(i)===-1)}function Ka(n,e){const{audioCodec:t,channels:s}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function jk(n,e,t,s,i){const r=e[s],l=e.reduce((g,v,S)=>{const x=v.uri;return(g[x]||(g[x]=[])).push(S),g},{})[r.uri];l.length>1&&(s=Math.max.apply(Math,l));const u=r.videoRange,d=r.frameRate,h=r.codecSet.substring(0,4),m=Vb(e,s,g=>{if(g.videoRange!==u||g.frameRate!==d||g.codecSet.substring(0,4)!==h)return!1;const v=g.audioGroups,S=t.filter(x=>!v||v.indexOf(x.groupId)!==-1);return or(n,S,i)>-1});return m>-1?m:Vb(e,s,g=>{const v=g.audioGroups,S=t.filter(x=>!v||v.indexOf(x.groupId)!==-1);return or(n,S,i)>-1})}function Vb(n,e,t){for(let s=e;s>-1;s--)if(t(n[s]))return s;for(let s=e+1;s<n.length;s++)if(t(n[s]))return s;return-1}function Mh(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class Vk extends Oi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:i,partCurrent:r,hls:a}=this,{autoLevelEnabled:l,media:u}=a;if(!i||!u)return;const d=performance.now(),h=r?r.stats:i.stats,m=r?r.duration:i.duration,g=d-h.loading.start,v=a.minAutoLevel,S=i.level,x=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||S<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;const T=x>-1&&x!==S,A=!!t||T;if(!A&&(u.paused||!u.playbackRate||!u.readyState))return;const E=a.mainForwardBufferInfo;if(!A&&E===null)return;const R=this.bwEstimator.getEstimateTTFB(),L=Math.abs(u.playbackRate);if(g<=Math.max(R,1e3*(m/(L*2))))return;const w=E?E.len/L:0,D=h.loading.first?h.loading.first-h.loading.start:-1,_=h.loaded&&D>-1,k=this.getBwEstimate(),N=a.levels,F=N[S],V=Math.max(h.loaded,Math.round(m*(i.bitrate||F.averageBitrate)/8));let H=_?g-D:g;H<1&&_&&(H=Math.min(g,h.loaded*8/k));const J=_?h.loaded*1e3/H:0,X=R/1e3,Q=J?(V-h.loaded)/J:V*8/k+X;if(Q<=w)return;const j=J?J*8:k,K=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,Y=this.hls.config.abrBandWidthUpFactor;let re=Number.POSITIVE_INFINITY,B;for(B=S-1;B>v;B--){const de=N[B].maxBitrate,Te=!N[B].details||K;if(re=this.getTimeToLoadFrag(X,j,m*de,Te),re<Math.min(w,m+X))break}if(re>=Q||re>m*10)return;_?this.bwEstimator.sample(g-Math.min(R,D),h.loaded):this.bwEstimator.sampleTTFB(g);const M=N[B].maxBitrate;this.getBwEstimate()*Y>M&&this.resetEstimator(M);const z=this.findBestLevel(M,v,B,0,w,1,1);z>-1&&(B=z),this.warn(`Fragment ${i.sn}${r?" part "+r.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${Q.toFixed(3)} s
      Estimated load time for down switch fragment: ${re.toFixed(3)} s
      TTFB estimate: ${D|0} ms
      Current BW estimate: ${je(k)?k|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${B} @ ${M|0} bps`),a.nextLoadLevel=a.nextAutoLevel=B,this.clearTimer();const G=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===B&&B>0){const de=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${B>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${de.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,B>v){let Te=this.findBestLevel(this.hls.levels[v].bitrate,v,B,0,de,1,1);Te===-1&&(Te=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Te,this.resetEstimator(this.hls.levels[Te].bitrate)}}};T||Q>re*2?G():this.timer=self.setInterval(G,re*1e3),a.trigger(O.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:r,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new YN(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(O.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var i;this.fragCurrent=s,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case te.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:i,partCurrent:r}=this;if(s&&i&&s.sn===i.sn&&s.level===i.level){const a=performance.now(),l=r?r.stats:s.stats,u=a-l.loading.start,d=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&d>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(m,d),l.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,s,i){const r=e+s/t,a=i?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;je(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===$e.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,a=this.hls.levels[t.level],l=(a.loaded?a.loaded.bytes:0)+i.loaded,u=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:l,duration:u},a.realBitrate=Math.round(8*l/u)}if(t.bitrateTest){const r={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(O.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=i!=null&&i.stats.loaded?i.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==$e.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,l=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=s,l=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),d=this.getStarvationDelay();let h=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(d){const T=this.findBestLevel(u,a,i,d,0,h,m);if(T>=0)return this.rebufferNotice=-1,T}let g=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay;if(!d){const T=this.bitrateTestDelay;T&&(g=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),h=m=1)}const v=this.findBestLevel(u,a,i,d,g,h,m);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const S=s.levels[a],x=s.loadLevelObj;return x&&S?.bitrate<x.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,a,l){var u;const d=i+r,h=this.lastLoadedFragLevel,m=h===-1?this.hls.firstLevel:h,{fragCurrent:g,partCurrent:v}=this,{levels:S,allAudioTracks:x,loadLevel:T,config:A}=this.hls;if(S.length===1)return 0;const E=S[m],R=!!((u=this.hls.latestLevelDetails)!=null&&u.live),L=T===-1||h===-1;let w,D="SDR",_=E?.frameRate||0;const{audioPreference:k,videoPreference:N}=A,F=this.audioTracksByGroup||(this.audioTracksByGroup=mI(x));let V=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const j=this.codecTiers||(this.codecTiers=Uk(S,F,t,s)),K=Mk(j,D,e,k,N),{codecSet:Y,videoRanges:re,minFramerate:B,minBitrate:M,minIndex:z,preferHDR:G}=K;V=z,w=Y,D=G?re[re.length-1]:re[0],_=B,e=Math.max(e,M),this.log(`picked start tier ${os(K)}`)}else w=E?.codecSet,D=E?.videoRange;const H=v?v.duration:g?g.duration:0,J=this.bwEstimator.getEstimateTTFB()/1e3,X=[];for(let j=s;j>=t;j--){var Q;const K=S[j],Y=j>m;if(!K)continue;if(A.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const Te=navigator.mediaCapabilities;typeof Te?.decodingInfo=="function"&&Rk(K,F,D,_,e,k)?(K.supportedPromise=hI(K,F,Te,this.supportedCache),K.supportedPromise.then(pe=>{if(!this.hls)return;K.supportedResult=pe;const Qe=this.hls.levels,ce=Qe.indexOf(K);pe.error?this.warn(`MediaCapabilities decodingInfo error: "${pe.error}" for level ${ce} ${os(pe)}`):pe.supported?pe.decodingInfoResults.some(Oe=>Oe.smooth===!1||Oe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ce} not smooth or powerEfficient: ${os(pe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ce} ${os(pe)}`),ce>-1&&Qe.length>1&&(this.log(`Removing unsupported level ${ce}`),this.hls.removeLevel(ce),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(pe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${pe}`)})):K.supportedResult=uI}if((w&&K.codecSet!==w||D&&K.videoRange!==D||Y&&_>K.frameRate||!Y&&_>0&&_<K.frameRate||(Q=K.supportedResult)!=null&&(Q=Q.decodingInfoResults)!=null&&Q.some(Te=>Te.smooth===!1))&&(!L||j!==V)){X.push(j);continue}const re=K.details,B=(v?re?.partTarget:re?.averagetargetduration)||H;let M;Y?M=l*e:M=a*e;const z=H&&i>=H*2&&r===0?K.averageBitrate:K.maxBitrate,G=this.getTimeToLoadFrag(J,M,z*B,re===void 0);if(M>=z&&(j===h||K.loadError===0&&K.fragmentError===0)&&(G<=J||!je(G)||R&&!this.bitrateTestDelay||G<d)){const Te=this.forcedAutoLevel;return j!==T&&(Te===-1||Te!==T)&&(X.length&&this.trace(`Skipped level(s) ${X.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[X[0]].codecs}" ${S[X[0]].videoRange}; not compatible with "${w}" ${D}`),this.info(`switch candidate:${m}->${j} adjustedbw(${Math.round(M)})-bitrate=${Math.round(M-z)} ttfb:${J.toFixed(1)} avgDuration:${B.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${G.toFixed(1)} firstSelection:${L} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${T}`)),L&&(this.firstSelection=j),j}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const pI={search:function(n,e){let t=0,s=n.length-1,i=null,r=null;for(;t<=s;){i=(t+s)/2|0,r=n[i];const a=e(r);if(a>0)t=i+1;else if(a<0)s=i-1;else return r}return null}};function $k(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!je(e))return null;const s=n[0].programDateTime;if(e<(s||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let r=0;r<n.length;++r){const a=n[r];if(Hk(e,t,a))return a}return null}function to(n,e,t=0,s=0,i=.005){let r=null;if(n){r=e[1+n.sn-e[0].sn]||null;const l=n.endDTS-t;l>0&&l<15e-7&&(t+=15e-7),r&&n.level!==r.level&&r.end<=n.end&&(r=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!n||n.level===r.level)&&$b(t,s,r)===0||Gk(r,n,Math.min(i,s))))return r;const a=pI.search(e,$b.bind(null,t,s));return a&&(a!==n||!r)?a:r}function Gk(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((i,r)=>(r[0]==="INF"&&(i+=parseFloat(r[1])),i),t);return n.start<=s}return!1}function $b(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=n?1:t.start-s>n&&t.start?-1:0}function Hk(n,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>n}function gI(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let s=n.fragments;const{fragmentHint:i}=n;i&&(s=s.concat(i));let r;return pI.search(s,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=t?1:a.start>t?-1:0)),r||null}return null}function Uh(n){switch(n.details){case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_TIMEOUT:case te.LEVEL_LOAD_TIMEOUT:case te.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function yI(n){return n.details.startsWith("key")}function vI(n){return yI(n)&&!!n.frag&&!n.frag.decryptdata}function Gb(n,e){const t=Uh(e);return n.default[`${t?"timeout":"error"}Retry`]}function ly(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Hb(n){return Xt(Xt({},n),{errorRetry:null,timeoutRetry:null})}function Fh(n,e,t,s){if(!n)return!1;const i=s?.code,r=e<n.maxNumRetry&&(zk(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,s,r):r}function zk(n){return o0(n)||!!n&&(n<400||n>499)}function o0(n){return n===0&&navigator.onLine===!1}var pn={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ni={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Kk extends Oi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.ERROR,this.onError,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.ERROR,this.onError,this),e.off(O.ERROR,this.onErrorOut,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===$e.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var l;return(l=a.details)==null?void 0:l.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case te.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=il();return}case te.FRAG_GAP:case te.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=pn.SendAlternateToPenaltyBox;return}case te.LEVEL_EMPTY_ERROR:case te.LEVEL_PARSING_ERROR:{var a;const u=t.parent===$e.MAIN?t.level:i.loadLevel;t.details===te.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case te.LEVEL_LOAD_ERROR:case te.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case te.AUDIO_TRACK_LOAD_ERROR:case te.AUDIO_TRACK_LOAD_TIMEOUT:case te.SUBTITLE_LOAD_ERROR:case te.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const u=i.loadLevelObj;if(u&&(r.type===wt.AUDIO_TRACK&&u.hasAudioGroup(r.groupId)||r.type===wt.SUBTITLE_TRACK&&u.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=pn.SendAlternateToPenaltyBox,t.errorAction.flags=ni.MoveAllAlternatesMatchingHost;return}}return;case te.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:pn.SendAlternateToPenaltyBox,flags:ni.MoveAllAlternatesMatchingHDCP};return;case te.KEY_SYSTEM_SESSION_UPDATE_FAILED:case te.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case te.KEY_SYSTEM_NO_SESSION:t.errorAction={action:pn.SendAlternateToPenaltyBox,flags:ni.MoveAllAlternatesMatchingKey};return;case te.BUFFER_ADD_CODEC_ERROR:case te.REMUX_ALLOC_ERROR:case te.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:i.loadLevel)}return;case te.INTERNAL_EXCEPTION:case te.BUFFER_APPENDING_ERROR:case te.BUFFER_FULL_ERROR:case te.LEVEL_SWITCH_ERROR:case te.BUFFER_STALLED_ERROR:case te.BUFFER_SEEK_OVER_HOLE:case te.BUFFER_NUDGE_ON_STALL:t.errorAction=il();return}t.type===qe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=il())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,i=Gb(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(Fh(i,r,Uh(e),e.response))return{action:pn.RetryRequest,flags:ni.None,retryConfig:i,retryCount:r};const l=this.getLevelSwitchAction(e,t);return i&&(l.retryConfig=i,l.retryCount=r),l}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,l=Gb(yI(e)?a:r,e),u=t.levels.reduce((h,m)=>h+m.fragmentError,0);if(i&&(e.details!==te.FRAG_GAP&&i.fragmentError++,!vI(e)&&Fh(l,u,Uh(e),e.response)))return{action:pn.RetryRequest,flags:ni.None,retryConfig:l,retryCount:u};const d=this.getLevelSwitchAction(e,s);return l&&(d.retryConfig=l,d.retryCount=u),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const d=e.details;i.loadError++,d===te.BUFFER_APPEND_ERROR&&i.fragmentError++;let h=-1;const{levels:m,loadLevel:g,minAutoLevel:v,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const x=(r=e.frag)==null?void 0:r.type,A=(x===$e.AUDIO&&d===te.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===te.BUFFER_ADD_CODEC_ERROR||d===te.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:D})=>i.audioCodec!==D),R=e.sourceBufferName==="video"&&(d===te.BUFFER_ADD_CODEC_ERROR||d===te.BUFFER_APPEND_ERROR)&&m.some(({codecSet:D,audioCodec:_})=>i.codecSet!==D&&i.audioCodec===_),{type:L,groupId:w}=(a=e.context)!=null?a:{};for(let D=m.length;D--;){const _=(D+g)%m.length;if(_!==g&&_>=v&&_<=S&&m[_].loadError===0){var l,u;const k=m[_];if(d===te.FRAG_GAP&&x===$e.MAIN&&e.frag){const N=m[_].details;if(N){const F=to(e.frag,N.fragments,e.frag.start);if(F!=null&&F.gap)continue}}else{if(L===wt.AUDIO_TRACK&&k.hasAudioGroup(w)||L===wt.SUBTITLE_TRACK&&k.hasSubtitleGroup(w))continue;if(x===$e.AUDIO&&(l=i.audioGroups)!=null&&l.some(N=>k.hasAudioGroup(N))||x===$e.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(N=>k.hasSubtitleGroup(N))||A&&i.audioCodec===k.audioCodec||R&&i.codecSet===k.codecSet||!A&&i.codecSet!==k.codecSet)continue}h=_;break}}if(h>-1&&s.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:pn.SendAlternateToPenaltyBox,flags:ni.None,nextAutoLevel:h}}return{action:pn.SendAlternateToPenaltyBox,flags:ni.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case pn.DoNothing:break;case pn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==te.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i}=s,r=s.nextAutoLevel;switch(i){case ni.None:this.switchLevel(e,r);break;case ni.MoveAllAlternatesMatchingHDCP:{const u=this.getVariantLevelIndex(e.frag),d=t.levels[u],h=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=a0[a0.indexOf(h)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ni.MoveAllAlternatesMatchingKey:{const u=e.decryptdata;if(u){const d=this.hls.levels,h=d.length;for(let g=h;g--;)if(this.variantHasKey(d[g],u)){var a,l;this.log(`Banned key found in level ${g} (${d[g].bitrate}bps) or audio group "${(a=d[g].audioGroups)==null?void 0:a.join(",")}" (${(l=e.frag)==null?void 0:l.type} fragment) ${jn(u.keyId||[])}`),d[g].fragmentError++,d[g].loadError++,this.log(`Removing level ${g} with key error (${e.error})`),this.hls.removeLevel(g)}const m=e.frag;if(this.hls.levels.length<h)s.resolved=!0;else if(m&&m.type!==$e.MAIN){const g=m.decryptdata;g&&!u.matches(g)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===te.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=r0(e.mimeType),i=this.hls.levels;for(let r=i.length;r--;)i[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function il(n){const e={action:pn.DoNothing,flags:ni.None};return n&&(e.resolved=!0),e}var en={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Yk{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const r=s[i];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const l=i[r[a]];if(l?.body.type===t&&(!s||l.buffered)){const u=l.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{const u=this.fragments[l];if(!u||a>=u.body.sn)return;if(!u.buffered&&(!u.loaded||r)){u.body.type===s&&this.removeFragment(u.body);return}const d=u.range[e];if(d){if(d.time.length===0){this.removeFragment(u.body);return}d.time.some(h=>{const m=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return m&&this.removeFragment(u.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,i=Qo(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const a=!s.relurl;Object.keys(t).forEach(l=>{const u=s.elementaryStreams[l];if(!u)return;const d=t[l],h=a||u.partial===!0;r.range[l]=this.getBufferedTimes(s,e.part,h,d)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),zd(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=zb(s,i=>i.fragment.sn>=e))}fragBuffered(e,t){const s=Qo(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},a=e.start,l=e.end,u=e.minEndPTS||l,d=e.maxStartPTS||a;for(let h=0;h<i.length;h++){const m=i.start(h)-this.bufferPadding,g=i.end(h)+this.bufferPadding;if(d>=m&&u<=g){r.time.push({startPTS:Math.max(a,i.start(h)),endPTS:Math.min(l,i.end(h))});break}else if(a<g&&l>m){const v=Math.max(a,i.start(h)),S=Math.min(l,i.end(h));S>v&&(r.partial=!0,r.time.push({startPTS:v,endPTS:S}))}else if(l<=m)break}return r}getPartialFragment(e){let t=null,s,i,r,a=0;const{bufferPadding:l,fragments:u}=this;return Object.keys(u).forEach(d=>{const h=u[d];h&&zd(h)&&(i=h.body.start-l,r=h.body.end+l,e>=i&&e<=r&&(s=Math.min(e-i,r-e),a<=s&&(t=h.body,a=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||zd(t))}getState(e){const t=Qo(e),s=this.fragments[t];return s?s.buffered?zd(s)?en.PARTIAL:en.OK:en.APPENDING:en.NOT_LOADED}isTimeBuffered(e,t,s){let i,r;for(let a=0;a<s.length;a++){if(i=s.start(a)-this.bufferPadding,r=s.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=Qo(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:a}=t;if(s.sn==="initSegment")return;const l=s.type;if(i){let d=this.activePartLists[l];d||(this.activePartLists[l]=d=[]),d.push(i)}this.timeRanges=r;const u=r[a];this.detectEvictedFragments(a,u,l,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Qo(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l)return;const u=l.body;u.type!==s||i&&!u.gap||u.start<t&&u.end>e&&(l.buffered||r)&&this.removeFragment(u)})}removeFragment(e){const t=Qo(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const i=e.sn;this.activePartLists[e.type]=zb(s,r=>r.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function zd(n){var e,t,s;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(s=n.range.audiovideo)!=null&&s.partial)}function Qo(n){return`${n.type}_${n.level}_${n.sn}`}function zb(n,e){return n.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Sa={cbc:0,ctr:1};class qk{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Sa.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Sa.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Qk(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class Xk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(i*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],a=s[2],l=s[3],u=this.invSubMix,d=u[0],h=u[1],m=u[2],g=u[3],v=new Uint32Array(256);let S=0,x=0,T=0;for(T=0;T<256;T++)T<128?v[T]=T<<1:v[T]=T<<1^283;for(T=0;T<256;T++){let A=x^x<<1^x<<2^x<<3^x<<4;A=A>>>8^A&255^99,e[S]=A,t[A]=S;const E=v[S],R=v[E],L=v[R];let w=v[A]*257^A*16843008;i[S]=w<<24|w>>>8,r[S]=w<<16|w>>>16,a[S]=w<<8|w>>>24,l[S]=w,w=L*16843009^R*65537^E*257^S*16843008,d[A]=w<<24|w>>>8,h[A]=w<<16|w>>>16,m[A]=w<<8|w>>>24,g[A]=w,S?(S=E^v[v[v[L^E]]],x^=v[v[x]]):S=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let l,u;const d=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),m=this.sBox,g=this.rcon,v=this.invSubMix,S=v[0],x=v[1],T=v[2],A=v[3];let E,R;for(l=0;l<a;l++){if(l<r){E=d[l]=t[l];continue}R=E,l%r===0?(R=R<<8|R>>>24,R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255],R^=g[l/r|0]<<24):r>6&&l%r===4&&(R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255]),d[l]=E=(d[l-r]^R)>>>0}for(u=0;u<a;u++)l=a-u,u&3?R=d[l]:R=d[l-4],u<4||l<=4?h[u]=R:h[u]=S[m[R>>>24]]^x[m[R>>>16&255]]^T[m[R>>>8&255]]^A[m[R&255]],h[u]=h[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],h=l[2],m=l[3],g=this.uint8ArrayToUint32Array_(s);let v=g[0],S=g[1],x=g[2],T=g[3];const A=new Int32Array(e),E=new Int32Array(A.length);let R,L,w,D,_,k,N,F,V,H,J,X,Q,j;const K=this.networkToHostOrderSwap;for(;t<A.length;){for(V=K(A[t]),H=K(A[t+1]),J=K(A[t+2]),X=K(A[t+3]),_=V^r[0],k=X^r[1],N=J^r[2],F=H^r[3],Q=4,j=1;j<i;j++)R=u[_>>>24]^d[k>>16&255]^h[N>>8&255]^m[F&255]^r[Q],L=u[k>>>24]^d[N>>16&255]^h[F>>8&255]^m[_&255]^r[Q+1],w=u[N>>>24]^d[F>>16&255]^h[_>>8&255]^m[k&255]^r[Q+2],D=u[F>>>24]^d[_>>16&255]^h[k>>8&255]^m[N&255]^r[Q+3],_=R,k=L,N=w,F=D,Q=Q+4;R=a[_>>>24]<<24^a[k>>16&255]<<16^a[N>>8&255]<<8^a[F&255]^r[Q],L=a[k>>>24]<<24^a[N>>16&255]<<16^a[F>>8&255]<<8^a[_&255]^r[Q+1],w=a[N>>>24]<<24^a[F>>16&255]<<16^a[_>>8&255]<<8^a[k&255]^r[Q+2],D=a[F>>>24]<<24^a[_>>16&255]<<16^a[k>>8&255]<<8^a[N&255]^r[Q+3],E[t]=K(R^v),E[t+1]=K(D^S),E[t+2]=K(w^x),E[t+3]=K(L^T),v=V,S=H,x=J,T=X,t=t+4}return E.buffer}}class Wk{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=Zk(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Zk(n){switch(n){case Sa.cbc:return"AES-CBC";case Sa.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const Jk=16;class cy{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Qk(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise((r,a)=>{const l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,t,s,i);const u=this.flush();u?r(u.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:a,remainderData:l}=this;if(i!==Sa.cbc||t.byteLength!==16)return Wt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=Ci(l,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;r&&(s=r);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Xk),d.expandKey(t);const h=a;return this.currentResult=d.decrypt(u.buffer,0,s),this.currentIV=u.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new Wk(this.subtle,t,i)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new qk(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Wt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i)))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%Jk;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Wt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Kb=Math.pow(2,17);class eM{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Pr({type:qe.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((l,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){u(qb(e));return}else e.gap=!1;const d=this.loader=r?new r(i):new a(i),h=Yb(e);e.loader=d;const m=Hb(i.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Kb};e.stats=d.stats;const v={onSuccess:(S,x,T,A)=>{this.resetLoader(e,d);let E=S.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),l({frag:e,part:null,payload:E,networkDetails:A})},onError:(S,x,T,A)=>{this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Xt({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:T,stats:A}))},onAbort:(S,x,T)=>{this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:S}))},onTimeout:(S,x,T)=>{this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:T,stats:S}))}};t&&(v.onProgress=(S,x,T,A)=>t({frag:e,part:null,payload:T,networkDetails:A})),d.load(h,g,v)})}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((l,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(qb(e,t));return}const d=this.loader=r?new r(i):new a(i),h=Yb(e,t);e.loader=d;const m=Hb(i.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Kb};t.stats=d.stats,d.load(h,g,{onSuccess:(v,S,x,T)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:v.data,networkDetails:T};s(A),l(A)},onError:(v,S,x,T)=>{this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Xt({url:h.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:x,stats:T}))},onAbort:(v,S,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:v}))},onTimeout:(v,S,x)=>{this.resetLoader(e,d),u(new Pr({type:qe.NETWORK_ERROR,details:te.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:x,stats:v}))}})})}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const u=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/r),u),m=(u-d)*Math.round(s.loaded/d);s.total=s.loaded+m}else s.total=Math.max(s.loaded,s.total);const a=s.loading,l=i.loading;a.start?a.first+=l.first-l.start:(a.start=l.start,a.first=l.first),a.end=l.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Yb(n,e=null){const t=e||n,s={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(je(i)&&je(r)){var a;let l=i,u=r;if(n.sn==="initSegment"&&tM((a=n.decryptdata)==null?void 0:a.method)){const d=r-i;d%16&&(u=r+(16-d%16)),i!==0&&(s.resetIV=!0,l=i-16)}s.rangeStart=l,s.rangeEnd=u}return s}function qb(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),s={type:qe.MEDIA_ERROR,details:te.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(s.part=e),(e||n).stats.aborted=!0,new Pr(s)}function tM(n){return n==="AES-128"||n==="AES-256"}class Pr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class xI extends Oi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class uy{constructor(e,t,s,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Kd(),this.buffering={audio:Kd(),video:Kd(),audiovideo:Kd()},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=a}}function Kd(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Qb={length:0,start:()=>0,end:()=>0};class ft{static isBuffered(e,t){if(e){const s=ft.getBuffered(e);for(let i=s.length;i--;)if(t>=s.start(i)&&t<=s.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=ft.getBuffered(e);return ft.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=ft.bufferedRanges(e);if(i.length)return ft.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((h,m)=>h.start-m.start||m.end-h.end);let i=-1,r=[];if(s)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(i=h);const m=r.length;if(m){const g=r[m-1].end;e[h].start-g<s?e[h].end>g&&(r[m-1].end=e[h].end):r.push(e[h])}else r.push(e[h])}else r=e;let a=0,l,u=t,d=t;for(let h=0;h<r.length;h++){const m=r[h].start,g=r[h].end;if(i===-1&&t>=m&&t<=g&&(i=h),t+s>=m&&t<g)u=m,d=g,a=d-t;else if(t+s<m){l=m;break}}return{len:a,start:u||0,end:d||0,nextStart:l,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Qb}catch(t){return Wt.log("failed to get media.buffered",t),Qb}}}const SI=/\{\$([a-zA-Z0-9-_]+)\}/g;function Xb(n){return SI.test(n)}function l0(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(SI,s=>{const i=s.substring(2,s.length-1),r=t?.[i];return r===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),s):r})}return e}function Wb(n,e,t){let s=n.variableList;s||(n.variableList=s={});let i,r;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))r=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,r=e.VALUE;i in s?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=r||""}function sM(n,e,t){const s=e.IMPORT;if(t&&s in t){let i=n.variableList;i||(n.variableList=i={}),i[s]=t[s]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const nM=/^(\d+)x(\d+)$/,Zb=/(.+?)=(".*?"|.*?)(?:,|$)/g;class As{constructor(e,t){typeof e=="string"&&(e=As.parseAttrList(e,t)),ts(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)s[i]=parseInt(t.slice(i*2,i*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((i,r)=>(i[r.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=nM.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(Zb.lastIndex=0;(s=Zb.exec(e))!==null;){const a=s[1].trim();let l=s[2];const u=l.indexOf('"')===0&&l.lastIndexOf('"')===l.length-1;let d=!1;if(u)l=l.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(u||d))l=l0(t,l);else if(!d&&!u)switch(a){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Wt.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=l}return i}}const iM="com.apple.hls.interstitial";function rM(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function aM(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class bI{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(i=t?.tagOrder)!=null?i:s,t){const r=t.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){Wt.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=ts(new As({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);je(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Wt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(je(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===iM}get isValid(){return!!this.id&&!this._badValueForSameId&&je(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const oM=10;class lM{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?je(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||oM}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function dy(n,e){return n.length===e.length?!n.some((t,s)=>t!==e[s]):!1}function Jb(n,e){return!n&&!e?!0:!n||!e?!1:dy(n,e)}function rl(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function hy(n){switch(n){case"AES-128":case"AES-256":return Sa.cbc;case"AES-256-CTR":return Sa.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function fy(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function c0(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function cM(n){const e=c0(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function TI(n){const e=function(s,i,r){const a=s[i];s[i]=s[r],s[r]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function uM(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),i=s[s.length-1].split(",");if(i.length===2){const r=i[0]==="base64",a=i[1];r?(s.splice(-1,1),t=fy(a)):t=cM(a)}}return t}const Bh=typeof self<"u"?self:void 0;var Is={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Cn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vh(n){switch(n){case Cn.FAIRPLAY:return Is.FAIRPLAY;case Cn.PLAYREADY:return Is.PLAYREADY;case Cn.WIDEVINE:return Is.WIDEVINE;case Cn.CLEARKEY:return Is.CLEARKEY}}function Wp(n){switch(n){case Is.FAIRPLAY:return Cn.FAIRPLAY;case Is.PLAYREADY:return Cn.PLAYREADY;case Is.WIDEVINE:return Cn.WIDEVINE;case Is.CLEARKEY:return Cn.CLEARKEY}}function Pc(n){const{drmSystems:e,widevineLicenseUrl:t}=n,s=e?[Is.FAIRPLAY,Is.WIDEVINE,Is.PLAYREADY,Is.CLEARKEY].filter(i=>!!e[i]):[];return!s[Is.WIDEVINE]&&t&&s.push(Is.WIDEVINE),s}const EI=(function(n){return Bh!=null&&(n=Bh.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function dM(n,e,t,s){let i;switch(n){case Is.FAIRPLAY:i=["cenc","sinf"];break;case Is.WIDEVINE:case Is.PLAYREADY:i=["cenc"];break;case Is.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return hM(i,e,t,s)}function hM(n,e,t,s){return[{initDataTypes:n,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function fM(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function mM(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(a){const l=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(l){const u=fy(l).subarray(0,16);return TI(u),u}}return null}let Yd={};class Qc{static clearKeyUriToKeyIdMap(){Yd={}}static setKeyIdForUri(e,t){Yd[e]=t}constructor(e,t,s,i=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!rl(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(eI(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&dy(e.keyFormatVersions,this.keyFormatVersions)&&Jb(e.iv,this.iv)&&Jb(e.keyId,this.keyId)}isSupported(){if(this.method){if(rl(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Cn.FAIRPLAY:case Cn.WIDEVINE:case Cn.PLAYREADY:case Cn.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(rl(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Wt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=pM(e)),new Qc(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;const t=uM(this.uri);if(t)switch(this.keyFormat){case Cn.WIDEVINE:if(this.pssh=t,!this.keyId){const i=yk(t.buffer);if(i.length){var s;const r=i[0];this.keyId=(s=r.kids)!=null&&s.length?r.kids[0]:null}}if(!this.keyId){const i=t.length-22;this.keyId=t.subarray(i,i+16)}break;case Cn.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=gk(i,null,t),this.keyId=mM(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Yd[this.uri];if(!i){const r=Object.keys(Yd).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),Qc.setKeyIdForUri(this.uri,i)}this.keyId=i}return this}}function pM(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const eT=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,tT=/#EXT-X-MEDIA:(.*)/g,gM=/^#EXT(?:INF|-X-TARGETDURATION):/m,Zp=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),yM=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class lr{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return ny.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return gM.test(e)}static parseMasterPlaylist(e,t){const s=Xb(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(eT.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=eT.exec(e))!=null;)if(a[1]){var l;const d=new As(a[1],i),h=l0(i,a[2]),m={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:lr.resolve(h,t)},g=d.decimalResolution("RESOLUTION");g&&(m.width=g.width,m.height=g.height),iT(d.CODECS,m);const v=d["SUPPLEMENTAL-CODECS"];v&&(m.supplemental={},iT(v,m.supplemental)),(l=m.unknownCodecs)!=null&&l.length||r.push(m),i.levels.push(m)}else if(a[3]){const d=a[3],h=a[4];switch(d){case"SESSION-DATA":{const m=new As(h,i),g=m["DATA-ID"];g&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[g]=m);break}case"SESSION-KEY":{const m=sT(h,t,i);m.encrypted&&m.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(m)):Wt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const m=new As(h,i);Wb(i,m,t)}break}case"CONTENT-STEERING":{const m=new As(h,i);i.contentSteering={uri:lr.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=nT(h);break}}}const u=r.length>0&&r.length<i.levels.length;return i.levels=u?r:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,s){let i;const r={},a=s.levels,l={AUDIO:a.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:a.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(tT.lastIndex=0;(i=tT.exec(e))!==null;){const d=new As(i[1],s),h=d.TYPE;if(h){const m=l[h],g=r[h]||[];r[h]=g;const v=d.LANGUAGE,S=d["ASSOC-LANGUAGE"],x=d.CHANNELS,T=d.CHARACTERISTICS,A=d["INSTREAM-ID"],E={attrs:d,bitrate:0,id:u++,groupId:d["GROUP-ID"]||"",name:d.NAME||v||"",type:h,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:v,url:d.URI?lr.resolve(d.URI,t):""};if(S&&(E.assocLang=S),x&&(E.channels=x),T&&(E.characteristics=T),A&&(E.instreamId=A),m!=null&&m.length){const R=lr.findGroup(m,E.groupId)||m[0];rT(E,R,"audioCodec"),rT(E,R,"textCodec")}g.push(E)}}return r}static parseLevelPlaylist(e,t,s,i,r,a){var l;const u={url:t},d=new lM(t),h=d.fragments,m=[];let g=null,v=0,S=0,x=0,T=0,A=0,E=null,R=new qp(i,u),L,w,D,_=-1,k=!1,N=null,F;if(Zp.lastIndex=0,d.m3u8=e,d.hasVariableRefs=Xb(e),((l=Zp.exec(e))==null?void 0:l[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(L=Zp.exec(e))!==null;){k&&(k=!1,R=new qp(i,u),R.playlistOffset=x,R.setStart(x),R.sn=v,R.cc=T,A&&(R.bitrate=A),R.level=s,g&&(R.initSegment=g,g.rawProgramDateTime&&(R.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),N&&(R.setByteRange(N),N=null)));const X=L[1];if(X){R.duration=parseFloat(X);const Q=(" "+L[2]).slice(1);R.title=Q||null,R.tagList.push(Q?["INF",X,Q]:["INF",X])}else if(L[3]){if(je(R.duration)){R.playlistOffset=x,R.setStart(x),D&&oT(R,D,d),R.sn=v,R.level=s,R.cc=T,h.push(R);const Q=(" "+L[3]).slice(1);R.relurl=l0(d,Q),u0(R,E,m),E=R,x+=R.duration,v++,S=0,k=!0}}else{if(L=L[0].match(yM),!L){Wt.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<L.length&&L[w]===void 0;w++);const Q=(" "+L[w]).slice(1),j=(" "+L[w+1]).slice(1),K=L[w+2]?(" "+L[w+2]).slice(1):null;switch(Q){case"BYTERANGE":E?R.setByteRange(j,E):R.setByteRange(j);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=j,R.tagList.push(["PROGRAM-DATE-TIME",j]),_===-1&&(_=h.length);break;case"PLAYLIST-TYPE":d.type&&Or(d,Q,L),d.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Or(d,Q,L):h.length>0&&lT(d,Q,L),v=d.startSN=parseInt(j);break;case"SKIP":{d.skippedSegments&&Or(d,Q,L);const Y=new As(j,d),re=Y.decimalInteger("SKIPPED-SEGMENTS");if(je(re)){d.skippedSegments+=re;for(let M=re;M--;)h.push(null);v+=re}const B=Y.enumeratedString("RECENTLY-REMOVED-DATERANGES");B&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(B.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Or(d,Q,L),d.targetduration=Math.max(parseInt(j),1);break;case"VERSION":d.version!==null&&Or(d,Q,L),d.version=parseInt(j);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Or(d,Q,L),d.live=!1;break;case"#":(j||K)&&R.tagList.push(K?[j,K]:[j]);break;case"DISCONTINUITY":T++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([Q]);break;case"BITRATE":R.tagList.push([Q,j]),A=parseInt(j)*1e3,je(A)?R.bitrate=A:A=0;break;case"DATERANGE":{const Y=new As(j,d),re=new bI(Y,d.dateRanges[Y.ID],d.dateRangeTagCount);d.dateRangeTagCount++,re.isValid||d.skippedSegments?d.dateRanges[re.id]=re:Wt.warn(`Ignoring invalid DATERANGE tag: "${j}"`),R.tagList.push(["EXT-X-DATERANGE",j]);break}case"DEFINE":{{const Y=new As(j,d);"IMPORT"in Y?sM(d,Y,a):Wb(d,Y,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Or(d,Q,L):h.length>0&&lT(d,Q,L),d.startCC=T=parseInt(j);break;case"KEY":{const Y=sT(j,t,d);if(Y.isSupported()){if(Y.method==="NONE"){D=void 0;break}D||(D={});const re=D[Y.keyFormat];re!=null&&re.matches(Y)||(re&&(D=ts({},D)),D[Y.keyFormat]=Y)}else Wt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${j}"`);break}case"START":d.startTimeOffset=nT(j);break;case"MAP":{const Y=new As(j,d);if(R.duration){const re=new qp(i,u);aT(re,Y,s,D),g=re,R.initSegment=g,g.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=g.rawProgramDateTime)}else{const re=R.byteRangeEndOffset;if(re){const B=R.byteRangeStartOffset;N=`${re-B}@${B}`}else N=null;aT(R,Y,s,D),g=R,k=!0}g.cc=T;break}case"SERVER-CONTROL":{F&&Or(d,Q,L),F=new As(j),d.canBlockReload=F.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=F.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&F.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=F.optionalFloat("PART-HOLD-BACK",0),d.holdBack=F.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Or(d,Q,L);const Y=new As(j);d.partTarget=Y.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Y=d.partList;Y||(Y=d.partList=[]);const re=S>0?Y[Y.length-1]:void 0,B=S++,M=new As(j,d),z=new nk(M,R,u,B,re);Y.push(z),R.duration+=z.duration;break}case"PRELOAD-HINT":{const Y=new As(j,d);d.preloadHint=Y;break}case"RENDITION-REPORT":{const Y=new As(j,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Y);break}default:Wt.warn(`line parsed but not handled: ${L}`);break}}}E&&!E.relurl?(h.pop(),x-=E.duration,d.partList&&(d.fragmentHint=E)):d.partList&&(u0(R,E,m),R.cc=T,d.fragmentHint=R,D&&oT(R,D,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const V=h.length,H=h[0],J=h[V-1];if(x+=d.skippedSegments*d.targetduration,x>0&&V&&J){d.averagetargetduration=x/V;const X=J.sn;d.endSN=X!=="initSegment"?X:0,d.live||(J.endList=!0),_>0&&(xM(h,_),H&&m.unshift(H))}return d.fragmentHint&&(x+=d.fragmentHint.duration),d.totalduration=x,m.length&&d.dateRangeTagCount&&H&&AI(m,d),d.endCC=T,d}}function AI(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const l=e.fragments[e.fragments.length-1];n.push(l),t++}else return;const s=n[t-1],i=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let l=r.length;l--;){const u=e.dateRanges[r[l]],d=u.startDate.getTime();u.tagAnchor=s.ref;for(let h=t;h--;){var a;if(((a=n[h])==null?void 0:a.sn)<e.startSN)break;const m=vM(e,d,n,h,i);if(m!==-1){u.tagAnchor=e.fragments[m].ref;break}}}}function vM(n,e,t,s,i){const r=t[s];if(r){const l=r.programDateTime;if(e>=l||s===0){var a;const u=(((a=t[s+1])==null?void 0:a.start)||i)-r.start;if(e<=l+u*1e3){const d=t[s].sn-n.startSN;if(d<0)return-1;const h=n.fragments;if(h.length>t.length){const g=(t[s+1]||h[h.length-1]).sn-n.startSN;for(let v=g;v>d;v--){const S=h[v].programDateTime;if(e>=S&&e<S+h[v].duration*1e3)return v}}return d}}}return-1}function sT(n,e,t){var s,i;const r=new As(n,t),a=(s=r.METHOD)!=null?s:"",l=r.URI,u=r.hexadecimalInteger("IV"),d=r.KEYFORMATVERSIONS,h=(i=r.KEYFORMAT)!=null?i:"identity";l&&r.IV&&!u&&Wt.error(`Invalid IV: ${r.IV}`);const m=l?lr.resolve(l,e):"",g=(d||"1").split("/").map(Number).filter(Number.isFinite);return new Qc(a,m,h,g,u,r.KEYID)}function nT(n){const t=new As(n).decimalFloatingPoint("TIME-OFFSET");return je(t)?t:null}function iT(n,e){let t=(n||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const i=t.filter(r=>ay(r,s));i.length&&(e[`${s}Codec`]=i.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>i.indexOf(r)===-1))}),e.unknownCodecs=t}function rT(n,e,t){const s=e[t];s&&(n[t]=s)}function xM(n,e){let t=n[e];for(let s=e;s--;){const i=n[s];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function u0(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function aT(n,e,t,s){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",s&&(n.levelkeys=s),n.initSegment=null}function oT(n,e,t){n.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&s.push(n)}function Or(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function lT(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Jp(n,e){const t=e.startPTS;if(je(t)){let s=0,i;e.sn>n.sn?(s=t-n.start,i=n):(s=n.start-t,i=e),i.duration!==s&&i.setDuration(s)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function II(n,e,t,s,i,r,a){s-t<=0&&(a.warn("Fragment should have a positive duration",e),s=t+e.duration,r=i+e.duration);let u=t,d=s;const h=e.startPTS,m=e.endPTS;if(je(h)){const A=Math.abs(h-t);n&&A>n.totalduration?a.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${n.url}`):je(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,u=Math.max(t,h),t=Math.min(t,h),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,d=Math.min(s,m),s=Math.max(s,m),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const g=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=i,e.endPTS=s,e.minEndPTS=d,e.endDTS=r;const v=e.sn;if(!n||v<n.startSN||v>n.endSN)return 0;let S;const x=v-n.startSN,T=n.fragments;for(T[x]=e,S=x;S>0;S--)Jp(T[S],T[S-1]);for(S=x;S<T.length-1;S++)Jp(T[S],T[S+1]);return n.fragmentHint&&Jp(T[T.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,g}function SM(n,e,t){if(n===e)return;let s=null;const i=n.fragments;for(let h=i.length-1;h>=0;h--){const m=i[h].initSegment;if(m){s=m;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let r;EM(n,e,(h,m,g,v)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==h.cc){const S=h.cc-m.cc;for(let x=g;x<v.length;x++)v[x].cc+=S;e.endCC=v[v.length-1].cc}je(h.startPTS)&&je(h.endPTS)&&(m.setStart(m.startPTS=h.startPTS),m.startDTS=h.startDTS,m.maxStartPTS=h.maxStartPTS,m.endPTS=h.endPTS,m.endDTS=h.endDTS,m.minEndPTS=h.minEndPTS,m.setDuration(h.endPTS-h.startPTS),m.duration&&(r=m),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(m.elementaryStreams=h.elementaryStreams),m.loader=h.loader,h.hasStats&&(m.stats=h.stats),h.initSegment&&(m.initSegment=h.initSegment,s=h.initSegment)});const a=e.fragments,l=e.fragmentHint?a.concat(e.fragmentHint):a;if(s&&l.forEach(h=>{var m;h&&(!h.initSegment||h.initSegment.relurl===((m=s)==null?void 0:m.relurl))&&(h.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=bM(n.dateRanges,e,t));const h=n.fragments.filter(m=>m.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<l.length;m++)l[m].programDateTime===null&&u0(l[m],l[m-1],h);AI(h,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var u;const h=CI(n,e.startSN-1);e.startCC=(u=h?.cc)!=null?u:a[0].cc}TM(n.partList,e.partList,(h,m)=>{m.elementaryStreams=h.elementaryStreams,m.stats=h.stats}),r?II(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):RI(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const h=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=h),e.driftEndTime=d,e.driftEnd=h}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function bM(n,e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=e,r=ts({},n);i&&i.forEach(u=>{delete r[u]});const l=Object.keys(r).length;return l?(Object.keys(s).forEach(u=>{const d=r[u],h=new bI(s[u].attr,d);h.isValid?(r[u]=h,d||(h.tagOrder+=l)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${os(s[u].attr)}"`)}),r):s}function TM(n,e,t){if(n&&e){let s=0;for(let i=0,r=n.length;i<=r;i++){const a=n[i],l=e[i+s];a&&l&&a.index===l.index&&a.fragment.sn===l.fragment.sn?t(a,l):s--}}}function EM(n,e,t){const s=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,r=(n.fragmentHint?1:0)+(s?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let d=i;d<=r;d++){const h=u[a+d];let m=l[d];if(s&&!m&&h&&(m=e.fragments[d]=h),h&&m){t(h,m,d,l);const g=h.relurl,v=m.relurl;if(g&&AM(g,v)){e.playlistParsingError=cT(`media sequence mismatch ${m.sn}:`,n,e,h,m);return}else if(h.cc!==m.cc){e.playlistParsingError=cT(`discontinuity sequence mismatch (${h.cc}!=${m.cc})`,n,e,h,m);return}}}}function cT(n,e,t,s,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function RI(n,e,t=!0){const s=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,r=s>=0;let a=0;if(r&&s<i.length)a=i[s].start;else if(r&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(r&&t)a=n.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;d0(e,a)}function d0(n,e){if(e){const t=n.fragments;for(let s=n.skippedSegments;s<t.length;s++)t[s].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function wI(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const s=n.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function CI(n,e,t){if(!n)return null;let s=n.fragments[e-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===e)?s:e<n.startSN&&t&&t.sn===e?t:null}function uT(n,e,t){return n?LI(n.partList,e,t):null}function LI(n,e,t){if(n)for(let s=n.length;s--;){const i=n[s];if(i.index===t&&i.fragment.sn===e)return i}return null}function DI(n){n.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function AM(n,e){return n!==e&&e?dT(n)!==dT(e):!1}function dT(n){return n.replace(/\?[^?]*$/,"")}function Nc(n,e){for(let s=0,i=n.length;s<i;s++){var t;if(((t=n[s])==null?void 0:t.cc)===e)return n[s]}return null}function IM(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function hT(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function OI(n,e){const t=e.fragments;for(let s=0,i=t.length;s<i;s++)hT(t[s],n);e.fragmentHint&&hT(e.fragmentHint,n),e.alignedSliding=!0}function RM(n,e){n&&(_I(e,n),e.alignedSliding||jh(e,n),!e.alignedSliding&&!e.skippedSegments&&RI(n,e,!1))}function _I(n,e){if(!IM(e,n))return;const t=Math.min(e.endCC,n.endCC),s=Nc(e.fragments,t),i=Nc(n.fragments,t);if(!s||!i)return;Wt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-i.start;OI(r,n)}function jh(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,s=e.fragments;if(!t.length||!s.length)return;let i,r;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(i=Nc(s,a),r=Nc(t,a)),(!i||!r)&&(i=s[Math.floor(s.length/2)],r=Nc(t,i.cc)||t[Math.floor(t.length/2)]);const l=i.programDateTime,u=r.programDateTime;if(!l||!u)return;const d=(u-l)/1e3-(r.start-i.start);OI(d,n)}function Dn(n,e,t){Vn(n,e,t),n.addEventListener(e,t)}function Vn(n,e,t){n.removeEventListener(e,t)}const wM={toString:function(n){let e="";const t=n.length;for(let s=0;s<t;s++)e+=`[${n.start(s).toFixed(3)}-${n.end(s).toFixed(3)}]`;return e}},ye={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class my extends xI{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ye.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:l,media:u,mediaBuffer:d,state:h}=this,m=u?u.currentTime:0,g=ft.bufferInfo(d||u,m,a.maxBufferHole),v=!g.len;if(this.log(`Media seeking to ${je(m)?m.toFixed(3):m}, state: ${h}, ${v?"out of":"in"} buffer`),this.state===ye.ENDED)this.resetLoadingState();else if(l){const S=a.maxFragLookUpTolerance,x=l.start-S,T=l.start+l.duration+S;if(v||T<g.start||x>g.end){const A=m>T;(m<x||A)&&(A&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(m>S&&(this.lastCurrentTime=m),!this.loadingParts){const x=Math.max(g.end,m),T=this.shouldLoadParts(this.getLevelDetails(),x);T&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,v&&(this.startPosition=m)),v&&this.state===ye.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new eM(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new cy(e.config)}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ye.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ye.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=ft.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const h=u[u.length-1];return ft.isBuffered(this.media,h.start+h.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Dn(s,"seeking",this.onMediaSeeking),Dn(s,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ye.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Vn(i,"seeking",this.onMediaSeeking),Vn(i,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ye.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const i=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,i).then(r=>{if(!r)return;const a=this.state,l=r.frag;if(this.fragContextChanged(l)){(a===ye.FRAG_LOADING||!this.fragCurrent&&a===ye.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=ye.IDLE);return}"payload"in r&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(O.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ye.STOPPED||this.state===ye.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===en.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),l=Math.max(e.duration,a?a.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===en.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(O.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const i=s?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:i}=this,{frag:r,payload:a}=s,l=r.decryptdata;if(a&&a.byteLength>0&&l!=null&&l.key&&l.iv&&rl(l.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),l.key.buffer,l.iv.buffer,hy(l.method)).catch(d=>{throw i.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:r}),d}).then(d=>{const h=self.performance.now();return i.trigger(O.FRAG_DECRYPTED,{frag:r,payload:d,stats:{tstart:u,tdecrypt:h}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ye.STOPPED||this.state===ye.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ye.STOPPED&&(this.state=ye.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,i;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(i=r.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,l=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(l.message),!a||a.mediaKeys?!1:(this.hls.trigger(O.ERROR,{type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_KEYS,fatal:!1,error:l,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?wM.toString(ft.getBuffered(s)):"(detached)"})`),Ys(e)){var i;if(e.type!==$e.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(l=>!!a[l])){this.state=ye.IDLE;return}}const r=(i=this.levels)==null?void 0:i[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ye.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,a=!r||r.length===0||r.some(u=>!u),l=new uy(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let l=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ye.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(O.KEY_LOADED,g),this.state===ye.KEY_LOADING&&(this.state=ye.IDLE),g}),this.hls.trigger(O.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(l=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(Ys(e)&&(!u||e.sn!==u.sn)){const g=this.shouldLoadParts(t.details,e.end);g!==this.loadingParts&&(this.log(`LL-Part loading ${g?"ON":"OFF"} loading sn ${u?.sn}->${e.sn}`),this.loadingParts=g)}if(s=Math.max(e.start,s||0),this.loadingParts&&Ys(e)){const g=a.partList;if(g&&i){s>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const v=this.getNextPart(g,e,s);if(v>-1){const S=g[v];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${v}/${g.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ye.FRAG_LOADING;let x;return l?x=l.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,S,t,i)).catch(T=>this.handleFragLoadError(T)):x=this.doFragPartsLoad(e,S,t,i).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(O.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(g,s))return Promise.resolve(null)}}if(Ys(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=a.partList)==null?void 0:d.filter(g=>g.loaded).map(g=>`[${g.start}-${g.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),je(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ye.FRAG_LOADING;const h=this.config.progressive;let m;return h&&l?m=l.then(g=>!g||this.fragContextChanged(g.frag)?null:this.fragmentLoader.load(e,i)).catch(g=>this.handleFragLoadError(g)):m=Promise.all([this.fragmentLoader.load(e,h?i:void 0),l]).then(([g])=>(!h&&i&&i(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(O.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,s,i){return new Promise((r,a)=>{var l;const u=[],d=(l=s.details)==null?void 0:l.partList,h=m=>{this.fragmentLoader.loadPart(e,m,i).then(g=>{u[m.index]=g;const v=g.part;this.hls.trigger(O.FRAG_LOADED,g);const S=uT(s.details,e.sn,m.index+1)||LI(d,e.sn,m.index+1);if(S)h(S);else return r({frag:e,part:v,partsLoaded:u})}).catch(a)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===te.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===qe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(O.ERROR,t)}else this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ye.PARSING){!this.fragCurrent&&this.state!==ye.STOPPED&&this.state!==ye.ERROR&&(this.state=ye.IDLE);return}const{frag:s,part:i,level:r}=t,a=self.performance.now();s.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const l=this.getLevelDetails(),d=l&&s.sn>l.endSN||this.shouldLoadParts(l,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===$e.SUBTITLE)return!1;const a=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const l=t[i],u=l.details,d=a>-1?uT(u,r,a):null,h=d?d.fragment:CI(u,r,s);return h?(s&&s!==h&&(h.stats=s.stats),{frag:h,part:d,level:l}):null}bufferFragmentData(e,t,s,i,r){if(this.state!==ye.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(l&&(u=Ci(a,l)),!u.length)return;const d=this.initPTS[t.cc],h=d?-d.baseTime/d.timescale:void 0,m={type:e.type,frag:t,part:s,chunkMeta:i,offset:h,parent:t.type,data:u};if(this.hls.trigger(O.BUFFER_APPENDING,m),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ft.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,i=ft.bufferInfo(t,s,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),l=Math.max(Math.min(e.start-a,i.end-a),s+a);e.start-l>a&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!je(i))return null;const a=this.lastCurrentTime>i||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,s,i){const r=ft.bufferInfo(e,t,i);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(r.nextStart<=a.end||a.gap)){const l=Math.max(Math.min(r.nextStart,a.end)-t,i);return ft.bufferInfo(e,t,l)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,i);return r>=i?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=$e.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,a=s[0].start,l=r.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const m=r.initialLiveManifestSize;if(i<m)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var d;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const g=this.hls.startPosition,v=this.hls.liveSyncPosition,S=u?(g!==-1&&g>=a?g:v)||u.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${g} liveSyncPosition: ${v} frag.start: ${(d=u)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=a&&(u=s[0]);if(!u){const m=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,m,t)}let h=this.filterReplacedPrimary(u,t);if(!h&&u){const m=u.sn-t.startSN;h=this.filterReplacedPrimary(s[m+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===en.OK||s===en.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(l!==null&&s.len+l.len>=r){const u=a.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(fT(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(fT(this.config)&&e.type!==$e.SUBTITLE){const s=this.hls.interstitialsManager,i=s?.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&t?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const r=s?.playerQueue;if(r)for(let a=r.length;a--;){const l=r[a].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let i=-1,r=!1,a=!0;for(let l=0,u=e.length;l<u;l++){const d=e[l];if(a=a&&!d.independent,i>-1&&s<d.start)break;const h=d.loaded;h?i=-1:(r||(d.independent||a)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),i=l),r=h}return i}loadedEndOfParts(e,t){let s;for(let i=e.length;i--;){if(s=e[i],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=$k(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];s.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=gI(e,s.cc,s.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(i=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:l}=s;const{fragmentHint:u}=s,{maxFragLookUpTolerance:d}=i,h=s.partList,m=!!(this.loadingParts&&h!=null&&h.length&&u);m&&!this.bitrateTest&&h[h.length-1].fragment.sn===u.sn&&(a=a.concat(u),l=u.sn);let g;if(e<t){var v;const x=e<this.lastCurrentTime||e>t-d||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:d;g=to(r,a,e,x)}else g=a[a.length-1];if(g){const S=g.sn-s.startSN,x=this.fragmentTracker.getState(g);if((x===en.OK||x===en.PARTIAL&&g.gap)&&(r=g),r&&g.sn===r.sn&&(!m||h[0].fragment.sn>g.sn||!s.live)&&g.level===r.level){const A=a[S+1];g.sn<l&&this.fragmentTracker.getState(A)!==en.OK?g=A:g=null}}return g}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,l=e.alignedSliding&&je(r);if(a||!l&&!r){RM(s,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&je(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ys(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ye.FRAG_LOADING_WAITING_RETRY)&&(this.state=ye.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=t.details===te.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const l=t.errorAction;if(!l){this.state=ye.ERROR;return}const{action:u,flags:d,retryCount:h=0,retryConfig:m}=l,g=!!m,v=g&&u===pn.RetryRequest,S=g&&!l.resolved&&d===ni.MoveAllAlternatesMatchingHost,x=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!v&&S&&Ys(i)&&!i.endList&&x&&!vI(t))this.resetFragmentErrors(e),this.treatAsGap(i),l.resolved=!0;else if((v||S)&&h<m.maxNumRetry){var T;const A=o0((T=t.response)==null?void 0:T.code),E=ly(m,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=ye.FRAG_LOADING_WAITING_RETRY,l.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${m.maxNumRetry} in ${E}ms`)}else if(m)if(this.resetFragmentErrors(e),h<m.maxNumRetry)!a&&u!==pn.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else u===pn.SendAlternateToPenaltyBox?this.state=ye.WAITING_LEVEL:this.state=ye.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!o0(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ye.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ye.PARSING||this.state===ye.PARSED){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,t?.duration||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===$e.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ye.STOPPED&&(this.state=ye.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const i=ft.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===ye.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ye.STOPPED&&(this.state=ye.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,d)=>{const h=e.elementaryStreams[d];if(h){const m=h.endPTS-h.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${m})`),u||!1;const g=i?0:II(r,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(O.LEVEL_PTS_UPDATED,{details:r,level:s,drift:g,type:d,frag:e,start:h.startPTS,end:h.endPTS}),!0}return u},!1)){var l;if(s.fragmentError===0&&this.treatAsGap(e,s),((l=this.transmuxer)==null?void 0:l.error)===null){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ye.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(O.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===$e.MAIN?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((i=t&&!s?e.startPTS:(s||e).start)!=null?i:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function fT(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class PI{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=CM(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function CM(n,e){const t=new Uint8Array(e);let s=0;for(let i=0;i<n.length;i++){const r=n[i];t.set(r,s),s+=r.length}return t}var eg={exports:{}},mT;function LM(){return mT||(mT=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(u,d,h){this.fn=u,this.context=d,this.once=h||!1}function r(u,d,h,m,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var v=new i(h,m||u,g),S=t?t+d:d;return u._events[S]?u._events[S].fn?u._events[S]=[u._events[S],v]:u._events[S].push(v):(u._events[S]=v,u._eventsCount++),u}function a(u,d){--u._eventsCount===0?u._events=new s:delete u._events[d]}function l(){this._events=new s,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],h,m;if(this._eventsCount===0)return d;for(m in h=this._events)e.call(h,m)&&d.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},l.prototype.listeners=function(d){var h=t?t+d:d,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,v=m.length,S=new Array(v);g<v;g++)S[g]=m[g].fn;return S},l.prototype.listenerCount=function(d){var h=t?t+d:d,m=this._events[h];return m?m.fn?1:m.length:0},l.prototype.emit=function(d,h,m,g,v,S){var x=t?t+d:d;if(!this._events[x])return!1;var T=this._events[x],A=arguments.length,E,R;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,h),!0;case 3:return T.fn.call(T.context,h,m),!0;case 4:return T.fn.call(T.context,h,m,g),!0;case 5:return T.fn.call(T.context,h,m,g,v),!0;case 6:return T.fn.call(T.context,h,m,g,v,S),!0}for(R=1,E=new Array(A-1);R<A;R++)E[R-1]=arguments[R];T.fn.apply(T.context,E)}else{var L=T.length,w;for(R=0;R<L;R++)switch(T[R].once&&this.removeListener(d,T[R].fn,void 0,!0),A){case 1:T[R].fn.call(T[R].context);break;case 2:T[R].fn.call(T[R].context,h);break;case 3:T[R].fn.call(T[R].context,h,m);break;case 4:T[R].fn.call(T[R].context,h,m,g);break;default:if(!E)for(w=1,E=new Array(A-1);w<A;w++)E[w-1]=arguments[w];T[R].fn.apply(T[R].context,E)}}return!0},l.prototype.on=function(d,h,m){return r(this,d,h,m,!1)},l.prototype.once=function(d,h,m){return r(this,d,h,m,!0)},l.prototype.removeListener=function(d,h,m,g){var v=t?t+d:d;if(!this._events[v])return this;if(!h)return a(this,v),this;var S=this._events[v];if(S.fn)S.fn===h&&(!g||S.once)&&(!m||S.context===m)&&a(this,v);else{for(var x=0,T=[],A=S.length;x<A;x++)(S[x].fn!==h||g&&!S[x].once||m&&S[x].context!==m)&&T.push(S[x]);T.length?this._events[v]=T.length===1?T[0]:T:a(this,v)}return this},l.prototype.removeAllListeners=function(d){var h;return d?(h=t?t+d:d,this._events[h]&&a(this,h)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l})(eg)),eg.exports}var DM=LM(),py=tk(DM);const Xc="1.6.12",fl={};function OM(){return typeof __HLS_WORKER_BUNDLE__=="function"}function _M(){const n=fl[Xc];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return fl[Xc]=i,i}function PM(n){const e=fl[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return fl[n]=i,i}function NM(n){const e=fl[n||Xc];if(e&&e.clientCount--===1){const{worker:s,objectURL:i}=e;delete fl[n||Xc],i&&self.URL.revokeObjectURL(i),s.terminate()}}function NI(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function gy(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function cf(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Wc(n,e){const t=e;let s=0;for(;gy(n,e);){s+=10;const i=cf(n,e+6);s+=i,NI(n,e+10)&&(s+=10),e+=s}if(s>0)return n.subarray(t,t+s)}function kM(n,e,t,s){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],a=r>>2&15;if(a>12){const v=new Error(`invalid ADTS sampling index:${a}`);n.emit(O.ERROR,O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const l=(r>>6&3)+1,u=e[t+3]>>6&3|(r&1)<<2,d="mp4a.40."+l,h=i[a];let m=a;(l===5||l===29)&&(m-=3);const g=[l<<3|(m&14)>>1,(m&1)<<7|u<<3];return Wt.log(`manifest codec:${s}, parsed codec:${d}, channels:${u}, rate:${h} (ADTS object type:${l} sampling index:${a})`),{config:g,samplerate:h,channelCount:u,codec:d,parsedCodec:d,manifestCodec:s}}function kI(n,e){return n[e]===255&&(n[e+1]&246)===240}function MI(n,e){return n[e+1]&1?7:9}function yy(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function MM(n,e){return e+5<n.length}function Vh(n,e){return e+1<n.length&&kI(n,e)}function UM(n,e){return MM(n,e)&&kI(n,e)&&yy(n,e)<=n.length-e}function FM(n,e){if(Vh(n,e)){const t=MI(n,e);if(e+t>=n.length)return!1;const s=yy(n,e);if(s<=t)return!1;const i=e+s;return i===n.length||Vh(n,i)}return!1}function UI(n,e,t,s,i){if(!n.samplerate){const r=kM(e,t,s,i);if(!r)return;ts(n,r)}}function FI(n){return 1024*9e4/n}function BM(n,e){const t=MI(n,e);if(e+t<=n.length){const s=yy(n,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function BI(n,e,t,s,i){const r=FI(n.samplerate),a=s+i*r,l=BM(e,t);let u;if(l){const{frameLength:m,headerLength:g}=l,v=g+m,S=Math.max(0,t+v-e.length);S?(u=new Uint8Array(v-g),u.set(e.subarray(t+g,e.length),0)):u=e.subarray(t+g,t+v);const x={unit:u,pts:a};return S||n.samples.push(x),{sample:x,length:v,missing:S}}const d=e.length-t;return u=new Uint8Array(d),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:a},length:d,missing:-1}}function jM(n,e){return gy(n,e)&&cf(n,e+6)+10<=n.length-e}function VM(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function tg(n,e=0,t=1/0){return $M(n,e,t,Uint8Array)}function $M(n,e,t,s){const i=GM(n);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const a=HM(n)?n.byteOffset:0,l=(a+n.byteLength)/r,u=(a+e)/r,d=Math.floor(Math.max(0,Math.min(u,l))),h=Math.floor(Math.min(d+Math.max(t,0),l));return new s(i,d,h-d)}function GM(n){return n instanceof ArrayBuffer?n:n.buffer}function HM(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function zM(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=n.data.subarray(1).indexOf(0);if(s===-1)return;const i=oi(tg(n.data,1,s)),r=n.data[2+s],a=n.data.subarray(3+s).indexOf(0);if(a===-1)return;const l=oi(tg(n.data,3+s,a));let u;return i==="-->"?u=oi(tg(n.data,4+s+a)):u=VM(n.data.subarray(4+s+a)),e.mimeType=i,e.pictureType=r,e.description=l,e.data=u,e}function KM(n){if(n.size<2)return;const e=oi(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function YM(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const s=oi(n.data.subarray(t),!0);t+=s.length+1;const i=oi(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=oi(n.data.subarray(1));return{key:n.type,info:"",data:e}}function qM(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const s=oi(n.data.subarray(t),!0);t+=s.length+1;const i=oi(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=oi(n.data);return{key:n.type,info:"",data:e}}function QM(n){return n.type==="PRIV"?KM(n):n.type[0]==="W"?qM(n):n.type==="APIC"?zM(n):YM(n)}function XM(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=cf(n,4),s=10;return{type:e,size:t,data:n.subarray(s,s+t)}}const qd=10,WM=10;function jI(n){let e=0;const t=[];for(;gy(n,e);){const s=cf(n,e+6);n[e+5]>>6&1&&(e+=qd),e+=qd;const i=e+s;for(;e+WM<i;){const r=XM(n.subarray(e)),a=QM(r);a&&t.push(a),e+=r.size+qd}NI(n,e)&&(e+=qd)}return t}function VI(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function ZM(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function vy(n){const e=jI(n);for(let t=0;t<e.length;t++){const s=e[t];if(VI(s))return ZM(s)}}let ii=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function rr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class xy{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Ci(this.cachedData,e),this.cachedData=null);let s=Wc(e,0),i=s?s.length:0,r;const a=this._audioTrack,l=this._id3Track,u=s?vy(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&je(u))&&(this.basePTS=JM(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ii.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(e,i)){const h=this.appendFrame(a,e,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,r=i):i=d}else jM(e,i)?(s=Wc(e,i),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ii.audioId3,duration:Number.POSITIVE_INFINITY}),i+=s.length,r=i):i++;if(i===d&&r!==d){const h=e.slice(r);this.cachedData?this.cachedData=Ci(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:rr(),id3Track:l,textTrack:rr()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:rr(),id3Track:this._id3Track,textTrack:rr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const JM=(n,e,t)=>{if(je(n))return n*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Qd=null;const e3=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],t3=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],s3=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],n3=[0,1,1,4];function $I(n,e,t,s,i){if(t+24>e.length)return;const r=GI(e,t);if(r&&t+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,l=s+i*a,u={unit:e.subarray(t,t+r.frameLength),pts:l,dts:l};return n.config=[],n.channelCount=r.channelCount,n.samplerate=r.sampleRate,n.samples.push(u),{sample:u,length:r.frameLength,missing:0}}}function GI(n,e){const t=n[e+1]>>3&3,s=n[e+1]>>1&3,i=n[e+2]>>4&15,r=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&r!==3){const a=n[e+2]>>1&1,l=n[e+3]>>6,u=t===3?3-s:s===3?3:4,d=e3[u*14+i-1]*1e3,m=t3[(t===3?0:t===2?1:2)*3+r],g=l===3?1:2,v=s3[t][s],S=n3[s],x=v*8*S,T=Math.floor(v*d/m+a)*S;if(Qd===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Qd=R?parseInt(R[1]):0}return!!Qd&&Qd<=87&&s===2&&d>=224e3&&l===0&&(n[e+3]=n[e+3]|128),{sampleRate:m,channelCount:g,frameLength:T,samplesPerFrame:x}}}function Sy(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function HI(n,e){return e+1<n.length&&Sy(n,e)}function i3(n,e){return Sy(n,e)&&4<=n.length-e}function zI(n,e){if(e+1<n.length&&Sy(n,e)){const s=GI(n,e);let i=4;s!=null&&s.frameLength&&(i=s.frameLength);const r=e+i;return r===n.length||HI(n,r)}return!1}class r3 extends xy{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Wc(e,0);let i=s?.length||0;if(zI(e,i))return!1;for(let r=e.length;i<r;i++)if(FM(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return UM(e,t)}appendFrame(e,t,s){UI(e,this.observer,t,s,e.manifestCodec);const i=BI(e,t,s,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const KI=(n,e)=>{let t=0,s=5;e+=s;const i=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=n[e];const l=Math.min(s,8),u=8-l;r[0]=4278190080>>>24+u<<u,i[0]=(a[0]&r[0])>>u,t=t?t<<l|i[0]:i[0],e+=1,s-=l}return t};class a3 extends xy{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=YI(e,t,s,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Wc(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&vy(t)!==void 0&&KI(e,s)<16}}function YI(n,e,t,s,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const l=[48e3,44100,32e3][r],u=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+r]*2;if(t+h>e.length)return-1;const m=e[t+6]>>5;let g=0;m===2?g+=2:(m&1&&m!==1&&(g+=2),m&4&&(g+=2));const v=(e[t+6]<<8|e[t+7])>>12-g&1,x=[2,1,2,3,3,4,4,5][m]+v,T=e[t+5]>>3,A=e[t+5]&7,E=new Uint8Array([r<<6|T<<1|A>>2,(A&3)<<6|m<<3|v<<2|u>>4,u<<4&224]),R=1536/l*9e4,L=s+i*R,w=e.subarray(t,t+h);return n.config=E,n.channelCount=x,n.samplerate=l,n.samples.push({unit:w,pts:L}),h}class o3 extends xy{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wc(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&vy(t)!==void 0&&KI(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(zI(e,s))return Wt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return i3(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return $I(e,t,s,this.basePTS,this.frameIndex)}}const l3=/\/emsg[-/]ID3/i;class c3{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=rr("video",1),a=this.audioTrack=rr("audio",1),l=this.txtTrack=rr("text",1);if(this.id3Track=rr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=aI(e);if(u.video){const{id:d,timescale:h,codec:m,supplemental:g}=u.video;r.id=d,r.timescale=l.timescale=h,r.codec=m,r.supplemental=g}if(u.audio){const{id:d,timescale:h,codec:m}=u.audio;a.id=d,a.timescale=h,a.codec=m}l.id=nI.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return ak(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Ci(this.remainderData,e));const l=hk(s);this.remainderData=l.remainder,i.samples=l.valid||new Uint8Array}else i.samples=s;const a=this.extractID3Track(i,t);return r.samples=Pb(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=Pb(e,t),{videoTrack:t,audioTrack:rr(),id3Track:i,textTrack:rr()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=Et(e.samples,["emsg"]);i&&i.forEach(r=>{const a=mk(r);if(l3.test(a.schemeIdUri)){const l=pT(a,t);let u=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const d=a.payload;s.samples.push({data:d,len:d.byteLength,dts:l,pts:l,type:ii.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const l=pT(a,t);s.samples.push({data:a.payload,len:a.payload.byteLength,dts:l,pts:l,type:ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function pT(n,e){return je(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class u3{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new cy(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Sa.cbc)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(l=>{const u=new Uint8Array(l);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const a=lI(r.data),l=this.getAvcEncryptedData(a);this.decryptBuffer(l.buffer).then(u=>{r.data=this.getAvcDecryptedUnit(a,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}).catch(i)}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){i();return}const r=e[t].units;for(;!(s>=r.length);s++){const a=r[s];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,s,i,a),!this.decrypter.isSync()))return}}}}class qI{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,i;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;i=r[r.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,i=s.length;if(i){const r=s[i-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const a=r,l=[];let u=0,d,h,m,g=-1,v=0;for(r===-1&&(g=0,v=this.getNALuType(t,0),r=0,u=1);u<i;){if(d=t[u++],!r){r=d?0:1;continue}if(r===1){r=d?0:2;continue}if(!d)r=3;else if(d===1){if(h=u-r-1,g>=0){const S={data:t.subarray(g,h),type:v};l.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(a&&u<=4-a&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-a)),h>0&&(S.data=Ci(S.data,t.subarray(0,h)),S.state=0))}u<i?(m=this.getNALuType(t,u),g=u,v=m,r=0):r=-1}else r=0}if(g>=0&&r>=0){const S={data:t.subarray(g,i),type:v,state:r};l.push(S)}if(l.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=Ci(S.data,t))}return e.naluState=r,l}}class kc{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Wt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class d3 extends qI{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a=this.VideoSample,l,u=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(d=>{var h,m;switch(d.type){case 1:{let x=!1;l=!0;const T=d.data;if(u&&T.length>4){const A=this.readSliceType(T);(A===2||A===4||A===7||A===9)&&(x=!0)}if(x){var g;(g=a)!=null&&g.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=x;break}case 5:l=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:{l=!0,ry(d.data,1,s.pts,t.samples);break}case 7:{var v,S;l=!0,u=!0;const x=d.data,T=this.readSPS(x);if(!e.sps||e.width!==T.width||e.height!==T.height||((v=e.pixelRatio)==null?void 0:v[0])!==T.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[x];const A=x.subarray(1,4);let E="avc1.";for(let R=0;R<3;R++){let L=A[R].toString(16);L.length<2&&(L="0"+L),E+=L}e.codec=E}break}case 8:l=!0,e.pps=[d.data];break;case 9:l=!0,e.audFound=!0,(m=a)!=null&&m.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:l=!0;break;default:l=!1;break}a&&l&&a.units.push(d)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new kc(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,i=8,r;for(let a=0;a<e;a++)i!==0&&(r=t.readEG(),i=(s+r+256)%256),s=i===0?s:i}readSPS(e){const t=new kc(e);let s=0,i=0,r=0,a=0,l,u,d;const h=t.readUByte.bind(t),m=t.readBits.bind(t),g=t.readUEG.bind(t),v=t.readBoolean.bind(t),S=t.skipBits.bind(t),x=t.skipEG.bind(t),T=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);h();const E=h();if(m(5),S(3),h(),T(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const k=g();if(k===3&&S(1),T(),T(),S(1),v())for(u=k!==3?8:12,d=0;d<u;d++)v()&&(d<6?A(16,t):A(64,t))}T();const R=g();if(R===0)g();else if(R===1)for(S(1),x(),x(),l=g(),d=0;d<l;d++)x();T(),S(1);const L=g(),w=g(),D=m(1);D===0&&S(1),S(1),v()&&(s=g(),i=g(),r=g(),a=g());let _=[1,1];if(v()&&v())switch(h()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((L+1)*16-s*2-i*2),height:(2-D)*(w+1)*16-(D?2:4)*(r+a),pixelRatio:_}}}class h3 extends qI{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a=this.VideoSample,l,u=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(d=>{var h,m;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,u){var g;(g=a)!=null&&g.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:l=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:l=!0,ry(d.data,2,s.pts,t.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ts(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(l=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(d.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in v.params)e.params[S]=v.params[S]}this.pushParameterSet(e.sps,d.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(d.data);for(const S in v)e.params[S]=v[S]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(m=a)!=null&&m.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:l=!1;break}a&&l&&a.units.push(d)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new kc(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:i}}readSPS(e){const t=new kc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),l=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=t.readUByte(),S=t.readUByte(),x=t.readUByte(),T=t.readUByte(),A=t.readUByte(),E=[],R=[];for(let ke=0;ke<s;ke++)E.push(t.readBoolean()),R.push(t.readBoolean());if(s>0)for(let ke=s;ke<8;ke++)t.readBits(2);for(let ke=0;ke<s;ke++)E[ke]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[ke]&&t.readUByte();t.readUEG();const L=t.readUEG();L==3&&t.skipBits(1);const w=t.readUEG(),D=t.readUEG(),_=t.readBoolean();let k=0,N=0,F=0,V=0;_&&(k+=t.readUEG(),N+=t.readUEG(),F+=t.readUEG(),V+=t.readUEG());const H=t.readUEG(),J=t.readUEG(),X=t.readUEG(),Q=t.readBoolean();for(let ke=Q?0:s;ke<=s;ke++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Je=0;Je<4;Je++)for(let ot=0;ot<(Je===3?2:6);ot++)if(!t.readBoolean())t.readUEG();else{const vt=Math.min(64,1<<4+(Je<<1));Je>1&&t.readEG();for(let fe=0;fe<vt;fe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Y=t.readUEG();let re=0;for(let ke=0;ke<Y;ke++){let Je=!1;if(ke!==0&&(Je=t.readBoolean()),Je){ke===Y&&t.readUEG(),t.readBoolean(),t.readUEG();let ot=0;for(let kt=0;kt<=re;kt++){const vt=t.readBoolean();let fe=!1;vt||(fe=t.readBoolean()),(vt||fe)&&ot++}re=ot}else{const ot=t.readUEG(),kt=t.readUEG();re=ot+kt;for(let vt=0;vt<ot;vt++)t.readUEG(),t.readBoolean();for(let vt=0;vt<kt;vt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ke=t.readUEG();for(let Je=0;Je<ke;Je++){for(let ot=0;ot<X+4;ot++)t.readBits(1);t.readBits(1)}}let M=0,z=1,G=1,de=!0,Te=1,pe=0;t.readBoolean(),t.readBoolean();let Qe=!1;if(t.readBoolean()){if(t.readBoolean()){const ze=t.readUByte(),Ve=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Fe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ze>0&&ze<16?(z=Ve[ze-1],G=Fe[ze-1]):ze===255&&(z=t.readBits(16),G=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Qe=t.readBoolean(),Qe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Te=t.readBits(32),pe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Fe=t.readBoolean(),et=t.readBoolean();let W=!1;(Fe||et)&&(W=t.readBoolean(),W&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),W&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let se=0;se<=s;se++){de=t.readBoolean();const me=de||t.readBoolean();let he=!1;me?t.readEG():he=t.readBoolean();const Ke=he?1:t.readUEG()+1;if(Fe)for(let Be=0;Be<Ke;Be++)t.readUEG(),t.readUEG(),W&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(et)for(let Be=0;Be<Ke;Be++)t.readUEG(),t.readUEG(),W&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),M=t.readUEG())}let Oe=w,Ue=D;if(_){let ke=1,Je=1;L===1?ke=Je=2:L==2&&(ke=2),Oe=w-ke*N-ke*k,Ue=D-Je*V-Je*F}const Ze=i?["A","B","C"][i]:"",nt=l<<24|u<<16|d<<8|h;let Dt=0;for(let ke=0;ke<32;ke++)Dt=(Dt|(nt>>ke&1)<<31-ke)>>>0;let Nt=Dt.toString(16);return a===1&&Nt==="2"&&(Nt="6"),{codecString:`hvc1.${Ze}${a}.${Nt}.${r?"H":"L"}${A}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[l,u,d,h],general_constraint_indicator_flags:[m,g,v,S,x,T],general_level_idc:A,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:J,min_spatial_segmentation_idc:M,chroma_format_idc:L,frame_rate:{fixed:de,fps:pe/Te}},width:Oe,height:Ue,pixelRatio:[z,G]}}readPPS(e){const t=new kc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),r=t.readBoolean();let a=1;return r&&i?a=0:r?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const cn=188;class ma{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=ma.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(cn*5,t-cn)+1,i=0;for(;i<s;){let r=!1,a=-1,l=0;for(let u=i;u<t;u+=cn)if(e[u]===71&&(t-u===cn||e[u+cn]===71)){if(l++,a===-1&&(a=u,a!==0&&(s=Math.min(a+cn*99,e.length-cn)+1)),r||(r=h0(e,u)===0),r&&l>1&&(a===0&&l>2||u+cn>s))return a}else{if(l)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:nI[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ma.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=ma.createTrack("audio",i),this._id3Track=ma.createTrack("id3"),this._txtTrack=ma.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){s||(this.sampleAes=null);let r;const a=this._videoTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack;let h=a.pid,m=a.pesData,g=l.pid,v=u.pid,S=l.pesData,x=u.pesData,T=null,A=this.pmtParsed,E=this._pmtId,R=e.length;if(this.remainderData&&(e=Ci(this.remainderData,e),R=e.length,this.remainderData=null),R<cn&&!i)return this.remainderData=e,{audioTrack:l,videoTrack:a,id3Track:u,textTrack:d};const L=Math.max(0,ma.syncOffset(e));R-=(R-L)%cn,R<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let w=0;for(let _=L;_<R;_+=cn)if(e[_]===71){const k=!!(e[_+1]&64),N=h0(e,_),F=(e[_+3]&48)>>4;let V;if(F>1){if(V=_+5+e[_+4],V===_+cn)continue}else V=_+4;switch(N){case h:k&&(m&&(r=Xo(m,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,d,r,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(V,_+cn)),m.size+=_+cn-V);break;case g:if(k){if(S&&(r=Xo(S,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,r);break;case"mp3":this.parseMPEGPES(l,r);break;case"ac3":this.parseAC3PES(l,r);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(V,_+cn)),S.size+=_+cn-V);break;case v:k&&(x&&(r=Xo(x,this.logger))&&this.parseID3PES(u,r),x={data:[],size:0}),x&&(x.data.push(e.subarray(V,_+cn)),x.size+=_+cn-V);break;case 0:k&&(V+=e[V]+1),E=this._pmtId=f3(e,V);break;case E:{k&&(V+=e[V]+1);const H=m3(e,V,this.typeSupported,s,this.observer,this.logger);h=H.videoPid,h>0&&(a.pid=h,a.segmentCodec=H.segmentVideoCodec),g=H.audioPid,g>0&&(l.pid=g,l.segmentCodec=H.segmentAudioCodec),v=H.id3Pid,v>0&&(u.pid=v),T!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${_} after unknown PID '${T}'. Backtracking to sync byte @${L} to parse all TS packets.`),T=null,_=L-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=N;break}}else w++;w>0&&f0(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=m,l.pesData=S,u.pesData=x;const D={audioTrack:l,videoTrack:a,id3Track:u,textTrack:d};return i&&this.extractRemainingSamples(D),D}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,a=s.pesData,l=t.pesData,u=i.pesData;let d;if(a&&(d=Xo(a,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,d,!0),s.pesData=null)):s.pesData=a,l&&(d=Xo(l,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=l;u&&(d=Xo(u,this.logger))?(this.parseID3PES(i,d),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new u3(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new d3:e==="hevc"&&(this.videoParser=new h3))}decrypt(e,t){return new Promise(s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r=t.data;if(i){this.aacOverFlow=null;const m=i.missing,g=i.sample.unit.byteLength;if(m===-1)r=Ci(i.sample.unit,r);else{const v=g-m;i.sample.unit.set(r.subarray(0,m),v),e.samples.push(i.sample),s=i.missing}}let a,l;for(a=s,l=r.length;a<l-1&&!Vh(r,a);a++);if(a!==s){let m;const g=a<l-1;if(g?m=`AAC PES did not start with ADTS header,offset:${a}`:m="No ADTS header found in AAC PES",f0(this.observer,new Error(m),g,this.logger),!g)return}UI(e,this.observer,r,a,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const m=FI(e.samplerate);u=i.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,h;for(;a<l;)if(h=BI(e,r,a,u,d),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(d++;a<l-1&&!Vh(r,a);a++);}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,a=0;const l=t.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(HI(s,a)){const u=$I(e,s,a,l,r);if(u)a+=u.length,r++;else break}else a++}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let a=0,l=0,u;for(;l<r&&(u=YI(e,s,l,i,a++))>0;)l+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=ts({},t,{type:this._videoTrack?ii.emsg:ii.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function h0(n,e){return((n[e+1]&31)<<8)+n[e+2]}function f3(n,e){return(n[e+10]&31)<<8|n[e+11]}function m3(n,e,t,s,i,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(n[e+1]&15)<<8|n[e+2],u=e+3+l-4,d=(n[e+10]&15)<<8|n[e+11];for(e+=12+d;e<u;){const h=h0(n,e),m=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!s){sg("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=h);break;case 21:a.id3Pid===-1&&(a.id3Pid=h);break;case 219:if(!s){sg("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="mp3");break;case 193:if(!s){sg("AC-3",r);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&m>0){let g=e+5,v=m;for(;v>2;){switch(n[g]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=h,a.segmentAudioCodec="ac3");break}const x=n[g+1]+2;g+=x,v-=x}}break;case 194:case 135:return f0(i,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=h,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=m+5}return a}function f0(n,e,t,s){s.warn(`parsing error: ${e.message}`),n.emit(O.ERROR,O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function sg(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Xo(n,e){let t=0,s,i,r,a,l;const u=n.data;if(!n||n.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=Ci(u[0],u[1]),u.splice(1,1);if(s=u[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(i=(s[4]<<8)+s[5],i&&i>n.size-6)return null;const h=s[7];h&192&&(a=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,h&64?(l=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,a-l>60*9e4&&(e.warn(`${Math.round((a-l)/9e4)}s delta between PTS and DTS, align them`),a=l)):l=a),r=s[8];let m=r+9;if(n.size<=m)return null;n.size-=m;const g=new Uint8Array(n.size);for(let v=0,S=u.length;v<S;v++){s=u[v];let x=s.byteLength;if(m)if(m>x){m-=x;continue}else s=s.subarray(m),x-=m,m=0;g.set(s,t),t+=x}return i&&(i-=r+3),{data:g,pts:a,dts:l,len:i}}return null}class p3{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const da=Math.pow(2,32)-1;class ee{static init(){ee.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in ee.types)ee.types.hasOwnProperty(e)&&(ee.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ee.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);ee.STTS=ee.STSC=ee.STCO=r,ee.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ee.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),ee.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),ee.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);ee.FTYP=ee.box(ee.types.ftyp,a,u,a,l),ee.DINF=ee.box(ee.types.dinf,ee.box(ee.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(e,4),i=0,s=8;i<r;i++)a.set(t[i],s),s+=t[i].byteLength;return a}static hdlr(e){return ee.box(ee.types.hdlr,ee.HDLR_TYPES[e])}static mdat(e){return ee.box(ee.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(da+1)),i=Math.floor(t%(da+1));return ee.box(ee.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return ee.box(ee.types.mdia,ee.mdhd(e.timescale||0,e.duration||0),ee.hdlr(e.type),ee.minf(e))}static mfhd(e){return ee.box(ee.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?ee.box(ee.types.minf,ee.box(ee.types.smhd,ee.SMHD),ee.DINF,ee.stbl(e)):ee.box(ee.types.minf,ee.box(ee.types.vmhd,ee.VMHD),ee.DINF,ee.stbl(e))}static moof(e,t,s){return ee.box(ee.types.moof,ee.mfhd(e),ee.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=ee.trak(e[t]);return ee.box.apply(null,[ee.types.moov,ee.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(ee.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=ee.trex(e[t]);return ee.box.apply(null,[ee.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(da+1)),i=Math.floor(t%(da+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ee.box(ee.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return ee.box(ee.types.sdtp,s)}static stbl(e){return ee.box(ee.types.stbl,ee.stsd(e),ee.box(ee.types.stts,ee.STTS),ee.box(ee.types.stsc,ee.STSC),ee.box(ee.types.stsz,ee.STSZ),ee.box(ee.types.stco,ee.STCO))}static avc1(e){let t=[],s=[],i,r,a;for(i=0;i<e.sps.length;i++)r=e.sps[i],a=r.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(r));for(i=0;i<e.pps.length;i++)r=e.pps[i],a=r.byteLength,s.push(a>>>8&255),s.push(a&255),s=s.concat(Array.prototype.slice.call(r));const l=ee.box(ee.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),u=e.width,d=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return ee.box(ee.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,ee.box(ee.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ee.box(ee.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return ee.box(ee.types.mp4a,ee.audioStsd(e),ee.box(ee.types.esds,ee.esds(e)))}static mp3(e){return ee.box(ee.types[".mp3"],ee.audioStsd(e))}static ac3(e){return ee.box(ee.types["ac-3"],ee.audioStsd(e),ee.box(ee.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return ee.box(ee.types.stsd,ee.STSD,ee.mp4a(e));if(t==="ac3"&&e.config)return ee.box(ee.types.stsd,ee.STSD,ee.ac3(e));if(t==="mp3"&&e.codec==="mp3")return ee.box(ee.types.stsd,ee.STSD,ee.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return ee.box(ee.types.stsd,ee.STSD,ee.avc1(e));if(t==="hevc"&&e.vps)return ee.box(ee.types.stsd,ee.STSD,ee.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(s/(da+1)),l=Math.floor(s%(da+1));return ee.box(ee.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=ee.sdtp(e),i=e.id,r=Math.floor(t/(da+1)),a=Math.floor(t%(da+1));return ee.box(ee.types.traf,ee.box(ee.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),ee.box(ee.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),ee.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,ee.box(ee.types.trak,ee.tkhd(e),ee.mdia(e))}static trex(e){const t=e.id;return ee.box(ee.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,a=new Uint8Array(r);let l,u,d,h,m,g;for(t+=8+r,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),l=0;l<i;l++)u=s[l],d=u.duration,h=u.size,m=u.flags,g=u.cts,a.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*l);return ee.box(ee.types.trun,a)}static initSegment(e){ee.types||ee.init();const t=ee.moov(e);return Ci(ee.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let a=r.length;for(let S=0;S<s.length;S+=1){a+=3;for(let x=0;x<s[S].length;x+=1)a+=2+s[S][x].length}const l=new Uint8Array(a);l.set(r,0),a=r.length;const u=s.length-1;for(let S=0;S<s.length;S+=1){l.set(new Uint8Array([32+S|(S===u?128:0),0,s[S].length]),a),a+=3;for(let x=0;x<s[S].length;x+=1)l.set(new Uint8Array([s[S][x].length>>8,s[S][x].length&255]),a),a+=2,l.set(s[S][x],a),a+=s[S][x].length}const d=ee.box(ee.types.hvcC,l),h=e.width,m=e.height,g=e.pixelRatio[0],v=e.pixelRatio[1];return ee.box(ee.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,ee.box(ee.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ee.box(ee.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,v>>24,v>>16&255,v>>8&255,v&255])))}}ee.types=void 0;ee.HDLR_TYPES=void 0;ee.STTS=void 0;ee.STSC=void 0;ee.STCO=void 0;ee.STSZ=void 0;ee.VMHD=void 0;ee.SMHD=void 0;ee.STSD=void 0;ee.FTYP=void 0;ee.DINF=void 0;const QI=9e4;function by(n,e,t=1,s=!1){const i=n*e*t;return s?Math.round(i):i}function g3(n,e,t=1,s=!1){return by(n,e,1/t,s)}function Oc(n,e=!1){return by(n,1e3,1/QI,e)}function y3(n,e=1){return by(n,QI,1/e)}const v3=10*1e3,x3=1024,S3=1152,b3=1536;let Wo=null,ng=null;function gT(n,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class xh extends Oi{constructor(e,t,s,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Wo===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Wo=a?parseInt(a[1]):0}if(ng===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);ng=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce((r,a)=>{let l=a.pts,u=l-r;return u<-4294967296&&(t=!0,l=Ti(l,s),u=l-r),u>0?r:l},s);return t&&this.debug("PTS rollover detected"),i}remux(e,t,s,i,r,a,l,u){let d,h,m,g,v,S,x=r,T=r;const A=e.pid>-1,E=t.pid>-1,R=t.samples.length,L=e.samples.length>0,w=l&&R>0||R>1;if((!A||L)&&(!E||w)||this.ISGenerated||l){if(this.ISGenerated){var _,k,N,F;const X=this.videoTrackConfig;(X&&(t.width!==X.width||t.height!==X.height||((_=t.pixelRatio)==null?void 0:_[0])!==((k=X.pixelRatio)==null?void 0:k[0])||((N=t.pixelRatio)==null?void 0:N[1])!==((F=X.pixelRatio)==null?void 0:F[1]))||!X&&w||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,r,a));const V=this.isVideoContiguous;let H=-1,J;if(w&&(H=T3(t.samples),!V&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,H>0){this.warn(`Dropped ${H} out of ${R} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,T+=(t.samples[0].pts-X)/t.inputTimeScale,J=T}else H===-1&&(this.warn(`No keyframe found out of ${R} video samples`),S=!1);if(this.ISGenerated){if(L&&w){const X=this.getVideoStartPts(t.samples),j=(Ti(e.samples[0].pts,X)-X)/t.inputTimeScale;x+=Math.max(0,j),T+=Math.max(0,-j)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,r,a)),h=this.remuxAudio(e,x,this.isAudioContiguous,a,E||w||u===$e.AUDIO?T:void 0),w){const X=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,r,a)),d=this.remuxVideo(t,T,V,X)}}else w&&(d=this.remuxVideo(t,T,V,0));d&&(d.firstKeyFrame=H,d.independent=H!==-1,d.firstKeyFramePTS=J)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(v=XI(s,r,this._initPTS,this._initDTS)),i.samples.length&&(g=WI(i,r,this._initPTS))),{audio:h,video:d,initSegment:m,independent:S,text:g,id3:v}}generateIS(e,t,s,i){const r=e.samples,a=t.samples,l=this.typeSupported,u={},d=this._initPTS;let h=!d||i,m="audio/mp4",g,v,S,x=-1;if(h&&(g=v=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(m="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):ee.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(x=e.id,S=e.inputTimeScale,!d||S!==d.timescale?g=v=r[0].pts-Math.round(S*s):h=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ee.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(x=t.id,S=t.inputTimeScale,!d||S!==d.timescale){const T=this.getVideoStartPts(a),A=Math.round(S*s);v=Math.min(v,Ti(a[0].dts,T)-A),g=Math.min(g,T-A)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,h?(d&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${s} ${g/S} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${g/S} (${g}/${S}) trackId: ${x}`),this._initPTS={baseTime:g,timescale:S,trackId:x},this._initDTS={baseTime:v,timescale:S,trackId:x}):g=S=void 0,{tracks:u,initPTS:g,timescale:S,trackId:x}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,a=e.samples,l=[],u=a.length,d=this._initPTS,h=d.baseTime*r/d.timescale;let m=this.nextVideoTs,g=8,v=this.videoSampleDuration,S,x,T=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,E=!1;if(!s||m===null){const M=h+t*r,z=a[0].pts-Ti(a[0].dts,a[0].pts);Wo&&m!==null&&Math.abs(M-z-(m+h))<15e3?s=!0:m=M-z-h}const R=m+h;for(let M=0;M<u;M++){const z=a[M];z.pts=Ti(z.pts,R),z.dts=Ti(z.dts,R),z.dts<a[M>0?M-1:M].dts&&(E=!0)}E&&a.sort(function(M,z){const G=M.dts-z.dts,de=M.pts-z.pts;return G||de}),S=a[0].dts,x=a[a.length-1].dts;const L=x-S,w=L?Math.round(L/(u-1)):v||e.inputTimeScale/30;if(s){const M=S-R,z=M>w,G=M<-1;if((z||G)&&(z?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Oc(M,!0)} ms (${M}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Oc(-M,!0)} ms (${M}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!G||R>=a[0].pts||Wo)){S=R;const de=a[0].pts-M;if(z)a[0].dts=S,a[0].pts=de;else{let Te=!0;for(let pe=0;pe<a.length&&!(a[pe].dts>de&&Te);pe++){const Qe=a[pe].pts;if(a[pe].dts-=M,a[pe].pts-=M,pe<a.length-1){const ce=a[pe+1].pts,Oe=a[pe].pts,Ue=ce<=Oe,Ze=ce<=Qe;Te=Ue==Ze}}}this.log(`Video: Initial PTS/DTS adjusted: ${Oc(de,!0)}/${Oc(S,!0)}, delta: ${Oc(M,!0)} ms`)}}S=Math.max(0,S);let D=0,_=0,k=S;for(let M=0;M<u;M++){const z=a[M],G=z.units,de=G.length;let Te=0;for(let pe=0;pe<de;pe++)Te+=G[pe].data.length;_+=Te,D+=de,z.length=Te,z.dts<k?(z.dts=k,k+=w/4|0||1):k=z.dts,T=Math.min(z.pts,T),A=Math.max(z.pts,A)}x=a[u-1].dts;const N=_+4*D+8;let F;try{F=new Uint8Array(N)}catch(M){this.observer.emit(O.ERROR,O.ERROR,{type:qe.MUX_ERROR,details:te.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:N,reason:`fail allocating video mdat ${N}`});return}const V=new DataView(F.buffer);V.setUint32(0,N),F.set(ee.types.mdat,4);let H=!1,J=Number.POSITIVE_INFINITY,X=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let M=0;M<u;M++){const z=a[M],G=z.units;let de=0;for(let Qe=0,ce=G.length;Qe<ce;Qe++){const Oe=G[Qe],Ue=Oe.data,Ze=Oe.data.byteLength;V.setUint32(g,Ze),g+=4,F.set(Ue,g),g+=Ze,de+=4+Ze}let Te;if(M<u-1)v=a[M+1].dts-z.dts,Te=a[M+1].pts-z.pts;else{const Qe=this.config,ce=M>0?z.dts-a[M-1].dts:w;if(Te=M>0?z.pts-a[M-1].pts:w,Qe.stretchShortVideoTrack&&this.nextAudioTs!==null){const Oe=Math.floor(Qe.maxBufferHole*r),Ue=(i?T+i*r:this.nextAudioTs+h)-z.pts;Ue>Oe?(v=Ue-ce,v<0?v=ce:H=!0,this.log(`It is approximately ${Ue/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=ce}else v=ce}const pe=Math.round(z.pts-z.dts);J=Math.min(J,v),Q=Math.max(Q,v),X=Math.min(X,Te),j=Math.max(j,Te),l.push(gT(z.key,v,de,pe))}if(l.length){if(Wo){if(Wo<70){const M=l[0].flags;M.dependsOn=2,M.isNonSync=0}}else if(ng&&j-X<Q-J&&w/Q<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let M=S;for(let z=0,G=l.length;z<G;z++){const de=M+l[z].duration,Te=M+l[z].cts;if(z<G-1){const pe=de+l[z+1].cts;l[z].duration=pe-Te}else l[z].duration=z?l[z-1].duration:w;l[z].cts=0,M=de}}}v=H||!v?w:v;const K=x+v;this.nextVideoTs=m=K-h,this.videoSampleDuration=v,this.isVideoContiguous=!0;const B={data1:ee.moof(e.sequenceNumber++,S,ts(e,{samples:l})),data2:F,startPTS:(T-h)/r,endPTS:(A+v-h)/r,startDTS:(S-h)/r,endDTS:m/r,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,B}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return S3;case"ac3":return b3;default:return x3}}remuxAudio(e,t,s,i,r){const a=e.inputTimeScale,l=e.samplerate?e.samplerate:a,u=a/l,d=this.getSamplesPerFrame(e),h=d*u,m=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],S=r!==void 0;let x=e.samples,T=g?0:8,A=this.nextAudioTs||-1;const E=m.baseTime*a/m.timescale,R=E+t*a;if(this.isAudioContiguous=s=s||x.length&&A>0&&(i&&Math.abs(R-(A+E))<9e3||Math.abs(Ti(x[0].pts,R)-(A+E))<20*h),x.forEach(function(j){j.pts=Ti(j.pts,R)}),!s||A<0){if(x=x.filter(j=>j.pts>=0),!x.length)return;r===0?A=0:i&&!S?A=Math.max(0,R-E):A=x[0].pts-E}if(e.segmentCodec==="aac"){const j=this.config.maxAudioFramesDrift;for(let K=0,Y=A+E;K<x.length;K++){const re=x[K],B=re.pts,M=B-Y,z=Math.abs(1e3*M/a);if(M<=-j*h&&S)K===0&&(this.warn(`Audio frame @ ${(B/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*M/a)} ms.`),this.nextAudioTs=A=B-E,Y=B);else if(M>=j*h&&z<v3&&S){let G=Math.round(M/h);for(Y=B-G*h;Y<0&&G&&h;)G--,Y+=h;K===0&&(this.nextAudioTs=A=Y-E),this.warn(`Injecting ${G} audio frames @ ${((Y-E)/a).toFixed(3)}s due to ${Math.round(1e3*M/a)} ms gap.`);for(let de=0;de<G;de++){let Te=p3.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=re.unit.subarray()),x.splice(K,0,{unit:Te,pts:Y}),Y+=h,K++}}re.pts=Y,Y+=h}}let L=null,w=null,D,_=0,k=x.length;for(;k--;)_+=x[k].unit.byteLength;for(let j=0,K=x.length;j<K;j++){const Y=x[j],re=Y.unit;let B=Y.pts;if(w!==null){const z=v[j-1];z.duration=Math.round((B-w)/u)}else if(s&&e.segmentCodec==="aac"&&(B=A+E),L=B,_>0){_+=T;try{D=new Uint8Array(_)}catch(z){this.observer.emit(O.ERROR,O.ERROR,{type:qe.MUX_ERROR,details:te.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:_,reason:`fail allocating audio mdat ${_}`});return}g||(new DataView(D.buffer).setUint32(0,_),D.set(ee.types.mdat,4))}else return;D.set(re,T);const M=re.byteLength;T+=M,v.push(gT(!0,d,M,0)),w=B}const N=v.length;if(!N)return;const F=v[v.length-1];A=w-E,this.nextAudioTs=A+u*F.duration;const V=g?new Uint8Array(0):ee.moof(e.sequenceNumber++,L/u,ts({},e,{samples:v}));e.samples=[];const H=(L-E)/a,J=A/a,Q={data1:V,data2:D,startPTS:H,endPTS:J,startDTS:H,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:N};return this.isAudioContiguous=!0,Q}}function Ti(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function T3(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function XI(n,e,t,s){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let l=0;l<i;l++){const u=n.samples[l];u.pts=Ti(u.pts-t.baseTime*r/t.timescale,e*r)/r,u.dts=Ti(u.dts-s.baseTime*r/s.timescale,e*r)/r}const a=n.samples;return n.samples=[],{samples:a}}function WI(n,e,t){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=Ti(l.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((a,l)=>a.pts-l.pts);const r=n.samples;return n.samples=[],{samples:r}}class E3 extends Oi{constructor(e,t,s,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:a}=this.initData=aI(e);if(t)uk(e,t);else{const u=r||a;u!=null&&u.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${u.codec}")!`)}r&&(s=yT(r,as.AUDIO,this)),a&&(i=yT(a,as.VIDEO,this));const l={};r&&a?l.audiovideo={container:"video/mp4",codec:s+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?l.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?l.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,s,i,r,a){var l,u;let{initPTS:d,lastEndTime:h}=this;const m={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};je(h)||(h=this.lastEndTime=r||0);const g=t.samples;if(!g.length)return m;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((l=S)!=null&&l.length||(this.generateInitSegment(g),S=this.initData),!((u=S)!=null&&u.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const x=dk(g,S,this),T=S.audio?x[S.audio.id]:null,A=S.video?x[S.video.id]:null,E=Xd(A,1/0),R=Xd(T,1/0),L=Xd(A,0,!0),w=Xd(T,0,!0);let D=r,_=0;const k=T&&(!A||!d&&R<E||d&&d.trackId===S.audio.id),N=k?T:A;if(N){const Y=N.timescale,re=N.start-r*Y,B=k?S.audio.id:S.video.id;D=N.start/Y,_=k?w-R:L-E,(a||!d)&&(A3(d,D,r,_)||Y!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${r} ${re/Y} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${D-r} (${re}/${Y}) trackId: ${B}`),d=null,v.initPTS=re,v.timescale=Y,v.trackId=B)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);d?(v.initPTS=d.baseTime,v.timescale=d.timescale,v.trackId=d.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=D,v.timescale=1,v.trackId=-1),this.initPTS=d={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const F=D-d.baseTime/d.timescale,V=F+_;_>0?this.lastEndTime=V:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!S.audio,J=!!S.video;let X="";H&&(X+="audio"),J&&(X+="video");const Q=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),j={data1:g,startPTS:F,startDTS:F,endPTS:V,endDTS:V,type:X,hasAudio:H,hasVideo:J,nb:1,dropped:0,encrypted:Q};m.audio=H&&!J?j:void 0,m.video=J?j:void 0;const K=A?.sampleCount;if(K){const Y=A.keyFrameIndex,re=Y!==-1;j.nb=K,j.dropped=Y===0||this.isVideoContiguous?0:re?Y:K,j.independent=re,j.firstKeyFrame=Y,re&&A.keyFrameStart&&(j.firstKeyFramePTS=(A.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(m.independent=re),this.isVideoContiguous||(this.isVideoContiguous=re),j.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Y}/${K} dropped: ${j.dropped} start: ${j.firstKeyFramePTS||"NA"}`)}return m.initSegment=v,m.id3=XI(s,r,d,d),i.samples.length&&(m.text=WI(i,r,d)),m}}function Xd(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function A3(n,e,t,s){if(n===null)return!0;const i=Math.max(s,1),r=e-n.baseTime/n.timescale;return Math.abs(r-t)>i}function yT(n,e,t){const s=n.codec;return s&&s.length>4?s:e===as.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Nh(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Nr;try{Nr=self.performance.now.bind(self.performance)}catch{Nr=Date.now}const Sh=[{demux:c3,remux:E3},{demux:ma,remux:xh},{demux:r3,remux:xh},{demux:o3,remux:xh}];Sh.splice(2,0,{demux:a3,remux:xh});class vT{constructor(e,t,s,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=Nr();let a=new Uint8Array(e);const{currentTransmuxState:l,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:d,discontinuity:h,trackSwitch:m,accurateTimeOffset:g,timeOffset:v,initSegmentChange:S}=i||l,{audioCodec:x,videoCodec:T,defaultInitPts:A,duration:E,initSegmentData:R}=u,L=I3(a,t);if(L&&rl(L.method)){const k=this.getDecrypter(),N=hy(L.method);if(k.isSync()){let F=k.softwareDecrypt(a,L.key.buffer,L.iv.buffer,N);if(s.part>-1){const H=k.flush();F=H&&H.buffer}if(!F)return r.executeEnd=Nr(),ig(s);a=new Uint8Array(F)}else return this.asyncResult=!0,this.decryptionPromise=k.webCryptoDecrypt(a,L.key.buffer,L.iv.buffer,N).then(F=>{const V=this.push(F,null,s);return this.decryptionPromise=null,V}),this.decryptionPromise}const w=this.needsProbing(h,m);if(w){const k=this.configureTransmuxer(a);if(k)return this.logger.warn(`[transmuxer] ${k.message}`),this.observer.emit(O.ERROR,O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),r.executeEnd=Nr(),ig(s)}(h||m||S||w)&&this.resetInitSegment(R,x,T,E,t),(h||S||w)&&this.resetInitialTimestamp(A),d||this.resetContiguity();const D=this.transmux(a,L,v,g,s);this.asyncResult=Zc(D);const _=this.currentTransmuxState;return _.contiguous=!0,_.discontinuity=!1,_.trackSwitch=!1,r.executeEnd=Nr(),D}flush(e){const t=e.transmuxing;t.executeStart=Nr();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:l}=i;if(s){const m=s.flush();m&&a.push(this.push(m.buffer,null,e))}const{demuxer:u,remuxer:d}=this;if(!u||!d){t.executeEnd=Nr();const m=[ig(e)];return this.asyncResult?Promise.resolve(m):m}const h=u.flush(l);return Zc(h)?(this.asyncResult=!0,h.then(m=>(this.flushRemux(a,m,e),a))):(this.flushRemux(a,h,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:l}=t,{accurateTimeOffset:u,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===$e.MAIN?"level":"track"} ${s.level}`);const h=this.remuxer.remux(i,r,a,l,d,u,!0,this.id);e.push({remuxResult:h,chunkMeta:s}),s.transmuxing.executeEnd=Nr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:a,remuxer:l}=this;!a||!l||(a.resetInitSegment(e,t,s,i),l.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,s,i,r):a=this.transmuxUnencrypted(e,s,i,r),a}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:a,id3Track:l,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,l,u,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,s,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let m=0,g=Sh.length;m<g;m++){var a;if((a=Sh[m].demux)!=null&&a.probe(e,this.logger)){r=Sh[m];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,u=this.remuxer,d=r.remux,h=r.demux;(!u||!(u instanceof d))&&(this.remuxer=new d(s,t,i,this.logger)),(!l||!(l instanceof h))&&(this.demuxer=new h(s,t,i,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new cy(this.config)),e}}function I3(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ig=n=>({remuxResult:{},chunkMeta:n});function Zc(n){return"then"in n&&n.then instanceof Function}class R3{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class w3{constructor(e,t,s,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let xT=0;class ZI{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=xT++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const d=u.data,h=this.hls;if(!(!h||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var m;const g=(m=this.workerContext)==null?void 0:m.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{h.logger[d.data.logType]&&h.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,h.trigger(d.event,d.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const d=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const a=(u,d)=>{d=d||{},d.frag=this.frag||void 0,u===O.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(u,d)};this.observer=new py,this.observer.on(O.FRAG_DECRYPTED,a),this.observer.on(O.ERROR,a);const l=Mb(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(r.workerPath||OM()){try{r.workerPath?(u.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=PM(r.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=_M());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:t,config:os(r)})}catch(h){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new vT(this.observer,l,r,"",t,e.logger)}return}}this.transmuxer=new vT(this.observer,l,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=xT++;const t=this.hls.config,s=Mb(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:os(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),NM(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,a,l,u,d,h){var m,g;d.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:S}=this,x=a?a.start:r.start,T=r.decryptdata,A=this.frag,E=!(A&&r.cc===A.cc),R=!(A&&d.level===A.level),L=A?d.sn-A.sn:-1,w=this.part?d.part-this.part.index:-1,D=L===0&&d.id>1&&d.id===A?.stats.chunkCount,_=!R&&(L===1||L===0&&(w===1||D&&w<=0)),k=self.performance.now();(R||L||r.stats.parsing.start===0)&&(r.stats.parsing.start=k),a&&(w||!_)&&(a.stats.parsing.start=k);const N=!(A&&((m=r.initSegment)==null?void 0:m.url)===((g=A.initSegment)==null?void 0:g.url)),F=new w3(E,_,u,R,x,N);if(!_||E||N){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===$e.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${E}
        trackSwitch: ${R}
        contiguous: ${_}
        accurateTimeOffset: ${u}
        timeOffset: ${x}
        initSegmentChange: ${N}`);const V=new R3(s,i,t,l,h);this.configureTransmuxer(V)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:T,chunkMeta:d,state:F},e instanceof ArrayBuffer?[e]:[]);else if(S){const V=S.push(e,T,d,F);Zc(V)?V.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(V)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const i=s.flush(e);Zc(i)?i.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const ST=100;class C3 extends my{constructor(e,t,s){super(e,t,s,"audio-stream-controller",$e.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:a}){if(s===$e.MAIN){const l=t.cc,u=this.fragCurrent;if(this.initPTS[l]={baseTime:i,timescale:r,trackId:a},this.log(`InitPTS for cc: ${l} found from main: ${i/r} (${i}/${r}) trackId: ${a}`),this.mainAnchor=t,this.state===ye.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==l)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==l?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===ye.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const i=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&i?.cc===t.cc)return;const r=(i||e).cc,a=this.getLevelDetails(),l=this.getLoadPosition(),u=gI(a,r,l);u&&(this.log(`Syncing with main frag at ${u.start} cc ${u.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===ye.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ye.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(ST),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ye.IDLE):this.state=ye.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ye.IDLE:this.doTickIdle();break;case ye.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],i=s?.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=ye.WAITING_INIT_PTS}break}case ye.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ye.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ye.FRAG_LOADING;const l=i.flush().buffer,u={frag:t,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),r&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ye.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(s!=null&&s[r]))return;const l=s[r],u=l.details;if(!u||this.waitForLive(l)||this.waitForCdnTuneIn(u)){this.state=ye.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,as.AUDIO,$e.AUDIO));const h=this.getFwdBufferInfo(d,$e.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,u)){t.trigger(O.BUFFER_EOS,{type:"audio"}),this.state=ye.ENDED;return}const m=h.len,g=t.maxBufferLength,v=u.fragments,S=v[0].start,x=this.getLoadPosition(),T=this.flushing?x:h.end;if(this.switchingTrack&&i){const R=x;u.PTSKnown&&R<S&&(h.end>S||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=S+.05)}if(m>=g&&!this.switchingTrack&&T<v[v.length-1].start)return;let A=this.getNextFragment(T,u);if(A&&this.isLoopLoading(A,T)&&(A=this.getNextFragmentLoopLoading(A,u,h,$e.MAIN,g)),!A){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&Ys(A)&&!A.endList&&(!u.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===en.OK&&(this.mainFragLoading=E=null),E&&Ys(E))){if(A.start>E.end){const L=this.fragmentTracker.getFragAtPos(T,$e.MAIN);L&&L.end>E.end&&(E=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(A.start>E.end)return}this.loadFragment(A,l,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new qc(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ye.STOPPED&&(this.setInterval(ST),this.state=ye.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(O.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:a,groupId:l,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${u.name}" of "${l}"`);return}const d=this.mainDetails;if(!d||r.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==ye.STOPPED&&(this.state=ye.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${u.name}" of "${l}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const h=i[a];let m=0;if(r.live||(s=h.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(h.details){var g;m=this.alignPlaylists(r,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}r.alignedSliding||(_I(r,d),r.alignedSliding||jh(r,d),m=r.fragmentStart)}h.details=r,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(d,m),this.hls.trigger(O.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===ye.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ye.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:a,trackId:l,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=u[l];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const h=d.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const m=a.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new ZI(this.hls,$e.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(v!==void 0){const T=i?i.index:-1,A=T!==-1,E=new uy(s.level,s.sn,s.stats.chunkCount,r.byteLength,T,A);g.push(r,S,m,"",s,i,h.totalduration,!1,E,v)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${h.startSN} ,${h.endSN}],track ${l}`);const{cache:x}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new PI,complete:!1};x.push(new Uint8Array(r)),this.state!==ye.STOPPED&&(this.state=ye.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===$e.MAIN&&Ys(t.frag)&&(this.mainFragLoading=t,this.state===ye.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type!==$e.AUDIO){!this.audioOnly&&s.type===$e.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ys(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(O.AUDIO_TRACK_SWITCHED,Xt({},r)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ye.ERROR;return}switch(t.details){case te.FRAG_GAP:case te.FRAG_PARSING_ERROR:case te.FRAG_DECRYPT_ERROR:case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($e.AUDIO,t);break;case te.AUDIO_TRACK_LOAD_ERROR:case te.AUDIO_TRACK_LOAD_TIMEOUT:case te.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ye.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===wt.AUDIO_TRACK&&(this.state=ye.IDLE);break;case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case te.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case te.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==as.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==as.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ye.ENDED&&(this.state=ye.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,$e.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}const{frag:u,part:d,level:h}=l,{details:m}=h,{audio:g,text:v,id3:S,initSegment:x}=r;if(this.fragContextChanged(u)||!m){this.fragmentTracker.removeFragment(u);return}if(this.state=ye.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const T=u.initSegment||u;if(this.unhandledEncryptionError(x,u))return;this._bufferInitSegment(h,x.tracks,T,a),i.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:x.tracks})}if(g){const{startPTS:T,endPTS:A,startDTS:E,endDTS:R}=g;d&&(d.elementaryStreams[as.AUDIO]={startPTS:T,endPTS:A,startDTS:E,endDTS:R}),u.setElementaryStreamInfo(as.AUDIO,T,A,E,R),this.bufferFragmentData(g,u,d,a)}if(S!=null&&(t=S.samples)!=null&&t.length){const T=ts({id:s,frag:u,details:m},S);i.trigger(O.FRAG_PARSING_METADATA,T)}if(v){const T=ts({id:s,frag:u,details:m},v);i.trigger(O.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,s,i){if(this.state!==ye.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=$e.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(O.BUFFER_CODECS,t);const l=r.initSegment;if(l!=null&&l.byteLength){const u={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:l};this.hls.trigger(O.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===en.NOT_LOADED||i===en.PARTIAL){var r;if(!Ys(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ye.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&jh(t.details,a)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:l}=this.bufferedTrack;Za({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:l},e,Ka)||(Mh(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(O.AUDIO_TRACK_SWITCHED,Xt({},e))}}class Ty extends Oi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=t?.renditionReports;if(i){let r=-1;for(let a=0;a<i.length;a++){const l=i[a];let u;try{u=new self.URL(l.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),u=l.URI||""}if(u===e){r=a;break}else u===e.substring(0,u.length)&&(r=a)}if(r!==-1){const a=i[r],l=parseInt(a["LAST-MSN"])||t.lastPartSn;let u=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&h>t.partTarget&&(u+=1)}const d=s&&Ub(s);return new Fb(l,u>=0?u:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,a=self.performance.now(),l=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-l;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const h=Math.max(u||0,0);i.appliedTimelineOffset=h,i.fragments.forEach(m=>{m.setStart(m.playlistOffset+h)})}if(i.live||s!=null&&s.live){const h="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){SM(s,i,this);const E=i.playlistParsingError;if(E){this.warn(E);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var d;const{networkDetails:L}=t;R.trigger(O.ERROR,{type:qe.NETWORK_ERROR,details:te.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:E,reason:E.message,level:t.level||void 0,parent:(d=i.fragments[0])==null?void 0:d.type,networkDetails:L,stats:r});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=r.loading.start);const m=this.hls.mainForwardBufferInfo,g=m?m.end-m.len:0,v=(i.edge-g)*1e3,S=wI(i,v);if(i.requestScheduled+S<a?i.requestScheduled=a:i.requestScheduled+=S,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let x,T,A;if(i.canBlockReload&&i.endSN&&i.advanced){const E=this.hls.config.lowLatencyMode,R=i.lastPartSn,L=i.endSN,w=i.lastPartIndex,D=w!==-1,_=R===L;D?_?(T=L+1,A=E?0:w):(T=R,A=E?w+1:i.maxPartIndex):T=L+1;const k=i.age,N=k+i.ageHeader;let F=Math.min(N-i.partTarget,i.targetduration*1.5);if(F>0){if(N>i.targetduration*3)this.log(`Playlist last advanced ${k.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,A=void 0;else if(s!=null&&s.tuneInGoal&&N-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${F} with playlist age: ${i.age}`),F=0;else{const V=Math.floor(F/i.targetduration);if(T+=V,A!==void 0){const H=Math.round(F%i.targetduration/i.partTarget);A+=H}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${k.toFixed(2)}s goal: ${F} skip sn ${V} to part ${A}`)}i.tuneInGoal=F}if(x=this.getDeliveryDirectives(i,t.deliveryDirectives,T,A),E||!_){i.requestScheduled=a,this.loadingPlaylist(h,x);return}}else(i.canBlockReload||i.canSkipUntil)&&(x=this.getDeliveryDirectives(i,t.deliveryDirectives,T,A));x&&T!==void 0&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(S-l*2,S/2)),this.scheduleLoading(h,x,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i){this.loadingPlaylist(e,t);return}const r=self.performance.now(),a=i.requestScheduled;if(r>=a){this.loadingPlaylist(e,t);return}const l=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),l)}getDeliveryDirectives(e,t,s,i){let r=Ub(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=yh.No),new Fb(s,i,r)}checkRetry(e){const t=e.details,s=Uh(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:l}=i||{},u=!!i&&!!l&&(r===pn.RetryRequest||!i.resolved&&r===pn.SendAlternateToPenaltyBox);if(u){var d;if(a>=l.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=ly(l,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function JI(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Jc(n[t].attrs,e[t].attrs))return!1;return!0}function Jc(n,e,t){const s=n["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function m0(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class L3 extends Ty{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Audio track with id:${s} and group:${i} not found in active group ${a?.groupId}`);return}const l=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||i?.length!==s?.length||s!=null&&s.some(l=>i?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(g=>g.default)&&(this.selectDefaultTrack=!1),l.forEach((g,v)=>{g.id=v});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const u=this.hls.config.audioPreference;if(!r&&u){const g=or(u,l,Ka);if(g>-1)r=l[g];else{const v=or(u,this.tracks);r=this.tracks[v]}}let d=this.findTrackId(r);d===-1&&r&&(d=this.findTrackId(null));const h={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(O.AUDIO_TRACKS_UPDATED,h);const m=this.trackId;if(d!==-1&&m===-1)this.setAudioTrack(d);else if(l.length&&m===-1){var a;const g=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${l.length}`);this.warn(g.message),this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:g})}}}onError(e,t){t.fatal||!t.context||t.context.type===wt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Za(e,i,Ka))return i;const r=or(e,this.tracksInGroup,Ka);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const l=jk(e,t.levels,s,a,Ka);if(l===-1)return null;t.nextLoadLevel=l}if(e.channels||e.audioCodec){const a=or(e,s);if(a>-1)return s[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(O.AUDIO_TRACK_SWITCHING,Xt({},i)),r))return;const a=this.switchParams(i.url,s?.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Za(e,i,Ka)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:a,audioCodec:l,channels:u}=e;for(let d=0;d<t.length;d++){const h=t[d];if(Za({name:s,lang:i,assocLang:r,characteristics:a,audioCodec:l,channels:u},h,Ka))return d}for(let d=0;d<t.length;d++){const h=t[d];if(Jc(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const h=t[d];if(Jc(e.attrs,h.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Mh(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(O.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}}class D3{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){var s;if(i.onError(r),this.queues===null||this.tracks===null)return;const a=(s=this.tracks[e])==null?void 0:s.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],i=s?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const bT=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,eR="HlsJsTrackRemovedError";class O3 extends Error{constructor(e){super(e),this.name=eR}}class _3 extends Oi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:i,mediaSource:r}=this;s&&this.log("Media source opened"),!(!i||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(O.MEDIA_ATTACHED,{media:i,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:i}=this;s!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=ek(xa(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.BUFFER_EOS,this.onBufferEos,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.FRAG_PARSED,this.onFragParsed,this),e.on(O.FRAG_CHANGED,this.onFragChanged,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_EOS,this.onBufferEos,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.FRAG_PARSED,this.onFragParsed,this),e.off(O.FRAG_CHANGED,this.onFragChanged,this),e.off(O.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?ts(s,i.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(s[a]=ts({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const i=xa(this.appendSource);if(i){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),r)this._objectUrl=s.src,this.attachTransferred();else{const l=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const u=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||u&&a instanceof u,TT(s),P3(s,l),s.load()}catch{s.src=l}else s.src=l}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,l=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${os(s,(u,d)=>u==="initSegment"?void 0:d)};
transfer tracks: ${os(i,(u,d)=>u==="initSegment"?void 0:d)}}`),!JA(i,s)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,d=this.details,h=Math.max(u,d?.fragments[0].start||0);if(h-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${h} currentTime: ${u}`),this.onMediaDetaching(O.MEDIA_DETACHING,{}),this.onMediaAttaching(O.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,r.forEach(u=>{const d=u,h=i[d];if(h){const m=h.buffer;if(m){const g=this.fragmentTracker,v=h.id;if(g.hasFragments(v)||g.hasParts(v)){const T=ft.getBuffered(m);g.detectEvictedFragments(d,T,v,null,!0)}const S=rg(d),x=[d,m];this.sourceBuffers[S]=x,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,h)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const l=r.readyState==="open";try{const u=r.sourceBuffers;for(let d=u.length;d--;)l&&u[d].abort(),r.removeSourceBuffer(u[d]);l&&r.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&TT(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(O.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[rg(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new D3(this.tracks)}onBufferCodecs(e,t){var s;const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),l=!a&&this.sourceBufferCount&&this.media&&r.some(u=>!i[u]);if(a||l){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(u=>{var d,h;const m=t[u],{id:g,codec:v,levelCodec:S,container:x,metadata:T,supplemental:A}=m;let E=i[u];const R=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[u],L=R!=null&&R.buffer?R:E,w=L?.pendingCodec||L?.codec,D=L?.levelCodec;E||(E=i[u]={buffer:void 0,listeners:[],codec:v,supplemental:A,container:x,levelCodec:S,metadata:T,id:g});const _=gh(w,D),k=_?.replace(bT,"$1");let N=gh(v,S);const F=(h=N)==null?void 0:h.replace(bT,"$1");N&&_&&k!==F&&(u.slice(0,5)==="audio"&&(N=Nh(N,this.appendSource)),this.log(`switching codec ${w} to ${N}`),N!==(E.pendingCodec||E.codec)&&(E.pendingCodec=N),E.container=x,this.appendChangeType(u,x,N))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const l=a.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),l.changeType(i),a.codec=s,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,$e.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var l;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&ft.isBuffered(u.buffer,i)||((l=this.fragmentTracker.getAppendedFrag(i,$e.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:a,frag:l,part:u,chunkMeta:d,offset:h}=t,m=d.buffering[r],{sn:g,cc:v}=l,S=self.performance.now();m.start=S;const x=l.stats.buffering,T=u?u.stats.buffering:null;x.start===0&&(x.start=S),T&&T.start===0&&(T.start=S);const A=s.audio;let E=!1;r==="audio"&&A?.container==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const R=s.video,L=R?.buffer;if(L&&g!=="initSegment"){const _=u||l,k=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const F=_.start+_.duration*.05,V=L.buffered,H=this.currentOp("video");!V.length&&!H?this.blockAudio(_):!H&&!ft.isBuffered(L,F)&&this.lastVideoAppendEnd<F&&this.blockAudio(_)}else if(r==="video"){const N=_.end;if(k){const F=k.frag.start;(N>F||N<this.lastVideoAppendEnd||ft.isBuffered(L,F))&&this.unblockAudio()}this.lastVideoAppendEnd=N}}const w=(u||l).start,D={label:`append-${r}`,execute:()=>{var _;m.executeStart=self.performance.now();const k=(_=this.tracks[r])==null?void 0:_.buffer;k&&(E?this.updateTimestampOffset(k,w,.1,r,g,v):h!==void 0&&je(h)&&this.updateTimestampOffset(k,h,1e-6,r,g,v)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const _=self.performance.now();m.executeEnd=m.end=_,x.first===0&&(x.first=_),T&&T.first===0&&(T.first=_);const k={};this.sourceBuffers.forEach(([N,F])=>{N&&(k[N]=ft.getBuffered(F))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(O.BUFFER_APPENDED,{type:r,frag:l,part:u,chunkMeta:d,parent:l.type,timeRanges:k})},onError:_=>{var k;const N={type:qe.MEDIA_ERROR,parent:l.type,details:te.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:l,part:u,chunkMeta:d,error:_,err:_,fatal:!1},F=(k=this.media)==null?void 0:k.error;if(_.code===DOMException.QUOTA_EXCEEDED_ERR||_.name=="QuotaExceededError"||"quota"in _)N.details=te.BUFFER_FULL_ERROR;else if(_.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!F)N.errorAction=il(!0);else if(_.name===eR&&this.sourceBufferCount===0)N.errorAction=il(!0);else{const V=++this.appendErrors[r];this.warn(`Failed ${V}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${F||"no media error"})`),(V>=this.hls.config.appendErrorMaxRetry||F)&&(N.fatal=!0)}this.hls.trigger(O.ERROR,N)}};this.log(`queuing "${r}" append sn: ${g}${u?" p: "+u.index:""} of ${l.type===$e.MAIN?"level":"track"} ${l.level} cc: ${v}`),this.append(D,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(O.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,r),a)})}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],a=i?i.elementaryStreams:s.elementaryStreams;a[as.AUDIOVIDEO]?r.push("audiovideo"):(a[as.AUDIO]&&r.push("audio"),a[as.VIDEO]&&r.push("video"));const l=()=>{const u=self.performance.now();s.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const d=i?i.stats:s.stats;this.hls.trigger(O.FRAG_BUFFERED,{frag:s,part:i,stats:d,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(l,r).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([a])=>{if(a){const l=this.tracks[a];(!t.type||t.type===a)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var l;return a&&!((l=this.tracks[a])!=null&&l.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(O.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(O.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===te.BUFFER_APPEND_ERROR&&t.frag){var s;const i=(s=t.errorAction)==null?void 0:s.nextAutoLevel;je(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,a=t.levelTargetDuration,l=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(je(l)&&l>=0){const d=Math.max(l,a),h=Math.floor(r/a)*a-d;this.flushBackBuffer(r,a,h)}const u=i.frontBufferFlushThreshold;if(je(u)&&u>0){const d=Math.max(i.maxBufferLength,u),h=Math.max(d,a),m=Math.floor(r/a)*a+h;this.flushFrontBuffer(r,a,m)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const l=ft.getBuffered(r);if(l.length>0&&s>l.start(0)){var a;this.hls.trigger(O.BACK_BUFFER_REACHED,{bufferEnd:s});const u=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(O.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:i})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const a=ft.getBuffered(r),l=a.length;if(l<2)return;const u=a.start(l-1),d=a.end(l-1);if(s>u||e>=u&&e<=d)return;this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),h=Math.max(d,i);return{duration:1/0,start:d,end:h}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return je(r)?{duration:r}:null;const a=this.media.duration,l=je(s.duration)?s.duration:0;return i>l&&i>a||!je(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(je(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${os(s)}`),this.tracksReady){var i;const r=(i=this.transferData)==null?void 0:i.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(O.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,l=e[a];if(this.isPending(l)){const u=this.getTrackCodec(l,a),d=`${l.container};codecs=${u}`;l.codec=u,this.log(`creating sourceBuffer(${d})${this.currentOp(a)?" Queued":""} ${os(l)}`);try{const h=s.addSourceBuffer(d),m=rg(a),g=[a,h];t[m]=g,l.buffer=h}catch(h){var i;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:a,mimeType:d,parent:l.id});return}this.trackSourceBuffer(a,l)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&(t==="video"||t==="audiovideo")&&Kc(s,"video")&&(i=bk(i,s));const r=gh(i,e.levelCodec);return r?t.slice(0,5)==="audio"?Nh(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const l=a.removedRanges;l!=null&&l.length&&this.hls.trigger(O.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,s,i,r,a){const l=t-e.timestampOffset;Math.abs(l)>=s&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,a=this.tracks[e],l=a?.buffer;if(!i||!r||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=je(i.duration)?i.duration:1/0,d=je(r.duration)?r.duration:1/0,h=Math.max(0,t),m=Math.min(s,u,d);m>h&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${h},${m}] from the ${e} SourceBuffer`),l.remove(h,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=s?.buffer;if(!i)throw new O3(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const i=(s=this.tracks[t])==null?void 0:s.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=s.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(i=>{s.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function TT(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function P3(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function rg(n){return n==="audio"?1:0}class Ey{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&je(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((i,r)=>this.isLevelAllowed(i)&&r<=e);return this.clientRect=null,Ey.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const i=(l,u)=>u?l.width!==u.width||l.height!==u.height:!0;let r=e.length-1;const a=Math.max(t,s);for(let l=0;l<e.length;l+=1){const u=e[l];if((u.width>=a||u.height>=a)&&i(u,e[l+1])){r=l;break}}return r}}const N3={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Fn=N3,k3={HLS:"h"},M3=k3;class ur{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof ur?s:new ur(s))),this.value=e,this.params=t}}const U3="Dict";function F3(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function B3(n,e,t,s){return new Error(`failed to ${n} "${F3(e)}" as ${t}`,{cause:s})}function dr(n,e,t){return B3("serialize",n,e,t)}class tR{constructor(e){this.description=e}}const ET="Bare Item",j3="Boolean";function V3(n){if(typeof n!="boolean")throw dr(n,j3);return n?"?1":"?0"}function $3(n){return btoa(String.fromCharCode(...n))}const G3="Byte Sequence";function H3(n){if(ArrayBuffer.isView(n)===!1)throw dr(n,G3);return`:${$3(n)}:`}const z3="Integer";function K3(n){return n<-999999999999999||999999999999999<n}function sR(n){if(K3(n))throw dr(n,z3);return n.toString()}function Y3(n){return`@${sR(n.getTime()/1e3)}`}function nR(n,e){if(n<0)return-nR(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const q3="Decimal";function Q3(n){const e=nR(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw dr(n,q3);const t=e.toString();return t.includes(".")?t:`${t}.0`}const X3="String",W3=/[\x00-\x1f\x7f]+/;function Z3(n){if(W3.test(n))throw dr(n,X3);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function J3(n){return n.description||n.toString().slice(7,-1)}const eU="Token";function AT(n){const e=J3(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw dr(e,eU);return e}function p0(n){switch(typeof n){case"number":if(!je(n))throw dr(n,ET);return Number.isInteger(n)?sR(n):Q3(n);case"string":return Z3(n);case"symbol":return AT(n);case"boolean":return V3(n);case"object":if(n instanceof Date)return Y3(n);if(n instanceof Uint8Array)return H3(n);if(n instanceof tR)return AT(n);default:throw dr(n,ET)}}const tU="Key";function g0(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw dr(n,tU);return n}function Ay(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${g0(e)}`:`;${g0(e)}=${p0(t)}`).join("")}function iR(n){return n instanceof ur?`${p0(n.value)}${Ay(n.params)}`:p0(n)}function sU(n){return`(${n.value.map(iR).join(" ")})${Ay(n.params)}`}function nU(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw dr(n,U3);const t=n instanceof Map?n.entries():Object.entries(n),s=e?.whitespace?" ":"";return Array.from(t).map(([i,r])=>{r instanceof ur||(r=new ur(r));let a=g0(i);return r.value===!0?a+=Ay(r.params):(a+="=",Array.isArray(r.value)?a+=sU(r):a+=iR(r)),a}).join(`,${s}`)}function rR(n,e){return nU(n,e)}const nr="CMCD-Object",Ps="CMCD-Request",Ha="CMCD-Session",ha="CMCD-Status",iU={br:nr,ab:nr,d:nr,ot:nr,tb:nr,tpb:nr,lb:nr,tab:nr,lab:nr,url:nr,pb:Ps,bl:Ps,tbl:Ps,dl:Ps,ltc:Ps,mtp:Ps,nor:Ps,nrr:Ps,rc:Ps,sn:Ps,sta:Ps,su:Ps,ttfb:Ps,ttfbb:Ps,ttlb:Ps,cmsdd:Ps,cmsds:Ps,smrt:Ps,df:Ps,cs:Ps,ts:Ps,cid:Ha,pr:Ha,sf:Ha,sid:Ha,st:Ha,v:Ha,msd:Ha,bs:ha,bsd:ha,cdn:ha,rtp:ha,bg:ha,pt:ha,ec:ha,e:ha},rU={REQUEST:Ps};function aU(n){return Object.keys(n).reduce((e,t)=>{var s;return(s=n[t])===null||s===void 0||s.forEach(i=>e[i]=t),e},{})}function oU(n,e){const t={};if(!n)return t;const s=Object.keys(n),i=e?aU(e):{};return s.reduce((r,a)=>{var l;const u=iU[a]||i[a]||rU.REQUEST,d=(l=r[u])!==null&&l!==void 0?l:r[u]={};return d[a]=n[a],r},t)}function lU(n){return["ot","sf","st","e","sta"].includes(n)}function cU(n){return typeof n=="number"?je(n):n!=null&&n!==""&&n!==!1}const aR="event";function uU(n,e){const t=new URL(n),s=new URL(e);if(t.origin!==s.origin)return n;const i=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;i[0]===r[0];)i.shift(),r.shift();for(;r.length;)r.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const bh=n=>Math.round(n),y0=(n,e)=>Array.isArray(n)?n.map(t=>y0(t,e)):n instanceof ur&&typeof n.value=="string"?new ur(y0(n.value,e),n.params):(e.baseUrl&&(n=uU(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Wd=n=>bh(n/100)*100,dU=(n,e)=>{let t=n;return e.version>=2&&(n instanceof ur&&typeof n.value=="string"?t=new ur([n]):typeof n=="string"&&(t=[n])),y0(t,e)},hU={br:bh,d:bh,bl:Wd,dl:Wd,mtp:Wd,nor:dU,rtp:Wd,tb:bh},oR="request",lR="response",Iy=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],fU=["e"],mU=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function uf(n){return mU.test(n)}function pU(n){return Iy.includes(n)||fU.includes(n)||uf(n)}const cR=["d","dl","nor","ot","rtp","su"];function gU(n){return Iy.includes(n)||cR.includes(n)||uf(n)}const yU=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function vU(n){return Iy.includes(n)||cR.includes(n)||yU.includes(n)||uf(n)}const xU=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function SU(n){return xU.includes(n)||uf(n)}const bU={[lR]:vU,[aR]:pU,[oR]:gU};function uR(n,e={}){const t={};if(n==null||typeof n!="object")return t;const s=e.version||n.v||1,i=e.reportingMode||oR,r=s===1?SU:bU[i];let a=Object.keys(n).filter(r);const l=e.filter;typeof l=="function"&&(a=a.filter(l));const u=i===lR||i===aR;u&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const d=ts({},hU,e.formatters),h={version:s,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(m=>{let g=n[m];const v=d[m];if(typeof v=="function"&&(g=v(g,h)),m==="v"){if(s===1)return;g=s}m=="pr"&&g===1||(u&&m==="ts"&&!je(g)&&(g=Date.now()),cU(g)&&(lU(m)&&typeof g=="string"&&(g=new tR(g)),t[m]=g))}),t}function TU(n,e={}){const t={};if(!n)return t;const s=uR(n,e),i=oU(s,e?.customHeaderMap);return Object.entries(i).reduce((r,[a,l])=>{const u=rR(l,{whitespace:!1});return u&&(r[a]=u),r},t)}function EU(n,e,t){return ts(n,TU(e,t))}const AU="CMCD";function IU(n,e={}){return n?rR(uR(n,e),{whitespace:!1}):""}function RU(n,e={}){if(!n)return"";const t=IU(n,e);return encodeURIComponent(t)}function wU(n,e={}){if(!n)return"";const t=RU(n,e);return`${AU}=${t}`}const IT=/CMCD=[^&#]+/;function CU(n,e,t){const s=wU(e,t);if(!s)return n;if(IT.test(n))return n.replace(IT,s);const i=n.includes("?")?"&":"?";return`${n}${i}${s}`}class LU{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Fn.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=i=>{try{const{frag:r,part:a}=i,l=this.hls.levels[r.level],u=this.getObjectType(r),d={d:(a||r).duration*1e3,ot:u};(u===Fn.VIDEO||u===Fn.AUDIO||u==Fn.MUXED)&&(d.br=l.bitrate/1e3,d.tb=this.getTopBandwidth(u)/1e3,d.bl=this.getBufferLength(u));const h=a?this.getNextPart(a):this.getNextFrag(r);h!=null&&h.url&&h.url!==r.url&&(d.nor=h.url),this.apply(i,d)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHED,this.onMediaDetached,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHED,this.onMediaDetached,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:M3.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ts(t,this.createData());const s=t.ot===Fn.INIT||t.ot===Fn.VIDEO||t.ot===Fn.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,l)=>(i.includes(l)&&(a[l]=t[l]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),EU(e.headers,t,r)):e.url=CU(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const i=e.sn-s.startSN;return s.fragments[i+1]}}getNextPart(e){var t;const{index:s,fragment:i}=e,r=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:a}=i;for(let l=r.length-1;l>=0;l--){const u=r[l];if(u.index===s&&u.fragment.sn===a)return r[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Fn.TIMED_TEXT;if(e.sn==="initSegment")return Fn.INIT;if(t==="audio")return Fn.AUDIO;if(t==="main")return this.hls.audioTracks.length?Fn.VIDEO:Fn.MUXED}getTopBandwidth(e){let t=0,s;const i=this.hls;if(e===Fn.AUDIO)s=i.audioTracks;else{const r=i.maxAutoLevel,a=r>-1?r+1:i.levels.length;s=i.levels.slice(0,a)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Fn.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:ft.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){t(r),this.loader.load(r,a,l)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){t(r),this.loader.load(r,a,l)}}}}const DU=3e5;class OU extends Oi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===pn.SendAlternateToPenaltyBox&&s.flags===ni.MoveAllAlternatesMatchingHost){const i=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:l,pathwayId:u,type:d}=t.context;l&&i?a=this.getPathwayForGroupId(l,d,a):u&&(a=u)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&i&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==a),t.details===te.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${os(r)} penalized: ${os(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach(r=>{i-s[r]>DU&&delete s[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in s)continue;if(a===this.pathwayId)return;const l=this.hls.nextLoadLevel,u=this.hls.levels[l];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,DI(t),this.hls.trigger(O.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[l];u&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===wt.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===wt.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach(r=>{const{ID:a,"BASE-ID":l,"URI-REPLACEMENT":u}=r;if(t.some(h=>h.pathwayId===a))return;const d=this.getLevelsForPathway(l).map(h=>{const m=new As(h.attrs);m["PATHWAY-ID"]=a;const g=m.AUDIO&&`${m.AUDIO}_clone_${a}`,v=m.SUBTITLES&&`${m.SUBTITLES}_clone_${a}`;g&&(s[m.AUDIO]=g,m.AUDIO=g),v&&(i[m.SUBTITLES]=v,m.SUBTITLES=v);const S=dR(h.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),x=new qc({attrs:m,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:S,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let T=1;T<h.audioGroups.length;T++)x.addGroupId("audio",`${h.audioGroups[T]}_clone_${a}`);if(h.subtitleGroups)for(let T=1;T<h.subtitleGroups.length;T++)x.addGroupId("text",`${h.subtitleGroups[T]}_clone_${a}`);return x});t.push(...d),RT(this.audioTracks,s,u,a),RT(this.subtitleTracks,i,u,a)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+h)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,l=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(h,m,g,v)=>{this.log(`Loaded steering manifest: "${i}"`);const S=h.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":A}=S;if(x)try{this.uri=new self.URL(x,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||g.url),T&&this.clonePathways(T);const E={steeringManifest:S,url:i.toString()};this.hls.trigger(O.STEERING_MANIFEST_LOADED,E),A&&this.updatePathwayPriority(A)},onError:(h,m,g,v)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${m.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let S=this.timeToLoad*1e3;if(h.code===429){const x=this.loader;if(typeof x?.getResponseHeader=="function"){const T=x.getResponseHeader("Retry-After");T&&(S=parseFloat(T)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,S)},onTimeout:(h,m,g)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,u,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const i=(s=this.hls)==null?void 0:s.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function RT(n,e,t,s){n&&Object.keys(e).forEach(i=>{const r=n.filter(a=>a.groupId===i).map(a=>{const l=ts({},a);return l.details=void 0,l.attrs=new As(l.attrs),l.url=l.attrs.URI=dR(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),l.groupId=l.attrs["GROUP-ID"]=e[i],l.attrs["PATHWAY-ID"]=s,l});n.push(...r)})}function dR(n,e,t,s){const{HOST:i,PARAMS:r,[t]:a}=s;let l;e&&(l=a?.[e],l&&(n=l));const u=new self.URL(n);return i&&!l&&(u.host=i),r&&Object.keys(r).sort().forEach(d=>{d&&u.searchParams.set(d,r[d])}),u.href}class al extends Oi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=al.CDMCleanupPromise?[al.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:i}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Pc(this.config));const l=a.map(Wp).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(a=>{const l=vh(a);if(s!=="sinf"||l!==Is.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${l}`);return}let u;try{const v=Zs(new Uint8Array(i)),S=fy(JSON.parse(v).sinf),x=oI(S);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(x.subarray(8,24))}catch(v){this.warn(`${r} Failed to parse sinf: ${v}`);return}const d=jn(u),{keyIdToKeySessionPromise:h,mediaKeySessions:m}=this;let g=h[d];for(let v=0;v<m.length;v++){const S=m[v],x=S.decryptdata;if(!x.keyId)continue;const T=jn(x.keyId);if(dy(u,x.keyId)||x.uri.replace(/-/g,"").indexOf(d)!==-1){if(g=h[T],!g)continue;if(x.pssh)break;delete h[T],x.pssh=new Uint8Array(i),x.keyId=u,g=h[d]=g.then(()=>this.generateRequestWithPreferredKeySession(S,s,i,"encrypted-event-key-match")),g.catch(A=>this.handleError(A));break}}g||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(O.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(O.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t?.[e];if(i)return i.licenseUrl;if(e===Is.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(a,l,u)=>!!a&&u.indexOf(a)===l,i=t.map(a=>a.audioCodec).filter(s),r=t.map(a=>a.videoCodec).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,l)=>{const u=d=>{const h=d.shift();this.getMediaKeysPromise(h,i,r).then(m=>a({keySystem:h,mediaKeys:m})).catch(m=>{d.length?u(d):m instanceof ti?l(m):l(new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${s}`;return EI===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return s(e,t)}getMediaKeysPromise(e,t,s){var i;const r=dM(e,t,s,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],l=(i=a)==null?void 0:i.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${os(r)}`),l=this.requestMediaKeySystemAccess(e,r);const u=a=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),l.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=u.mediaKeys=d.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,h.then(v=>v?this.setMediaKeysServerCertificate(g,e,v):g)));return m.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),m})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${jn(e.keyId||[])} keyUri: ${e.uri}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=Zd(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${jn(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Wp(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const r=Wp(i);r?t(r):s(new Error(`Unable to find format for key-system "${i}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Pc(this.config),s=e.map(vh).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const i=_U(e,t[s]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,s=Zd(t),i=this.bannedKeyIds[s];if(i||this.getKeyStatus(t)==="internal-error"){const l=wT(i||"internal-error",t);return this.handleError(l,e.frag),Promise.reject(l)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const a=this.keyIdToKeySessionPromise[s];if(!a){const l=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(u,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:t}))))).then(u=>{const d="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,d,h,"playlist-key")});return l.catch(u=>this.handleError(u,e.frag)),this.keyIdToKeySessionPromise[s]=l,l}return a.catch(l=>{if(l instanceof ti){const u=Xt({},l.data);this.getKeyStatus(t)==="internal-error"&&(u.decryptdata=t);const d=new ti(u,l.message);this.handleError(d,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof ti){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${jn(s.keyId||[])})`:""}`),this.hls.trigger(O.ERROR,e.data)}else this.error(e.message),this.hls.trigger(O.ERROR,{type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Zd(e),s=this.keyIdToKeySessionPromise[t];if(!s){const i=vh(e.keyFormat),r=i?[i]:Pc(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Pc(this.config)),e.length===0)throw new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${os({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,i){var r;const a=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(a)try{const S=a.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=Zd(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${l} URI: ${u} (init data type: ${t} length: ${s.byteLength})`);const d=new py,h=e._onmessage=S=>{const x=e.mediaKeysSession;if(!x){d.emit("error",new Error("invalid state"));return}const{messageType:T,message:A}=S;this.log(`"${T}" message event for session "${x.sessionId}" message size: ${A.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,A).catch(E=>{d.eventNames().length?d.emit("error",E):this.handleError(E)}):T==="license-release"?e.keySystem===Is.FAIRPLAY&&this.updateKeySession(e,c0("acknowledged")).then(()=>this.removeSession(e)).catch(E=>this.handleError(E)):this.warn(`unhandled media key message type "${T}"`)},m=(S,x)=>{x.keyStatus=S;let T;S.startsWith("usable")?d.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?T=wT(S,x.decryptdata):S==="expired"?T=new Error(`key expired (keyId: ${l})`):S==="released"?T=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${l})`),T&&(d.eventNames().length?d.emit("error",T):this.handleError(T))},g=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(L=>T[L]!=="status-pending"))return;if(T[l]==="expired"){this.log(`Expired key ${os(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let E=T[l];if(E)m(E,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[l]||(R[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),m(w,e);this.log(`key status for ${l} in key-session "${e.mediaKeysSession.sessionId}" timed out after 0ms`),E="internal-error",m(E,e)},0)),this.log(`No status for keyId ${l} (${os(T)}).`)}};Dn(e.mediaKeysSession,"message",h),Dn(e.mediaKeysSession,"keystatuseschange",g);const v=new Promise((S,x)=>{d.on("error",x),d.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${l} URI: ${u}`)}).catch(S=>{throw new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>v).catch(S=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,i)=>{if(typeof i=="string"&&typeof s=="object"){const l=i;i=s,s=l}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);e.keySystem===Is.PLAYREADY&&r.length===16&&TI(r);const a=jn(r);s==="internal-error"&&(this.bannedKeyIds[a]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,i=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,l)=>{const u={responseType:"arraybuffer",url:r},d=t.certLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,S,x)=>{a(g.data)},onError:(g,v,S,x)=>{l(new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:Xt({url:u.url,data:void 0},g)},`"${e}" certificate request failed (${r}). Status: ${g.code} (${g.text})`))},onTimeout:(g,v,S)=>{l(new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(g,v,S)=>{l(new Error("aborted"))}};i.load(u,h,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((i,r)=>{e.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),i(e)}).catch(a=>{r(new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(i=>{throw new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let h;for(let m=0,g=r.length;m<g;m++){var a,l;h=r[m];const v=(a=h.querySelector("name"))==null?void 0:a.textContent,S=(l=h.querySelector("value"))==null?void 0:l.textContent;v&&S&&e.setRequestHeader(v,S)}}const u=i.querySelector("Challenge"),d=u?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return c0(atob(d))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)}).catch(a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let u=l.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const d=this.config.licenseResponseCallback;if(d)try{u=d.call(this.hls,l,a,e)}catch(h){this.error(h)}i(u)}else{const u=s.errorRetry,d=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||l.status>=400&&l.status<500)r(new ti({type:qe.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`));else{const h=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,a,e,t).then(({xhr:u,licenseChallenge:d})=>{e.keySystem==Is.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(u,d)),u.send(d)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Dn(s,"encrypted",this.onMediaEncrypted),Dn(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Vn(e,"encrypted",this.onMediaEncrypted),Vn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Qc.clearKeyUriToKeyIdMap();const i=s.length;al.CDMCleanupPromise=Promise.all(s.map(r=>this.removeSession(r)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{this.log(`Could not clear media keys: ${r}`),this.hls&&this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))||Promise.resolve())).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}`),this.hls&&this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((i,r)=>(i.indexOf(r.keyFormat)===-1&&i.push(r.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${jn(i?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(d=>self.clearTimeout(a[d]));const{drmSystemOptions:l}=this.config;return(fM(l)?new Promise((d,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(h)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}al.CDMCleanupPromise=void 0;function Zd(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return jn(n.keyId)}function _U(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class ti extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function wT(n,e){const t=n==="output-restricted",s=t?te.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:te.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ti({type:qe.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class PU{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const r=i-this.lastTime,a=s-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*a/r,d=this.hls;if(d.trigger(O.FPS_DROP,{currentDropped:a,currentDecoded:l,totalDroppedFrames:s}),u>0&&a>d.config.fpsDroppedMonitoringThreshold*l){let h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(O.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function hR(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function fR(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Wt.debug(`[texttrack-utils]: ${s}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){Wt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function sl(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let s=n.cues.length;s--;)e&&n.cues[s].removeEventListener("enter",e),n.removeCue(n.cues[s]);t==="disabled"&&(n.mode=t)}function v0(n,e,t,s){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const r=kU(n.cues,e,t);for(let a=0;a<r.length;a++)(!s||s(r[a]))&&n.removeCue(r[a])}i==="disabled"&&(n.mode=i)}function NU(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let s=0,i=t,r;for(;s<=i;)if(r=Math.floor((i+s)/2),e<n[r].startTime)i=r-1;else if(e>n[r].startTime&&s<t)s=r+1;else return r;return n[s].startTime-e<e-n[i].startTime?s:i}function kU(n,e,t){const s=[],i=NU(n,e);if(i>-1)for(let r=i,a=n.length;r<a;r++){const l=n[r];if(l.startTime>=e&&l.endTime<=t)s.push(l);else if(l.startTime>t)return s}return s}function Th(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(n[t])}return e}class MU extends Ty{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Th(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;Th(s.textTracks).forEach(a=>{sl(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${a?.groupId}`);return}const l=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||i?.length!==s?.length||s!=null&&s.some(a=>i?.indexOf(a)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!s||s.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,m)=>{h.id=m});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.subtitlePreference;if(!r&&l){this.selectDefaultTrack=!1;const h=or(l,a);if(h>-1)r=a[h];else{const m=or(l,this.tracks);r=this.tracks[m]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const d={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(O.SUBTITLE_TRACKS_UPDATED,d),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if(!(s&&!r.default||!s&&!e)&&(!e||Za(r,e)))return i}if(e){for(let i=0;i<t.length;i++){const r=t[i];if(Jc(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const r=t[i];if(Jc(e.attrs,r.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(m0(i,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===wt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Za(e,s))return s;const i=or(e,this.tracksInGroup);if(i>-1){const r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}else{if(s)return null;{const r=or(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(O.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Th(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter(r=>m0(s,r))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==i&&(r.mode="disabled")}),i){const r=this.subtitleDisplay?"showing":"hidden";i.mode!==r&&(i.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!je(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:l="",name:u,type:d,url:h}=i;this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:u,type:d,url:h});const m=this.switchParams(i.url,s?.details,i.details);this.loadPlaylist(m)}}function UU(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?r:r&3|8).toString(16)})}}}function Mc(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const ol=.025;let $h=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function FU(n,e,t){return`${n.identifier}-${t+1}-${Mc(e)}`}class BU{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ag(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=ag(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=je(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ag(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ol))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?$h.Range:$h.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return jU(this)}}function ag(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<ol)?e.start:e.start+e.duration}function mR(n,e,t){const s=new self.URL(n,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function og(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function jU(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Zo(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class VU{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(O.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;const a=()=>{this.hasDetails=!0};r.once(O.LEVEL_LOADED,a),r.once(O.AUDIO_TRACK_LOADED,a),r.once(O.SUBTITLE_TRACK_LOADED,a),r.on(O.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(O.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,r.trigger(O.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=mR(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=ft.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ft.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,s){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,s){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Zo(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const CT=.033;class $U extends Oi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=i[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const r=s[i].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const a=s[r];if(!a.error){const l=a.timelineStart;if(t===l||t>l&&(t<l+(a.duration||0)||r===i-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,i=s[s.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,a=this.parseDateRanges(i,{url:s.url},t),l=Object.keys(i),u=r?r.filter(d=>!l.includes(d.identifier)):[];a.length&&a.sort((d,h)=>{const m=d.cue.pre,g=d.cue.post,v=h.cue.pre,S=h.cue.post;if(m&&!v)return-1;if(v&&!m||g&&!S)return 1;if(S&&!g)return-1;if(!m&&!v&&!g&&!S){const x=d.startTime,T=h.startTime;if(x!==T)return x-T}return d.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=a,u.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,u)}updateSchedule(e,t=[],s=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(i,e);(s||t.length||r?.length!==a.length||a.some((u,d)=>Math.abs(u.playout.start-r[d].playout.start)>.005||Math.abs(u.playout.end-r[d].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const l=r[a],u=e[l];if(u.isInterstitial){let d=this.eventMap[l];d?d.setDateRange(u):(d=new BU(u,t),this.eventMap[l]=d,s===!1&&(d.appendInPlace=s)),i.push(d)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,d=0;if(e.forEach((h,m)=>{const g=h.cue.pre,v=h.cue.post,S=e[m-1]||null,x=h.appendInPlace,T=v?r:h.startOffset,A=h.duration,E=h.timelineOccupancy===$h.Range?A:0,R=h.resumptionOffset,L=S?.startTime===T,w=T+h.cumulativeDuration;let D=x?w+A:T+R;if(g||!v&&T<=0){const k=d;d+=E,h.timelineStart=w;const N=a;a+=A,s.push({event:h,start:w,end:D,playout:{start:N,end:a},integrated:{start:k,end:d}})}else if(T<=r){if(!L){const F=T-u;if(F>CT){const V=u,H=d;d+=F;const J=a;a+=F;const X={previousEvent:e[m-1]||null,nextEvent:h,start:V,end:V+F,playout:{start:J,end:a},integrated:{start:H,end:d}};s.push(X)}else F>0&&S&&(S.cumulativeDuration+=F,s[s.length-1].end=T)}v&&(D=w),h.timelineStart=w;const k=d;d+=E;const N=a;a+=A,s.push({event:h,start:w,end:D,playout:{start:N,end:a},integrated:{start:k,end:d}})}else return;const _=h.resumeTime;v||_>r?u=r:u=_}),u<r){var l;const h=u,m=d,g=r-u;d+=g;const v=a;a+=g,s.push({previousEvent:((l=s[s.length-1])==null?void 0:l.event)||null,nextEvent:null,start:u,end:h+g,playout:{start:v,end:a},integrated:{start:m,end:d}})}this.setDurations(r,a,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,a=-1;e.forEach((l,u)=>{const d=l.cue.pre,h=l.cue.post,m=d?0:h?i:l.startTime;this.updateAssetDurations(l),a===m?l.cumulativeDuration=r:(r=0,a=m),!h&&l.snapOptions.in&&(l.resumeAnchor=to(null,s.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,t)||(l.appendInPlace=!1)),!l.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<CT&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));const v=je(l.resumeOffset)?l.resumeOffset:l.duration;r+=v})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(s-i)>ol?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const l=t[a].details,u=l.edge;if(s>=u)return this.log(`"${e.identifier}" resumption ${s} past ${a} playlist end ${u}`),!1;const d=to(null,l.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${a} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;const h=a==="audio"?.175:0;return Math.abs(d.start-s)<ol+h||Math.abs(d.end-s)<ol+h?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${a} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const l=e.assetList[a],u=t+s;l.startOffset=s,l.timelineStart=u,i||(i=l.duration===null),r||(r=!!l.error);const d=l.error?0:l.duration||0;s+=d}i&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ui(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class GU{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=mR(s,this.hls.sessionId,e.baseUrl)}catch(g){const v=this.assignAssetListError(e,te.ASSET_LIST_LOAD_ERROR,g,s);this.hls.trigger(O.ERROR,v);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=r.loader,l=new a(r),u={responseType:"json",url:i.href},d=r.interstitialAssetListLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,S,x)=>{const T=g.data,A=T?.ASSETS;if(!Array.isArray(A)){const E=this.assignAssetListError(e,te.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,v,x);this.hls.trigger(O.ERROR,E);return}e.assetListResponse=T,this.hls.trigger(O.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:x})},onError:(g,v,S,x)=>{const T=this.assignAssetListError(e,te.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${g.code} ${g.text} (${v.url})`),v.url,x,S);this.hls.trigger(O.ERROR,T)},onTimeout:(g,v,S)=>{const x=this.assignAssetListError(e,te.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,g,S);this.hls.trigger(O.ERROR,x)}};return l.load(u,h,m),this.hls.trigger(O.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,t,s,i,r,a){return e.error=s,{type:qe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:a,stats:r}}}function LT(n){n?.play().catch(()=>{})}function Jd(n,e){return`[${n}] Advancing timeline position to ${e}`}class HU extends Oi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const i=s-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=s,this.bufferedPos=s;const l=this.playingItem;if(!l){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(s,s-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&s<l.start||s>=l.end){var u;const v=this.findItemIndex(l);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=v+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${s} (resolving from ${v} to ${S})`)),!this.isInterstitial(l)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!a&&S>v){const x=this.schedule.findJumpRestrictedIndex(v+1,S);if(x>v){this.setSchedulePosition(x);return}}this.setSchedulePosition(S);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(l)){const v=l.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,v))}return}const h=d.timelineStart,m=d.duration||0;if(a&&s<h||s>=h+m){var g;(g=l.event)!=null&&g.appendInPlace&&(this.clearInterstitial(l.event,l),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(s>=i.end){this.timelinePos=i.end;const l=this.findItemIndex(i);this.setSchedulePosition(l+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);s>=a&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,i)=>{const r=this.schedule;if(!r)return;const a=this.playingItem,l=r.events||[],u=r.items||[],d=r.durations,h=s.map(x=>x.identifier),m=!!(l.length||h.length);(m||i)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${u.map(x=>Ui(x))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let g=null,v=null;a&&(g=this.updateItem(a,this.timelinePos),this.itemsMatch(a,g)?this.playingItem=g:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(v=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,v)?this.bufferingItem=v:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(x=>{x.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const T=x.assetItem.timelineStart,A=x.timelineOffset-T;if(A)try{x.timelineOffset=T}catch(E){Math.abs(A)>ol&&this.warn(`${E} ("${x.assetId}" ${x.timelineOffset}->${T})`)}}}),m||i){if(this.hls.trigger(O.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:u.slice(0),durations:d,removedIds:h}),this.isInterstitial(a)&&h.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(g,a),S&&v!==g&&this.trimInPlace(v,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new GU(e),this.schedule=new $U(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(O.MEDIA_ENDED,this.onMediaEnded,this),e.on(O.ERROR,this.onError,this),e.on(O.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(O.MEDIA_ENDED,this.onMediaEnded,this),e.off(O.ERROR,this.onError,this),e.off(O.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Vn(e,"play",this.onPlay),Vn(e,"pause",this.onPause),Vn(e,"seeking",this.onSeeking),Vn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Dn(s,"seeking",this.onSeeking),Dn(s,"timeupdate",this.onTimeupdate),Dn(s,"play",this.onPlay),Dn(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!i){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=m=>m&&e.getAssetPlayer(m.identifier),i=(m,g,v,S,x)=>{if(m){let T=m[g].start;const A=m.event;if(A){if(g==="playout"||A.timelineOccupancy!==$h.Point){const E=s(v);E?.interstitial===A&&(T+=E.assetItem.startOffset+E[x])}}else{const E=S==="bufferedPos"?a():e[S];T+=E-m.start}return T}return 0},r=(m,g)=>{var v;if(m!==0&&g!=="primary"&&(v=e.schedule)!=null&&v.length){var S;const x=e.schedule.findItemIndexAtTime(m),T=(S=e.schedule.items)==null?void 0:S[x];if(T){const A=T[g].start-T.start;return m+A}}return m},a=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?l("primary"):Math.max(m,0)},l=m=>{var g,v;return(g=e.primaryDetails)!=null&&g.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[m])||0},u=(m,g)=>{var v,S;const x=e.effectivePlayingItem;if(x!=null&&(v=x.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${g}"`);const T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(m,g),E=(S=e.schedule.items)==null?void 0:S[A],R=e.getBufferingPlayer(),L=R?.interstitial,w=L?.appendInPlace,D=T&&e.itemsMatch(T,E);if(T&&(w||D)){const _=s(e.playingAsset),k=_?.media||e.primaryMedia;if(k){const N=g==="primary"?k.currentTime:i(T,g,e.playingAsset,"timelinePos","currentTime"),F=m-N,V=(w?N:k.currentTime)+F;if(V>=0&&(!_||w||V<=_.duration)){k.currentTime=V;return}}}if(E){let _=m;if(g!=="primary"){const N=E[g].start,F=m-N;_=E.start+F}const k=!e.isInterstitial(E);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(k||E.event.appendInPlace)){const N=e.media||(w?R?.media:null);N&&(N.currentTime=_)}else if(T){const N=e.findItemIndex(T);if(A>N){const V=e.schedule.findJumpRestrictedIndex(N+1,A);if(V>N){e.setSchedulePosition(V);return}}let F=0;if(k)e.timelinePos=_,e.checkBuffer();else{const V=E.event.assetList,H=m-(E[g]||E).start;for(let J=V.length;J--;){const X=V[J];if(X.duration&&H>=X.startOffset&&H<X.startOffset+X.duration){F=J;break}}}e.setSchedulePosition(A,F)}}},d=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const g=t();return e.isInterstitial(g)?g:null},h={get bufferedEnd(){const m=t(),g=e.bufferingItem;if(g&&g===m){var v;return i(g,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const m=d(),g=e.effectivePlayingItem;return g&&g===m?i(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(m){const g=d(),v=e.effectivePlayingItem;v&&v===g&&u(m+v.playout.start,"playout")},get duration(){const m=d();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const g=(m=d())==null?void 0:m.event.assetList;return g?g.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var m;const g=(m=d())==null?void 0:m.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return d()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return a()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){u(m,"primary")},get duration(){return l("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){u(m,"integrated")},get duration(){return l("integrated")},get seekableStart(){var m;return r(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,g=m?.event;if(g&&!g.restrictions.skip){const v=e.findItemIndex(m);if(g.appendInPlace){const S=m.playout.start+m.event.duration;u(S+.001,"playout")}else e.advanceAfterAssetEnded(g,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const r=(t=i)==null?void 0:t.currentTime;if(!(r===void 0||!je(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${os(r)}`),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const a=this.hls,l=e!==a,u=l&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let h;if(a.media)u&&(r=a.transferMedia(),this.detachedData=r),h="Primary";else if(d){const S=this.getBufferingPlayer();S?(r=S.transferMedia(),h=`${S}`):h="detached MediaSource"}else h="detached media";if(!r){if(d)r=this.detachedData,this.log(`using detachedData: MediaSource ${os(r)}`);else if(!this.detachedData||a.media===t){const S=this.playerQueue;S.length>1&&S.forEach(x=>{if(l&&x.interstitial.appendInPlace!==u){const T=x.interstitial;this.clearInterstitial(x.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=r&&"mediaSource"in r&&((i=r.mediaSource)==null?void 0:i.readyState)!=="closed",g=m&&r?r:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(g===r&&v){const S=l&&e.assetId===v.assetIdAtEnd;g.overrides={duration:v.duration,endOfStream:!l||S,cueRemoval:!l}}e.attachMedia(g)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Jd("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,l=e.findItemIndexAtTime(a);this.setSchedulePosition(l)}}else if(i&&!this.playingItem){const r=e.findItemIndex(i);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,i=s.findAssetIndex(t),r=og(s,i);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var a;const l=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];l&&this.bufferedToItem(l)}}advanceAfterAssetEnded(e,t,s){const i=og(e,s);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const r=this.schedule.items;if(r){const a=t+1,l=r.length;if(a>=l){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.log(Jd("advanceAfterAssetEnded",u)),this.timelinePos=u,e.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const r=e.assetList[i];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const i=t.parentIdentifier,r=s.getEvent(i);if(r){const a=s.findEventIndex(i),l=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,l-1)}}setSchedulePosition(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&Ui(r)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(a)){const h=a.event,m=this.playingAsset,g=m?.identifier,v=g?this.getAssetPlayer(g):null;if(v&&g&&(!this.eventItemsMatch(a,r)||t!==void 0&&g!==h.assetList[t].identifier)){var u;const S=h.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${h.assetList.length} ${Zo(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(O.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:S,event:h,schedule:i.slice(0),scheduleIndex:e,player:v}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(g,r),v.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${Ui(a)}`),h.hasPlayed=!0,this.hls.trigger(O.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){var d;this.updateSchedule();const S=(d=this.schedule)==null?void 0:d.items;if(r&&S){const x=this.findItemIndex(r);this.advanceSchedule(x,S,t,a,l)}return}}this.advanceSchedule(e,i,t,a,l)}advanceSchedule(e,t,s,i,r){const a=this.schedule;if(!a)return;const l=t[e]||null,u=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(h=>{const m=h.interstitial,g=a.findEventIndex(m.identifier);(g<e||g>e+1)&&this.clearInterstitial(m,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const h=l.event;if(s===void 0){s=a.findAssetIndex(h,this.timelinePos);const S=og(h,s-1);if(h.isAssetPastPlayoutLimit(S)||h.appendInPlace&&this.timelinePos===l.end){this.advanceAfterAssetEnded(h,e,s);return}s=S}const m=this.waitingItem;this.assetsBuffered(l,u)||this.setBufferingItem(l);let g=this.preloadAssets(h,s);if(this.eventItemsMatch(l,m||i)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${Ui(l)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(O.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const v=h.assetList[s];if(!v){this.advanceAfterAssetEnded(h,e,s||0);return}if(g||(g=this.getAssetPlayer(v.identifier)),g===null||g.destroyed){const S=h.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${h}`),g=this.createAssetPlayer(h,v,s),g.loadSource()}if(!this.eventItemsMatch(l,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(g,s,t,e,u),this.shouldPlay&&LT(g.media)}else l?(this.resumePrimary(l,e,i),this.shouldPlay&&LT(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ui(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.log(Jd("resumePrimary",l)),this.timelinePos=l),this.attachPrimary(l,e)}if(!s)return;const a=(r=this.schedule)==null?void 0:r.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ui(e)}`),this.hls.trigger(O.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(s<i.fragmentStart||s>i.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ft.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Jd("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((s=i.mainForwardBufferInfo)==null?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(O.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(O.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const i=Xt(Xt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Xt(Xt({},this.altSelection),{},{audio:s});return}const r=Xt(Xt({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Xt(Xt({},this.altSelection),{},{subtitles:s});return}const r=Xt(Xt({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=jb(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=jb(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const r=t[i];if(r.cue.post){var s;const a=this.schedule.findEventIndex(r.identifier),l=(s=this.schedule.items)==null?void 0:s[a];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,i=ft.bufferInfo(this.primaryMedia,s,0);(i.end>s||(i.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Ui(e)} (was ${Ui(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const i=ft.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,s,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const a=this.playingItem,l=this.findItemIndex(a);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const h=this.findItemIndex(r),m=Math.min(h+1,t.length-1),g=t[m];if((u===-1&&r&&e>=r.end||(d=g.event)!=null&&d.appendInPlace&&e+.01>=g.start)&&(u=m),this.isInterstitial(r)){const v=r.event;if(m-l>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,u>h&&u>l)this.bufferedToItem(g);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&g.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else s&&a&&!this.itemsMatch(a,r)&&(u===l?this.bufferedToItem(a):u===l+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const r=this.getAssetPlayer(i.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:i,events:r}=s;if(!i||!r)return t;const a=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=l?l.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ui(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,m)=>{const g=this.getAssetPlayer(h.identifier);g&&(m===d&&g.loadSource(),g.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(O.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(i||!r){const a=this.preloadAssets(s,t);if(a!=null&&a.interstitial.appendInPlace){const l=this.primaryMedia;l&&this.bufferAssetPlayer(a,l)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=i===0&&!e.assetListLoader,a=e.cue.once;if(r){const u=e.timelineStart;if(e.appendInPlace){var l;const g=this.playingItem;!this.isInterstitial(g)&&(g==null||(l=g.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let d,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const g=h-u;g>0&&(d=Math.round(g*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${d?` live-start: ${h} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,u,e.duration,s);const m=this.assetListLoader.loadAssetList(e,d);m&&(e.assetListLoader=m)}else if(!a&&i){for(let d=t;d<i;d++){const h=e.assetList[d],m=this.getAssetPlayerQueueIndex(h.identifier);(m===-1||this.playerQueue[m].destroyed)&&!h.error&&this.createAssetPlayer(e,h,d)}const u=e.assetList[t];if(u){const d=this.getAssetPlayer(u.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,i,r,a){const l={parentIdentifier:e.identifier,identifier:FU(e,a,t),duration:r,startOffset:s,timelineStart:i,uri:a};return this.createAssetPlayer(e,l,t)}createAssetPlayer(e,t,s){const i=this.hls,r=i.userConfig;let a=r.videoPreference;const l=i.loadLevelObj||i.levels[i.currentLevel];(a||l)&&(a=ts({},a),l.videoCodec&&(a.videoCodec=l.videoCodec),l.videoRange&&(a.allowedVideoRanges=[l.videoRange]));const u=i.audioTracks[i.audioTrack],d=i.subtitleTracks[i.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const w=t.duration;w&&L<w&&(h=L)}}const m=t.identifier,g=Xt(Xt({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:u||r.audioPreference,subtitlePreference:d||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(g.timelineOffset=t.timelineStart));const v=g.cmcd;v!=null&&v.sessionId&&v.contentId&&(g.cmcd=ts({},v,{contentId:Mc(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const S=new VU(this.HlsPlayerClass,g,e,t);this.playerQueue.push(S),e.assetList[s]=t;let x=!0;const T=L=>{if(L.live){var w;const k=new Error(`Interstitials MUST be VOD assets ${e}`),N={fatal:!0,type:qe.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:k},F=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(N,e,F,s,k.message);return}const D=L.edge-L.fragmentStart,_=t.duration;(x||_===null||D>_)&&(x=!1,this.log(`Interstitial asset "${m}" duration change ${_} > ${D}`),t.duration=D,this.updateSchedule())};S.on(O.LEVEL_UPDATED,(L,{details:w})=>T(w)),S.on(O.LEVEL_PTS_UPDATED,(L,{details:w})=>T(w)),S.on(O.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(L,w)=>{const D=this.getAssetPlayer(m);if(D&&w.tracks){D.off(O.BUFFER_CODECS,A),D.tracks=w.tracks;const _=this.primaryMedia;this.bufferingAsset===D.assetItem&&_&&!D.media&&this.bufferAssetPlayer(D,_)}};S.on(O.BUFFER_CODECS,A);const E=()=>{var L;const w=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const D=this.schedule.findEventIndex(e.identifier),_=(L=this.schedule.items)==null?void 0:L[D];this.isInterstitial(_)&&this.advanceAssetBuffering(_,t)};S.on(O.BUFFERED_TO_END,E);const R=L=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const D=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,D,L)};return S.once(O.MEDIA_ENDED,R(s)),S.once(O.PLAYOUT_LIMIT_REACHED,R(1/0)),S.on(O.ERROR,(L,w)=>{if(!this.schedule)return;const D=this.getAssetPlayer(m);if(w.details===te.BUFFER_STALLED_ERROR){if(D!=null&&D.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${w.error} ${e}`)}),S.on(O.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${m}`),D={fatal:!0,type:qe.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),s,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Zo(t)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const i=this.playerQueue[s];this.log(`clear ${i} toSegment: ${t&&Ui(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:a,assetItem:l,assetId:u}=e,d=a.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!h||h.identifier!==u)&&(h&&(this.clearAssetPlayer(h.identifier,s[i]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Zo(l)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,l=this.schedule.findEventIndex(r.identifier),u=(s=this.schedule.items)==null?void 0:s[l];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=a;const d=this.getBufferingPlayer();if(d===e)return;const h=r.appendInPlace;if(h&&d?.interstitial.appendInPlace===!1)return;const m=d?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!JA(m,e.tracks)){const g=new Error(`Asset ${Zo(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),v={fatal:!0,type:qe.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},S=r.findAssetIndex(a);this.handleAssetItemError(v,r,l,S,g.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const i=s.currentTime,r=t.findAssetIndex(e,i),a=e.assetList[r];if(a){const l=this.getAssetPlayer(a.identifier);if(l){const u=l.currentTime||i-a.timelineStart,d=l.duration-u;if(this.warn(`Stalled at ${u} of ${u+d} in ${l} ${e} (media.currentTime: ${i})`),u&&(d/s.playbackRate<.5||l.bufferedInPlaceToEnd(s))&&l.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,i,r){if(e.details===te.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Zo(a)} ${e.error}`),!this.schedule)return;const l=a?.identifier||"",u=this.getAssetPlayerQueueIndex(l),d=this.playerQueue[u]||null,h=this.schedule.items,m=ts({},e,{fatal:!1,errorAction:il(!0),asset:a,assetListIndex:i,event:t,schedule:h,scheduleIndex:s,player:d});if(this.hls.trigger(O.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const g=this.playingAsset,v=this.bufferingAsset,S=new Error(r);if(a&&(this.clearAssetPlayer(l,null),a.error=S),!t.assetList.some(x=>!x.error))t.error=S;else for(let x=i;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):g&&g.identifier===l?this.advanceAfterAssetEnded(t,s,i):v&&v.identifier===l&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${Ui(s)} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const r=this.updateItem(s,i);if(this.itemsMatch(s,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var s,i;const r=t.event,a=r.identifier,l=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(a)))return;const u=r.timelineStart,d=r.duration;let h=0;l.forEach((x,T)=>{const A=parseFloat(x.DURATION);this.createAsset(r,T,h,u+h,A,x.URI),h+=A}),r.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${d}) ${r}`);const m=this.waitingItem,g=m?.event.identifier===a;this.updateSchedule();const v=(i=this.bufferingItem)==null?void 0:i.event;if(g){var S;const x=this.schedule.findEventIndex(a),T=(S=this.schedule.items)==null?void 0:S[x];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(x)}else if(v?.identifier===a){const x=r.assetList[0];if(x){const T=this.getAssetPlayer(x.identifier);if(v.appendInPlace){const A=this.primaryMedia;T&&A&&this.bufferAssetPlayer(T,A)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case te.ASSET_LIST_PARSING_ERROR:case te.ASSET_LIST_LOAD_ERROR:case te.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case te.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const DT=500;class zU extends my{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",$e.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ye.IDLE,this.setInterval(DT),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(this.fragContextChanged(s)||(Ys(s)&&(this.fragPrevious=s),this.state=ye.IDLE),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const l=s.start;for(let d=0;d<r.length;d++)if(l>=r[d].start&&l<=r[d].end){a=r[d];break}const u=s.start+s.duration;a?a.end=u:(a={start:l,end:u},r.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(s===0&&i!==Number.POSITIVE_INFINITY){const r=i-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let l=0;l<a.length;){if(a[l].end<=r){a.shift();continue}else if(a[l].start<r)a[l].start=r;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(s,r,$e.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===$e.SUBTITLE&&(t.details===te.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ye.STOPPED&&(this.state=ye.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&JI(this.levels,t)){this.levels=t.map(s=>new qc(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const i=new qc(s);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,$e.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ye.STOPPED&&this.setInterval(DT)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:a,id:l}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}const u=r[l];if(l>=r.length||!u)return;this.log(`Subtitle track ${l} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(a.live||(s=u.details)!=null&&s.live){if(a.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const g=m.fragments[0];if(!u.details)a.hasProgramDateTime&&m.hasProgramDateTime?(jh(a,m),d=a.fragmentStart):g&&(d=g.start,d0(a,d));else{var h;d=this.alignPlaylists(a,u.details,(h=this.levelLastLoaded)==null?void 0:h.details),d===0&&g&&(d=g.start,d0(a,d))}m&&!this.startFragRequested&&this.setStartPosition(m,d)}u.details=a,this.levelLastLoaded=u,l===i&&(this.hls.trigger(O.SUBTITLE_TRACK_UPDATED,{details:a,id:l,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ye.IDLE&&(to(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&i!=null&&i.key&&i.iv&&rl(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,hy(i.method)).catch(l=>{throw r.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const u=performance.now();r.trigger(O.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:a,tdecrypt:u}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=ye.IDLE})}}doTick(){if(!this.media){this.state=ye.IDLE;return}if(this.state===ye.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),a=ft.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:l,len:u}=a,d=s.details,h=this.hls.maxBufferLength+d.levelTargetDuration;if(u>h)return;const m=d.fragments,g=m.length,v=d.edge;let S=null;const x=this.fragPrevious;if(l<v){const E=i.maxFragLookUpTolerance,R=l>v-E?0:E;S=to(x,m,Math.max(m[0].start,l),R),!S&&x&&x.start<m[0].start&&(S=m[0])}else S=m[g-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const T=S.sn-d.startSN,A=m[T-1];if(A&&A.cc===S.cc&&this.fragmentTracker.getState(A)===en.NOT_LOADED&&(S=A),this.fragmentTracker.getState(S)===en.NOT_LOADED){const E=this.mapToInitFragWhenRequired(S);E&&this.loadFragment(E,s,l)}}}loadFragment(e,t,s){Ys(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new KU(this.tracksBuffered[this.currentTrackId]||[])}}class KU{constructor(e){this.buffered=void 0;const t=(s,i,r)=>{if(i=i>>>0,i>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const YU={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},pR=n=>String.fromCharCode(YU[n]||n),Fi=15,_r=100,qU={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},QU={17:2,18:4,21:6,22:8,23:10,19:13,20:15},XU={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},WU={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ZU=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class JU{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Wt.log(`${this.time} [${e}] ${s}`)}}}const za=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class gR{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class e4{constructor(){this.uchar=" ",this.penState=new gR}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class t4{constructor(e){this.chars=[],this.pos=0,this.currPenState=new gR,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<_r;t++)this.chars.push(new e4);this.logger=e}equals(e){for(let t=0;t<_r;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<_r;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<_r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>_r&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=_r)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=pR(e);if(this.pos>=_r){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<_r;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<_r;s++){const i=this.chars[s].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class lg{constructor(e){this.rows=[],this.currRow=Fi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Fi;t++)this.rows.push(new t4(e));this.logger=e}reset(){for(let e=0;e<Fi;e++)this.rows[e].clear();this.currRow=Fi-1}equals(e){let t=!0;for(let s=0;s<Fi;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Fi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Fi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+os(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let l=0;l<Fi;l++)this.rows[l].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const l=a.rows[r].cueStartTime,u=this.logger.time;if(l!==null&&u!==null&&l<u)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(a.rows[r+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+os(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<Fi;r++){const a=this.rows[r].getTextString();a&&(i=r+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class OT{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new lg(s),this.nonDisplayedMemory=new lg(s),this.lastOutputScreen=new lg(s),this.currRollUpRow=this.displayedMemory.rows[Fi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Fi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+os(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class _T{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=n4(),this.logger=void 0;const i=this.logger=new JU;this.channels=[null,new OT(e,t,i),new OT(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const i=t[s]&127,r=t[s+1]&127;let a=!1,l=null;if(i===0&&r===0)continue;this.logger.log(3,()=>"["+za([t[s],t[s+1]])+"] -> ("+za([i,r])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(s4(i,r,u)){eh(null,null,u),this.logger.log(3,()=>"Repeated command ("+za([i,r])+") is dropped");continue}eh(i,r,this.cmdHistory),a=this.parseCmd(i,r),a||(a=this.parseMidrow(i,r)),a||(a=this.parsePAC(i,r)),a||(a=this.parseBackgroundAttributes(i,r))}else eh(null,null,u);if(!a&&(l=this.parseChars(i,r),l)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+za([i,r])+" orig: "+za([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(s||i))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+za([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(i||r))return!1;const a=e<=23?1:2;t>=64&&t<=95?s=a===1?qU[e]:XU[e]:s=a===1?QU[e]:WU[e];const l=this.channels[a];return l?(l.setPAC(this.interpretPAC(s,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,i.underline=(s&1)===1,s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((s-16)/2)*4,i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let a;r===17?a=t+80:r===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+pR(a)+"' in channel "+s),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+za(i).join(",")),i}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(s||i))return!1;let r;const a={};e===16||e===24?(r=Math.floor((t-32)/2),a.background=ZU[r],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const l=e<=23?1:2;return this.channels[l].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}eh(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function eh(n,e,t){t.a=n,t.b=e}function s4(n,e,t){return t.a===n&&t.b===e}function n4(){return{a:null,b:null}}var Ry=(function(){if(Bh!=null&&Bh.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(l,u){if(typeof u!="string"||!Array.isArray(l))return!1;const d=u.toLowerCase();return~l.indexOf(d)?d:!1}function s(l){return t(n,l)}function i(l){return t(e,l)}function r(l,...u){let d=1;for(;d<arguments.length;d++){const h=arguments[d];for(const m in h)l[m]=h[m]}return l}function a(l,u,d){const h=this,m={enumerable:!0};h.hasBeenReset=!1;let g="",v=!1,S=l,x=u,T=d,A=null,E="",R=!0,L="auto",w="start",D=50,_="middle",k=50,N="middle";Object.defineProperty(h,"id",r({},m,{get:function(){return g},set:function(F){g=""+F}})),Object.defineProperty(h,"pauseOnExit",r({},m,{get:function(){return v},set:function(F){v=!!F}})),Object.defineProperty(h,"startTime",r({},m,{get:function(){return S},set:function(F){if(typeof F!="number")throw new TypeError("Start time must be set to a number.");S=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",r({},m,{get:function(){return x},set:function(F){if(typeof F!="number")throw new TypeError("End time must be set to a number.");x=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",r({},m,{get:function(){return T},set:function(F){T=""+F,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",r({},m,{get:function(){return A},set:function(F){A=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",r({},m,{get:function(){return E},set:function(F){const V=s(F);if(V===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",r({},m,{get:function(){return R},set:function(F){R=!!F,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",r({},m,{get:function(){return L},set:function(F){if(typeof F!="number"&&F!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",r({},m,{get:function(){return w},set:function(F){const V=i(F);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");w=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",r({},m,{get:function(){return D},set:function(F){if(F<0||F>100)throw new Error("Position must be between 0 and 100.");D=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",r({},m,{get:function(){return _},set:function(F){const V=i(F);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");_=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",r({},m,{get:function(){return k},set:function(F){if(F<0||F>100)throw new Error("Size must be between 0 and 100.");k=F,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",r({},m,{get:function(){return N},set:function(F){const V=i(F);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");N=V,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class i4{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function yR(n){function e(s,i,r,a){return(s|0)*3600+(i|0)*60+(r|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}let r4=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}};function vR(n,e,t,s){const i=s?n.split(s):[n];for(const r in i){if(typeof i[r]!="string")continue;const a=i[r].split(t);if(a.length!==2)continue;const l=a[0],u=a[1];e(l,u)}}const x0=new Ry(0,0,""),th=x0.align==="middle"?"middle":"center";function a4(n,e,t){const s=n;function i(){const l=yR(n);if(l===null)throw new Error("Malformed timestamp: "+s);return n=n.replace(/^[^\sa-zA-Z-]+/,""),l}function r(l,u){const d=new r4;vR(l,function(g,v){let S;switch(g){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===v){d.set(g,t[x].region);break}break;case"vertical":d.alt(g,v,["rl","lr"]);break;case"line":S=v.split(","),d.integer(g,S[0]),d.percent(g,S[0])&&d.set("snapToLines",!1),d.alt(g,S[0],["auto"]),S.length===2&&d.alt("lineAlign",S[1],["start",th,"end"]);break;case"position":S=v.split(","),d.percent(g,S[0]),S.length===2&&d.alt("positionAlign",S[1],["start",th,"end","line-left","line-right","auto"]);break;case"size":d.percent(g,v);break;case"align":d.alt(g,v,["start",th,"end","left","right"]);break}},/:/,/\s/),u.region=d.get("region",null),u.vertical=d.get("vertical","");let h=d.get("line","auto");h==="auto"&&x0.line===-1&&(h=-1),u.line=h,u.lineAlign=d.get("lineAlign","start"),u.snapToLines=d.get("snapToLines",!0),u.size=d.get("size",100),u.align=d.get("align",th);let m=d.get("position","auto");m==="auto"&&x0.position===50&&(m=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=m}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);n=n.slice(3),a(),e.endTime=i(),a(),r(n,e)}function xR(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class o4{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new i4,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,a=0;for(r=xR(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const l=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,t.buffer=r.slice(a),l}function i(r){vR(r,function(a,l){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const l=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=s(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Ry(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{a4(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const l=r.indexOf("-->")!==-1;if(!r||l&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const l4=/\r\n|\n\r|\n|\r/g,cg=function(e,t,s=0){return e.slice(s,s+t.length)===t},c4=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!je(t)||!je(s)||!je(i)||!je(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*i,t+=3600*1e3*r,t};function wy(n,e,t){return Mc(n.toString())+Mc(e.toString())+Mc(t)}const u4=function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s};function d4(n,e,t,s,i,r,a){const l=new o4,u=oi(new Uint8Array(n)).trim().replace(l4,`
`).split(`
`),d=[],h=e?y3(e.baseTime,e.timescale):0;let m="00:00.000",g=0,v=0,S,x=!0;l.oncue=function(T){const A=t[s];let E=t.ccOffset;const R=(g-h)/9e4;if(A!=null&&A.new&&(v!==void 0?E=t.ccOffset=A.start:u4(t,s,R)),R){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}E=R-t.presentationOffset}const L=T.endTime-T.startTime,w=Ti((T.startTime+E-v)*9e4,i*9e4)/9e4;T.startTime=Math.max(w,0),T.endTime=Math.max(w+L,0);const D=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(D)),T.id||(T.id=wy(T.startTime,T.endTime,D)),T.endTime>0&&d.push(T)},l.onparsingerror=function(T){S=T},l.onflush=function(){if(S){a(S);return}r(d)},u.forEach(T=>{if(x)if(cg(T,"X-TIMESTAMP-MAP=")){x=!1,T.slice(16).split(",").forEach(A=>{cg(A,"LOCAL:")?m=A.slice(6):cg(A,"MPEGTS:")&&(g=parseInt(A.slice(7)))});try{v=c4(m)/1e3}catch(A){S=A}return}else T===""&&(x=!1);l.parse(T+`
`)}),l.flush()}const ug="stpp.ttml.im1t",SR=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bR=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,h4={left:"start",center:"center",right:"end",start:"start",end:"end"};function PT(n,e,t,s){const i=Et(new Uint8Array(n),["mdat"]);if(i.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=i.map(l=>oi(l)),a=g3(e.baseTime,1,e.timescale);try{r.forEach(l=>t(f4(l,a)))}catch(l){s(l)}}function f4(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((m,g)=>(m[g]=i.getAttribute(`ttp:${g}`)||r[g],m),{}),l=i.getAttribute("xml:space")!=="preserve",u=NT(dg(i,"styling","style")),d=NT(dg(i,"layout","region")),h=dg(i,"body","[begin]");return[].map.call(h,m=>{const g=TR(m,l);if(!g||!m.hasAttribute("begin"))return null;const v=fg(m.getAttribute("begin"),a),S=fg(m.getAttribute("dur"),a);let x=fg(m.getAttribute("end"),a);if(v===null)throw kT(m);if(x===null){if(S===null)throw kT(m);x=v+S}const T=new Ry(v-e,x-e,g);T.id=wy(T.startTime,T.endTime,T.text);const A=d[m.getAttribute("region")],E=u[m.getAttribute("style")],R=m4(A,E,u),{textAlign:L}=R;if(L){const w=h4[L];w&&(T.lineAlign=w),T.align=L}return ts(T,R),T}).filter(m=>m!==null)}function dg(n,e,t){const s=n.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function NT(n){return n.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function TR(n,e){return[].slice.call(n.childNodes).reduce((t,s,i)=>{var r;return s.nodeName==="br"&&i?t+`
`:(r=s.childNodes)!=null&&r.length?TR(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function m4(n,e,t){const s="http://www.w3.org/ns/ttml#styling";let i=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),r.reduce((l,u)=>{const d=hg(e,s,u)||hg(n,s,u)||hg(i,s,u);return d&&(l[u]=d),l},{})}function hg(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function kT(n){return new Error(`Could not parse ttml timestamp ${n}`)}function fg(n,e){if(!n)return null;let t=yR(n);return t===null&&(SR.test(n)?t=p4(n,e):bR.test(n)&&(t=g4(n,e))),t}function p4(n,e){const t=SR.exec(n),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function g4(n,e){const t=bR.exec(n),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class sh{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class y4{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=UT(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new sh(this,"textTrack1"),t=new sh(this,"textTrack2"),s=new sh(this,"textTrack3"),i=new sh(this,"textTrack4");this.cea608Parser1=new _T(1,e,t),this.cea608Parser2=new _T(3,s,i)}addCues(e,t,s,i,r){let a=!1;for(let l=r.length;l--;){const u=r[l],d=v4(u[0],u[1],t,s);if(d>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],s),a=!0,d/(s-t)>.5))return}if(a||r.push([t,s]),this.config.renderTextTracksNatively){const l=this.captionsTracks[e];this.Cues.newCue(l,t,s,i)}else{const l=this.Cues.newCue(null,t,s,i);this.hls.trigger(O.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:a}){const{unparsedVttFrags:l}=this;s===$e.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:r,trackId:a}),l.length&&(this.unparsedVttFrags=[],l.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(O.FRAG_LOADED,u):this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(MT(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:a}=t[e],l=this.getExistingTrack(r,a);if(l)s[e]=l,sl(s[e]),hR(s[e],i);else{const u=this.createTextTrack("captions",r,a);u&&(u[e]=!0,s[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,i={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach(r=>{sl(i[r]),delete i[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=UT(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)sl(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some(r=>r.textCodec===ug);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(JI(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const a=this.media,l=a?Th(a.textTracks):null;if(this.tracks.forEach((u,d)=>{let h;if(l){let m=null;for(let g=0;g<l.length;g++)if(l[g]&&MT(l[g],u)){m=l[g],l[g]=null;break}m&&(h=m)}if(h)sl(h);else{const m=ER(u);h=this.createTextTrack(m,u.name,u.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),l!=null&&l.length){const u=l.filter(d=>d!==null).map(d=>d.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const i=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!i)return;const r=`textTrack${i[1]}`,a=this.captionsProperties[r];a&&(a.label=s.name,s.lang&&(a.languageCode=s.lang),a.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===$e.MAIN){var s,i;const{cea608Parser1:r,cea608Parser2:a,lastSn:l}=this,{cc:u,sn:d}=t.frag,h=(s=(i=t.part)==null?void 0:i.index)!=null?s:-1;r&&a&&(d!==l+1||d===l&&h!==this.lastPartIndex+1||u!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=u,this.lastSn=d,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===$e.SUBTITLE)if(i.byteLength){const r=s.decryptdata,a="stats"in t;if(r==null||!r.encrypted||a){const l=this.tracks[s.level],u=this.vttCCs;u[s.cc]||(u[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),l&&l.textCodec===ug?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;PT(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),s.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{s.logger.log(`Failed to parse IMSC1: ${i}`),s.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,l=r.length-1;if(!r[s.cc]&&l===-1){a.push(e);return}const u=this.hls,d=(t=s.initSegment)!=null&&t.data?Ci(s.initSegment.data,new Uint8Array(i)).buffer:i;d4(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,h=>{this._appendCues(h,s.level),u.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},h=>{const m=h.message==="Missing initPTS for VTT MPEGTS";m?a.push(e):this._fallbackToIMSC1(s,i),u.logger.log(`Failed to parse VTT cue: ${h}`),!(m&&l>s.cc)&&u.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:h})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||PT(t,this.initPTS[e.cc],()=>{s.textCodec=ug,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(r=>fR(i,r))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(O.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===$e.SUBTITLE&&this.onFragLoaded(O.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(!(s.type===$e.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<i.length;r++){const a=i[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const l=this.extractCea608Data(a);this.cea608Parser1.addData(i[r].pts,l[0]),this.cea608Parser2.addData(i[r].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(!(!a||a.currentTime<s)){if(!r||r==="video"){const{captionsTracks:l}=this;Object.keys(l).forEach(u=>v0(l[u],t,s))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:l}=this;Object.keys(l).forEach(u=>v0(l[u],t,i))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let i=2;for(let r=0;r<s;r++){const a=e[i++],l=127&e[i++],u=127&e[i++];if(l===0&&u===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(t[h].push(l),t[h].push(u))}}return t}}function ER(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function MT(n,e){return!!n&&n.kind===ER(e)&&m0(e,n)}function v4(n,e,t,s){return Math.min(e,s)-Math.max(n,t)}function UT(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const x4=/\s/,S4={newCue(n,e,t,s){const i=[];let r,a,l,u,d;const h=self.VTTCue||self.TextTrackCue;for(let g=0;g<s.rows.length;g++)if(r=s.rows[g],l=!0,u=0,d="",!r.isEmpty()){var m;for(let x=0;x<r.chars.length;x++)x4.test(r.chars[x].uchar)&&l?u++:(d+=r.chars[x].uchar,l=!1);r.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const v=xR(d.trim()),S=wy(e,t,v);n!=null&&(m=n.cues)!=null&&m.getCueById(S)||(a=new h(e,t,v),a.id=S,a.line=g+1,a.align="left",a.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(a))}return n&&i.length&&(i.sort((g,v)=>g.line==="auto"||v.line==="auto"?0:g.line>8&&v.line>8?v.line-g.line:g.line-v.line),i.forEach(g=>fR(n,g))),i}};function b4(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const T4=/(\d+)-(\d+)\/(\d+)/;class FT{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||R4,this.controller=new self.AbortController,this.stats=new iy}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=E4(e,this.controller.signal),a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=u&&je(u)?u:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Zc(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var g;this.response=this.loader=m;const v=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},d-(v-i.loading.start)),!m.ok){const{status:x,statusText:T}=m;throw new w4(T||"fetch, bad network response",x,m)}i.loading.first=v,i.total=I4(m.headers)||i.total;const S=(g=this.callbacks)==null?void 0:g.onProgress;return S&&je(t.highWaterMark)?this.loadProgressively(m,i,e,t.highWaterMark,S):a?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var g,v;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const x=m[l];x&&(i.loaded=i.total=x);const T={url:S.url,data:m,code:S.status},A=(g=this.callbacks)==null?void 0:g.onProgress;A&&!je(t.highWaterMark)&&A(i,e,m,S),(v=this.callbacks)==null||v.onSuccess(T,i,e,S)}).catch(m=>{var g;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const v=m&&m.code||0,S=m?m.message:null;(g=this.callbacks)==null||g.onError({code:v,text:S},e,m?m.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const a=new PI,l=e.body.getReader(),u=()=>l.read().then(d=>{if(d.done)return a.dataLength&&r(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=d.value,m=h.length;return t.loaded+=m,m<i||a.dataLength?(a.push(h),a.dataLength>=i&&r(t,s,a.flush().buffer,e)):r(t,s,h.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function E4(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ts({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function A4(n){const e=T4.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function I4(n){const e=n.get("Content-Range");if(e){const s=A4(e);if(je(s))return s}const t=n.get("Content-Length");if(t)return parseInt(t)}function R4(n,e){return new self.Request(n.url,e)}class w4 extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const C4=/^age:\s*[\d.]+\s*$/im;class AR{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new iy,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(a=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(a=>{var l;(l=this.callbacks)==null||l.onError({code:s.status,text:a.message},t,s,i)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=s.loadPolicy;if(i)for(const l in i)e.setRequestHeader(l,i[l]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&je(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,h=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const S=h??t.response;if(S!=null){var a,l;s.loading.end=Math.max(self.performance.now(),s.loading.first);const x=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=x,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const T=(a=this.callbacks)==null?void 0:a.onProgress;T&&T(s,e,S,t);const A={url:t.responseURL,data:S,code:d};(l=this.callbacks)==null||l.onSuccess(A,s,e,t);return}}const m=r.loadPolicy.errorRetry,g=s.retry,v={url:e.url,data:void 0,code:d};if(Fh(m,g,!1,v))this.retry(m);else{var u;Wt.error(`${d} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Fh(e,t,!0))this.retry(e);else{var s;Wt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=ly(e,s.retry),s.retry++,Wt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&C4.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const L4={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},D4=Xt(Xt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:AR,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Vk,bufferController:_3,capLevelController:Ey,errorController:Kk,fpsController:PU,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:EI,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:L4},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},O4()),{},{subtitleStreamController:zU,subtitleTrackController:MU,timelineController:y4,audioStreamController:C3,audioTrackController:L3,emeController:al,cmcdController:LU,contentSteeringController:OU,interstitialsController:HU});function O4(){return{cueHandler:S4,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function _4(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=S0(n),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const l=`${a==="level"?"playlist":a}LoadPolicy`,u=e[l]===void 0,d=[];r.forEach(h=>{const m=`${a}Loading${h}`,g=e[m];if(g!==void 0&&u){d.push(m);const v=s[l].default;switch(e[l]={default:v},h){case"TimeOut":v.maxLoadTimeMs=g,v.maxTimeToFirstByteMs=g;break;case"MaxRetry":v.errorRetry.maxNumRetry=g,v.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":v.errorRetry.retryDelayMs=g,v.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=g,v.timeoutRetry.maxRetryDelayMs=g;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${l}": ${os(e[l])}`)}),Xt(Xt({},s),e)}function S0(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(S0):Object.keys(n).reduce((e,t)=>(e[t]=S0(n[t]),e),{}):n}function P4(n,e){const t=n.loader;t!==FT&&t!==AR?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):b4()&&(n.loader=FT,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Eh=2,N4=.1,k4=.05,M4=100;class U4 extends xI{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(M4),this.mediaSource=t.mediaSource;const s=this.media=t.media;Dn(s,"playing",this.onMediaPlaying),Dn(s,"waiting",this.onMediaWaiting),Dn(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Vn(s,"playing",this.onMediaPlaying),Vn(s,"waiting",this.onMediaWaiting),Vn(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:l}=a,u=this.seeking&&!l,d=!this.seeking&&l,h=a.paused&&!l||a.ended||a.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||u){u&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1}));return}if(!ft.getBuffered(a).length){this.nudgeRetry=0;return}const m=ft.bufferInfo(a,e,0),g=m.nextStart||0,v=this.fragmentTracker;if(l&&v&&this.hls){const D=BT(this.hls.inFlightFragments,e),_=m.len>Eh,k=!g||D||g-e>Eh&&!v.getPartialFragment(e);if(_||k)return;this.moved=!1}const S=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(m.len>0)&&!g)return;const _=Math.max(g,m.start||0)-e,N=!!(S!=null&&S.live)?S.targetduration*2:Eh,F=nh(e,v);if(_>0&&(_<=N||F)){a.paused||this._trySkipBufferHole(F);return}}const x=r.detectStallWithCurrentTimeMs,T=self.performance.now(),A=this.waiting;let E=this.stalled;if(E===null)if(A>0&&T-A<x)E=this.stalled=A;else{this.stalled=T;return}const R=T-E;if(!l&&(R>=x||A)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const w=ft.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(w,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(O.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&i&&i.length>1&&e>i.end(0)){const r=ft.bufferedInfo(ft.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const a=ft.timeRangesToArray(i),l=ft.bufferedInfo(a,t,0).bufferedIndex;if(l>-1&&l<a.length-1){const u=ft.bufferedInfo(a,e,0).bufferedIndex,d=a[l].end,h=a[l+1].start;if((u===-1||u>l)&&h-d<1&&e-d<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${h} buffered index: ${u}`);this.warn(m.message),this.media.currentTime+=1e-6;let g=nh(e,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);const v=ft.bufferInfo(this.media,e,0);this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:g,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,s){var i,r;const{fragmentTracker:a,media:l}=this,u=(i=this.hls)==null?void 0:i.config;if(!l||!a||!u)return;const d=(r=this.hls)==null?void 0:r.latestLevelDetails,h=nh(s,a);if((h||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const m=e.buffered,g=this.adjacentTraversal(e,s);(m&&m.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-s<u.maxBufferHole||g))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,i=e.nextStart;if(s&&i){const r=s.getFragAtPos(t,$e.MAIN),a=s.getFragAtPos(i,$e.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&r!==null&&s&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${os(e)})`);this.warn(a.message),t.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=(t=this.hls)==null?void 0:t.config;if(!i||!s||!r)return 0;const a=i.currentTime,l=ft.bufferInfo(i,a,0),u=a<l.start?l.start:l.nextStart;if(u&&this.hls){const h=l.len<=r.maxBufferHole,m=l.len>0&&l.len<1&&i.readyState<3,g=u-a;if(g>0&&(h||m)){if(g>r.maxBufferHole){let S=!1;if(a===0){const x=s.getAppendedFrag(0,$e.MAIN);x&&u<x.end&&(S=!0)}if(!S&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||BT(this.hls.inFlightFragments,u))return 0;let T=!1,A=e.end;for(;A<u;){const E=nh(A,s);if(E)A+=E.duration;else{T=!0;break}}if(T)return 0}}const v=Math.max(u+k4,a+N4);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${v}`),this.moved=!0,i.currentTime=v,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${v}`),x={type:qe.MEDIA_ERROR,details:te.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:l.len,bufferInfo:l};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(O.ERROR,x)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=t?.config;if(!s||!r)return 0;const a=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const l=a+(i+1)*r.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${a} to ${l}`);this.warn(u.message),s.currentTime=l,t.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const l=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(l.message),t.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}function BT(n,e){const t=jT(n.main);if(t&&t.start<=e)return t;const s=jT(n.audio);return s&&s.start<=e?s:null}function jT(n){if(!n)return null;switch(n.state){case ye.IDLE:case ye.STOPPED:case ye.ENDED:case ye.ERROR:return null}return n.frag}function nh(n,e){return e.getAppendedFrag(n,$e.MAIN)||e.getPartialFragment(n)}const F4=.25;function b0(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function mg(n,e,t,s,i){let r=new n(e,t,"");try{r.value=s,i&&(r.type=i)}catch{r=new n(e,t,os(i?Xt({type:i},s):s))}return r}const ih=(()=>{const n=b0();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class B4{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(O.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&sl(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return hR(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:i}=this.hls.config;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=b0();if(a)for(let l=0;l<r.length;l++){const u=r[l].type;if(u===ii.emsg&&!s||!i)continue;const d=jI(r[l].data),h=r[l].pts;let m=h+r[l].duration;m>ih&&(m=ih),m-h<=0&&(m=h+F4);for(let v=0;v<d.length;v++){const S=d[v];if(!VI(S)){this.updateId3CueEnds(h,u);const x=mg(a,h,m,S,u);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var s;const i=(s=this.id3Track)==null?void 0:s.cues;if(i)for(let r=i.length;r--;){const a=i[r];a.type===t&&a.startTime<e&&a.endTime===ih&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:u}}=a;if(r&&(l||u)){let d;i==="audio"?d=h=>h.type===ii.audioId3&&u:i==="video"?d=h=>h.type===ii.emsg&&l:d=h=>h.type===ii.audioId3&&u||h.type===ii.emsg&&l,v0(r,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const l=b0();if(s&&i&&!a){const{fragmentStart:x,fragmentEnd:T}=e;let A=this.assetCue;A?(A.startTime=x,A.endTime=T):l&&(A=this.assetCue=mg(l,x,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:u}=this,{dateRanges:d}=e,h=Object.keys(d);let m=this.dateRangeCuesAppended;if(u&&t){var g;if((g=u.cues)!=null&&g.length){const x=Object.keys(m).filter(T=>!h.includes(T));for(let T=x.length;T--;){var v;const A=x[T],E=(v=m[A])==null?void 0:v.cues;delete m[A],E&&Object.keys(E).forEach(R=>{const L=E[R];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{u.removeCue(L)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(h.length===0||!je(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<h.length;x++){const T=h[x],A=d[T],E=A.startTime,R=m[T],L=R?.cues||{};let w=R?.durationKnown||!1,D=ih;const{duration:_,endDate:k}=A;if(k&&_!==null)D=E+_,w=!0;else if(A.endOnNext&&!w){const F=h.reduce((V,H)=>{if(H!==A.id){const J=d[H];if(J.class===A.class&&J.startDate>A.startDate&&(!V||A.startDate<V.startDate))return J}return V},null);F&&(D=F.startTime,w=!0)}const N=Object.keys(A.attr);for(let F=0;F<N.length;F++){const V=N[F];if(!rM(V))continue;const H=L[V];if(H)w&&!(R!=null&&R.durationKnown)?H.endTime=D:Math.abs(H.startTime-E)>.01&&(H.startTime=E,H.endTime=D);else if(l){let J=A.attr[V];aM(V)&&(J=eI(J));const Q=mg(l,E,D,{key:V,data:J},ii.dateRange);Q&&(Q.id=T,this.id3Track.addCue(Q),L[V]=Q,a&&(V==="X-ASSET-LIST"||V==="X-ASSET-URL")&&Q.addEventListener("enter",this.onEventCueEnter))}}m[T]={cues:L,dateRange:A,durationKnown:w}}}}}class j4{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!s.live)return;const l=this.targetLatency;if(l===null)return;const u=i-l,d=Math.min(this.maxLatency,l+s.targetduration);if(u<d&&u>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,a)),g=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,v=Math.min(m,Math.max(1,g));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:l}=this.config,u=this.hls.userConfig;let d=l&&s||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||d===0)&&(d=r!==void 0?r:a*i);const h=i;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const i=s.edge,r=e-t-this.edgeStalled,a=i-s.totalduration,l=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,r),l)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===te.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class V4 extends Ty{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let l=!1,u=!1,d=!1;t.levels.forEach(h=>{const m=h.attrs;let{audioCodec:g,videoCodec:v}=h;g&&(h.audioCodec=g=Nh(g,s)||void 0),v&&(v=h.videoCodec=Tk(v));const{width:S,height:x,unknownCodecs:T}=h,A=T?.length||0;if(l||(l=!!(S&&x)),u||(u=!!v),d||(d=!!g),A||g&&!this.isAudioSupported(g)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":R,"HDCP-LEVEL":L,"PATHWAY-ID":w,RESOLUTION:D,"VIDEO-RANGE":_}=m,N=`${`${w||"."}-`}${h.bitrate}-${D}-${R}-${E}-${_}-${L}`;if(r[N])if(r[N].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const F=a[N]+=1;h.attrs["PATHWAY-ID"]=new Array(F+1).join(".");const V=this.createLevel(h);r[N]=V,i.push(V)}else r[N].addGroupId("audio",m.AUDIO),r[N].addGroupId("text",m.SUBTITLES);else{const F=this.createLevel(h);r[N]=F,a[N]=1,i.push(F)}}),this.filterAndSortMediaOptions(i,t,l,u,d)}createLevel(e){const t=new qc(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(i.message),t.supportedResult=dI(i,[])}return t}isAudioSupported(e){return Kc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Kc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){var a;let l=[],u=[],d=e;const h=((a=t.stats)==null?void 0:a.parsing)||{};if((s||i)&&r&&(d=d.filter(({videoCodec:E,videoRange:R,width:L,height:w})=>(!!E||!!(L&&w))&&_k(R))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",R=E;t.levels.length&&(R=`one or more CODECS in variant not supported: ${os(t.levels.map(w=>w.attrs.CODECS).filter((w,D,_)=>_.indexOf(w)===D))}`,this.warn(R),E+=` (${R})`);const L=new Error(E);this.hls.trigger(O.ERROR,{type:qe.MEDIA_ERROR,details:te.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:R})}}),h.end=performance.now();return}t.audioTracks&&(l=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),VT(l)),t.subtitles&&(u=t.subtitles,VT(u));const m=d.slice(0);d.sort((E,R)=>{if(E.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&E.height!==R.height)return E.height-R.height;if(E.frameRate!==R.frameRate)return E.frameRate-R.frameRate;if(E.videoRange!==R.videoRange)return kh.indexOf(E.videoRange)-kh.indexOf(R.videoRange);if(E.videoCodec!==R.videoCodec){const L=Nb(E.videoCodec),w=Nb(R.videoCodec);if(L!==w)return w-L}if(E.uri===R.uri&&E.codecSet!==R.codecSet){const L=Ph(E.codecSet),w=Ph(R.codecSet);if(L!==w)return w-L}return E.averageBitrate!==R.averageBitrate?E.averageBitrate-R.averageBitrate:0});let g=m[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==m.length)){for(let E=0;E<m.length;E++)if(m[E].pathwayId===d[0].pathwayId){g=m[E];break}}this._levels=d;for(let E=0;E<d.length;E++)if(d[E]===g){var v;this._firstLevel=E;const R=g.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${R}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const w=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);w>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const S=r&&!i,x=this.hls.config,T=!!(x.audioStreamController&&x.audioTrackController),A={levels:d,audioTracks:l,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:T&&!S&&l.some(E=>!!E.url)};h.end=performance.now(),this.hls.trigger(O.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:h,reason:h.message}),m)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],l=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&i&&r===l)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${l?" with Pathway "+l:""} from level ${s}${r?" with Pathway "+r:""}`);const u={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(O.LEVEL_SWITCHING,u);const d=a.details;if(!d||d.live){const h=this.switchParams(a.uri,i?.details,d);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===wt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===$e.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,a=t.levelInfo;if(!a){var l;this.warn(`Invalid level index ${i}`),(l=t.deliveryDirectives)!=null&&l.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let u=a.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,l=a?.age;this.log(`Loading level index ${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(O.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(l=>l.level=-1)),!1));DI(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(O.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(O.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function VT(n){const e={};n.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function IR(){return self.SourceBuffer||self.WebKitSourceBuffer}function RR(){if(!xa())return!1;const e=IR();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function $4(){if(!RR())return!1;const n=xa();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Yc(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Yc(e,"audio"))))}function G4(){var n;const e=IR();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const H4=100;class z4 extends my{constructor(e,t,s){super(e,t,s,"stream-controller",$e.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,r=i?i.currentTime:null;if(r===null||!je(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(i,r,$e.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(H4),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ye.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ye.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ye.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],i=s?.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=ye.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ye.IDLE;break}break}case ye.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ye.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const a=s[r],l=this.getMainFwdBufferInfo();if(l===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(l,u)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(O.BUFFER_EOS,x),this.state=ye.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const d=a.details;if(!d||this.state===ye.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=ye.WAITING_LEVEL,this.startFragRequested=!1;return}const h=l.len,m=this.getMaxBufferLength(a.maxBitrate);if(h>=m)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const g=this.backtrackFragment?this.backtrackFragment.start:l.end;let v=this.getNextFragment(g,d);if(this.couldBacktrack&&!this.fragPrevious&&v&&Ys(v)&&this.fragmentTracker.getState(v)!==en.OK){var S;const T=((S=this.backtrackFragment)!=null?S:v).sn-d.startSN,A=d.fragments[T-1];A&&v.cc===A.cc&&(v=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,g)){if(!v.gap){const T=this.audioOnly&&!this.altAudio?as.AUDIO:as.VIDEO,A=(T===as.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,T,$e.MAIN)}v=this.getNextFragmentLoopLoading(v,d,l,$e.MAIN,m)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,a,g))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===en.NOT_LOADED||i===en.PARTIAL?Ys(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,$e.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const l=this.getMainFwdBufferInfo();if(!l||l.len<r.targetduration*2)return}if(!t.paused&&e){const l=this.hls.nextLoadLevel,u=e[l],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:s=0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const l=this.followingBufferedFrag(a);if(l){this.abortCurrentFrag();const u=l.maxStartPTS?l.maxStartPTS:l.start,d=l.duration,h=Math.max(a.end,u+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ye.KEY_LOADING:case ye.FRAG_LOADING:case ye.FRAG_LOADING_WAITING_RETRY:case ye.PARSING:case ye.PARSED:this.state=ye.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Dn(s,"playing",this.onMediaPlaying),Dn(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Vn(s,"playing",this.onMediaPlaying),Vn(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;for(let r=0;r<t.levels.length;r++){const a=t.levels[r].audioCodec;a&&(s=s||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&i&&!G4(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ye.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ye.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,a=t.level,l=t.details,u=l.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${u}`);const d=t.levelInfo,h=this.fragCurrent;h&&(this.state===ye.FRAG_LOADING||this.state===ye.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let m=0;if(l.live||(s=d.details)!=null&&s.live){var g;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;m=this.alignPlaylists(l,d.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(d.details=l,this.levelLastLoaded=d,r||this.setStartPosition(l,m),this.hls.trigger(O.LEVEL_UPDATED,{details:l,level:a}),this.state===ye.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=ye.IDLE}r&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,l=e.edge,u=r>=a-t.maxFragLookUpTolerance&&r<=l;if(i!==null&&s.duration>i&&(r<i||!u)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&s.readyState<4||r<l-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const m=ft.bufferInfo(s,i,0);if(!((d=m.buffered)!=null&&d.length)){s.currentTime=i;return}if(m.start<=r){s.currentTime=i;return}const{nextStart:v}=ft.bufferedInfo(m.buffered,r,0);v&&(s.currentTime=v)}else s.currentTime=i}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const l=a[s.level];if(!l){this.warn(`Level ${s.level} not found on progress`);return}const u=l.details;if(!u){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=l.videoCodec,h=u.PTSKnown||!u.live,m=(t=s.initSegment)==null?void 0:t.data,g=this._getAudioCodec(l),v=this.transmuxer=this.transmuxer||new ZI(this.hls,$e.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=i?i.index:-1,x=S!==-1,T=new uy(s.level,s.sn,s.stats.chunkCount,r.byteLength,S,x),A=this.initPTS[s.cc];v.push(r,m,g,d,s,i,u.totalduration,h,T,A)}onAudioTrackSwitching(e,t){const s=this.hls,i=this.altAudio===2;if(Mh(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),s.once(O.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(O.AUDIO_TRACK_SWITCHED,t)}),s.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(O.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Mh(t.url,this.hls);if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,a=!1;for(const l in s){const u=s[l];if(u.id==="main"){if(r=l,i=u,l==="video"){const d=s[l];d&&(this.videoBuffer=d.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===$e.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ye.PARSED&&(this.state=ye.IDLE);return}const l=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),Ys(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const a=this.media;a&&(!this._hasEnoughToStart&&ft.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ye.ERROR;return}switch(t.details){case te.FRAG_GAP:case te.FRAG_PARSING_ERROR:case te.FRAG_DECRYPT_ERROR:case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($e.MAIN,t);break;case te.LEVEL_LOAD_ERROR:case te.LEVEL_LOAD_TIMEOUT:case te.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ye.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===wt.LEVEL&&(this.state=ye.IDLE);break;case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case te.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case te.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ye.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==as.AUDIO||!this.altAudio){const s=(t===as.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,$e.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),a=ft.getBuffered(e),l=a.length?a.start(0):0,u=l-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<d||this.loadingParts&&u<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),s+=u,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${l}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:i}=this,r=s?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ye.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(O.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===ye.STOPPED||this.state===ye.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:i,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a){this.resetWhenMissingContext(r);return}const{frag:l,part:u,level:d}=a,{video:h,text:m,id3:g,initSegment:v}=i,{details:S}=d,x=this.altAudio?void 0:i.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=ye.PARSING,v){const T=v.tracks;if(T){const L=l.initSegment||l;if(this.unhandledEncryptionError(v,l))return;this._bufferInitSegment(d,T,L,r),s.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:t,tracks:T})}const A=v.initPTS,E=v.timescale,R=this.initPTS[l.cc];if(je(A)&&(!R||R.baseTime!==A||R.timescale!==E)){const L=v.trackId;this.initPTS[l.cc]={baseTime:A,timescale:E,trackId:L},s.trigger(O.INIT_PTS_FOUND,{frag:l,id:t,initPTS:A,timescale:E,trackId:L})}}if(h&&S){x&&h.type==="audiovideo"&&this.logMuxedErr(l);const T=S.fragments[l.sn-1-S.startSN],A=l.sn===S.startSN,E=!T||l.cc>T.cc;if(i.independent!==!1){const{startPTS:R,endPTS:L,startDTS:w,endDTS:D}=h;if(u)u.elementaryStreams[h.type]={startPTS:R,endPTS:L,startDTS:w,endDTS:D};else if(h.firstKeyFrame&&h.independent&&r.id===1&&!E&&(this.couldBacktrack=!0),h.dropped&&h.independent){const _=this.getMainFwdBufferInfo(),k=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,N=h.firstKeyFramePTS?h.firstKeyFramePTS:R;if(!A&&k<N-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(h.type,l.start,L,l.start,D,!0)}else A&&R-(S.appliedTimelineOffset||0)>Eh&&(l.gap=!0);l.setElementaryStreamInfo(h.type,R,L,w,D),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(h,l,u,r,A||E)}else if(A||E)l.gap=!0;else{this.backtrack(l);return}}if(x){const{startPTS:T,endPTS:A,startDTS:E,endDTS:R}=x;u&&(u.elementaryStreams[as.AUDIO]={startPTS:T,endPTS:A,startDTS:E,endDTS:R}),l.setElementaryStreamInfo(as.AUDIO,T,A,E,R),this.bufferFragmentData(x,l,u,r)}if(S&&g!=null&&g.samples.length){const T={id:t,frag:l,details:S,samples:g.samples};s.trigger(O.FRAG_PARSING_METADATA,T)}if(S&&m){const T={id:t,frag:l,details:S,samples:m.samples};s.trigger(O.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${Ys(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==ye.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:a,audiovideo:l}=t;if(r){const d=e.audioCodec;let h=gh(r.codec,d);h==="mp4a"&&(h="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const g=r.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),d&&d!==h&&this.log(`Swapping manifest audio codec "${d}" for "${h}"`),r.levelCodec=h,r.id=$e.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${h||""}/${d||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=$e.MAIN;const d=a.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${a.codec!==d?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(O.BUFFER_CODECS,t),!this.hls)return;u.forEach(d=>{const m=t[d].initSegment;m!=null&&m.byteLength&&this.hls.trigger(O.BUFFER_APPENDING,{type:d,data:m,frag:s,part:null,chunkMeta:i,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,$e.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ye.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(ft.isBuffered(e,s)?t=this.getAppendedFrag(s):ft.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,r=t.level;(!i||t.sn!==i.sn||i.level!==r)&&(this.fragPlaying=t,this.hls.trigger(O.FRAG_CHANGED,{frag:t}),(!i||i.level!==r)&&this.hls.trigger(O.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return je(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(je(t)){const s=this.getLevelDetails(),i=this.currentFrag||(s?to(null,s.fragments,t):null);if(i){const r=i.programDateTime;if(r!==null){const a=r+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class K4 extends Oi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[s].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=te.KEY_LOAD_ERROR,s,i,r){return new Pr({type:qe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const a=t[i];if(e.cc<=a.cc&&(!Ys(e)||!Ys(a)||e.sn<a.sn)||!s&&i==r-1)return this.emeController.selectKeySystemFormat(a).then(l=>{if(!this.emeController)return;a.setKeyFormat(l);const u=vh(l);if(u)return this.emeController.getKeySystemAccess([u])})}if(this.config.requireKeySystemAccessOnStart){const i=Pc(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,d))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const l=pg(r);let u=this.keyIdToKeyInfo[l];if((s=u)!=null&&s.decryptdata.key)return r.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(this.emeController&&(i=u)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(u.decryptdata)){case"usable":case"usable-in-future":return u.keyLoadPromise.then(h=>{const{keyInfo:m}=h;return r.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[l]?"Rel":"L"}oading${r.keyId?" keyId: "+jn(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),u=this.keyIdToKeyInfo[l]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(s);return(e.keyLoadPromise=i.then(r=>(e.mediaKeySessionContext=r,s))).catch(r=>{throw e.keyLoadPromise=null,"data"in r&&(r.data.frag=t),r})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=s.loader,r=new i(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,l)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,S,x)=>{const{frag:T,keyInfo:A}=S,E=pg(A.decryptdata);if(!T.decryptdata||A!==this.keyIdToKeyInfo[E])return l(this.createKeyLoadError(T,te.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));A.decryptdata.key=T.decryptdata.key=new Uint8Array(g.data),T.keyLoader=null,A.loader=null,a({frag:T,keyInfo:A})},onError:(g,v,S,x)=>{this.resetLoader(v),l(this.createKeyLoadError(t,te.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),S,Xt({url:u.url,data:void 0},g)))},onTimeout:(g,v,S)=>{this.resetLoader(v),l(this.createKeyLoadError(t,te.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(g,v,S)=>{this.resetLoader(v),l(this.createKeyLoadError(t,te.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};r.load(u,h,m)})}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const a=pg(s.decryptdata)||i;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function pg(n){if(n.keyFormat!==Cn.FAIRPLAY){const e=n.keyId;if(e)return jn(e)}return n.uri}function $T(n){const{type:e}=n;switch(e){case wt.AUDIO_TRACK:return $e.AUDIO;case wt.SUBTITLE_TRACK:return $e.SUBTITLE;default:return $e.MAIN}}function gg(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Y4{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=s||i,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:wt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:a,deliveryDirectives:l,levelInfo:u}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:wt.LEVEL,url:a,deliveryDirectives:l,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:l}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:wt.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:l}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:wt.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onLevelsUpdated(e,t){const s=this.loaders[wt.LEVEL];if(s){const i=s.context;i&&!t.levels.some(r=>r===i.levelOrTrack)&&(s.abort(),delete this.loaders[wt.LEVEL])}}load(e){var t;const s=this.hls.config;let i=this.getInternalLoader(e);if(i){const d=this.hls.logger,h=i.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let r;if(e.type===wt.MANIFEST?r=s.manifestLoadPolicy.default:r=ts({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),je((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===wt.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===wt.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===wt.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const h=d.partTarget,m=d.targetduration;if(h&&m){const g=Math.max(h*3,m*.8)*1e3;r=ts({},r,{maxTimeToFirstByteMs:Math.min(g,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},l={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(d,h,m,g)=>{const v=this.getInternalLoader(m);this.resetInternalLoader(m.type);const S=d.data;h.parsing.start=performance.now(),lr.isMediaPlaylist(S)||m.type!==wt.MANIFEST?this.handleTrackOrLevelPlaylist(d,h,m,g||null,v):this.handleMasterPlaylist(d,h,m,g)},onError:(d,h,m,g)=>{this.handleNetworkError(h,m,!1,d,g)},onTimeout:(d,h,m)=>{this.handleNetworkError(h,m,!0,void 0,d)}};i.load(e,l,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,a=e.data,l=gg(e,s),u=lr.parseMasterPlaylist(a,l);if(u.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,u.playlistParsingError,i,t);return}const{contentSteering:d,levels:h,sessionData:m,sessionKeys:g,startTimeOffset:v,variableList:S}=u;this.variableList=S,h.forEach(E=>{const{unknownCodecs:R}=E;if(R){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:w,videoCodec:D}=E;for(let _=R.length;_--;){const k=R[_];Kc(k,"audio",L)?(E.audioCodec=w=w?`${w},${k}`:k,hl.audio[w.substring(0,4)]=2,R.splice(_,1)):Kc(k,"video",L)&&(E.videoCodec=D=D?`${D},${k}`:k,hl.video[D.substring(0,4)]=2,R.splice(_,1))}}});const{AUDIO:x=[],SUBTITLES:T,"CLOSED-CAPTIONS":A}=lr.parseMasterPlaylistMedia(a,l,u);x.length&&!x.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new As({}),bitrate:0,url:""})),r.trigger(O.MANIFEST_LOADED,{levels:h,audioTracks:x,subtitles:T,captions:A,contentSteering:d,url:l,stats:t,networkDetails:i,sessionData:m,sessionKeys:g,startTimeOffset:v,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,i,r){const a=this.hls,{id:l,level:u,type:d}=s,h=gg(e,s),m=je(u)?u:je(l)?l:0,g=$T(s),v=lr.parseLevelPlaylist(e.data,h,m,g,0,this.variableList);if(d===wt.MANIFEST){const S={attrs:new As({}),bitrate:0,details:v,name:"",url:h};v.requestScheduled=t.loading.start+wI(v,0),a.trigger(O.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=v,this.handlePlaylistLoaded(v,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(O.ERROR,{type:qe.NETWORK_ERROR,details:te.MANIFEST_PARSING_ERROR,fatal:t.type===wt.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let a=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===wt.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===wt.AUDIO_TRACK||e.type===wt.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const l=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let u=te.UNKNOWN,d=!1;const h=this.getInternalLoader(e);switch(e.type){case wt.MANIFEST:u=s?te.MANIFEST_LOAD_TIMEOUT:te.MANIFEST_LOAD_ERROR,d=!0;break;case wt.LEVEL:u=s?te.LEVEL_LOAD_TIMEOUT:te.LEVEL_LOAD_ERROR,d=!1;break;case wt.AUDIO_TRACK:u=s?te.AUDIO_TRACK_LOAD_TIMEOUT:te.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case wt.SUBTITLE_TRACK:u=s?te.SUBTITLE_TRACK_LOAD_TIMEOUT:te.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(e.type);const m={type:qe.NETWORK_ERROR,details:u,fatal:d,url:e.url,loader:h,context:e,error:l,networkDetails:t,stats:r};if(i){const g=t?.url||e.url;m.response=Xt({url:g,data:void 0},i)}this.hls.trigger(O.ERROR,m)}handlePlaylistLoaded(e,t,s,i,r,a){const l=this.hls,{type:u,level:d,levelOrTrack:h,id:m,groupId:g,deliveryDirectives:v}=i,S=gg(t,i),x=$T(i);let T=typeof i.level=="number"&&x===$e.MAIN?d:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!l.config.ignorePlaylistParsingErrors){l.trigger(O.ERROR,{type:qe.NETWORK_ERROR,details:te.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:A,reason:A.message,response:t,context:i,level:T,parent:x,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(O.ERROR,{type:qe.NETWORK_ERROR,details:te.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:E,reason:E.message,response:t,context:i,level:T,parent:x,networkDetails:r,stats:s});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case wt.MANIFEST:case wt.LEVEL:if(T){if(!h)T=0;else if(h!==l.levels[T]){const E=l.levels.indexOf(h);E>-1&&(T=E)}}l.trigger(O.LEVEL_LOADED,{details:e,levelInfo:h||l.levels[0],level:T||0,id:m||0,stats:s,networkDetails:r,deliveryDirectives:v,withoutMultiVariant:u===wt.MANIFEST});break;case wt.AUDIO_TRACK:l.trigger(O.AUDIO_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:g||"",stats:s,networkDetails:r,deliveryDirectives:v});break;case wt.SUBTITLE_TRACK:l.trigger(O.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:g||"",stats:s,networkDetails:r,deliveryDirectives:v});break}}}class ri{static get version(){return Xc}static isMSESupported(){return RR()}static isSupported(){return $4()}static getMediaSource(){return xa()}static get Events(){return O}static get MetadataSchema(){return ii}static get ErrorTypes(){return qe}static get ErrorDetails(){return te}static get DefaultConfig(){return ri.defaultConfig?ri.defaultConfig:D4}static set DefaultConfig(e){ri.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new py,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=JN(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=_4(ri.DefaultConfig,e,t);this.userConfig=e,s.progressive&&P4(s,t);const{abrController:i,bufferController:r,capLevelController:a,errorController:l,fpsController:u}=s,d=new l(this),h=this.abrController=new i(this),m=new Yk(this),g=s.interstitialsController,v=g?this.interstitialsController=new g(this,ri):null,S=this.bufferController=new r(this,m),x=this.capLevelController=new a(this),T=new u(this),A=new Y4(this),E=s.contentSteeringController,R=E?new E(this):null,L=this.levelController=new V4(this,R),w=new B4(this),D=new K4(this.config,this.logger),_=this.streamController=new z4(this,m,D),k=this.gapController=new U4(this,m);x.setStreamController(_),T.setStreamController(_);const N=[A,L,_];v&&N.splice(1,0,v),R&&N.splice(1,0,R),this.networkControllers=N;const F=[h,S,k,x,T,w,m];this.audioTrackController=this.createController(s.audioTrackController,N);const V=s.audioStreamController;V&&N.push(this.audioStreamController=new V(this,m,D)),this.subtitleTrackController=this.createController(s.subtitleTrackController,N);const H=s.subtitleStreamController;H&&N.push(this.subtititleStreamController=new H(this,m,D)),this.createController(s.timelineController,F),D.emeController=this.emeController=this.createController(s.emeController,F),this.cmcdController=this.createController(s.cmcdController,F),this.latencyController=this.createController(j4,F),this.coreComponents=F,N.push(d);const J=d.onErrorOut;typeof J=="function"&&this.on(O.ERROR,J,d),this.on(O.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const i=e===O.ERROR;this.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,fatal:i,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(O.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(O.ERROR,{type:qe.OTHER_ERROR,details:te.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(O.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(O.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(O.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=ny.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(O.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[$e.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[$e.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[$e.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=UU()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ok(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,s)for(let r=i;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=mI(t);return hI(e,s,navigator.mediaCapabilities)}}ri.defaultConfig=void 0;const GT=(n,e=!1)=>{if(!n)return[];const t=n.pages.map((i,r)=>i?Array.isArray(i)?i[0]&&!ty(i[0])?(console.error("getAllTracks: Page does not contain MediaItem objects",n),console.trace(),[]):i.map(a=>({...a,pageIndex:r})):(console.error("getAllTracks: Page is not an array",n),console.trace(),[]):(console.error("getAllTracks: Page is undefined or null",n),console.trace(),[])).flat();if(e)return t;const s=new Set;return t.filter(i=>s.has(i.Id)?!1:(s.add(i.Id),!0))},_i=({queryKey:n,queryFn:e,initialPageParam:t=0,queryFnReviver:s,allowDuplicates:i=!1,enabled:r=!0,staleTime:a})=>{const{data:u,isFetching:d,isPending:h,error:m,fetchNextPage:g,hasNextPage:v,isFetchingNextPage:S}=GE({queryKey:n,queryFn:e,getNextPageParam:(A,E)=>A.length>=40?E.length:void 0,initialPageParam:t,enabled:r,staleTime:a});C.useEffect(()=>{m instanceof ro&&m.response?.status===401&&(localStorage.removeItem("auth"),window.location.href="/login")},[m]);const x=C.useMemo(()=>GT(u,i),[u,i]),T=C.useCallback(async()=>{if(v&&!S)return GT((await g()).data)},[v,S,g]);return{items:x,infiniteData:u,isLoading:d||h,error:m?m.message:null,hasNextPage:v,loadMore:T,reviver:{queryKey:n,queryFn:s}}},ui="___PAGE_PARAM_INDEX___",q4=({initialVolume:n,clearOnLogout:e})=>{const t=Yt(),[s,i]=C.useState(()=>{const oe=localStorage.getItem("sessionPlayCount");return oe?Number(oe):0}),[r,a]=C.useState(localStorage.getItem("lyricsTimestamps")==="on");C.useEffect(()=>localStorage.setItem("lyricsTimestamps",r?"on":"off"),[r]);const[l,u]=C.useState(localStorage.getItem("centeredLyrics")==="on");C.useEffect(()=>localStorage.setItem("centeredLyrics",l?"on":"off"),[l]);const[d,h]=C.useState(localStorage.getItem("rememberFilters")==="on");C.useEffect(()=>localStorage.setItem("rememberFilters",d?"on":"off"),[d]);const[m,g]=C.useState(localStorage.getItem("warnBeforeOverwriteQueue")==="on");C.useEffect(()=>localStorage.setItem("warnBeforeOverwriteQueue",m?"on":"off"),[m]);const[v,S]=C.useState({index:localStorage.getItem("currentTrackIndex")?Number(localStorage.getItem("currentTrackIndex")):-1}),[x,T]=C.useState(!1),[A,E]=C.useState(()=>{const oe=localStorage.getItem("volume");return oe?parseFloat(oe):n}),[R,L]=C.useState(localStorage.getItem("shuffle")==="true"),[w,D]=C.useState(()=>{const oe=localStorage.getItem("repeatMode");return oe==="all"||oe==="one"?oe:"off"}),[_,k]=C.useState(localStorage.getItem("crossfade")==="true"),[N,F]=C.useState(()=>{const oe=localStorage.getItem("crossfadeDuration");return oe?Number(oe):1}),[V,H]=C.useState(localStorage.getItem("preload")!=="false"),[J,X]=C.useState(()=>{const oe=localStorage.getItem("preloadDuration");return oe?Number(oe):6}),Q=C.useRef(!1),j=C.useRef(void 0);C.useEffect(()=>{localStorage.setItem("crossfade",_.toString())},[_]),C.useEffect(()=>{localStorage.setItem("crossfadeDuration",N.toString())},[N]),C.useEffect(()=>{localStorage.setItem("preload",V.toString())},[V]),C.useEffect(()=>{localStorage.setItem("preloadDuration",J.toString())},[J]),C.useEffect(()=>{localStorage.setItem("shuffle",R.toString())},[R]);const K=C.useRef([new Audio,new Audio]),Y=C.useRef([null,null]),re=C.useCallback(()=>{K.current.push(K.current.shift())},[]),B=C.useCallback(()=>{Y.current.push(Y.current.shift())},[]),M=K.current[0],z=K.current[1],G=C.useRef(!1),de=lu(),[Te,pe]=C.useState(localStorage.getItem("playlistTitle")||""),[Qe,ce]=C.useState(localStorage.getItem("playlistUrl")||""),[Oe,Ue]=C.useState(JSON.parse(localStorage.getItem("reviver")||"{}")||{}),[Ze,nt]=C.useState(Number(localStorage.getItem("bitrate"))),[Dt,Nt]=C.useState(()=>localStorage.getItem("maxWidth")||"800"),Ot=C.useRef(!1),ke=Sl(),Je=C.useRef(void 0);C.useEffect(()=>{localStorage.setItem("bitrate",Ze.toString())},[Ze]),C.useEffect(()=>{localStorage.setItem("maxWidth",Dt)},[Dt]);const ot=C.useMemo(()=>R&&!(Oe.queryFn?.params||[]).includes(ui),[Oe.queryFn?.params,R]),kt=C.useMemo(()=>{const oe=Oe.queryFn?.fn||"",Ye=[...Oe.queryFn?.params||[]],tt=Ye.findIndex(bt=>bt===ui);return{queryKey:["reviver",...R&&!ot?["shuffle"]:[],...Oe.queryKey||[]],queryFn:async({pageParam:bt=0})=>{try{const Gs=Ye[tt+1],Us=bt*Gs;Ye[tt]=Us,R&&!ot&&(Ye[tt+2]="Random");const Ls=await t[oe]?.(...Ye)||[];return R&&!ot&&Je.current&&Ls.splice(v.index,0,Je.current),Je.current=void 0,Ls}catch(Gs){return console.error("Error in reviver queryFn:",Gs),console.trace(),[]}},queryFnReviver:void 0,initialPageParam:Number(localStorage.getItem("reviverPageIndex"))||0,allowDuplicates:!0,enabled:Ye.length>0,staleTime:1/0}},[t,v.index,ot,Oe.queryFn?.fn,Oe.queryFn?.params,Oe.queryKey,R]),vt=C.useRef(0),fe=C.useCallback(oe=>(oe.queueId||=`${oe.Id}-${Date.now().toString(36)}-${vt.current++}`,oe),[]),ze=C.useCallback(oe=>(oe.queueId=`${oe.Id}-${Date.now().toString(36)}-${vt.current++}`,oe),[]),Ve=C.useCallback(oe=>oe.map(Ye=>({...Ye,manuallyAdded:!0})),[]),{items:Fe,hasNextPage:et,loadMore:W,isLoading:se,infiniteData:me}=_i(kt),he=C.useMemo(()=>{const oe=Fe.map(fe);if(ot&&oe.length){const Ye=v.index+1,tt=oe.slice(0,Ye),bt=oe.slice(Ye).sort(()=>Math.random()-.5);return[...tt,...bt]}return oe},[Fe,fe,ot]),Ke=C.useMemo(()=>me?.pages.map(oe=>oe?Array.isArray(oe)?oe[0]&&!ty(oe[0])?(console.error("_pages: Page does not contain MediaItem objects",me),console.trace(),[]):oe.map(fe):(console.error("_pages: Page is not an array",me),console.trace(),[]):(console.error("_pages: Page is undefined or null",me),console.trace(),[]))||[],[fe,me]),Be=C.useCallback(async oe=>{const Ye=kt.queryKey;de.setQueryData(Ye,{pageParams:Object.keys(Ke),pages:(await oe(Ke)).map(tt=>tt.map(ze))})},[kt.queryKey,Ke,de,ze]),ht=C.useCallback(oe=>{if(oe.reviver!=="persistAll"){if(m&&he&&he.length>0&&v.index>=0){const bt=he.slice(v.index+1).filter(Gs=>Gs.manuallyAdded);if(bt.length>0){const Gs=bt.length===1?"track":"tracks";if(!confirm(`You've added ${bt.length} ${Gs} to your queue that haven't played yet. Are you sure you want to overwrite the active queue?`))return!1}}const Ye=["reviver",...oe.reviver?.queryKey||[]];de.setQueryData(Ye,oe.pages),localStorage.setItem("reviver",JSON.stringify(oe.reviver||{})),Ue(oe.reviver||{}),L(!1),localStorage.setItem("playlistTitle",oe.title),pe(oe.title);const tt=location.href;tt!=="/"&&!oe.disableUrl?(localStorage.setItem("playlistUrl",tt),ce(tt)):(localStorage.removeItem("playlistUrl"),ce(""))}return Je.current=void 0,!0},[de,m,he,v.index]),Mt=C.useCallback(oe=>ht({pages:{pageParams:[1],pages:[oe.playlist]},title:oe.title,disableUrl:oe.disableUrl}),[ht]),_t=C.useCallback(async(oe,Ye)=>{await Be(async tt=>{const bt=tt.flat(),[Gs]=bt.splice(oe,1);bt.splice(Ye,0,Gs);const Us=[];let Ls=0;for(const Yi of tt){const Kn=Yi.length;Us.push(bt.slice(Ls,Ls+Kn)),Ls+=Kn}return Us})},[Be]),It=C.useRef(null),[Ss,ds]=C.useState(!1),Vs=C.useRef(0),$s=C.useRef(void 0),dn=C.useRef(void 0),it=C.useMemo(()=>Je.current||he[v.index]||void 0,[v.index,he]),rt=C.useCallback((oe,Ye,tt)=>{!oe||oe.Id===dn.current||(dn.current=oe.Id,t.reportPlaybackStopped(oe.Id,Ye,tt))},[t]);C.useEffect(()=>{ot&&(Je.current=void 0)},[ot,he]);const{data:ns,isLoading:bs}=nn({queryKey:["lyrics",it?.Id],queryFn:async()=>{const oe=it?.Id;if(oe)try{return await t.getTrackLyrics(oe)}catch(Ye){return Ye instanceof a2&&Ye.response?.status===404||console.error(Ye),null}return null}}),Ts=C.useCallback(oe=>{if("mediaSession"in navigator){const Ye=t.getImageUrl(oe,"Primary",{width:512,height:512});navigator.mediaSession.metadata=new MediaMetadata({title:oe.Name||"Unknown Track",artist:oe.Artists?.join(", ")||oe.AlbumArtist||"Unknown Artist",album:oe.Album||"Unknown Album",artwork:Ye?[{src:Ye,sizes:"512x512",type:"image/webp"}]:[]})}},[t]),ps=C.useCallback(oe=>{oe.seekTime!==void 0&&(M.currentTime=oe.seekTime)},[M]);C.useEffect(()=>{if(!x||!it)return;const oe=setInterval(()=>{t.reportPlaybackProgress(it.Id,M.currentTime,!1)},1e4);return()=>clearInterval(oe)},[t,M,it,x]),C.useEffect(()=>{e||!t.auth.token?(i(0),localStorage.removeItem("sessionPlayCount")):t.auth.token&&localStorage.setItem("sessionPlayCount",s.toString())},[t.auth.token,e,s]);const gs=()=>{i(0),localStorage.removeItem("sessionPlayCount")},Ms=C.useCallback(async(oe,Ye,tt,bt,Gs)=>{const Us={enableWorker:!1,maxBufferLength:10,maxMaxBufferLength:20};if(tt){const Yi=await ke.getTrack(Gs);if(Yi?.type==="m3u8"){const Kn=await Yi.playlist.text(),Au=await Promise.all(Yi.ts.map(hi=>hi.arrayBuffer())),Iu=Kn.match(/#EXT-X-MEDIA-SEQUENCE:(\d+)/),lo=Iu?parseInt(Iu[1],10):1;class co extends ri.DefaultConfig.loader{load(Br,bf,jr){if(Br.frag){const Ll=Br.frag.sn-lo,uo=Au[Ll];uo&&jr.onSuccess({data:uo,url:Br.url},{aborted:!1,loaded:uo.byteLength,total:uo.byteLength,retry:0,chunkCount:0,bwEstimate:0,loading:{start:0,first:0,end:0},parsing:{start:0,end:0},buffering:{start:0,first:0,end:0}},Br,null)}}}Us.fLoader=co}}const Ls=new ri(Us);Y.current[Ye]=Ls,Ls.loadSource(tt||bt),Ls.attachMedia(oe),Ls.on(ri.Events.ERROR,(Yi,Kn)=>{if(console.error("HLS error:",Kn.type,Kn.details,Kn),Kn.fatal)switch(Kn.type){case ri.ErrorTypes.NETWORK_ERROR:Ot.current=!0,oe.pause();break;case ri.ErrorTypes.MEDIA_ERROR:Ls.recoverMediaError();break;default:Ot.current=!0,oe.pause()}})},[ke]),Rs=C.useCallback(async(oe,Ye,tt)=>{oe.pause(),oe.currentTime=0,Y.current[Ye]?.destroy();const bt=await ke.getPlayableUrl(tt.Id),Gs=t.getStreamUrl(tt.Id,Ze);(bt?bt.type==="m3u8":[128e3,192e3,256e3,32e4].includes(Ze))&&ri.isSupported()?await Ms(oe,Ye,bt?.url,Gs,tt.Id):(oe.src=bt?.url||Gs,oe.load())},[t,ke,Ze,Ms]),St=C.useCallback(async()=>{if(!it)return;it.pageIndex?localStorage.setItem("reviverPageIndex",it.pageIndex.toString()):localStorage.removeItem("reviverPageIndex"),It.current?.abort("abort"),It.current=new AbortController;const oe=It.current.signal;let Ye=M,tt=z;x&&$s.current&&rt($s.current,Ye.currentTime,oe),$s.current=it;try{Q.current?(Q.current=!1,j.current=void 0,_||(re(),B(),Ye=K.current[0],tt=K.current[1])):await Rs(Ye,0,it),Ye.readyState>=HTMLMediaElement.HAVE_METADATA?setTimeout(async()=>{Ss&&(await Ye.play(),V&&!_&&tt.pause())}):await new Promise((bt,Gs)=>{const Us=async()=>{Ye.removeEventListener("loadedmetadata",Us),oe.removeEventListener("abort",Ls);try{Ss&&(await Ye.play(),V&&!_&&tt.pause())}catch(Yi){Gs(Yi)}bt()},Ls=()=>{Ye.removeEventListener("loadedmetadata",Us),bt()};oe.addEventListener("abort",Ls),Ye.addEventListener("loadedmetadata",Us)}),i(bt=>bt+1),Ts(it),t.reportPlaybackStart(it.Id,oe)}catch(bt){console.error("Error playing track:",bt)}},[t,M,z,it,_,x,V,rt,Rs,re,B,Ts,Ss]),Pt=C.useCallback(async()=>{if(ds(!0),it)if(x)Vs.current=Date.now(),M.pause(),z.pause(),t.reportPlaybackProgress(it.Id,M.currentTime,!0);else{if(Ot.current||!M.src&&!Y.current[0]&&it){const oe=Ot.current?M.currentTime:0;Ot.current=!1,await Rs(M,0,it),oe&&(M.currentTime=oe)}try{await M.play(),t.reportPlaybackProgress(it.Id,M.currentTime,!1),Ts(it)}catch(oe){console.error("Error resuming playback:",oe),M.pause()}}},[t,M,z,it,x,Rs,Ts]),jt=C.useCallback(async()=>{if(Date.now()-Vs.current<2e3){console.info("Ignoring automatic play request - user recently paused");return}await Pt()},[Pt]);C.useEffect(()=>{v.index>=0&&v.index<he.length&&he[v.index]?St():M.pause()},[it?.Id]);const zt=C.useCallback(()=>{if(!(!he||he.length===0||v.index===-1))return he[v.index+1]},[v.index,he]),ws=C.useCallback(()=>!!zt(),[zt]),Cs=C.useCallback(async()=>{if(ds(!0),!he||he.length===0||v.index===-1||!it){M.pause();return}if(w==="one")St();else{const oe=v.index+1;if(oe>=he.length)if(await W())S({index:oe});else if(w==="all")S({index:0});else{M.pause();return}else S({index:oe})}},[M,it,v.index,he,W,St,w]),Qs=C.useCallback(async()=>{if(ds(!0),!he||he.length===0||v.index===-1||!it){M.pause();return}if(w==="one")St();else{const oe=v.index-1;if(oe<0)if(w==="all")S({index:he.length-1});else{M.pause();return}else S({index:oe})}},[M,it,v.index,he,St,w]),Ee=C.useCallback(async()=>{ws()&&(re(),B(),await Cs())},[ws,Cs,re,B]),rn=C.useCallback(async()=>{const oe=zt();oe&&(Rs(z,1,oe),Q.current=!0,j.current=oe.Id)},[z,zt,Rs]);C.useEffect(()=>{const oe=()=>{if(_&&M.duration-M.currentTime<N&&x&&w!=="one"){Ee();return}if(!Q.current&&V&&M.duration-M.currentTime<(_?N:0)+J&&x&&w!=="one"){rn();return}};return M.addEventListener("timeupdate",oe),()=>{M.removeEventListener("timeupdate",oe)}},[M,N,_,x,Ee,rn,w,V,J]),C.useEffect(()=>{const oe=zt();Q.current&&j.current&&oe?.Id!==j.current&&(Q.current=!1,j.current=void 0,x&&V&&oe&&w!=="one"&&rn())},[zt,x,V,rn,w]);const wa=C.useCallback(()=>{const oe=!R;L(oe),oe&&(Je.current=it,de.removeQueries({queryKey:["reviver",...oe&&!ot?["shuffle"]:[],...Oe.queryKey||[]]}))},[it,ot,de,Oe.queryKey,R]),Ki=()=>{D(oe=>oe==="off"?"all":oe==="all"?"one":"off")},Fr=oe=>{if(isNaN(oe)||oe===0)return"0:00";const Ye=Math.floor(oe/3600),tt=Math.floor(oe%3600/60),bt=Math.floor(oe%60);return Ye>0?`${Ye}:${tt<10?"0":""}${tt}:${bt<10?"0":""}${bt}`:`${tt}:${bt<10?"0":""}${bt}`};return C.useEffect(()=>{M.volume=A},[]),C.useEffect(()=>{T(!M.paused);const oe=()=>{T(!0)},Ye=()=>{T(!1)};return M.addEventListener("play",oe),M.addEventListener("pause",Ye),()=>{M.removeEventListener("play",oe),M.removeEventListener("pause",Ye)}},[M]),C.useEffect(()=>{const oe=Ye=>{console.error("Audio error during playback:",Ye),Ot.current=!0,M.pause()};return M.addEventListener("error",oe),()=>{M.removeEventListener("error",oe)}},[M]),C.useEffect(()=>{const oe=()=>{!x&&Vs.current>0&&(Vs.current=Date.now())};if("mediaDevices"in navigator)return navigator.mediaDevices.addEventListener("devicechange",oe),()=>{navigator.mediaDevices.removeEventListener("devicechange",oe)}},[x]),C.useEffect(()=>{if("mediaSession"in navigator)return navigator.mediaSession.setActionHandler("nexttrack",Cs),navigator.mediaSession.setActionHandler("previoustrack",Qs),navigator.mediaSession.setActionHandler("play",jt),navigator.mediaSession.setActionHandler("pause",Pt),navigator.mediaSession.setActionHandler("seekto",ps),()=>{navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("seekto",null)}},[Cs,Qs,jt,Pt,ps]),C.useEffect(()=>{localStorage.setItem("volume",A.toString()),M.volume=A},[M,A]),C.useEffect(()=>{localStorage.setItem("repeatMode",w)},[w]),C.useEffect(()=>{localStorage.setItem("currentTrackIndex",v.index.toString())},[v]),C.useEffect(()=>{if(G.current)return;G.current=!0,(async()=>{const Ye=localStorage.getItem("currentTrackIndex");if(t.auth.token){const tt=Number(Ye);S(tt!==-1?{index:v.index}:Ye?{index:Number(Ye)}:{index:-1});const bt=he[v.index];bt&&(await Rs(M,0,bt),Ts(bt))}else t.auth.token||S({index:-1})})()},[t.auth.token,M,v.index,he,Rs,Ts]),C.useEffect(()=>{et&&v.index>=he.length-5&&W()},[v.index,et,he.length,W]),C.useEffect(()=>{const oe=async()=>{if(!it||v.index===-1||!he||he.length===0){it&&rt(it,M.currentTime);return}rt(it,M.currentTime),w==="one"?St():Cs()};return M.addEventListener("ended",oe),()=>{M.removeEventListener("ended",oe)}},[t,M,it,v.index,he,Cs,St,w,rt,re]),C.useEffect(()=>{e&&it&&(rt(it,M.currentTime),S({index:-1}),M.pause())},[t,M,e,it,rt]),{currentTrack:it,currentTrackIndex:v.index,currentTrackLyricsLoading:bs,currentTrackLyrics:ns,isPlaying:x,togglePlayPause:Pt,formatTime:Fr,lyricsTimestamps:r,setLyricsTimestamps:a,centeredLyrics:l,setCenteredLyrics:u,volume:A,setVolume:E,playTrack:oe=>{ds(!0),S({index:oe})},nextTrack:Cs,previousTrack:Qs,shuffle:R,toggleShuffle:wa,repeat:w,toggleRepeat:Ki,currentPlaylist:he,setCurrentPlaylist:ht,setCurrentPlaylistSimple:Mt,updateCurrentPlaylist:Be,moveItemInPlaylist:_t,loadMore:W,sessionPlayCount:s,resetSessionCount:gs,playlistTitle:Te,playlistUrl:Qe,audioRef:M,crossfadeRef:z,bitrate:Ze,setBitrate:nt,isLoading:se,isCrossfadeActive:_,setIsCrossfadeActive:k,crossfadeDuration:N,setCrossfadeDuration:F,isPreloadActive:V,setIsPreloadActive:H,preloadDuration:J,setPreloadDuration:X,rememberFilters:d,setRememberFilters:h,warnBeforeOverwriteQueue:m,setWarnBeforeOverwriteQueue:g,maxWidth:Dt,setMaxWidth:Nt,markAsManuallyAdded:Ve}},Q4=n=>q4(n),X4=n=>{const{children:e,...t}=n,s=Q4(t);return y.jsx(NA.Provider,{value:s,children:e})},W4=()=>{const[n,e]=C.useState(!1);return C.useEffect(()=>{const t=document.getElementsByTagName("body")[0];return n?t.classList.add("lockscroll"):t.classList.remove("lockscroll"),()=>{t.classList.remove("lockscroll")}},[n]),{disabled:n,setDisabled:e}},Z4=({children:n})=>{const e=W4();return y.jsx(zA.Provider,{value:e,children:n})},J4=()=>{const[n,e]=C.useState(!1),t=xn();return C.useEffect(()=>{t?.pathname&&e(!1)},[t?.pathname]),C.useEffect(()=>(n?document.body.classList.add("lockscroll"):document.body.classList.remove("lockscroll"),()=>{document.body.classList.remove("lockscroll")}),[n]),{showSidenav:n,toggleSidenav:()=>{e(r=>!r)},closeSidenav:()=>{e(!1)}}},e6=({children:n})=>{const e=J4();return y.jsx(UA.Provider,{value:e,children:n})},wR=C.createContext({}),t6=()=>C.useContext(wR),s6=()=>{const[n,e]=C.useState(()=>localStorage.getItem("theme")||"light");return C.useEffect(()=>{const s=document.documentElement,i=window.matchMedia("(prefers-color-scheme: dark)");(l=>{const u=s.classList.contains("dark")?"dark":"light",d=l==="system"?i.matches?"dark":"light":l;if(u!==d)if(s.classList.remove("light","dark"),l==="system"){const h=i.matches;s.classList.add(h?"dark":"light")}else s.classList.add(l)})(n);const a=l=>{n==="system"&&(s.classList.remove("light","dark"),s.classList.add(l.matches?"dark":"light"))};return i.addEventListener("change",a),()=>i.removeEventListener("change",a)},[]),{theme:n,toggleTheme:s=>{e(s);const i=document.documentElement;setTimeout(()=>{if(i.classList.remove("light","dark"),s==="system"){const r=window.matchMedia("(prefers-color-scheme: dark)").matches;i.classList.add(r?"dark":"light")}else i.classList.add(s);localStorage.setItem("theme",s)},200)}}},n6=({children:n})=>{const e=s6();return y.jsx(wR.Provider,{value:e,children:n})},i6=()=>{const{currentTrack:n,isPlaying:e}=ss(),{pageTitle:t}=fr(),s=xn();C.useEffect(()=>{if(n&&e){const i=n.AlbumArtist||n.Artists?.[0]||"Unknown Artist";document.title=`${n.Name} - ${i}`}else document.title=`${Wg(t,s)} - Jelly Music App`},[n,e,t,s.pathname,s])},zn=()=>y.jsx("div",{className:"loading_container",children:y.jsxs("svg",{className:"loading",children:[y.jsx("circle",{cx:"14",cy:"14",r:"14"}),y.jsx("circle",{cx:"14",cy:"14",r:"14"})]})});function r6(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return C.useMemo(()=>s=>{e.forEach(i=>i(s))},e)}const df=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function El(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function Cy(n){return"nodeType"in n}function On(n){var e,t;return n?El(n)?n:Cy(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function Ly(n){const{Document:e}=On(n);return n instanceof e}function gu(n){return El(n)?!1:n instanceof On(n).HTMLElement}function CR(n){return n instanceof On(n).SVGElement}function Al(n){return n?El(n)?n.document:Cy(n)?Ly(n)?n:gu(n)||CR(n)?n.ownerDocument:document:document:document}const ji=df?C.useLayoutEffect:C.useEffect;function hf(n){const e=C.useRef(n);return ji(()=>{e.current=n}),C.useCallback(function(){for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];return e.current==null?void 0:e.current(...s)},[])}function a6(){const n=C.useRef(null),e=C.useCallback((s,i)=>{n.current=setInterval(s,i)},[]),t=C.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function eu(n,e){e===void 0&&(e=[n]);const t=C.useRef(n);return ji(()=>{t.current!==n&&(t.current=n)},e),t}function yu(n,e){const t=C.useRef();return C.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Gh(n){const e=hf(n),t=C.useRef(null),s=C.useCallback(i=>{i!==t.current&&e?.(i,t.current),t.current=i},[]);return[t,s]}function Hh(n){const e=C.useRef();return C.useEffect(()=>{e.current=n},[n]),e.current}let yg={};function vu(n,e){return C.useMemo(()=>{if(e)return e;const t=yg[n]==null?0:yg[n]+1;return yg[n]=t,n+"-"+t},[n,e])}function LR(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return s.reduce((r,a)=>{const l=Object.entries(a);for(const[u,d]of l){const h=r[u];h!=null&&(r[u]=h+n*d)}return r},{...e})}}const ll=LR(1),zh=LR(-1);function o6(n){return"clientX"in n&&"clientY"in n}function ff(n){if(!n)return!1;const{KeyboardEvent:e}=On(n.target);return e&&n instanceof e}function l6(n){if(!n)return!1;const{TouchEvent:e}=On(n.target);return e&&n instanceof e}function Kh(n){if(l6(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return o6(n)?{x:n.clientX,y:n.clientY}:null}const ba=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[ba.Translate.toString(n),ba.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),HT="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function c6(n){return n.matches(HT)?n:n.querySelector(HT)}const u6={display:"none"};function d6(n){let{id:e,value:t}=n;return Se.createElement("div",{id:e,style:u6},t)}function h6(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Se.createElement("div",{id:e,style:i,role:"status","aria-live":s,"aria-atomic":!0},t)}function f6(){const[n,e]=C.useState("");return{announce:C.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const DR=C.createContext(null);function m6(n){const e=C.useContext(DR);C.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function p6(){const[n]=C.useState(()=>new Set),e=C.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[C.useCallback(s=>{let{type:i,event:r}=s;n.forEach(a=>{var l;return(l=a[i])==null?void 0:l.call(a,r)})},[n]),e]}const g6={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},y6={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function v6(n){let{announcements:e=y6,container:t,hiddenTextDescribedById:s,screenReaderInstructions:i=g6}=n;const{announce:r,announcement:a}=f6(),l=vu("DndLiveRegion"),[u,d]=C.useState(!1);if(C.useEffect(()=>{d(!0)},[]),m6(C.useMemo(()=>({onDragStart(m){let{active:g}=m;r(e.onDragStart({active:g}))},onDragMove(m){let{active:g,over:v}=m;e.onDragMove&&r(e.onDragMove({active:g,over:v}))},onDragOver(m){let{active:g,over:v}=m;r(e.onDragOver({active:g,over:v}))},onDragEnd(m){let{active:g,over:v}=m;r(e.onDragEnd({active:g,over:v}))},onDragCancel(m){let{active:g,over:v}=m;r(e.onDragCancel({active:g,over:v}))}}),[r,e])),!u)return null;const h=Se.createElement(Se.Fragment,null,Se.createElement(d6,{id:s,value:i.draggable}),Se.createElement(h6,{id:l,announcement:a}));return t?el.createPortal(h,t):h}var tn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(tn||(tn={}));function Yh(){}function zT(n,e){return C.useMemo(()=>({sensor:n,options:{}}),[n,e])}function x6(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return C.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const Vi=Object.freeze({x:0,y:0});function S6(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function b6(n,e){const t=Kh(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function T6(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function E6(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function A6(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function KT(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const I6=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const i=KT(e,e.left,e.top),r=[];for(const a of s){const{id:l}=a,u=t.get(l);if(u){const d=S6(KT(u),i);r.push({id:l,data:{droppableContainer:a,value:d}})}}return r.sort(T6)};function R6(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),i=Math.min(e.left+e.width,n.left+n.width),r=Math.min(e.top+e.height,n.top+n.height),a=i-s,l=r-t;if(s<i&&t<r){const u=e.width*e.height,d=n.width*n.height,h=a*l,m=h/(u+d-h);return Number(m.toFixed(4))}return 0}const w6=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const i=[];for(const r of s){const{id:a}=r,l=t.get(a);if(l){const u=R6(l,e);u>0&&i.push({id:a,data:{droppableContainer:r,value:u}})}}return i.sort(E6)};function C6(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function OR(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:Vi}function L6(n){return function(t){for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];return i.reduce((a,l)=>({...a,top:a.top+n*l.y,bottom:a.bottom+n*l.y,left:a.left+n*l.x,right:a.right+n*l.x}),{...t})}}const D6=L6(1);function _R(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function O6(n,e,t){const s=_R(e);if(!s)return n;const{scaleX:i,scaleY:r,x:a,y:l}=s,u=n.left-a-(1-i)*parseFloat(t),d=n.top-l-(1-r)*parseFloat(t.slice(t.indexOf(" ")+1)),h=i?n.width/i:n.width,m=r?n.height/r:n.height;return{width:h,height:m,top:d,right:u+h,bottom:d+m,left:u}}const _6={ignoreTransform:!1};function Il(n,e){e===void 0&&(e=_6);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:d,transformOrigin:h}=On(n).getComputedStyle(n);d&&(t=O6(t,d,h))}const{top:s,left:i,width:r,height:a,bottom:l,right:u}=t;return{top:s,left:i,width:r,height:a,bottom:l,right:u}}function YT(n){return Il(n,{ignoreTransform:!0})}function P6(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function N6(n,e){return e===void 0&&(e=On(n).getComputedStyle(n)),e.position==="fixed"}function k6(n,e){e===void 0&&(e=On(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const r=e[i];return typeof r=="string"?t.test(r):!1})}function Dy(n,e){const t=[];function s(i){if(e!=null&&t.length>=e||!i)return t;if(Ly(i)&&i.scrollingElement!=null&&!t.includes(i.scrollingElement))return t.push(i.scrollingElement),t;if(!gu(i)||CR(i)||t.includes(i))return t;const r=On(n).getComputedStyle(i);return i!==n&&k6(i,r)&&t.push(i),N6(i,r)?t:s(i.parentNode)}return n?s(n):t}function PR(n){const[e]=Dy(n,1);return e??null}function vg(n){return!df||!n?null:El(n)?n:Cy(n)?Ly(n)||n===Al(n).scrollingElement?window:gu(n)?n:null:null}function NR(n){return El(n)?n.scrollX:n.scrollLeft}function kR(n){return El(n)?n.scrollY:n.scrollTop}function T0(n){return{x:NR(n),y:kR(n)}}var un;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(un||(un={}));function MR(n){return!df||!n?!1:n===document.scrollingElement}function UR(n){const e={x:0,y:0},t=MR(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},i=n.scrollTop<=e.y,r=n.scrollLeft<=e.x,a=n.scrollTop>=s.y,l=n.scrollLeft>=s.x;return{isTop:i,isLeft:r,isBottom:a,isRight:l,maxScroll:s,minScroll:e}}const M6={x:.2,y:.2};function U6(n,e,t,s,i){let{top:r,left:a,right:l,bottom:u}=t;s===void 0&&(s=10),i===void 0&&(i=M6);const{isTop:d,isBottom:h,isLeft:m,isRight:g}=UR(n),v={x:0,y:0},S={x:0,y:0},x={height:e.height*i.y,width:e.width*i.x};return!d&&r<=e.top+x.height?(v.y=un.Backward,S.y=s*Math.abs((e.top+x.height-r)/x.height)):!h&&u>=e.bottom-x.height&&(v.y=un.Forward,S.y=s*Math.abs((e.bottom-x.height-u)/x.height)),!g&&l>=e.right-x.width?(v.x=un.Forward,S.x=s*Math.abs((e.right-x.width-l)/x.width)):!m&&a<=e.left+x.width&&(v.x=un.Backward,S.x=s*Math.abs((e.left+x.width-a)/x.width)),{direction:v,speed:S}}function F6(n){if(n===document.scrollingElement){const{innerWidth:r,innerHeight:a}=window;return{top:0,left:0,right:r,bottom:a,width:r,height:a}}const{top:e,left:t,right:s,bottom:i}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:i,width:n.clientWidth,height:n.clientHeight}}function FR(n){return n.reduce((e,t)=>ll(e,T0(t)),Vi)}function B6(n){return n.reduce((e,t)=>e+NR(t),0)}function j6(n){return n.reduce((e,t)=>e+kR(t),0)}function BR(n,e){if(e===void 0&&(e=Il),!n)return;const{top:t,left:s,bottom:i,right:r}=e(n);PR(n)&&(i<=0||r<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const V6=[["x",["left","right"],B6],["y",["top","bottom"],j6]];class Oy{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Dy(t),i=FR(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[r,a,l]of V6)for(const u of a)Object.defineProperty(this,u,{get:()=>{const d=l(s),h=i[r]-d;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Uc{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var i;(i=this.target)==null||i.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function $6(n){const{EventTarget:e}=On(n);return n instanceof e?n:Al(n)}function xg(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var Ai;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Ai||(Ai={}));function qT(n){n.preventDefault()}function G6(n){n.stopPropagation()}var Ht;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Ht||(Ht={}));const jR={start:[Ht.Space,Ht.Enter],cancel:[Ht.Esc],end:[Ht.Space,Ht.Enter,Ht.Tab]},H6=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case Ht.Right:return{...t,x:t.x+25};case Ht.Left:return{...t,x:t.x-25};case Ht.Down:return{...t,y:t.y+25};case Ht.Up:return{...t,y:t.y-25}}};class VR{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Uc(Al(t)),this.windowListeners=new Uc(On(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ai.Resize,this.handleCancel),this.windowListeners.add(Ai.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ai.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&BR(s),t(Vi)}handleKeyDown(e){if(ff(e)){const{active:t,context:s,options:i}=this.props,{keyboardCodes:r=jR,coordinateGetter:a=H6,scrollBehavior:l="smooth"}=i,{code:u}=e;if(r.end.includes(u)){this.handleEnd(e);return}if(r.cancel.includes(u)){this.handleCancel(e);return}const{collisionRect:d}=s.current,h=d?{x:d.left,y:d.top}:Vi;this.referenceCoordinates||(this.referenceCoordinates=h);const m=a(e,{active:t,context:s.current,currentCoordinates:h});if(m){const g=zh(m,h),v={x:0,y:0},{scrollableAncestors:S}=s.current;for(const x of S){const T=e.code,{isTop:A,isRight:E,isLeft:R,isBottom:L,maxScroll:w,minScroll:D}=UR(x),_=F6(x),k={x:Math.min(T===Ht.Right?_.right-_.width/2:_.right,Math.max(T===Ht.Right?_.left:_.left+_.width/2,m.x)),y:Math.min(T===Ht.Down?_.bottom-_.height/2:_.bottom,Math.max(T===Ht.Down?_.top:_.top+_.height/2,m.y))},N=T===Ht.Right&&!E||T===Ht.Left&&!R,F=T===Ht.Down&&!L||T===Ht.Up&&!A;if(N&&k.x!==m.x){const V=x.scrollLeft+g.x,H=T===Ht.Right&&V<=w.x||T===Ht.Left&&V>=D.x;if(H&&!g.y){x.scrollTo({left:V,behavior:l});return}H?v.x=x.scrollLeft-V:v.x=T===Ht.Right?x.scrollLeft-w.x:x.scrollLeft-D.x,v.x&&x.scrollBy({left:-v.x,behavior:l});break}else if(F&&k.y!==m.y){const V=x.scrollTop+g.y,H=T===Ht.Down&&V<=w.y||T===Ht.Up&&V>=D.y;if(H&&!g.x){x.scrollTo({top:V,behavior:l});return}H?v.y=x.scrollTop-V:v.y=T===Ht.Down?x.scrollTop-w.y:x.scrollTop-D.y,v.y&&x.scrollBy({top:-v.y,behavior:l});break}}this.handleMove(e,ll(zh(m,this.referenceCoordinates),v))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}VR.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=jR,onActivation:i}=e,{active:r}=t;const{code:a}=n.nativeEvent;if(s.start.includes(a)){const l=r.activatorNode.current;return l&&n.target!==l?!1:(n.preventDefault(),i?.({event:n.nativeEvent}),!0)}return!1}}];function QT(n){return!!(n&&"distance"in n)}function XT(n){return!!(n&&"delay"in n)}class _y{constructor(e,t,s){var i;s===void 0&&(s=$6(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:r}=e,{target:a}=r;this.props=e,this.events=t,this.document=Al(a),this.documentListeners=new Uc(this.document),this.listeners=new Uc(s),this.windowListeners=new Uc(On(a)),this.initialCoordinates=(i=Kh(r))!=null?i:Vi,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Ai.Resize,this.handleCancel),this.windowListeners.add(Ai.DragStart,qT),this.windowListeners.add(Ai.VisibilityChange,this.handleCancel),this.windowListeners.add(Ai.ContextMenu,qT),this.documentListeners.add(Ai.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(XT(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(QT(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:i}=this.props;i(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Ai.Click,G6,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ai.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:i,props:r}=this,{onMove:a,options:{activationConstraint:l}}=r;if(!i)return;const u=(t=Kh(e))!=null?t:Vi,d=zh(i,u);if(!s&&l){if(QT(l)){if(l.tolerance!=null&&xg(d,l.tolerance))return this.handleCancel();if(xg(d,l.distance))return this.handleStart()}if(XT(l)&&xg(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}e.cancelable&&e.preventDefault(),a(u)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Ht.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const z6={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Py extends _y{constructor(e){const{event:t}=e,s=Al(t.target);super(e,z6,s)}}Py.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s?.({event:t}),!0)}}];const K6={move:{name:"mousemove"},end:{name:"mouseup"}};var E0;(function(n){n[n.RightClick=2]="RightClick"})(E0||(E0={}));class Y6 extends _y{constructor(e){super(e,K6,Al(e.event.target))}}Y6.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===E0.RightClick?!1:(s?.({event:t}),!0)}}];const Sg={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class $R extends _y{constructor(e){super(e,Sg)}static setup(){return window.addEventListener(Sg.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Sg.move.name,e)};function e(){}}}$R.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:i}=t;return i.length>1?!1:(s?.({event:t}),!0)}}];var Fc;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Fc||(Fc={}));var qh;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(qh||(qh={}));function q6(n){let{acceleration:e,activator:t=Fc.Pointer,canScroll:s,draggingRect:i,enabled:r,interval:a=5,order:l=qh.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:h,delta:m,threshold:g}=n;const v=X6({delta:m,disabled:!r}),[S,x]=a6(),T=C.useRef({x:0,y:0}),A=C.useRef({x:0,y:0}),E=C.useMemo(()=>{switch(t){case Fc.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Fc.DraggableRect:return i}},[t,i,u]),R=C.useRef(null),L=C.useCallback(()=>{const D=R.current;if(!D)return;const _=T.current.x*A.current.x,k=T.current.y*A.current.y;D.scrollBy(_,k)},[]),w=C.useMemo(()=>l===qh.TreeOrder?[...d].reverse():d,[l,d]);C.useEffect(()=>{if(!r||!d.length||!E){x();return}for(const D of w){if(s?.(D)===!1)continue;const _=d.indexOf(D),k=h[_];if(!k)continue;const{direction:N,speed:F}=U6(D,k,E,e,g);for(const V of["x","y"])v[V][N[V]]||(F[V]=0,N[V]=0);if(F.x>0||F.y>0){x(),R.current=D,S(L,a),T.current=F,A.current=N;return}}T.current={x:0,y:0},A.current={x:0,y:0},x()},[e,L,s,x,r,a,JSON.stringify(E),JSON.stringify(v),S,d,w,h,JSON.stringify(g)])}const Q6={x:{[un.Backward]:!1,[un.Forward]:!1},y:{[un.Backward]:!1,[un.Forward]:!1}};function X6(n){let{delta:e,disabled:t}=n;const s=Hh(e);return yu(i=>{if(t||!s||!i)return Q6;const r={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[un.Backward]:i.x[un.Backward]||r.x===-1,[un.Forward]:i.x[un.Forward]||r.x===1},y:{[un.Backward]:i.y[un.Backward]||r.y===-1,[un.Forward]:i.y[un.Forward]||r.y===1}}},[t,e,s])}function W6(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return yu(i=>{var r;return e==null?null:(r=s??i)!=null?r:null},[s,e])}function Z6(n,e){return C.useMemo(()=>n.reduce((t,s)=>{const{sensor:i}=s,r=i.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,s)}));return[...t,...r]},[]),[n,e])}var tu;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(tu||(tu={}));var A0;(function(n){n.Optimized="optimized"})(A0||(A0={}));const WT=new Map;function J6(n,e){let{dragging:t,dependencies:s,config:i}=e;const[r,a]=C.useState(null),{frequency:l,measure:u,strategy:d}=i,h=C.useRef(n),m=T(),g=eu(m),v=C.useCallback(function(A){A===void 0&&(A=[]),!g.current&&a(E=>E===null?A:E.concat(A.filter(R=>!E.includes(R))))},[g]),S=C.useRef(null),x=yu(A=>{if(m&&!t)return WT;if(!A||A===WT||h.current!==n||r!=null){const E=new Map;for(let R of n){if(!R)continue;if(r&&r.length>0&&!r.includes(R.id)&&R.rect.current){E.set(R.id,R.rect.current);continue}const L=R.node.current,w=L?new Oy(u(L),L):null;R.rect.current=w,w&&E.set(R.id,w)}return E}return A},[n,r,t,m,u]);return C.useEffect(()=>{h.current=n},[n]),C.useEffect(()=>{m||v()},[t,m]),C.useEffect(()=>{r&&r.length>0&&a(null)},[JSON.stringify(r)]),C.useEffect(()=>{m||typeof l!="number"||S.current!==null||(S.current=setTimeout(()=>{v(),S.current=null},l))},[l,m,v,...s]),{droppableRects:x,measureDroppableContainers:v,measuringScheduled:r!=null};function T(){switch(d){case tu.Always:return!1;case tu.BeforeDragging:return t;default:return!t}}}function Ny(n,e){return yu(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function eF(n,e){return Ny(n,e)}function tF(n){let{callback:e,disabled:t}=n;const s=hf(e),i=C.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:r}=window;return new r(s)},[s,t]);return C.useEffect(()=>()=>i?.disconnect(),[i]),i}function mf(n){let{callback:e,disabled:t}=n;const s=hf(e),i=C.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:r}=window;return new r(s)},[t]);return C.useEffect(()=>()=>i?.disconnect(),[i]),i}function sF(n){return new Oy(Il(n),n)}function ZT(n,e,t){e===void 0&&(e=sF);const[s,i]=C.useState(null);function r(){i(u=>{if(!n)return null;if(n.isConnected===!1){var d;return(d=u??t)!=null?d:null}const h=e(n);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const a=tF({callback(u){if(n)for(const d of u){const{type:h,target:m}=d;if(h==="childList"&&m instanceof HTMLElement&&m.contains(n)){r();break}}}}),l=mf({callback:r});return ji(()=>{r(),n?(l?.observe(n),a?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),a?.disconnect())},[n]),s}function nF(n){const e=Ny(n);return OR(n,e)}const JT=[];function iF(n){const e=C.useRef(n),t=yu(s=>n?s&&s!==JT&&n&&e.current&&n.parentNode===e.current.parentNode?s:Dy(n):JT,[n]);return C.useEffect(()=>{e.current=n},[n]),t}function rF(n){const[e,t]=C.useState(null),s=C.useRef(n),i=C.useCallback(r=>{const a=vg(r.target);a&&t(l=>l?(l.set(a,T0(a)),new Map(l)):null)},[]);return C.useEffect(()=>{const r=s.current;if(n!==r){a(r);const l=n.map(u=>{const d=vg(u);return d?(d.addEventListener("scroll",i,{passive:!0}),[d,T0(d)]):null}).filter(u=>u!=null);t(l.length?new Map(l):null),s.current=n}return()=>{a(n),a(r)};function a(l){l.forEach(u=>{const d=vg(u);d?.removeEventListener("scroll",i)})}},[i,n]),C.useMemo(()=>n.length?e?Array.from(e.values()).reduce((r,a)=>ll(r,a),Vi):FR(n):Vi,[n,e])}function eE(n,e){e===void 0&&(e=[]);const t=C.useRef(null);return C.useEffect(()=>{t.current=null},e),C.useEffect(()=>{const s=n!==Vi;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?zh(n,t.current):Vi}function aF(n){C.useEffect(()=>{if(!df)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t?.()}},n.map(e=>{let{sensor:t}=e;return t}))}function oF(n,e){return C.useMemo(()=>n.reduce((t,s)=>{let{eventName:i,handler:r}=s;return t[i]=a=>{r(a,e)},t},{}),[n,e])}function GR(n){return C.useMemo(()=>n?P6(n):null,[n])}const tE=[];function lF(n,e){e===void 0&&(e=Il);const[t]=n,s=GR(t?On(t):null),[i,r]=C.useState(tE);function a(){r(()=>n.length?n.map(u=>MR(u)?s:new Oy(e(u),u)):tE)}const l=mf({callback:a});return ji(()=>{l?.disconnect(),a(),n.forEach(u=>l?.observe(u))},[n]),i}function HR(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return gu(e)?e:n}function cF(n){let{measure:e}=n;const[t,s]=C.useState(null),i=C.useCallback(d=>{for(const{target:h}of d)if(gu(h)){s(m=>{const g=e(h);return m?{...m,width:g.width,height:g.height}:g});break}},[e]),r=mf({callback:i}),a=C.useCallback(d=>{const h=HR(d);r?.disconnect(),h&&r?.observe(h),s(h?e(h):null)},[e,r]),[l,u]=Gh(a);return C.useMemo(()=>({nodeRef:l,rect:t,setRef:u}),[t,l,u])}const uF=[{sensor:Py,options:{}},{sensor:VR,options:{}}],dF={current:{}},Ah={draggable:{measure:YT},droppable:{measure:YT,strategy:tu.WhileDragging,frequency:A0.Optimized},dragOverlay:{measure:Il}};class Bc extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const hF={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Bc,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Yh},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ah,measureDroppableContainers:Yh,windowRect:null,measuringScheduled:!1},zR={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Yh,draggableNodes:new Map,over:null,measureDroppableContainers:Yh},xu=C.createContext(zR),KR=C.createContext(hF);function fF(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Bc}}}function mF(n,e){switch(e.type){case tn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case tn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case tn.DragEnd:case tn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case tn.RegisterDroppable:{const{element:t}=e,{id:s}=t,i=new Bc(n.droppable.containers);return i.set(s,t),{...n,droppable:{...n.droppable,containers:i}}}case tn.SetDroppableDisabled:{const{id:t,key:s,disabled:i}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const a=new Bc(n.droppable.containers);return a.set(t,{...r,disabled:i}),{...n,droppable:{...n.droppable,containers:a}}}case tn.UnregisterDroppable:{const{id:t,key:s}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const r=new Bc(n.droppable.containers);return r.delete(t),{...n,droppable:{...n.droppable,containers:r}}}default:return n}}function pF(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:i}=C.useContext(xu),r=Hh(s),a=Hh(t?.id);return C.useEffect(()=>{if(!e&&!s&&r&&a!=null){if(!ff(r)||document.activeElement===r.target)return;const l=i.get(a);if(!l)return;const{activatorNode:u,node:d}=l;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const h of[u.current,d.current]){if(!h)continue;const m=c6(h);if(m){m.focus();break}}})}},[s,e,i,a,r]),null}function YR(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((i,r)=>r({transform:i,...s}),t):t}function gF(n){return C.useMemo(()=>({draggable:{...Ah.draggable,...n?.draggable},droppable:{...Ah.droppable,...n?.droppable},dragOverlay:{...Ah.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function yF(n){let{activeNode:e,measure:t,initialRect:s,config:i=!0}=n;const r=C.useRef(!1),{x:a,y:l}=typeof i=="boolean"?{x:i,y:i}:i;ji(()=>{if(!a&&!l||!e){r.current=!1;return}if(r.current||!s)return;const d=e?.node.current;if(!d||d.isConnected===!1)return;const h=t(d),m=OR(h,s);if(a||(m.x=0),l||(m.y=0),r.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const g=PR(d);g&&g.scrollBy({top:m.y,left:m.x})}},[e,a,l,s,t])}const pf=C.createContext({...Vi,scaleX:1,scaleY:1});var pa;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(pa||(pa={}));const vF=C.memo(function(e){var t,s,i,r;let{id:a,accessibility:l,autoScroll:u=!0,children:d,sensors:h=uF,collisionDetection:m=w6,measuring:g,modifiers:v,...S}=e;const x=C.useReducer(mF,void 0,fF),[T,A]=x,[E,R]=p6(),[L,w]=C.useState(pa.Uninitialized),D=L===pa.Initialized,{draggable:{active:_,nodes:k,translate:N},droppable:{containers:F}}=T,V=_!=null?k.get(_):null,H=C.useRef({initial:null,translated:null}),J=C.useMemo(()=>{var rt;return _!=null?{id:_,data:(rt=V?.data)!=null?rt:dF,rect:H}:null},[_,V]),X=C.useRef(null),[Q,j]=C.useState(null),[K,Y]=C.useState(null),re=eu(S,Object.values(S)),B=vu("DndDescribedBy",a),M=C.useMemo(()=>F.getEnabled(),[F]),z=gF(g),{droppableRects:G,measureDroppableContainers:de,measuringScheduled:Te}=J6(M,{dragging:D,dependencies:[N.x,N.y],config:z.droppable}),pe=W6(k,_),Qe=C.useMemo(()=>K?Kh(K):null,[K]),ce=it(),Oe=eF(pe,z.draggable.measure);yF({activeNode:_!=null?k.get(_):null,config:ce.layoutShiftCompensation,initialRect:Oe,measure:z.draggable.measure});const Ue=ZT(pe,z.draggable.measure,Oe),Ze=ZT(pe?pe.parentElement:null),nt=C.useRef({activatorEvent:null,active:null,activeNode:pe,collisionRect:null,collisions:null,droppableRects:G,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:F,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Dt=F.getNodeFor((t=nt.current.over)==null?void 0:t.id),Nt=cF({measure:z.dragOverlay.measure}),Ot=(s=Nt.nodeRef.current)!=null?s:pe,ke=D?(i=Nt.rect)!=null?i:Ue:null,Je=!!(Nt.nodeRef.current&&Nt.rect),ot=nF(Je?null:Ue),kt=GR(Ot?On(Ot):null),vt=iF(D?Dt??pe:null),fe=lF(vt),ze=YR(v,{transform:{x:N.x-ot.x,y:N.y-ot.y,scaleX:1,scaleY:1},activatorEvent:K,active:J,activeNodeRect:Ue,containerNodeRect:Ze,draggingNodeRect:ke,over:nt.current.over,overlayNodeRect:Nt.rect,scrollableAncestors:vt,scrollableAncestorRects:fe,windowRect:kt}),Ve=Qe?ll(Qe,N):null,Fe=rF(vt),et=eE(Fe),W=eE(Fe,[Ue]),se=ll(ze,et),me=ke?D6(ke,ze):null,he=J&&me?m({active:J,collisionRect:me,droppableRects:G,droppableContainers:M,pointerCoordinates:Ve}):null,Ke=A6(he,"id"),[Be,ht]=C.useState(null),Mt=Je?ze:ll(ze,W),_t=C6(Mt,(r=Be?.rect)!=null?r:null,Ue),It=C.useRef(null),Ss=C.useCallback((rt,ns)=>{let{sensor:bs,options:Ts}=ns;if(X.current==null)return;const ps=k.get(X.current);if(!ps)return;const gs=rt.nativeEvent,Ms=new bs({active:X.current,activeNode:ps,event:gs,options:Ts,context:nt,onAbort(St){if(!k.get(St))return;const{onDragAbort:jt}=re.current,zt={id:St};jt?.(zt),E({type:"onDragAbort",event:zt})},onPending(St,Pt,jt,zt){if(!k.get(St))return;const{onDragPending:Cs}=re.current,Qs={id:St,constraint:Pt,initialCoordinates:jt,offset:zt};Cs?.(Qs),E({type:"onDragPending",event:Qs})},onStart(St){const Pt=X.current;if(Pt==null)return;const jt=k.get(Pt);if(!jt)return;const{onDragStart:zt}=re.current,ws={activatorEvent:gs,active:{id:Pt,data:jt.data,rect:H}};el.unstable_batchedUpdates(()=>{zt?.(ws),w(pa.Initializing),A({type:tn.DragStart,initialCoordinates:St,active:Pt}),E({type:"onDragStart",event:ws}),j(It.current),Y(gs)})},onMove(St){A({type:tn.DragMove,coordinates:St})},onEnd:Rs(tn.DragEnd),onCancel:Rs(tn.DragCancel)});It.current=Ms;function Rs(St){return async function(){const{active:jt,collisions:zt,over:ws,scrollAdjustedTranslate:Cs}=nt.current;let Qs=null;if(jt&&Cs){const{cancelDrop:Ee}=re.current;Qs={activatorEvent:gs,active:jt,collisions:zt,delta:Cs,over:ws},St===tn.DragEnd&&typeof Ee=="function"&&await Promise.resolve(Ee(Qs))&&(St=tn.DragCancel)}X.current=null,el.unstable_batchedUpdates(()=>{A({type:St}),w(pa.Uninitialized),ht(null),j(null),Y(null),It.current=null;const Ee=St===tn.DragEnd?"onDragEnd":"onDragCancel";if(Qs){const rn=re.current[Ee];rn?.(Qs),E({type:Ee,event:Qs})}})}}},[k]),ds=C.useCallback((rt,ns)=>(bs,Ts)=>{const ps=bs.nativeEvent,gs=k.get(Ts);if(X.current!==null||!gs||ps.dndKit||ps.defaultPrevented)return;const Ms={active:gs};rt(bs,ns.options,Ms)===!0&&(ps.dndKit={capturedBy:ns.sensor},X.current=Ts,Ss(bs,ns))},[k,Ss]),Vs=Z6(h,ds);aF(h),ji(()=>{Ue&&L===pa.Initializing&&w(pa.Initialized)},[Ue,L]),C.useEffect(()=>{const{onDragMove:rt}=re.current,{active:ns,activatorEvent:bs,collisions:Ts,over:ps}=nt.current;if(!ns||!bs)return;const gs={active:ns,activatorEvent:bs,collisions:Ts,delta:{x:se.x,y:se.y},over:ps};el.unstable_batchedUpdates(()=>{rt?.(gs),E({type:"onDragMove",event:gs})})},[se.x,se.y]),C.useEffect(()=>{const{active:rt,activatorEvent:ns,collisions:bs,droppableContainers:Ts,scrollAdjustedTranslate:ps}=nt.current;if(!rt||X.current==null||!ns||!ps)return;const{onDragOver:gs}=re.current,Ms=Ts.get(Ke),Rs=Ms&&Ms.rect.current?{id:Ms.id,rect:Ms.rect.current,data:Ms.data,disabled:Ms.disabled}:null,St={active:rt,activatorEvent:ns,collisions:bs,delta:{x:ps.x,y:ps.y},over:Rs};el.unstable_batchedUpdates(()=>{ht(Rs),gs?.(St),E({type:"onDragOver",event:St})})},[Ke]),ji(()=>{nt.current={activatorEvent:K,active:J,activeNode:pe,collisionRect:me,collisions:he,droppableRects:G,draggableNodes:k,draggingNode:Ot,draggingNodeRect:ke,droppableContainers:F,over:Be,scrollableAncestors:vt,scrollAdjustedTranslate:se},H.current={initial:ke,translated:me}},[J,pe,he,me,k,Ot,ke,G,F,Be,vt,se]),q6({...ce,delta:N,draggingRect:me,pointerCoordinates:Ve,scrollableAncestors:vt,scrollableAncestorRects:fe});const $s=C.useMemo(()=>({active:J,activeNode:pe,activeNodeRect:Ue,activatorEvent:K,collisions:he,containerNodeRect:Ze,dragOverlay:Nt,draggableNodes:k,droppableContainers:F,droppableRects:G,over:Be,measureDroppableContainers:de,scrollableAncestors:vt,scrollableAncestorRects:fe,measuringConfiguration:z,measuringScheduled:Te,windowRect:kt}),[J,pe,Ue,K,he,Ze,Nt,k,F,G,Be,de,vt,fe,z,Te,kt]),dn=C.useMemo(()=>({activatorEvent:K,activators:Vs,active:J,activeNodeRect:Ue,ariaDescribedById:{draggable:B},dispatch:A,draggableNodes:k,over:Be,measureDroppableContainers:de}),[K,Vs,J,Ue,A,B,k,Be,de]);return Se.createElement(DR.Provider,{value:R},Se.createElement(xu.Provider,{value:dn},Se.createElement(KR.Provider,{value:$s},Se.createElement(pf.Provider,{value:_t},d)),Se.createElement(pF,{disabled:l?.restoreFocus===!1})),Se.createElement(v6,{...l,hiddenTextDescribedById:B}));function it(){const rt=Q?.autoScrollEnabled===!1,ns=typeof u=="object"?u.enabled===!1:u===!1,bs=D&&!rt&&!ns;return typeof u=="object"?{...u,enabled:bs}:{enabled:bs}}}),xF=C.createContext(null),sE="button",SF="Draggable";function bF(n){let{id:e,data:t,disabled:s=!1,attributes:i}=n;const r=vu(SF),{activators:a,activatorEvent:l,active:u,activeNodeRect:d,ariaDescribedById:h,draggableNodes:m,over:g}=C.useContext(xu),{role:v=sE,roleDescription:S="draggable",tabIndex:x=0}=i??{},T=u?.id===e,A=C.useContext(T?pf:xF),[E,R]=Gh(),[L,w]=Gh(),D=oF(a,e),_=eu(t);ji(()=>(m.set(e,{id:e,key:r,node:E,activatorNode:L,data:_}),()=>{const N=m.get(e);N&&N.key===r&&m.delete(e)}),[m,e]);const k=C.useMemo(()=>({role:v,tabIndex:x,"aria-disabled":s,"aria-pressed":T&&v===sE?!0:void 0,"aria-roledescription":S,"aria-describedby":h.draggable}),[s,v,x,T,S,h.draggable]);return{active:u,activatorEvent:l,activeNodeRect:d,attributes:k,isDragging:T,listeners:s?void 0:D,node:E,over:g,setNodeRef:R,setActivatorNodeRef:w,transform:A}}function qR(){return C.useContext(KR)}const TF="Droppable",EF={timeout:25};function AF(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:i}=n;const r=vu(TF),{active:a,dispatch:l,over:u,measureDroppableContainers:d}=C.useContext(xu),h=C.useRef({disabled:t}),m=C.useRef(!1),g=C.useRef(null),v=C.useRef(null),{disabled:S,updateMeasurementsFor:x,timeout:T}={...EF,...i},A=eu(x??s),E=C.useCallback(()=>{if(!m.current){m.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{d(Array.isArray(A.current)?A.current:[A.current]),v.current=null},T)},[T]),R=mf({callback:E,disabled:S||!a}),L=C.useCallback((k,N)=>{R&&(N&&(R.unobserve(N),m.current=!1),k&&R.observe(k))},[R]),[w,D]=Gh(L),_=eu(e);return C.useEffect(()=>{!R||!w.current||(R.disconnect(),m.current=!1,R.observe(w.current))},[w,R]),C.useEffect(()=>(l({type:tn.RegisterDroppable,element:{id:s,key:r,disabled:t,node:w,rect:g,data:_}}),()=>l({type:tn.UnregisterDroppable,key:r,id:s})),[s]),C.useEffect(()=>{t!==h.current.disabled&&(l({type:tn.SetDroppableDisabled,id:s,key:r,disabled:t}),h.current.disabled=t)},[s,r,t,l]),{active:a,rect:g,isOver:u?.id===s,node:w,over:u,setNodeRef:D}}function IF(n){let{animation:e,children:t}=n;const[s,i]=C.useState(null),[r,a]=C.useState(null),l=Hh(t);return!t&&!s&&l&&i(l),ji(()=>{if(!r)return;const u=s?.key,d=s?.props.id;if(u==null||d==null){i(null);return}Promise.resolve(e(d,r)).then(()=>{i(null)})},[e,s,r]),Se.createElement(Se.Fragment,null,t,s?C.cloneElement(s,{ref:a}):null)}const RF={x:0,y:0,scaleX:1,scaleY:1};function wF(n){let{children:e}=n;return Se.createElement(xu.Provider,{value:zR},Se.createElement(pf.Provider,{value:RF},e))}const CF={position:"fixed",touchAction:"none"},LF=n=>ff(n)?"transform 250ms ease":void 0,DF=C.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:i,children:r,className:a,rect:l,style:u,transform:d,transition:h=LF}=n;if(!l)return null;const m=i?d:{...d,scaleX:1,scaleY:1},g={...CF,width:l.width,height:l.height,top:l.top,left:l.left,transform:ba.Transform.toString(m),transformOrigin:i&&s?b6(s,l):void 0,transition:typeof h=="function"?h(s):h,...u};return Se.createElement(t,{className:a,style:g,ref:e},r)}),OF=n=>e=>{let{active:t,dragOverlay:s}=e;const i={},{styles:r,className:a}=n;if(r!=null&&r.active)for(const[l,u]of Object.entries(r.active))u!==void 0&&(i[l]=t.node.style.getPropertyValue(l),t.node.style.setProperty(l,u));if(r!=null&&r.dragOverlay)for(const[l,u]of Object.entries(r.dragOverlay))u!==void 0&&s.node.style.setProperty(l,u);return a!=null&&a.active&&t.node.classList.add(a.active),a!=null&&a.dragOverlay&&s.node.classList.add(a.dragOverlay),function(){for(const[u,d]of Object.entries(i))t.node.style.setProperty(u,d);a!=null&&a.active&&t.node.classList.remove(a.active)}},_F=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:ba.Transform.toString(e)},{transform:ba.Transform.toString(t)}]},PF={duration:250,easing:"ease",keyframes:_F,sideEffects:OF({styles:{active:{opacity:"0"}}})};function NF(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:i}=n;return hf((r,a)=>{if(e===null)return;const l=t.get(r);if(!l)return;const u=l.node.current;if(!u)return;const d=HR(a);if(!d)return;const{transform:h}=On(a).getComputedStyle(a),m=_R(h);if(!m)return;const g=typeof e=="function"?e:kF(e);return BR(u,i.draggable.measure),g({active:{id:r,data:l.data,node:u,rect:i.draggable.measure(u)},draggableNodes:t,dragOverlay:{node:a,rect:i.dragOverlay.measure(d)},droppableContainers:s,measuringConfiguration:i,transform:m})})}function kF(n){const{duration:e,easing:t,sideEffects:s,keyframes:i}={...PF,...n};return r=>{let{active:a,dragOverlay:l,transform:u,...d}=r;if(!e)return;const h={x:l.rect.left-a.rect.left,y:l.rect.top-a.rect.top},m={scaleX:u.scaleX!==1?a.rect.width*u.scaleX/l.rect.width:1,scaleY:u.scaleY!==1?a.rect.height*u.scaleY/l.rect.height:1},g={x:u.x-h.x,y:u.y-h.y,...m},v=i({...d,active:a,dragOverlay:l,transform:{initial:u,final:g}}),[S]=v,x=v[v.length-1];if(JSON.stringify(S)===JSON.stringify(x))return;const T=s?.({active:a,dragOverlay:l,...d}),A=l.node.animate(v,{duration:e,easing:t,fill:"forwards"});return new Promise(E=>{A.onfinish=()=>{T?.(),E()}})}}let nE=0;function MF(n){return C.useMemo(()=>{if(n!=null)return nE++,nE},[n])}const UF=Se.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:i,transition:r,modifiers:a,wrapperElement:l="div",className:u,zIndex:d=999}=n;const{activatorEvent:h,active:m,activeNodeRect:g,containerNodeRect:v,draggableNodes:S,droppableContainers:x,dragOverlay:T,over:A,measuringConfiguration:E,scrollableAncestors:R,scrollableAncestorRects:L,windowRect:w}=qR(),D=C.useContext(pf),_=MF(m?.id),k=YR(a,{activatorEvent:h,active:m,activeNodeRect:g,containerNodeRect:v,draggingNodeRect:T.rect,over:A,overlayNodeRect:T.rect,scrollableAncestors:R,scrollableAncestorRects:L,transform:D,windowRect:w}),N=Ny(g),F=NF({config:s,draggableNodes:S,droppableContainers:x,measuringConfiguration:E}),V=N?T.setRef:void 0;return Se.createElement(wF,null,Se.createElement(IF,{animation:F},m&&_?Se.createElement(DF,{key:_,id:m.id,ref:V,as:l,activatorEvent:h,adjustScale:e,className:u,transition:r,rect:N,style:{zIndex:d,...i},transform:k},t):null))}),FF=n=>{let{transform:e}=n;return{...e,x:0}};function QR(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function BF(n,e){return n.reduce((t,s,i)=>{const r=e.get(s);return r&&(t[i]=r),t},Array(n.length))}function rh(n){return n!==null&&n>=0}function jF(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function VF(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const XR=n=>{let{rects:e,activeIndex:t,overIndex:s,index:i}=n;const r=QR(e,s,t),a=e[i],l=r[i];return!l||!a?null:{x:l.left-a.left,y:l.top-a.top,scaleX:l.width/a.width,scaleY:l.height/a.height}},ah={scaleX:1,scaleY:1},$F=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:i,rects:r,overIndex:a}=n;const l=(e=r[t])!=null?e:s;if(!l)return null;if(i===t){const d=r[a];return d?{x:0,y:t<a?d.top+d.height-(l.top+l.height):d.top-l.top,...ah}:null}const u=GF(r,i,t);return i>t&&i<=a?{x:0,y:-l.height-u,...ah}:i<t&&i>=a?{x:0,y:l.height+u,...ah}:{x:0,y:0,...ah}};function GF(n,e,t){const s=n[e],i=n[e-1],r=n[e+1];return s?t<e?i?s.top-(i.top+i.height):r?r.top-(s.top+s.height):0:r?r.top-(s.top+s.height):i?s.top-(i.top+i.height):0:0}const WR="Sortable",ZR=Se.createContext({activeIndex:-1,containerId:WR,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:XR,disabled:{draggable:!1,droppable:!1}});function HF(n){let{children:e,id:t,items:s,strategy:i=XR,disabled:r=!1}=n;const{active:a,dragOverlay:l,droppableRects:u,over:d,measureDroppableContainers:h}=qR(),m=vu(WR,t),g=l.rect!==null,v=C.useMemo(()=>s.map(D=>typeof D=="object"&&"id"in D?D.id:D),[s]),S=a!=null,x=a?v.indexOf(a.id):-1,T=d?v.indexOf(d.id):-1,A=C.useRef(v),E=!jF(v,A.current),R=T!==-1&&x===-1||E,L=VF(r);ji(()=>{E&&S&&h(v)},[E,v,S,h]),C.useEffect(()=>{A.current=v},[v]);const w=C.useMemo(()=>({activeIndex:x,containerId:m,disabled:L,disableTransforms:R,items:v,overIndex:T,useDragOverlay:g,sortedRects:BF(v,u),strategy:i}),[x,m,L.draggable,L.droppable,R,v,T,u,g,i]);return Se.createElement(ZR.Provider,{value:w},e)}const zF=n=>{let{id:e,items:t,activeIndex:s,overIndex:i}=n;return QR(t,s,i).indexOf(e)},KF=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:i,items:r,newIndex:a,previousItems:l,previousContainerId:u,transition:d}=n;return!d||!s||l!==r&&i===a?!1:t?!0:a!==i&&e===u},YF={duration:200,easing:"ease"},JR="transform",qF=ba.Transition.toString({property:JR,duration:0,easing:"linear"}),QF={roleDescription:"sortable"};function XF(n){let{disabled:e,index:t,node:s,rect:i}=n;const[r,a]=C.useState(null),l=C.useRef(t);return ji(()=>{if(!e&&t!==l.current&&s.current){const u=i.current;if(u){const d=Il(s.current,{ignoreTransform:!0}),h={x:u.left-d.left,y:u.top-d.top,scaleX:u.width/d.width,scaleY:u.height/d.height};(h.x||h.y)&&a(h)}}t!==l.current&&(l.current=t)},[e,t,s,i]),C.useEffect(()=>{r&&a(null)},[r]),r}function WF(n){let{animateLayoutChanges:e=KF,attributes:t,disabled:s,data:i,getNewIndex:r=zF,id:a,strategy:l,resizeObserverConfig:u,transition:d=YF}=n;const{items:h,containerId:m,activeIndex:g,disabled:v,disableTransforms:S,sortedRects:x,overIndex:T,useDragOverlay:A,strategy:E}=C.useContext(ZR),R=ZF(s,v),L=h.indexOf(a),w=C.useMemo(()=>({sortable:{containerId:m,index:L,items:h},...i}),[m,i,L,h]),D=C.useMemo(()=>h.slice(h.indexOf(a)),[h,a]),{rect:_,node:k,isOver:N,setNodeRef:F}=AF({id:a,data:w,disabled:R.droppable,resizeObserverConfig:{updateMeasurementsFor:D,...u}}),{active:V,activatorEvent:H,activeNodeRect:J,attributes:X,setNodeRef:Q,listeners:j,isDragging:K,over:Y,setActivatorNodeRef:re,transform:B}=bF({id:a,data:w,attributes:{...QF,...t},disabled:R.draggable}),M=r6(F,Q),z=!!V,G=z&&!S&&rh(g)&&rh(T),de=!A&&K,Te=de&&G?B:null,Qe=G?Te??(l??E)({rects:x,activeNodeRect:J,activeIndex:g,overIndex:T,index:L}):null,ce=rh(g)&&rh(T)?r({id:a,items:h,activeIndex:g,overIndex:T}):L,Oe=V?.id,Ue=C.useRef({activeId:Oe,items:h,newIndex:ce,containerId:m}),Ze=h!==Ue.current.items,nt=e({active:V,containerId:m,isDragging:K,isSorting:z,id:a,index:L,items:h,newIndex:Ue.current.newIndex,previousItems:Ue.current.items,previousContainerId:Ue.current.containerId,transition:d,wasDragging:Ue.current.activeId!=null}),Dt=XF({disabled:!nt,index:L,node:k,rect:_});return C.useEffect(()=>{z&&Ue.current.newIndex!==ce&&(Ue.current.newIndex=ce),m!==Ue.current.containerId&&(Ue.current.containerId=m),h!==Ue.current.items&&(Ue.current.items=h)},[z,ce,m,h]),C.useEffect(()=>{if(Oe===Ue.current.activeId)return;if(Oe!=null&&Ue.current.activeId==null){Ue.current.activeId=Oe;return}const Ot=setTimeout(()=>{Ue.current.activeId=Oe},50);return()=>clearTimeout(Ot)},[Oe]),{active:V,activeIndex:g,attributes:X,data:w,rect:_,index:L,newIndex:ce,items:h,isOver:N,isSorting:z,isDragging:K,listeners:j,node:k,overIndex:T,over:Y,setNodeRef:M,setActivatorNodeRef:re,setDroppableNodeRef:F,setDraggableNodeRef:Q,transform:Dt??Qe,transition:Nt()};function Nt(){if(Dt||Ze&&Ue.current.newIndex===L)return qF;if(!(de&&!ff(H)||!d)&&(z||nt))return ba.Transition.toString({...d,property:JR})}}function ZF(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n?.draggable)!=null?t:e.draggable,droppable:(s=n?.droppable)!=null?s:e.droppable}}Ht.Down,Ht.Right,Ht.Up,Ht.Left;const ew=(n,e)=>{const[t,s]=C.useState(n),i=C.useRef({}),r=C.useRef([]),a=C.useRef([]);C.useEffect(()=>{s(e?[...n,...Array(4).fill({isPlaceholder:!0})]:n)},[n,e]);const l=(u,d)=>{i.current={...i.current,[u]:d}};return C.useEffect(()=>{const u=()=>{m()},d=()=>{a.current=r.current.map((g,v)=>{const S=new ResizeObserver(()=>{if(g){const x=g.style.height;g.style.height="auto";const T=g.getBoundingClientRect().height;g.style.height=x||`${T}px`,T!==i.current[v]&&l(v,T)}});return g&&S.observe(g),S})},h=()=>{a.current.forEach(g=>g.disconnect()),a.current=[]},m=()=>{r.current.forEach((g,v)=>{if(g){const S=g.style.height;g.style.height="auto";const x=g.getBoundingClientRect().height;g.style.height=S||`${x}px`,x!==i.current[v]&&l(v,x)}})};return r.current=t.map(()=>null),h(),m(),d(),document.body.style.overflowY="auto",window.addEventListener("resize",u),()=>{h(),window.removeEventListener("resize",u)}},[t]),{displayItems:t,setDisplayItems:s,setRowRefs:(u,d)=>{r.current[u]=d}}},tw=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Unknown Date",iE=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric"}):"Unknown Date",Jo=({type:n="album"})=>y.jsxs("div",{className:"skeleton-loading",children:[y.jsx("div",{className:`skeleton-effect thumbnail ${n==="playlist"?"playlist":n==="artist"?"artist":n==="genre"?"genre":""}`}),y.jsxs("div",{className:"skeleton-details",children:[n==="album"&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"skeleton-effect album title"}),y.jsx("div",{className:"skeleton-effect album artist"})]}),n==="artist"&&y.jsx(y.Fragment,{children:y.jsx("div",{className:"skeleton-effect artist title"})}),n==="song"&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"skeleton-effect track title"}),y.jsx("div",{className:"skeleton-effect track artist"})]}),n==="playlist"&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"skeleton-effect playlist title"}),y.jsx("div",{className:"skeleton-effect playlist artist"})]}),n==="genre"&&y.jsx(y.Fragment,{children:y.jsx("div",{className:"skeleton-effect genre title"})})]}),n==="playlist"&&y.jsx("div",{className:"skeleton-indicators",children:y.jsx("div",{className:"skeleton-effect duration"})})]}),gf=0,Aa=1,Rl=2,sw=4;function rE(n){return()=>n}function JF(n){n()}function nw(n,e){return t=>n(e(t))}function aE(n,e){return()=>n(e)}function e8(n,e){return t=>n(e,t)}function ky(n){return n!==void 0}function t8(...n){return()=>{n.map(JF)}}function wl(){}function yf(n,e){return e(n),n}function s8(n,e){return e(n)}function ms(...n){return n}function Kt(n,e){return n(Aa,e)}function yt(n,e){n(gf,e)}function My(n){n(Rl)}function js(n){return n(sw)}function We(n,e){return Kt(n,e8(e,gf))}function Bi(n,e){const t=n(Aa,s=>{t(),e(s)});return t}function oE(n){let e,t;return s=>i=>{e=i,t&&clearTimeout(t),t=setTimeout(()=>{s(e)},n)}}function iw(n,e){return n===e}function fs(n=iw){let e;return t=>s=>{n(e,s)||(e=s,t(s))}}function dt(n){return e=>t=>{n(t)&&e(t)}}function Ge(n){return e=>nw(e,n)}function ar(n){return e=>()=>{e(n)}}function Ae(n,...e){const t=n8(...e);return(s,i)=>{switch(s){case Rl:My(n);return;case Aa:return Kt(n,t(i))}}}function cr(n,e){return t=>s=>{t(e=n(e,s))}}function so(n){return e=>t=>{n>0?n--:e(t)}}function kr(n){let e=null,t;return s=>i=>{e=i,!t&&(t=setTimeout(()=>{t=void 0,s(e)},n))}}function At(...n){const e=new Array(n.length);let t=0,s=null;const i=Math.pow(2,n.length)-1;return n.forEach((r,a)=>{const l=Math.pow(2,a);Kt(r,u=>{const d=t;t=t|l,e[a]=u,d!==i&&t===i&&s&&(s(),s=null)})}),r=>a=>{const l=()=>{r([a].concat(e))};t===i?l():s=l}}function n8(...n){return e=>n.reduceRight(s8,e)}function i8(n){let e,t;const s=()=>e?.();return function(i,r){switch(i){case Aa:return r?t===r?void 0:(s(),t=r,e=Kt(n,r),e):(s(),wl);case Rl:s(),t=null;return}}}function Me(n){let e=n;const t=Ut();return(s,i)=>{switch(s){case gf:e=i;break;case Aa:{i(e);break}case sw:return e}return t(s,i)}}function In(n,e){return yf(Me(e),t=>We(n,t))}function Ut(){const n=[];return(e,t)=>{switch(e){case gf:n.slice().forEach(s=>{s(t)});return;case Rl:n.splice(0,n.length);return;case Aa:return n.push(t),()=>{const s=n.indexOf(t);s>-1&&n.splice(s,1)}}}}function li(n){return yf(Ut(),e=>We(n,e))}function $t(n,e=[],{singleton:t}={singleton:!0}){return{constructor:n,dependencies:e,id:r8(),singleton:t}}const r8=()=>Symbol();function a8(n){const e=new Map,t=({constructor:s,dependencies:i,id:r,singleton:a})=>{if(a&&e.has(r))return e.get(r);const l=s(i.map(u=>t(u)));return a&&e.set(r,l),l};return t(n)}function qs(...n){const e=Ut(),t=new Array(n.length);let s=0;const i=Math.pow(2,n.length)-1;return n.forEach((r,a)=>{const l=Math.pow(2,a);Kt(r,u=>{t[a]=u,s=s|l,s===i&&yt(e,t)})}),function(r,a){switch(r){case Rl:{My(e);return}case Aa:return s===i&&a(t),Kt(e,a)}}}function ct(n,e=iw){return Ae(n,fs(e))}function I0(...n){return function(e,t){switch(e){case Rl:return;case Aa:return t8(...n.map(s=>Kt(s,t)))}}}var Hn=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n))(Hn||{});const o8={0:"debug",3:"error",1:"log",2:"warn"},l8=()=>typeof globalThis>"u"?window:globalThis,Ia=$t(()=>{const n=Me(3);return{log:Me((e,t,s=1)=>{var i;const r=(i=l8().VIRTUOSO_LOG_LEVEL)!=null?i:js(n);s>=r&&console[o8[s]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",e,t)}),logLevel:n}},[],{singleton:!0});function ao(n,e,t){return Uy(n,e,t).callbackRef}function Uy(n,e,t){const s=Se.useRef(null);let i=a=>{};const r=Se.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(a=>{const l=()=>{const u=a[0].target;u.offsetParent!==null&&n(u)};t?l():requestAnimationFrame(l)}):null,[n,t]);return i=a=>{a&&e?(r?.observe(a),s.current=a):(s.current&&r?.unobserve(s.current),s.current=null)},{callbackRef:i,ref:s}}function c8(n,e,t,s,i,r,a,l,u){const d=Se.useCallback(h=>{const m=u8(h.children,e,l?"offsetWidth":"offsetHeight",i);let g=h.parentElement;for(;!g.dataset.virtuosoScroller;)g=g.parentElement;const v=g.lastElementChild.dataset.viewportType==="window";let S;v&&(S=g.ownerDocument.defaultView);const x=a?l?a.scrollLeft:a.scrollTop:v?l?S.scrollX||S.document.documentElement.scrollLeft:S.scrollY||S.document.documentElement.scrollTop:l?g.scrollLeft:g.scrollTop,T=a?l?a.scrollWidth:a.scrollHeight:v?l?S.document.documentElement.scrollWidth:S.document.documentElement.scrollHeight:l?g.scrollWidth:g.scrollHeight,A=a?l?a.offsetWidth:a.offsetHeight:v?l?S.innerWidth:S.innerHeight:l?g.offsetWidth:g.offsetHeight;s({scrollHeight:T,scrollTop:Math.max(x,0),viewportHeight:A}),r?.(l?lE("column-gap",getComputedStyle(h).columnGap,i):lE("row-gap",getComputedStyle(h).rowGap,i)),m!==null&&n(m)},[n,e,i,r,a,s,l]);return Uy(d,t,u)}function u8(n,e,t,s){const i=n.length;if(i===0)return null;const r=[];for(let a=0;a<i;a++){const l=n.item(a);if(l.dataset.index===void 0)continue;const u=parseInt(l.dataset.index),d=parseFloat(l.dataset.knownSize),h=e(l,t);if(h===0&&s("Zero-sized element, this should not happen",{child:l},Hn.ERROR),h===d)continue;const m=r[r.length-1];r.length===0||m.size!==h||m.endIndex!==u-1?r.push({endIndex:u,size:h,startIndex:u}):r[r.length-1].endIndex++}return r}function lE(n,e,t){return e!=="normal"&&!(e!=null&&e.endsWith("px"))&&t(`${n} was not resolved to pixel value correctly`,e,Hn.WARN),e==="normal"?0:parseInt(e??"0",10)}function rw(n,e,t){const s=Se.useRef(null),i=Se.useCallback(u=>{if(!(u!=null&&u.offsetParent))return;const d=u.getBoundingClientRect(),h=d.width;let m,g;if(e){const v=e.getBoundingClientRect(),S=d.top-v.top;g=v.height-Math.max(0,S),m=S+e.scrollTop}else{const v=a.current.ownerDocument.defaultView;g=v.innerHeight-Math.max(0,d.top),m=d.top+v.scrollY}s.current={offsetTop:m,visibleHeight:g,visibleWidth:h},n(s.current)},[n,e]),{callbackRef:r,ref:a}=Uy(i,!0,t),l=Se.useCallback(()=>{i(a.current)},[i,a]);return Se.useEffect(()=>{var u;if(e){e.addEventListener("scroll",l);const d=new ResizeObserver(()=>{requestAnimationFrame(l)});return d.observe(e),()=>{e.removeEventListener("scroll",l),d.unobserve(e)}}else{const d=(u=a.current)==null?void 0:u.ownerDocument.defaultView;return d?.addEventListener("scroll",l),d?.addEventListener("resize",l),()=>{d?.removeEventListener("scroll",l),d?.removeEventListener("resize",l)}}},[l,e,a]),r}const _n=$t(()=>{const n=Ut(),e=Ut(),t=Me(0),s=Ut(),i=Me(0),r=Ut(),a=Ut(),l=Me(0),u=Me(0),d=Me(0),h=Me(0),m=Ut(),g=Ut(),v=Me(!1),S=Me(!1),x=Me(!1);return We(Ae(n,Ge(({scrollTop:T})=>T)),e),We(Ae(n,Ge(({scrollHeight:T})=>T)),a),We(e,i),{deviation:t,fixedFooterHeight:d,fixedHeaderHeight:u,footerHeight:h,headerHeight:l,horizontalDirection:S,scrollBy:g,scrollContainerState:n,scrollHeight:a,scrollingInProgress:v,scrollTo:m,scrollTop:e,skipAnimationFrameInResizeObserver:x,smoothScrollTargetReached:s,statefulScrollTop:i,viewportHeight:r}},[],{singleton:!0}),su={lvl:0};function aw(n,e){const t=n.length;if(t===0)return[];let{index:s,value:i}=e(n[0]);const r=[];for(let a=1;a<t;a++){const{index:l,value:u}=e(n[a]);r.push({end:l-1,start:s,value:i}),s=l,i=u}return r.push({end:1/0,start:s,value:i}),r}function ls(n){return n===su}function nu(n,e){if(!ls(n))return e===n.k?n.v:e<n.k?nu(n.l,e):nu(n.r,e)}function $i(n,e,t="k"){if(ls(n))return[-1/0,void 0];if(Number(n[t])===e)return[n.k,n.v];if(Number(n[t])<e){const s=$i(n.r,e,t);return s[0]===-1/0?[n.k,n.v]:s}return $i(n.l,e,t)}function ai(n,e,t){return ls(n)?cw(e,t,1):e===n.k?Js(n,{k:e,v:t}):e<n.k?cE(Js(n,{l:ai(n.l,e,t)})):cE(Js(n,{r:ai(n.r,e,t)}))}function cl(){return su}function vf(n,e,t){if(ls(n))return[];const s=$i(n,e)[0];return d8(w0(n,s,t))}function R0(n,e){if(ls(n))return su;const{k:t,l:s,r:i}=n;if(e===t){if(ls(s))return i;if(ls(i))return s;{const[r,a]=lw(s);return Ih(Js(n,{k:r,l:ow(s),v:a}))}}else return e<t?Ih(Js(n,{l:R0(s,e)})):Ih(Js(n,{r:R0(i,e)}))}function Xa(n){return ls(n)?[]:[...Xa(n.l),{k:n.k,v:n.v},...Xa(n.r)]}function w0(n,e,t){if(ls(n))return[];const{k:s,l:i,r,v:a}=n;let l=[];return s>e&&(l=l.concat(w0(i,e,t))),s>=e&&s<=t&&l.push({k:s,v:a}),s<=t&&(l=l.concat(w0(r,e,t))),l}function Ih(n){const{l:e,lvl:t,r:s}=n;if(s.lvl>=t-1&&e.lvl>=t-1)return n;if(t>s.lvl+1){if(bg(e))return uw(Js(n,{lvl:t-1}));if(!ls(e)&&!ls(e.r))return Js(e.r,{l:Js(e,{r:e.r.l}),lvl:t,r:Js(n,{l:e.r.r,lvl:t-1})});throw new Error("Unexpected empty nodes")}else{if(bg(n))return C0(Js(n,{lvl:t-1}));if(!ls(s)&&!ls(s.l)){const i=s.l,r=bg(i)?s.lvl-1:s.lvl;return Js(i,{l:Js(n,{lvl:t-1,r:i.l}),lvl:i.lvl+1,r:C0(Js(s,{l:i.r,lvl:r}))})}else throw new Error("Unexpected empty nodes")}}function Js(n,e){return cw(e.k!==void 0?e.k:n.k,e.v!==void 0?e.v:n.v,e.lvl!==void 0?e.lvl:n.lvl,e.l!==void 0?e.l:n.l,e.r!==void 0?e.r:n.r)}function ow(n){return ls(n.r)?n.l:Ih(Js(n,{r:ow(n.r)}))}function bg(n){return ls(n)||n.lvl>n.r.lvl}function lw(n){return ls(n.r)?[n.k,n.v]:lw(n.r)}function cw(n,e,t,s=su,i=su){return{k:n,l:s,lvl:t,r:i,v:e}}function cE(n){return C0(uw(n))}function uw(n){const{l:e}=n;return!ls(e)&&e.lvl===n.lvl?Js(e,{r:Js(n,{l:e.r})}):n}function C0(n){const{lvl:e,r:t}=n;return!ls(t)&&!ls(t.r)&&t.lvl===e&&t.r.lvl===e?Js(t,{l:Js(n,{r:t.l}),lvl:e+1}):n}function d8(n){return aw(n,({k:e,v:t})=>({index:e,value:t}))}function dw(n,e){return!!(n&&n.startIndex===e.startIndex&&n.endIndex===e.endIndex)}function iu(n,e){return!!(n&&n[0]===e[0]&&n[1]===e[1])}const Fy=$t(()=>({recalcInProgress:Me(!1)}),[],{singleton:!0});function hw(n,e,t){return n[Qh(n,e,t)]}function Qh(n,e,t,s=0){let i=n.length-1;for(;s<=i;){const r=Math.floor((s+i)/2),a=n[r],l=t(a,e);if(l===0)return r;if(l===-1){if(i-s<2)return r-1;i=r-1}else{if(i===s)return r;s=r+1}}throw new Error(`Failed binary finding record in array - ${n.join(",")}, searched for ${e}`)}function h8(n,e,t,s){const i=Qh(n,e,s),r=Qh(n,t,s,i);return n.slice(i,r+1)}function Ta(n,e){return Math.round(n.getBoundingClientRect()[e])}function xf(n){return!ls(n.groupOffsetTree)}function By({index:n},e){return e===n?0:e<n?-1:1}function f8(){return{groupIndices:[],groupOffsetTree:cl(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:cl()}}function m8(n,e){let t=ls(n)?0:1/0;for(const s of e){const{endIndex:i,size:r,startIndex:a}=s;if(t=Math.min(t,a),ls(n)){n=ai(n,0,r);continue}const l=vf(n,a-1,i+1);if(l.some(b8(s)))continue;let u=!1,d=!1;for(const{end:h,start:m,value:g}of l)u?(i>=m||r===g)&&(n=R0(n,m)):(d=g!==r,u=!0),h>i&&i>=m&&g!==r&&(n=ai(n,i+1,g));d&&(n=ai(n,a,r))}return[n,t]}function p8(n){return typeof n.groupIndex<"u"}function g8({offset:n},e){return e===n?0:e<n?-1:1}function ru(n,e,t){if(e.length===0)return 0;const{index:s,offset:i,size:r}=hw(e,n,By),a=n-s,l=r*a+(a-1)*t+i;return l>0?l+t:l}function fw(n,e){if(!xf(e))return n;let t=0;for(;e.groupIndices[t]<=n+t;)t++;return n+t}function mw(n,e,t){if(p8(n))return e.groupIndices[n.groupIndex]+1;{const s=n.index==="LAST"?t:n.index;let i=fw(s,e);return i=Math.max(0,i,Math.min(t,i)),i}}function y8(n,e,t,s=0){return s>0&&(e=Math.max(e,hw(n,s,By).offset)),aw(h8(n,e,t,g8),S8)}function v8(n,[e,t,s,i]){e.length>0&&s("received item sizes",e,Hn.DEBUG);const r=n.sizeTree;let a=r,l=0;if(t.length>0&&ls(r)&&e.length===2){const g=e[0].size,v=e[1].size;a=t.reduce((S,x)=>ai(ai(S,x,g),x+1,v),a)}else[a,l]=m8(a,e);if(a===r)return n;const{lastIndex:u,lastOffset:d,lastSize:h,offsetTree:m}=L0(n.offsetTree,l,a,i);return{groupIndices:t,groupOffsetTree:t.reduce((g,v)=>ai(g,v,ru(v,m,i)),cl()),lastIndex:u,lastOffset:d,lastSize:h,offsetTree:m,sizeTree:a}}function x8(n){return Xa(n).map(({k:e,v:t},s,i)=>{const r=i[s+1];return{endIndex:r?r.k-1:1/0,size:t,startIndex:e}})}function uE(n,e){let t=0,s=0;for(;t<n;)t+=e[s+1]-e[s]-1,s++;return s-(t===n?0:1)}function L0(n,e,t,s){let i=n,r=0,a=0,l=0,u=0;if(e!==0){u=Qh(i,e-1,By),l=i[u].offset;const d=$i(t,e-1);r=d[0],a=d[1],i.length&&i[u].size===$i(t,e)[1]&&(u-=1),i=i.slice(0,u+1)}else i=[];for(const{start:d,value:h}of vf(t,e,1/0)){const m=d-r,g=m*a+l+m*s;i.push({index:d,offset:g,size:h}),r=d,l=g,a=h}return{lastIndex:r,lastOffset:l,lastSize:a,offsetTree:i}}function S8(n){return{index:n.index,value:n}}function b8(n){const{endIndex:e,size:t,startIndex:s}=n;return i=>i.start===s&&(i.end===e||i.end===1/0)&&i.value===t}const T8={offsetHeight:"height",offsetWidth:"width"},mr=$t(([{log:n},{recalcInProgress:e}])=>{const t=Ut(),s=Ut(),i=In(s,0),r=Ut(),a=Ut(),l=Me(0),u=Me([]),d=Me(void 0),h=Me(void 0),m=Me((w,D)=>Ta(w,T8[D])),g=Me(void 0),v=Me(0),S=f8(),x=In(Ae(t,At(u,n,v),cr(v8,S),fs()),S),T=In(Ae(u,fs(),cr((w,D)=>({current:D,prev:w.current}),{current:[],prev:[]}),Ge(({prev:w})=>w)),[]);We(Ae(u,dt(w=>w.length>0),At(x,v),Ge(([w,D,_])=>{const k=w.reduce((N,F,V)=>ai(N,F,ru(F,D.offsetTree,_)||V),cl());return{...D,groupIndices:w,groupOffsetTree:k}})),x),We(Ae(s,At(x),dt(([w,{lastIndex:D}])=>w<D),Ge(([w,{lastIndex:D,lastSize:_}])=>[{endIndex:D,size:_,startIndex:w}])),t),We(d,h);const A=In(Ae(d,Ge(w=>w===void 0)),!0);We(Ae(h,dt(w=>w!==void 0&&ls(js(x).sizeTree)),Ge(w=>[{endIndex:0,size:w,startIndex:0}])),t);const E=li(Ae(t,At(x),cr(({sizes:w},[D,_])=>({changed:_!==w,sizes:_}),{changed:!1,sizes:S}),Ge(w=>w.changed)));Kt(Ae(l,cr((w,D)=>({diff:w.prev-D,prev:D}),{diff:0,prev:0}),Ge(w=>w.diff)),w=>{const{groupIndices:D}=js(x);if(w>0)yt(e,!0),yt(r,w+uE(w,D));else if(w<0){const _=js(T);_.length>0&&(w-=uE(-w,_)),yt(a,w)}}),Kt(Ae(l,At(n)),([w,D])=>{w<0&&D("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},Hn.ERROR)});const R=li(r);We(Ae(r,At(x),Ge(([w,D])=>{const _=D.groupIndices.length>0,k=[],N=D.lastSize;if(_){const F=nu(D.sizeTree,0);let V=0,H=0;for(;V<w;){const X=D.groupIndices[H],Q=D.groupIndices.length===H+1?1/0:D.groupIndices[H+1]-X-1;k.push({endIndex:X,size:F,startIndex:X}),k.push({endIndex:X+1+Q-1,size:N,startIndex:X+1}),H++,V+=Q+1}const J=Xa(D.sizeTree);return V!==w&&J.shift(),J.reduce((X,{k:Q,v:j})=>{let K=X.ranges;return X.prevSize!==0&&(K=[...X.ranges,{endIndex:Q+w-1,size:X.prevSize,startIndex:X.prevIndex}]),{prevIndex:Q+w,prevSize:j,ranges:K}},{prevIndex:w,prevSize:0,ranges:k}).ranges}return Xa(D.sizeTree).reduce((F,{k:V,v:H})=>({prevIndex:V+w,prevSize:H,ranges:[...F.ranges,{endIndex:V+w-1,size:F.prevSize,startIndex:F.prevIndex}]}),{prevIndex:0,prevSize:N,ranges:[]}).ranges})),t);const L=li(Ae(a,At(x,v),Ge(([w,{offsetTree:D},_])=>{const k=-w;return ru(k,D,_)})));return We(Ae(a,At(x,v),Ge(([w,D,_])=>{if(D.groupIndices.length>0){if(ls(D.sizeTree))return D;let k=cl();const N=js(T);let F=0,V=0,H=0;for(;F<-w;){H=N[V];const J=N[V+1]-H-1;V++,F+=J+1}if(k=Xa(D.sizeTree).reduce((J,{k:X,v:Q})=>ai(J,Math.max(0,X+w),Q),k),F!==-w){const J=nu(D.sizeTree,H);k=ai(k,0,J);const X=$i(D.sizeTree,-w+1)[1];k=ai(k,1,X)}return{...D,sizeTree:k,...L0(D.offsetTree,0,k,_)}}else{const k=Xa(D.sizeTree).reduce((N,{k:F,v:V})=>ai(N,Math.max(0,F+w),V),cl());return{...D,sizeTree:k,...L0(D.offsetTree,0,k,_)}}})),x),{beforeUnshiftWith:R,data:g,defaultItemSize:h,firstItemIndex:l,fixedItemSize:d,gap:v,groupIndices:u,itemSize:m,listRefresh:E,shiftWith:a,shiftWithOffset:L,sizeRanges:t,sizes:x,statefulTotalCount:i,totalCount:s,trackItemSizes:A,unshiftWith:r}},ms(Ia,Fy),{singleton:!0});function E8(n){return n.reduce((e,t)=>(e.groupIndices.push(e.totalCount),e.totalCount+=t+1,e),{groupIndices:[],totalCount:0})}const pw=$t(([{groupIndices:n,sizes:e,totalCount:t},{headerHeight:s,scrollTop:i}])=>{const r=Ut(),a=Ut(),l=li(Ae(r,Ge(E8)));return We(Ae(l,Ge(u=>u.totalCount)),t),We(Ae(l,Ge(u=>u.groupIndices)),n),We(Ae(qs(i,e,s),dt(([u,d])=>xf(d)),Ge(([u,d,h])=>$i(d.groupOffsetTree,Math.max(u-h,0),"v")[0]),fs(),Ge(u=>[u])),a),{groupCounts:r,topItemsIndexes:a}},ms(mr,_n)),Ra=$t(([{log:n}])=>{const e=Me(!1),t=li(Ae(e,dt(s=>s),fs()));return Kt(e,s=>{s&&js(n)("props updated",{},Hn.DEBUG)}),{didMount:t,propsReady:e}},ms(Ia),{singleton:!0}),A8=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function gw(n){const e=typeof n=="number"?{index:n}:n;return e.align||(e.align="start"),(!e.behavior||!A8)&&(e.behavior="auto"),e.offset||(e.offset=0),e}const Su=$t(([{gap:n,listRefresh:e,sizes:t,totalCount:s},{fixedFooterHeight:i,fixedHeaderHeight:r,footerHeight:a,headerHeight:l,scrollingInProgress:u,scrollTo:d,smoothScrollTargetReached:h,viewportHeight:m},{log:g}])=>{const v=Ut(),S=Ut(),x=Me(0);let T=null,A=null,E=null;function R(){T&&(T(),T=null),E&&(E(),E=null),A&&(clearTimeout(A),A=null),yt(u,!1)}return We(Ae(v,At(t,m,s,x,l,a,g),At(n,r,i),Ge(([[L,w,D,_,k,N,F,V],H,J,X])=>{const Q=gw(L),{align:j,behavior:K,offset:Y}=Q,re=_-1,B=mw(Q,w,re);let M=ru(B,w.offsetTree,H)+N;j==="end"?(M+=J+$i(w.sizeTree,B)[1]-D+X,B===re&&(M+=F)):j==="center"?M+=(J+$i(w.sizeTree,B)[1]-D+X)/2:M-=k,Y&&(M+=Y);const z=G=>{R(),G?(V("retrying to scroll to",{location:L},Hn.DEBUG),yt(v,L)):(yt(S,!0),V("list did not change, scroll successful",{},Hn.DEBUG))};if(R(),K==="smooth"){let G=!1;E=Kt(e,de=>{G=G||de}),T=Bi(h,()=>{z(G)})}else T=Bi(Ae(e,I8(150)),z);return A=setTimeout(()=>{R()},1200),yt(u,!0),V("scrolling from index to",{behavior:K,index:B,top:M},Hn.DEBUG),{behavior:K,top:M}})),d),{scrollTargetReached:S,scrollToIndex:v,topListHeight:x}},ms(mr,_n,Ia),{singleton:!0});function I8(n){return e=>{const t=setTimeout(()=>{e(!1)},n);return s=>{s&&(e(!0),clearTimeout(t))}}}function jy(n,e){n==0?e():requestAnimationFrame(()=>{jy(n-1,e)})}function Vy(n,e){const t=e-1;return typeof n=="number"?n:n.index==="LAST"?t:n.index}const bu=$t(([{defaultItemSize:n,listRefresh:e,sizes:t},{scrollTop:s},{scrollTargetReached:i,scrollToIndex:r},{didMount:a}])=>{const l=Me(!0),u=Me(0),d=Me(!0);return We(Ae(a,At(u),dt(([h,m])=>!!m),ar(!1)),l),We(Ae(a,At(u),dt(([h,m])=>!!m),ar(!1)),d),Kt(Ae(qs(e,a),At(l,t,n,d),dt(([[,h],m,{sizeTree:g},v,S])=>h&&(!ls(g)||ky(v))&&!m&&!S),At(u)),([,h])=>{Bi(i,()=>{yt(d,!0)}),jy(4,()=>{Bi(s,()=>{yt(l,!0)}),yt(r,h)})}),{initialItemFinalLocationReached:d,initialTopMostItemIndex:u,scrolledToInitialItem:l}},ms(mr,_n,Su,Ra),{singleton:!0});function yw(n,e){return Math.abs(n-e)<1.01}const au="up",jc="down",R8="none",w8={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},C8=0,Tu=$t(([{footerHeight:n,headerHeight:e,scrollBy:t,scrollContainerState:s,scrollTop:i,viewportHeight:r}])=>{const a=Me(!1),l=Me(!0),u=Ut(),d=Ut(),h=Me(4),m=Me(C8),g=In(Ae(I0(Ae(ct(i),so(1),ar(!0)),Ae(ct(i),so(1),ar(!1),oE(100))),fs()),!1),v=In(Ae(I0(Ae(t,ar(!0)),Ae(t,ar(!1),oE(200))),fs()),!1);We(Ae(qs(ct(i),ct(m)),Ge(([E,R])=>E<=R),fs()),l),We(Ae(l,kr(50)),d);const S=li(Ae(qs(s,ct(r),ct(e),ct(n),ct(h)),cr((E,[{scrollHeight:R,scrollTop:L},w,D,_,k])=>{const N=L+w-R>-k,F={scrollHeight:R,scrollTop:L,viewportHeight:w};if(N){let H,J;return L>E.state.scrollTop?(H="SCROLLED_DOWN",J=E.state.scrollTop-L):(H="SIZE_DECREASED",J=E.state.scrollTop-L||E.scrollTopDelta),{atBottom:!0,atBottomBecause:H,scrollTopDelta:J,state:F}}let V;return F.scrollHeight>E.state.scrollHeight?V="SIZE_INCREASED":w<E.state.viewportHeight?V="VIEWPORT_HEIGHT_DECREASING":L<E.state.scrollTop?V="SCROLLING_UPWARDS":V="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:V,state:F}},w8),fs((E,R)=>E&&E.atBottom===R.atBottom))),x=In(Ae(s,cr((E,{scrollHeight:R,scrollTop:L,viewportHeight:w})=>{if(yw(E.scrollHeight,R))return{changed:!1,jump:0,scrollHeight:R,scrollTop:L};{const D=R-(L+w)<1;return E.scrollTop!==L&&D?{changed:!0,jump:E.scrollTop-L,scrollHeight:R,scrollTop:L}:{changed:!0,jump:0,scrollHeight:R,scrollTop:L}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),dt(E=>E.changed),Ge(E=>E.jump)),0);We(Ae(S,Ge(E=>E.atBottom)),a),We(Ae(a,kr(50)),u);const T=Me(jc);We(Ae(s,Ge(({scrollTop:E})=>E),fs(),cr((E,R)=>js(v)?{direction:E.direction,prevScrollTop:R}:{direction:R<E.prevScrollTop?au:jc,prevScrollTop:R},{direction:jc,prevScrollTop:0}),Ge(E=>E.direction)),T),We(Ae(s,kr(50),ar(R8)),T);const A=Me(0);return We(Ae(g,dt(E=>!E),ar(0)),A),We(Ae(i,kr(100),At(g),dt(([E,R])=>!!R),cr(([E,R],[L])=>[R,L],[0,0]),Ge(([E,R])=>R-E)),A),{atBottomState:S,atBottomStateChange:u,atBottomThreshold:h,atTopStateChange:d,atTopThreshold:m,isAtBottom:a,isAtTop:l,isScrolling:g,lastJumpDueToItemResize:x,scrollDirection:T,scrollVelocity:A}},ms(_n)),Xh="top",Wh="bottom",dE="none";function hE(n,e,t){return typeof n=="number"?t===au&&e===Xh||t===jc&&e===Wh?n:0:t===au?e===Xh?n.main:n.reverse:e===Wh?n.main:n.reverse}function fE(n,e){var t;return typeof n=="number"?n:(t=n[e])!=null?t:0}const $y=$t(([{deviation:n,fixedHeaderHeight:e,headerHeight:t,scrollTop:s,viewportHeight:i}])=>{const r=Ut(),a=Me(0),l=Me(0),u=Me(0),d=In(Ae(qs(ct(s),ct(i),ct(t),ct(r,iu),ct(u),ct(a),ct(e),ct(n),ct(l)),Ge(([h,m,g,[v,S],x,T,A,E,R])=>{const L=h-E,w=T+A,D=Math.max(g-L,0);let _=dE;const k=fE(R,Xh),N=fE(R,Wh);return v-=E,v+=g+A,S+=g+A,S-=E,v>h+w-k&&(_=au),S<h-D+m+N&&(_=jc),_!==dE?[Math.max(L-g-hE(x,Xh,_)-k,0),L-D-A+m+hE(x,Wh,_)+N]:null}),dt(h=>h!=null),fs(iu)),[0,0]);return{increaseViewportBy:l,listBoundary:r,overscan:u,topListHeight:a,visibleRange:d}},ms(_n),{singleton:!0});function L8(n,e,t){if(xf(e)){const s=fw(n,e);return[{index:$i(e.groupOffsetTree,s)[0],offset:0,size:0},{data:t?.[0],index:s,offset:0,size:0}]}return[{data:t?.[0],index:n,offset:0,size:0}]}const Tg={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function Rh(n,e,t,s,i,r){const{lastIndex:a,lastOffset:l,lastSize:u}=i;let d=0,h=0;if(n.length>0){d=n[0].offset;const x=n[n.length-1];h=x.offset+x.size}const m=t-a,g=l+m*u+(m-1)*s,v=d,S=g-h;return{bottom:h,firstItemIndex:r,items:mE(n,i,r),offsetBottom:S,offsetTop:d,top:v,topItems:mE(e,i,r),topListHeight:e.reduce((x,T)=>T.size+x,0),totalCount:t}}function vw(n,e,t,s,i,r){let a=0;if(t.groupIndices.length>0)for(const h of t.groupIndices){if(h-a>=n)break;a++}const l=n+a,u=Vy(e,l),d=Array.from({length:l}).map((h,m)=>({data:r[m+u],index:m+u,offset:0,size:0}));return Rh(d,[],l,i,t,s)}function mE(n,e,t){if(n.length===0)return[];if(!xf(e))return n.map(d=>({...d,index:d.index+t,originalIndex:d.index}));const s=n[0].index,i=n[n.length-1].index,r=[],a=vf(e.groupOffsetTree,s,i);let l,u=0;for(const d of n){(!l||l.end<d.index)&&(l=a.shift(),u=e.groupIndices.indexOf(l.start));let h;d.index===l.start?h={index:u,type:"group"}:h={groupIndex:u,index:d.index-(u+1)+t},r.push({...h,data:d.data,offset:d.offset,originalIndex:d.index,size:d.size})}return r}const oo=$t(([{data:n,firstItemIndex:e,gap:t,sizes:s,totalCount:i},r,{listBoundary:a,topListHeight:l,visibleRange:u},{initialTopMostItemIndex:d,scrolledToInitialItem:h},{topListHeight:m},g,{didMount:v},{recalcInProgress:S}])=>{const x=Me([]),T=Me(0),A=Ut();We(r.topItemsIndexes,x);const E=In(Ae(qs(v,S,ct(u,iu),ct(i),ct(s),ct(d),h,ct(x),ct(e),ct(t),n),dt(([D,_,,k,,,,,,,N])=>{const F=N&&N.length!==k;return D&&!_&&!F}),Ge(([,,[D,_],k,N,F,V,H,J,X,Q])=>{const j=N,{offsetTree:K,sizeTree:Y}=j,re=js(T);if(k===0)return{...Tg,totalCount:k};if(D===0&&_===0)return re===0?{...Tg,totalCount:k}:vw(re,F,N,J,X,Q||[]);if(ls(Y))return re>0?null:Rh(L8(Vy(F,k),j,Q),[],k,X,j,J);const B=[];if(H.length>0){const Te=H[0],pe=H[H.length-1];let Qe=0;for(const ce of vf(Y,Te,pe)){const Oe=ce.value,Ue=Math.max(ce.start,Te),Ze=Math.min(ce.end,pe);for(let nt=Ue;nt<=Ze;nt++)B.push({data:Q?.[nt],index:nt,offset:Qe,size:Oe}),Qe+=Oe}}if(!V)return Rh([],B,k,X,j,J);const M=H.length>0?H[H.length-1]+1:0,z=y8(K,D,_,M);if(z.length===0)return null;const G=k-1,de=yf([],Te=>{for(const pe of z){const Qe=pe.value;let ce=Qe.offset,Oe=pe.start;const Ue=Qe.size;if(Qe.offset<D){Oe+=Math.floor((D-Qe.offset+X)/(Ue+X));const nt=Oe-pe.start;ce+=nt*Ue+nt*X}Oe<M&&(ce+=(M-Oe)*Ue,Oe=M);const Ze=Math.min(pe.end,G);for(let nt=Oe;nt<=Ze&&!(ce>=_);nt++)Te.push({data:Q?.[nt],index:nt,offset:ce,size:Ue}),ce+=Ue+X}});return Rh(de,B,k,X,j,J)}),dt(D=>D!==null),fs()),Tg);We(Ae(n,dt(ky),Ge(D=>D?.length)),i),We(Ae(E,Ge(D=>D.topListHeight)),m),We(m,l),We(Ae(E,Ge(D=>[D.top,D.bottom])),a),We(Ae(E,Ge(D=>D.items)),A);const R=li(Ae(E,dt(({items:D})=>D.length>0),At(i,n),dt(([{items:D},_])=>D[D.length-1].originalIndex===_-1),Ge(([,D,_])=>[D-1,_]),fs(iu),Ge(([D])=>D))),L=li(Ae(E,kr(200),dt(({items:D,topItems:_})=>D.length>0&&D[0].originalIndex===_.length),Ge(({items:D})=>D[0].index),fs())),w=li(Ae(E,dt(({items:D})=>D.length>0),Ge(({items:D})=>{let _=0,k=D.length-1;for(;D[_].type==="group"&&_<k;)_++;for(;D[k].type==="group"&&k>_;)k--;return{endIndex:D[k].index,startIndex:D[_].index}}),fs(dw)));return{endReached:R,initialItemCount:T,itemsRendered:A,listState:E,rangeChanged:w,startReached:L,topItemsIndexes:x,...g}},ms(mr,pw,$y,bu,Su,Tu,Ra,Fy),{singleton:!0}),xw=$t(([{fixedFooterHeight:n,fixedHeaderHeight:e,footerHeight:t,headerHeight:s},{listState:i}])=>{const r=Ut(),a=In(Ae(qs(t,n,s,e,i),Ge(([l,u,d,h,m])=>l+u+d+h+m.offsetBottom+m.bottom)),0);return We(ct(a),r),{totalListHeight:a,totalListHeightChanged:r}},ms(_n,oo),{singleton:!0}),D8=$t(([{viewportHeight:n},{totalListHeight:e}])=>{const t=Me(!1),s=In(Ae(qs(t,n,e),dt(([i])=>i),Ge(([,i,r])=>Math.max(0,i-r)),kr(0),fs()),0);return{alignToBottom:t,paddingTopAddition:s}},ms(_n,xw),{singleton:!0}),Sw=$t(()=>({context:Me(null)})),O8=({itemBottom:n,itemTop:e,locationParams:{align:t,behavior:s,...i},viewportBottom:r,viewportTop:a})=>e<a?{...i,align:t??"start",behavior:s}:n>r?{...i,align:t??"end",behavior:s}:null,bw=$t(([{gap:n,sizes:e,totalCount:t},{fixedFooterHeight:s,fixedHeaderHeight:i,headerHeight:r,scrollingInProgress:a,scrollTop:l,viewportHeight:u},{scrollToIndex:d}])=>{const h=Ut();return We(Ae(h,At(e,u,t,r,i,s,l),At(n),Ge(([[m,g,v,S,x,T,A,E],R])=>{const{align:L,behavior:w,calculateViewLocation:D=O8,done:_,...k}=m,N=mw(m,g,S-1),F=ru(N,g.offsetTree,R)+x+T,V=F+$i(g.sizeTree,N)[1],H=E+T,J=E+v-A,X=D({itemBottom:V,itemTop:F,locationParams:{align:L,behavior:w,...k},viewportBottom:J,viewportTop:H});return X?_&&Bi(Ae(a,dt(Q=>!Q),so(js(a)?1:2)),_):_&&_(),X}),dt(m=>m!==null)),d),{scrollIntoView:h}},ms(mr,_n,Su,oo,Ia),{singleton:!0});function pE(n){return n?n==="smooth"?"smooth":"auto":!1}const _8=(n,e)=>typeof n=="function"?pE(n(e)):e&&pE(n),P8=$t(([{listRefresh:n,totalCount:e,fixedItemSize:t,data:s},{atBottomState:i,isAtBottom:r},{scrollToIndex:a},{scrolledToInitialItem:l},{didMount:u,propsReady:d},{log:h},{scrollingInProgress:m},{context:g},{scrollIntoView:v}])=>{const S=Me(!1),x=Ut();let T=null;function A(w){yt(a,{align:"end",behavior:w,index:"LAST"})}Kt(Ae(qs(Ae(ct(e),so(1)),u),At(ct(S),r,l,m),Ge(([[w,D],_,k,N,F])=>{let V=D&&N,H="auto";return V&&(H=_8(_,k||F),V=V&&!!H),{followOutputBehavior:H,shouldFollow:V,totalCount:w}}),dt(({shouldFollow:w})=>w)),({followOutputBehavior:w,totalCount:D})=>{T&&(T(),T=null),js(t)?requestAnimationFrame(()=>{js(h)("following output to ",{totalCount:D},Hn.DEBUG),A(w)}):T=Bi(n,()=>{js(h)("following output to ",{totalCount:D},Hn.DEBUG),A(w),T=null})});function E(w){const D=Bi(i,_=>{w&&!_.atBottom&&_.notAtBottomBecause==="SIZE_INCREASED"&&!T&&(js(h)("scrolling to bottom due to increased size",{},Hn.DEBUG),A("auto"))});setTimeout(D,100)}Kt(Ae(qs(ct(S),e,d),dt(([w,,D])=>w&&D),cr(({value:w},[,D])=>({refreshed:w===D,value:D}),{refreshed:!1,value:0}),dt(({refreshed:w})=>w),At(S,e)),([,w])=>{js(l)&&E(w!==!1)}),Kt(x,()=>{E(js(S)!==!1)}),Kt(qs(ct(S),i),([w,D])=>{w&&!D.atBottom&&D.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&A("auto")});const R=Me(null),L=Ut();return We(I0(Ae(ct(s),Ge(w=>{var D;return(D=w?.length)!=null?D:0})),Ae(ct(e))),L),Kt(Ae(qs(Ae(L,so(1)),u),At(ct(R),l,m,g),Ge(([[w,D],_,k,N,F])=>D&&k&&_?.({context:F,totalCount:w,scrollingInProgress:N})),dt(w=>!!w),kr(0)),w=>{T&&(T(),T=null),js(t)?requestAnimationFrame(()=>{js(h)("scrolling into view",{}),yt(v,w)}):T=Bi(n,()=>{js(h)("scrolling into view",{}),yt(v,w),T=null})}),{autoscrollToBottom:x,followOutput:S,scrollIntoViewOnChange:R}},ms(mr,Tu,Su,bu,Ra,Ia,_n,Sw,bw)),N8=$t(([{data:n,firstItemIndex:e,gap:t,sizes:s},{initialTopMostItemIndex:i},{initialItemCount:r,listState:a},{didMount:l}])=>(We(Ae(l,At(r),dt(([,u])=>u!==0),At(i,s,e,t,n),Ge(([[,u],d,h,m,g,v=[]])=>vw(u,d,h,m,g,v))),a),{}),ms(mr,bu,oo,Ra),{singleton:!0}),k8=$t(([{didMount:n},{scrollTo:e},{listState:t}])=>{const s=Me(0);return Kt(Ae(n,At(s),dt(([,i])=>i!==0),Ge(([,i])=>({top:i}))),i=>{Bi(Ae(t,so(1),dt(r=>r.items.length>1)),()=>{requestAnimationFrame(()=>{yt(e,i)})})}),{initialScrollTop:s}},ms(Ra,_n,oo),{singleton:!0}),Tw=$t(([{scrollVelocity:n}])=>{const e=Me(!1),t=Ut(),s=Me(!1);return We(Ae(n,At(s,e,t),dt(([i,r])=>!!r),Ge(([i,r,a,l])=>{const{enter:u,exit:d}=r;if(a){if(d(i,l))return!1}else if(u(i,l))return!0;return a}),fs()),e),Kt(Ae(qs(e,n,t),At(s)),([[i,r,a],l])=>{i&&l&&l.change&&l.change(r,a)}),{isSeeking:e,scrollSeekConfiguration:s,scrollSeekRangeChanged:t,scrollVelocity:n}},ms(Tu),{singleton:!0}),Gy=$t(([{scrollContainerState:n,scrollTo:e}])=>{const t=Ut(),s=Ut(),i=Ut(),r=Me(!1),a=Me(void 0);return We(Ae(qs(t,s),Ge(([{scrollHeight:l,scrollTop:u,viewportHeight:d},{offsetTop:h}])=>({scrollHeight:l,scrollTop:Math.max(0,u-h),viewportHeight:d}))),n),We(Ae(e,At(s),Ge(([l,{offsetTop:u}])=>({...l,top:l.top+u}))),i),{customScrollParent:a,useWindowScroll:r,windowScrollContainerState:t,windowScrollTo:i,windowViewportRect:s}},ms(_n)),M8=$t(([{sizeRanges:n,sizes:e},{headerHeight:t,scrollTop:s},{initialTopMostItemIndex:i},{didMount:r},{useWindowScroll:a,windowScrollContainerState:l,windowViewportRect:u}])=>{const d=Ut(),h=Me(void 0),m=Me(null),g=Me(null);return We(l,m),We(u,g),Kt(Ae(d,At(e,s,a,m,g,t)),([v,S,x,T,A,E,R])=>{const L=x8(S.sizeTree);T&&A!==null&&E!==null&&(x=A.scrollTop-E.offsetTop),x-=R,v({ranges:L,scrollTop:x})}),We(Ae(h,dt(ky),Ge(U8)),i),We(Ae(r,At(h),dt(([,v])=>v!==void 0),fs(),Ge(([,v])=>v.ranges)),n),{getState:d,restoreStateFrom:h}},ms(mr,_n,bu,Ra,Gy));function U8(n){return{align:"start",index:0,offset:n.scrollTop}}const F8=$t(([{topItemsIndexes:n}])=>{const e=Me(0);return We(Ae(e,dt(t=>t>=0),Ge(t=>Array.from({length:t}).map((s,i)=>i))),n),{topItemCount:e}},ms(oo));function Ew(n){let e=!1,t;return()=>(e||(e=!0,t=n()),t)}const B8=Ew(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),j8=$t(([{deviation:n,scrollBy:e,scrollingInProgress:t,scrollTop:s},{isAtBottom:i,isScrolling:r,lastJumpDueToItemResize:a,scrollDirection:l},{listState:u},{beforeUnshiftWith:d,gap:h,shiftWithOffset:m,sizes:g},{log:v},{recalcInProgress:S}])=>{const x=li(Ae(u,At(a),cr(([,A,E,R],[{bottom:L,items:w,offsetBottom:D,totalCount:_},k])=>{const N=L+D;let F=0;return E===_&&A.length>0&&w.length>0&&(w[0].originalIndex===0&&A[0].originalIndex===0||(F=N-R,F!==0&&(F+=k))),[F,w,_,N]},[0,[],0,0]),dt(([A])=>A!==0),At(s,l,t,i,v,S),dt(([,A,E,R,,,L])=>!L&&!R&&A!==0&&E===au),Ge(([[A],,,,,E])=>(E("Upward scrolling compensation",{amount:A},Hn.DEBUG),A))));function T(A){A>0?(yt(e,{behavior:"auto",top:-A}),yt(n,0)):(yt(n,0),yt(e,{behavior:"auto",top:-A}))}return Kt(Ae(x,At(n,r)),([A,E,R])=>{R&&B8()?yt(n,E-A):T(-A)}),Kt(Ae(qs(In(r,!1),n,S),dt(([A,E,R])=>!A&&!R&&E!==0),Ge(([A,E])=>E),kr(1)),T),We(Ae(m,Ge(A=>({top:-A}))),e),Kt(Ae(d,At(g,h),Ge(([A,{groupIndices:E,lastSize:R,sizeTree:L},w])=>{function D(_){return _*(R+w)}if(E.length===0)return D(A);{let _=0;const k=nu(L,0);let N=0,F=0;for(;N<A;){N++,_+=k;let V=E.length===F+1?1/0:E[F+1]-E[F]-1;N+V>A&&(_-=k,V=A-N+1),N+=V,_+=D(V),F++}return _}})),A=>{yt(n,A),requestAnimationFrame(()=>{yt(e,{top:A}),requestAnimationFrame(()=>{yt(n,0),yt(S,!1)})})}),{deviation:n}},ms(_n,Tu,oo,mr,Ia,Fy)),V8=$t(([n,e,t,s,i,r,a,l,u,d,h])=>({...n,...e,...t,...s,...i,...r,...a,...l,...u,...d,...h}),ms($y,N8,Ra,Tw,xw,k8,D8,Gy,bw,Ia,Sw)),Aw=$t(([{data:n,defaultItemSize:e,firstItemIndex:t,fixedItemSize:s,gap:i,groupIndices:r,itemSize:a,sizeRanges:l,sizes:u,statefulTotalCount:d,totalCount:h,trackItemSizes:m},{initialItemFinalLocationReached:g,initialTopMostItemIndex:v,scrolledToInitialItem:S},x,T,A,{listState:E,topItemsIndexes:R,...L},{scrollToIndex:w},D,{topItemCount:_},{groupCounts:k},N])=>(We(L.rangeChanged,N.scrollSeekRangeChanged),We(Ae(N.windowViewportRect,Ge(F=>F.visibleHeight)),x.viewportHeight),{data:n,defaultItemHeight:e,firstItemIndex:t,fixedItemHeight:s,gap:i,groupCounts:k,initialItemFinalLocationReached:g,initialTopMostItemIndex:v,scrolledToInitialItem:S,sizeRanges:l,topItemCount:_,topItemsIndexes:R,totalCount:h,...A,groupIndices:r,itemSize:a,listState:E,scrollToIndex:w,statefulTotalCount:d,trackItemSizes:m,...L,...N,...x,sizes:u,...T}),ms(mr,bu,_n,M8,P8,oo,Su,j8,F8,pw,V8));function $8(n,e){const t={},s={};let i=0;const r=n.length;for(;i<r;)s[n[i]]=1,i+=1;for(const a in e)Object.hasOwn(s,a)||(t[a]=e[a]);return t}const oh=typeof document<"u"?Se.useLayoutEffect:Se.useEffect;function Iw(n,e,t){const s=Object.keys(e.required||{}),i=Object.keys(e.optional||{}),r=Object.keys(e.methods||{}),a=Object.keys(e.events||{}),l=Se.createContext({});function u(T,A){T.propsReady&&yt(T.propsReady,!1);for(const E of s){const R=T[e.required[E]];yt(R,A[E])}for(const E of i)if(E in A){const R=T[e.optional[E]];yt(R,A[E])}T.propsReady&&yt(T.propsReady,!0)}function d(T){return r.reduce((A,E)=>(A[E]=R=>{const L=T[e.methods[E]];yt(L,R)},A),{})}function h(T){return a.reduce((A,E)=>(A[E]=i8(T[e.events[E]]),A),{})}const m=Se.forwardRef((T,A)=>{const{children:E,...R}=T,[L]=Se.useState(()=>yf(a8(n),_=>{u(_,R)})),[w]=Se.useState(aE(h,L));oh(()=>{for(const _ of a)_ in R&&Kt(w[_],R[_]);return()=>{Object.values(w).map(My)}},[R,w,L]),oh(()=>{u(L,R)}),Se.useImperativeHandle(A,rE(d(L)));const D=t;return y.jsx(l.Provider,{value:L,children:t?y.jsx(D,{...$8([...s,...i,...a],R),children:E}):E})}),g=T=>{const A=Se.useContext(l);return Se.useCallback(E=>{yt(A[T],E)},[A,T])},v=T=>{const A=Se.useContext(l)[T],E=Se.useCallback(R=>Kt(A,R),[A]);return Se.useSyncExternalStore(E,()=>js(A),()=>js(A))},S=T=>{const A=Se.useContext(l)[T],[E,R]=Se.useState(aE(js,A));return oh(()=>Kt(A,L=>{L!==E&&R(rE(L))}),[A,E]),E},x=Se.version.startsWith("18")?v:S;return{Component:m,useEmitter:(T,A)=>{const E=Se.useContext(l)[T];oh(()=>Kt(E,A),[A,E])},useEmitterValue:x,usePublisher:g}}const Rw=Se.createContext(void 0),ww=Se.createContext(void 0),Cw=typeof document<"u"?Se.useLayoutEffect:Se.useEffect;function Eg(n){return"self"in n}function G8(n){return"body"in n}function Lw(n,e,t,s=wl,i,r){const a=Se.useRef(null),l=Se.useRef(null),u=Se.useRef(null),d=Se.useCallback(g=>{let v,S,x;const T=g.target;if(G8(T)||Eg(T)){const E=Eg(T)?T:T.defaultView;x=r?E.scrollX:E.scrollY,v=r?E.document.documentElement.scrollWidth:E.document.documentElement.scrollHeight,S=r?E.innerWidth:E.innerHeight}else x=r?T.scrollLeft:T.scrollTop,v=r?T.scrollWidth:T.scrollHeight,S=r?T.offsetWidth:T.offsetHeight;const A=()=>{n({scrollHeight:v,scrollTop:Math.max(x,0),viewportHeight:S})};g.suppressFlushSync?A():g_.flushSync(A),l.current!==null&&(x===l.current||x<=0||x===v-S)&&(l.current=null,e(!0),u.current&&(clearTimeout(u.current),u.current=null))},[n,e,r]);Se.useEffect(()=>{const g=i||a.current;return s(i||a.current),d({suppressFlushSync:!0,target:g}),g.addEventListener("scroll",d,{passive:!0}),()=>{s(null),g.removeEventListener("scroll",d)}},[a,d,t,s,i]);function h(g){const v=a.current;if(!v||(r?"offsetWidth"in v&&v.offsetWidth===0:"offsetHeight"in v&&v.offsetHeight===0))return;const S=g.behavior==="smooth";let x,T,A;Eg(v)?(T=Math.max(Ta(v.document.documentElement,r?"width":"height"),r?v.document.documentElement.scrollWidth:v.document.documentElement.scrollHeight),x=r?v.innerWidth:v.innerHeight,A=r?window.scrollX:window.scrollY):(T=v[r?"scrollWidth":"scrollHeight"],x=Ta(v,r?"width":"height"),A=v[r?"scrollLeft":"scrollTop"]);const E=T-x;if(g.top=Math.ceil(Math.max(Math.min(E,g.top),0)),yw(x,T)||g.top===A){n({scrollHeight:T,scrollTop:A,viewportHeight:x}),S&&e(!0);return}S?(l.current=g.top,u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{u.current=null,l.current=null,e(!0)},1e3)):l.current=null,r&&(g={behavior:g.behavior,left:g.top}),v.scrollTo(g)}function m(g){r&&(g={behavior:g.behavior,left:g.top}),a.current.scrollBy(g)}return{scrollByCallback:m,scrollerRef:a,scrollToCallback:h}}const Ag="-webkit-sticky",gE="sticky",Hy=Ew(()=>{if(typeof document>"u")return gE;const n=document.createElement("div");return n.style.position=Ag,n.style.position===Ag?Ag:gE});function zy(n){return n}const H8=$t(()=>{const n=Me(l=>`Item ${l}`),e=Me(l=>`Group ${l}`),t=Me({}),s=Me(zy),i=Me("div"),r=Me(wl),a=(l,u=null)=>In(Ae(t,Ge(d=>d[l]),fs()),u);return{components:t,computeItemKey:s,EmptyPlaceholder:a("EmptyPlaceholder"),FooterComponent:a("Footer"),GroupComponent:a("Group","div"),groupContent:e,HeaderComponent:a("Header"),HeaderFooterTag:i,ItemComponent:a("Item","div"),itemContent:n,ListComponent:a("List","div"),ScrollerComponent:a("Scroller","div"),scrollerRef:r,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TopItemListComponent:a("TopItemList")}}),z8=$t(([n,e])=>({...n,...e}),ms(Aw,H8)),K8=({height:n})=>y.jsx("div",{style:{height:n}}),Y8={overflowAnchor:"none",position:Hy(),zIndex:1},Dw={overflowAnchor:"none"},q8={...Dw,display:"inline-block",height:"100%"},yE=Se.memo(function({showTopList:n=!1}){const e=mt("listState"),t=Ii("sizeRanges"),s=mt("useWindowScroll"),i=mt("customScrollParent"),r=Ii("windowScrollContainerState"),a=Ii("scrollContainerState"),l=i||s?r:a,u=mt("itemContent"),d=mt("context"),h=mt("groupContent"),m=mt("trackItemSizes"),g=mt("itemSize"),v=mt("log"),S=Ii("gap"),x=mt("horizontalDirection"),{callbackRef:T}=c8(t,g,m,n?wl:l,v,S,i,x,mt("skipAnimationFrameInResizeObserver")),[A,E]=Se.useState(0);Ky("deviation",X=>{A!==X&&E(X)});const R=mt("EmptyPlaceholder"),L=mt("ScrollSeekPlaceholder")||K8,w=mt("ListComponent"),D=mt("ItemComponent"),_=mt("GroupComponent"),k=mt("computeItemKey"),N=mt("isSeeking"),F=mt("groupIndices").length>0,V=mt("alignToBottom"),H=mt("initialItemFinalLocationReached"),J=n?{}:{boxSizing:"border-box",...x?{display:"inline-block",height:"100%",marginLeft:A!==0?A:V?"auto":0,paddingLeft:e.offsetTop,paddingRight:e.offsetBottom,whiteSpace:"nowrap"}:{marginTop:A!==0?A:V?"auto":0,paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},...H?{}:{visibility:"hidden"}};return!n&&e.totalCount===0&&R?y.jsx(R,{...vn(R,d)}):y.jsx(w,{...vn(w,d),"data-testid":n?"virtuoso-top-item-list":"virtuoso-item-list",ref:T,style:J,children:(n?e.topItems:e.items).map(X=>{const Q=X.originalIndex,j=k(Q+e.firstItemIndex,X.data,d);return N?C.createElement(L,{...vn(L,d),height:X.size,index:X.index,key:j,type:X.type||"item",...X.type==="group"?{}:{groupIndex:X.groupIndex}}):X.type==="group"?C.createElement(_,{...vn(_,d),"data-index":Q,"data-item-index":X.index,"data-known-size":X.size,key:j,style:Y8},h(X.index,d)):C.createElement(D,{...vn(D,d),...Z8(D,X.data),"data-index":Q,"data-item-group-index":X.groupIndex,"data-item-index":X.index,"data-known-size":X.size,key:j,style:x?q8:Dw},F?u(X.index,X.groupIndex,X.data,d):u(X.index,X.data,d))})})}),Q8={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},X8={outline:"none",overflowX:"auto",position:"relative"},Sf=n=>({height:"100%",position:"absolute",top:0,width:"100%",...n?{display:"flex",flexDirection:"column"}:{}}),W8={position:Hy(),top:0,width:"100%",zIndex:1};function vn(n,e){if(typeof n!="string")return{context:e}}function Z8(n,e){return{item:typeof n=="string"?void 0:e}}const J8=Se.memo(function(){const n=mt("HeaderComponent"),e=Ii("headerHeight"),t=mt("HeaderFooterTag"),s=ao(Se.useMemo(()=>r=>{e(Ta(r,"height"))},[e]),!0,mt("skipAnimationFrameInResizeObserver")),i=mt("context");return n?y.jsx(t,{ref:s,children:y.jsx(n,{...vn(n,i)})}):null}),e5=Se.memo(function(){const n=mt("FooterComponent"),e=Ii("footerHeight"),t=mt("HeaderFooterTag"),s=ao(Se.useMemo(()=>r=>{e(Ta(r,"height"))},[e]),!0,mt("skipAnimationFrameInResizeObserver")),i=mt("context");return n?y.jsx(t,{ref:s,children:y.jsx(n,{...vn(n,i)})}):null});function Ow({useEmitter:n,useEmitterValue:e,usePublisher:t}){return Se.memo(function({children:s,style:i,...r}){const a=t("scrollContainerState"),l=e("ScrollerComponent"),u=t("smoothScrollTargetReached"),d=e("scrollerRef"),h=e("context"),m=e("horizontalDirection")||!1,{scrollByCallback:g,scrollerRef:v,scrollToCallback:S}=Lw(a,u,l,d,void 0,m);return n("scrollTo",S),n("scrollBy",g),y.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:v,style:{...m?X8:Q8,...i},tabIndex:0,...r,...vn(l,h),children:s})})}function _w({useEmitter:n,useEmitterValue:e,usePublisher:t}){return Se.memo(function({children:s,style:i,...r}){const a=t("windowScrollContainerState"),l=e("ScrollerComponent"),u=t("smoothScrollTargetReached"),d=e("totalListHeight"),h=e("deviation"),m=e("customScrollParent"),g=e("context"),v=Se.useRef(null),S=e("scrollerRef"),{scrollByCallback:x,scrollerRef:T,scrollToCallback:A}=Lw(a,u,l,S,m);return Cw(()=>{var E;return T.current=m||((E=v.current)==null?void 0:E.ownerDocument.defaultView),()=>{T.current=null}},[T,m]),n("windowScrollTo",A),n("scrollBy",x),y.jsx(l,{ref:v,"data-virtuoso-scroller":!0,style:{position:"relative",...i,...d!==0?{height:d+h}:{}},...r,...vn(l,g),children:s})})}const t5=({children:n})=>{const e=Se.useContext(Rw),t=Ii("viewportHeight"),s=Ii("fixedItemHeight"),i=mt("alignToBottom"),r=mt("horizontalDirection"),a=Se.useMemo(()=>nw(t,u=>Ta(u,r?"width":"height")),[t,r]),l=ao(a,!0,mt("skipAnimationFrameInResizeObserver"));return Se.useEffect(()=>{e&&(t(e.viewportHeight),s(e.itemHeight))},[e,t,s]),y.jsx("div",{"data-viewport-type":"element",ref:l,style:Sf(i),children:n})},s5=({children:n})=>{const e=Se.useContext(Rw),t=Ii("windowViewportRect"),s=Ii("fixedItemHeight"),i=mt("customScrollParent"),r=rw(t,i,mt("skipAnimationFrameInResizeObserver")),a=mt("alignToBottom");return Se.useEffect(()=>{e&&(s(e.itemHeight),t({offsetTop:0,visibleHeight:e.viewportHeight,visibleWidth:100}))},[e,t,s]),y.jsx("div",{"data-viewport-type":"window",ref:r,style:Sf(a),children:n})},n5=({children:n})=>{const e=mt("TopItemListComponent")||"div",t=mt("headerHeight"),s={...W8,marginTop:`${t}px`},i=mt("context");return y.jsx(e,{style:s,...vn(e,i),children:n})},i5=Se.memo(function(n){const e=mt("useWindowScroll"),t=mt("topItemsIndexes").length>0,s=mt("customScrollParent"),i=mt("context"),r=s||e?o5:a5,a=s||e?s5:t5;return y.jsxs(r,{...n,...vn(r,i),children:[t&&y.jsx(n5,{children:y.jsx(yE,{showTopList:!0})}),y.jsxs(a,{children:[y.jsx(J8,{}),y.jsx(yE,{}),y.jsx(e5,{})]})]})}),{Component:r5,useEmitter:Ky,useEmitterValue:mt,usePublisher:Ii}=Iw(z8,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",scrollIntoViewOnChange:"scrollIntoViewOnChange",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},i5),a5=Ow({useEmitter:Ky,useEmitterValue:mt,usePublisher:Ii}),o5=_w({useEmitter:Ky,useEmitterValue:mt,usePublisher:Ii}),l5=r5,c5=$t(()=>{const n=Me(d=>y.jsxs("td",{children:["Item $",d]})),e=Me(null),t=Me(d=>y.jsxs("td",{colSpan:1e3,children:["Group ",d]})),s=Me(null),i=Me(null),r=Me({}),a=Me(zy),l=Me(wl),u=(d,h=null)=>In(Ae(r,Ge(m=>m[d]),fs()),h);return{components:r,computeItemKey:a,context:e,EmptyPlaceholder:u("EmptyPlaceholder"),FillerRow:u("FillerRow"),fixedFooterContent:i,fixedHeaderContent:s,itemContent:n,groupContent:t,ScrollerComponent:u("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:u("ScrollSeekPlaceholder"),TableBodyComponent:u("TableBody","tbody"),TableComponent:u("Table","table"),TableFooterComponent:u("TableFoot","tfoot"),TableHeadComponent:u("TableHead","thead"),TableRowComponent:u("TableRow","tr"),GroupComponent:u("Group","tr")}});ms(Aw,c5);Hy();const vE={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},u5={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:xE,floor:Zh,max:Vc,min:Ig,round:SE}=Math;function bE(n,e,t){return Array.from({length:e-n+1}).map((s,i)=>({data:t===null?null:t[i+n],index:i+n}))}function d5(n){return{...u5,items:n}}function lh(n,e){return n&&n.width===e.width&&n.height===e.height}function h5(n,e){return n&&n.column===e.column&&n.row===e.row}const f5=$t(([{increaseViewportBy:n,listBoundary:e,overscan:t,visibleRange:s},{footerHeight:i,headerHeight:r,scrollBy:a,scrollContainerState:l,scrollTo:u,scrollTop:d,smoothScrollTargetReached:h,viewportHeight:m},g,v,{didMount:S,propsReady:x},{customScrollParent:T,useWindowScroll:A,windowScrollContainerState:E,windowScrollTo:R,windowViewportRect:L},w])=>{const D=Me(0),_=Me(0),k=Me(vE),N=Me({height:0,width:0}),F=Me({height:0,width:0}),V=Ut(),H=Ut(),J=Me(0),X=Me(null),Q=Me({column:0,row:0}),j=Ut(),K=Ut(),Y=Me(!1),re=Me(0),B=Me(!0),M=Me(!1),z=Me(!1);Kt(Ae(S,At(re),dt(([ce,Oe])=>!!Oe)),()=>{yt(B,!1)}),Kt(Ae(qs(S,B,F,N,re,M),dt(([ce,Oe,Ue,Ze,,nt])=>ce&&!Oe&&Ue.height!==0&&Ze.height!==0&&!nt)),([,,,,ce])=>{yt(M,!0),jy(1,()=>{yt(V,ce)}),Bi(Ae(d),()=>{yt(e,[0,0]),yt(B,!0)})}),We(Ae(K,dt(ce=>ce!=null&&ce.scrollTop>0),ar(0)),_),Kt(Ae(S,At(K),dt(([,ce])=>ce!=null)),([,ce])=>{ce&&(yt(N,ce.viewport),yt(F,ce.item),yt(Q,ce.gap),ce.scrollTop>0&&(yt(Y,!0),Bi(Ae(d,so(1)),Oe=>{yt(Y,!1)}),yt(u,{top:ce.scrollTop})))}),We(Ae(N,Ge(({height:ce})=>ce)),m),We(Ae(qs(ct(N,lh),ct(F,lh),ct(Q,(ce,Oe)=>ce&&ce.column===Oe.column&&ce.row===Oe.row),ct(d)),Ge(([ce,Oe,Ue,Ze])=>({gap:Ue,item:Oe,scrollTop:Ze,viewport:ce}))),j),We(Ae(qs(ct(D),s,ct(Q,h5),ct(F,lh),ct(N,lh),ct(X),ct(_),ct(Y),ct(B),ct(re)),dt(([,,,,,,,ce])=>!ce),Ge(([ce,[Oe,Ue],Ze,nt,Dt,Nt,Ot,,ke,Je])=>{const{column:ot,row:kt}=Ze,{height:vt,width:fe}=nt,{width:ze}=Dt;if(Ot===0&&(ce===0||ze===0))return vE;if(fe===0){const Be=Vy(Je,ce),ht=Be+Math.max(Ot-1,0);return d5(bE(Be,ht,Nt))}const Ve=Pw(ze,fe,ot);let Fe,et;ke?Oe===0&&Ue===0&&Ot>0?(Fe=0,et=Ot-1):(Fe=Ve*Zh((Oe+kt)/(vt+kt)),et=Ve*xE((Ue+kt)/(vt+kt))-1,et=Ig(ce-1,Vc(et,Ve-1)),Fe=Ig(et,Vc(0,Fe))):(Fe=0,et=-1);const W=bE(Fe,et,Nt),{bottom:se,top:me}=TE(Dt,Ze,nt,W),he=xE(ce/Ve),Ke=he*vt+(he-1)*kt-se;return{bottom:se,itemHeight:vt,items:W,itemWidth:fe,offsetBottom:Ke,offsetTop:me,top:me}})),k),We(Ae(X,dt(ce=>ce!==null),Ge(ce=>ce.length)),D),We(Ae(qs(N,F,k,Q),dt(([ce,Oe,{items:Ue}])=>Ue.length>0&&Oe.height!==0&&ce.height!==0),Ge(([ce,Oe,{items:Ue},Ze])=>{const{bottom:nt,top:Dt}=TE(ce,Ze,Oe,Ue);return[Dt,nt]}),fs(iu)),e);const G=Me(!1);We(Ae(d,At(G),Ge(([ce,Oe])=>Oe||ce!==0)),G);const de=li(Ae(qs(k,D),dt(([{items:ce}])=>ce.length>0),At(G),dt(([[ce,Oe],Ue])=>{const Ze=ce.items[ce.items.length-1].index===Oe-1;return(Ue||ce.bottom>0&&ce.itemHeight>0&&ce.offsetBottom===0&&ce.items.length===Oe)&&Ze}),Ge(([[,ce]])=>ce-1),fs())),Te=li(Ae(ct(k),dt(({items:ce})=>ce.length>0&&ce[0].index===0),ar(0),fs())),pe=li(Ae(ct(k),At(Y),dt(([{items:ce},Oe])=>ce.length>0&&!Oe),Ge(([{items:ce}])=>({endIndex:ce[ce.length-1].index,startIndex:ce[0].index})),fs(dw),kr(0)));We(pe,v.scrollSeekRangeChanged),We(Ae(V,At(N,F,D,Q),Ge(([ce,Oe,Ue,Ze,nt])=>{const Dt=gw(ce),{align:Nt,behavior:Ot,offset:ke}=Dt;let Je=Dt.index;Je==="LAST"&&(Je=Ze-1),Je=Vc(0,Je,Ig(Ze-1,Je));let ot=D0(Oe,nt,Ue,Je);return Nt==="end"?ot=SE(ot-Oe.height+Ue.height):Nt==="center"&&(ot=SE(ot-Oe.height/2+Ue.height/2)),ke&&(ot+=ke),{behavior:Ot,top:ot}})),u);const Qe=In(Ae(k,Ge(ce=>ce.offsetBottom+ce.bottom)),0);return We(Ae(L,Ge(ce=>({height:ce.visibleHeight,width:ce.visibleWidth}))),N),{customScrollParent:T,data:X,deviation:J,footerHeight:i,gap:Q,headerHeight:r,increaseViewportBy:n,initialItemCount:_,itemDimensions:F,overscan:t,restoreStateFrom:K,scrollBy:a,scrollContainerState:l,scrollHeight:H,scrollTo:u,scrollToIndex:V,scrollTop:d,smoothScrollTargetReached:h,totalCount:D,useWindowScroll:A,viewportDimensions:N,windowScrollContainerState:E,windowScrollTo:R,windowViewportRect:L,...v,gridState:k,horizontalDirection:z,initialTopMostItemIndex:re,totalListHeight:Qe,...g,endReached:de,propsReady:x,rangeChanged:pe,startReached:Te,stateChanged:j,stateRestoreInProgress:Y,...w}},ms($y,_n,Tu,Tw,Ra,Gy,Ia));function Pw(n,e,t){return Vc(1,Zh((n+t)/(Zh(e)+t)))}function TE(n,e,t,s){const{height:i}=t;if(i===void 0||s.length===0)return{bottom:0,top:0};const r=D0(n,e,t,s[0].index);return{bottom:D0(n,e,t,s[s.length-1].index)+i,top:r}}function D0(n,e,t,s){const i=Pw(n.width,t.width,e.column),r=Zh(s/i),a=r*t.height+Vc(0,r-1)*e.row;return a>0?a+e.row:a}const m5=$t(()=>{const n=Me(m=>`Item ${m}`),e=Me({}),t=Me(null),s=Me("virtuoso-grid-item"),i=Me("virtuoso-grid-list"),r=Me(zy),a=Me("div"),l=Me(wl),u=(m,g=null)=>In(Ae(e,Ge(v=>v[m]),fs()),g),d=Me(!1),h=Me(!1);return We(ct(h),d),{components:e,computeItemKey:r,context:t,FooterComponent:u("Footer"),HeaderComponent:u("Header"),headerFooterTag:a,itemClassName:s,ItemComponent:u("Item","div"),itemContent:n,listClassName:i,ListComponent:u("List","div"),readyStateChanged:d,reportReadyState:h,ScrollerComponent:u("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:u("ScrollSeekPlaceholder","div")}}),p5=$t(([n,e])=>({...n,...e}),ms(f5,m5)),g5=Se.memo(function(){const n=vs("gridState"),e=vs("listClassName"),t=vs("itemClassName"),s=vs("itemContent"),i=vs("computeItemKey"),r=vs("isSeeking"),a=Ri("scrollHeight"),l=vs("ItemComponent"),u=vs("ListComponent"),d=vs("ScrollSeekPlaceholder"),h=vs("context"),m=Ri("itemDimensions"),g=Ri("gap"),v=vs("log"),S=vs("stateRestoreInProgress"),x=Ri("reportReadyState"),T=ao(Se.useMemo(()=>A=>{const E=A.parentElement.parentElement.scrollHeight;a(E);const R=A.firstChild;if(R){const{height:L,width:w}=R.getBoundingClientRect();m({height:L,width:w})}g({column:EE("column-gap",getComputedStyle(A).columnGap,v),row:EE("row-gap",getComputedStyle(A).rowGap,v)})},[a,m,g,v]),!0,!1);return Cw(()=>{n.itemHeight>0&&n.itemWidth>0&&x(!0)},[n]),S?null:y.jsx(u,{className:e,ref:T,...vn(u,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:n.offsetBottom,paddingTop:n.offsetTop},children:n.items.map(A=>{const E=i(A.index,A.data,h);return r?y.jsx(d,{...vn(d,h),height:n.itemHeight,index:A.index,width:n.itemWidth},E):C.createElement(l,{...vn(l,h),className:t,"data-index":A.index,key:E},s(A.index,A.data,h))})})}),y5=Se.memo(function(){const n=vs("HeaderComponent"),e=Ri("headerHeight"),t=vs("headerFooterTag"),s=ao(Se.useMemo(()=>r=>{e(Ta(r,"height"))},[e]),!0,!1),i=vs("context");return n?y.jsx(t,{ref:s,children:y.jsx(n,{...vn(n,i)})}):null}),v5=Se.memo(function(){const n=vs("FooterComponent"),e=Ri("footerHeight"),t=vs("headerFooterTag"),s=ao(Se.useMemo(()=>r=>{e(Ta(r,"height"))},[e]),!0,!1),i=vs("context");return n?y.jsx(t,{ref:s,children:y.jsx(n,{...vn(n,i)})}):null}),x5=({children:n})=>{const e=Se.useContext(ww),t=Ri("itemDimensions"),s=Ri("viewportDimensions"),i=ao(Se.useMemo(()=>r=>{s(r.getBoundingClientRect())},[s]),!0,!1);return Se.useEffect(()=>{e&&(s({height:e.viewportHeight,width:e.viewportWidth}),t({height:e.itemHeight,width:e.itemWidth}))},[e,s,t]),y.jsx("div",{ref:i,style:Sf(!1),children:n})},S5=({children:n})=>{const e=Se.useContext(ww),t=Ri("windowViewportRect"),s=Ri("itemDimensions"),i=vs("customScrollParent"),r=rw(t,i,!1);return Se.useEffect(()=>{e&&(s({height:e.itemHeight,width:e.itemWidth}),t({offsetTop:0,visibleHeight:e.viewportHeight,visibleWidth:e.viewportWidth}))},[e,t,s]),y.jsx("div",{ref:r,style:Sf(!1),children:n})},b5=Se.memo(function({...n}){const e=vs("useWindowScroll"),t=vs("customScrollParent"),s=t||e?E5:T5,i=t||e?S5:x5,r=vs("context");return y.jsx(s,{...n,...vn(s,r),children:y.jsxs(i,{children:[y.jsx(y5,{}),y.jsx(g5,{}),y.jsx(v5,{})]})})}),{useEmitter:Nw,useEmitterValue:vs,usePublisher:Ri}=Iw(p5,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},b5),T5=Ow({useEmitter:Nw,useEmitterValue:vs,usePublisher:Ri}),E5=_w({useEmitter:Nw,useEmitterValue:vs,usePublisher:Ri});function EE(n,e,t){return e!=="normal"&&!(e!=null&&e.endsWith("px"))&&t(`${n} was not resolved to pixel value correctly`,e,Hn.WARN),e==="normal"?0:parseInt(e??"0",10)}const AE=new Map,O0=n=>{const e=C.useRef(null),t=C.useRef(null),[s,i]=C.useState(0);C.useEffect(()=>{i(t.current?.getBoundingClientRect().top||0)},[t]),C.useEffect(()=>{const a=()=>{const l=history.state?.idx;l!==void 0&&AE.set(l,window.scrollY-s)};return window.addEventListener("scrollend",a,{passive:!0}),()=>window.removeEventListener("scrollend",a)},[s]);const r=AE.get(history.state?.idx);return y.jsx("div",{ref:t,children:y.jsx(l5,{...n,ref:e,initialScrollTop:r||0,useWindowScroll:!0})})},ks=({items:n=[],infiniteData:e={pageParams:[],pages:[]},indexOffset:t=0,isLoading:s,type:i,title:r,disableUrl:a,reviver:l,loadMore:u,hidden:d={},disableActions:h=!1,albumDisplayMode:m="artist",isDraggable:g,removeButton:v,disableEvents:S=!1,className:x,preferItemType:T=!1})=>{const A=ss(),E=Ea(),{displayItems:R,setRowRefs:L}=ew(n,s),w=h?{...d,add_to_favorite:!0,remove_from_favorite:!0,add_to_playlist:!0,remove_from_playlist:!0}:d,D=di(),[_,k]=C.useState(null),N=Q=>!T||!Q||"isPlaceholder"in Q?i:Q.Type==="Audio"?"song":Q.Type==="MusicAlbum"?"album":Q.Type==="MusicArtist"?"artist":Q.Type==="Playlist"?"playlist":Q.Type==="MusicGenre"?"genre":i,F=Q=>{const{active:j,over:K}=Q;if(K&&j.id!==K.id){const Y=n.findIndex(B=>(B.queueId||B.Id)===j.id),re=n.findIndex(B=>(B.queueId||B.Id)===K.id);if(Y!==-1&&re!==-1){const B=t+Y,M=t+re;A.moveItemInPlaylist(B,M);const z=Array.from(n),[G]=z.splice(Y,1);z.splice(re,0,G),R.length=0,R.push(...z)}}k(null)},V=({active:Q})=>{k(Q.id)},H=(Q,j)=>!Q||!j?!1:g&&Q.queueId&&j.queueId?Q.queueId===j.queueId:Q.Id===j.Id,J=(Q,j)=>{N(Q)==="song"&&(H(A.currentTrack,Q)?A.togglePlayPause():A.setCurrentPlaylist({pages:e,title:r,disableUrl:a,reviver:l})&&A.playTrack(t+j))},X=(Q,j,K)=>{const Y=N(j);if(!j||"isPlaceholder"in j)return Y==="album"?y.jsx("div",{className:`media-item album-item ${x||""}`,ref:M=>L(Q,M),children:y.jsx(Jo,{type:"album"})}):Y==="artist"?y.jsx("div",{className:`media-item artist-item ${x||""}`,ref:M=>L(Q,M),children:y.jsx(Jo,{type:"artist"})}):Y==="playlist"?y.jsx("div",{className:`media-item album-item ${x||""}`,ref:M=>L(Q,M),children:y.jsx(Jo,{type:"album"})}):Y==="genre"?y.jsx("div",{className:`media-item genre-item ${x||""}`,ref:M=>L(Q,M),children:y.jsx(Jo,{type:"genre"})}):y.jsx("div",{className:`media-item song-item ${x||""}`,ref:M=>L(Q,M),children:y.jsx(Jo,{type:"song"})});const re=H(D.selectedItem,j)&&D.isOpen,B=[Y==="song"&&H(A.currentTrack,j)?A.isPlaying?"playing":"paused":"",re?"active":""].filter(Boolean).join(" ");return Y==="album"?y.jsxs("div",{className:`media-item album-item ${B} ${x||""}`,ref:M=>L(Q,M),...S?{}:{onClick:()=>E(`/album/${j.Id}`),onContextMenu:M=>D.onContextMenu(M,{item:j},!1,w),onTouchStart:M=>D.onTouchStart(M,{item:j},!1,w),onTouchMove:D.onTouchClear,onTouchEnd:D.onTouchClear},children:[y.jsx(Ln,{width:46,height:46,cornerRadius:6,className:"media-state",children:y.jsx(yn,{item:j,type:"Primary",width:46,height:46})}),y.jsxs("div",{className:"media-details",children:[y.jsx("span",{className:"song-name",children:j.Name}),y.jsxs("div",{className:"container",children:[m==="year"&&y.jsx("div",{className:"year",children:iE(j.PremiereDate)}),m==="artist"&&y.jsx("div",{className:"artist",children:j.AlbumArtist||"Unknown Artist"}),m==="both"&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"year",children:iE(j.PremiereDate)}),y.jsx("div",{className:"divider"}),y.jsx("div",{className:"artist",children:j.AlbumArtist||"Unknown Artist"})]})]})]}),y.jsx(_c,{item:j,disableActions:h,listeners:K,isDraggable:g,removeButton:v})]}):Y==="artist"?y.jsxs("div",{className:`media-item artist-item ${B} ${x||""}`,ref:M=>L(Q,M),...S?{}:{onClick:()=>E(`/artist/${j.Id}`),onContextMenu:M=>D.onContextMenu(M,{item:j},!1,w),onTouchStart:M=>D.onTouchStart(M,{item:j},!1,w),onTouchMove:D.onTouchClear,onTouchEnd:D.onTouchClear},children:[y.jsx("div",{className:"media-state",children:y.jsx(yn,{item:j,type:"Primary",width:36,height:36})}),y.jsx("div",{className:"media-details",children:y.jsx("div",{className:"song-name",children:j.Name||"Unknown Artist"})}),y.jsx(_c,{item:j,disableActions:h,listeners:K,isDraggable:g,removeButton:v})]}):Y==="playlist"?y.jsxs("div",{className:`media-item playlist-item ${B} ${x||""}`,ref:M=>L(Q,M),...S?{}:{onClick:()=>E(`/playlist/${j.Id}`),onContextMenu:M=>D.onContextMenu(M,{item:j},!1,w),onTouchStart:M=>D.onTouchStart(M,{item:j},!1,w),onTouchMove:D.onTouchClear,onTouchEnd:D.onTouchClear},children:[y.jsx(Ln,{width:46,height:46,cornerRadius:6,className:"media-state",children:y.jsx(yn,{item:j,type:"Primary",width:46,height:46})}),y.jsxs("div",{className:"media-details",children:[y.jsx("span",{className:"song-name",children:j.Name}),y.jsx("div",{className:"container",children:y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:j.ChildCount||0})," ",y.jsx("span",{children:(j.ChildCount||0)===1?"Track":"Tracks"})]})})]}),y.jsx(_c,{item:j,disableActions:h,listeners:K,isDraggable:g,removeButton:v})]}):Y==="genre"?y.jsxs("div",{className:`media-item genre-item ${B} ${x||""}`,ref:M=>L(Q,M),...S?{}:{onClick:()=>E(`/genre/${encodeURIComponent(j.Name||"")}`),onContextMenu:M=>D.onContextMenu(M,{item:j},!1,w),onTouchStart:M=>D.onTouchStart(M,{item:j},!1,w),onTouchMove:D.onTouchClear,onTouchEnd:D.onTouchClear},children:[y.jsx(Ln,{width:36,height:36,cornerRadius:8,className:"media-state",children:y.jsx(yn,{item:j,type:"Primary",width:36,height:36})}),y.jsx("div",{className:"media-details",children:y.jsx("span",{className:"song-name",children:j.Name||"Unknown Genre"})}),y.jsx(_c,{item:j,disableActions:h,listeners:K,isDraggable:g,removeButton:v})]}):y.jsxs("div",{className:`media-item song-item ${B} ${x||""}`,ref:M=>L(Q,M),...S?{}:{onClick:()=>J(j,Q),onContextMenu:M=>D.onContextMenu(M,{item:j},!1,w),onTouchStart:M=>D.onTouchStart(M,{item:j},!1,w),onTouchMove:D.onTouchClear,onTouchEnd:D.onTouchClear},children:[y.jsxs(Ln,{width:46,height:46,cornerRadius:6,className:"media-state",children:[y.jsx(yn,{item:j,type:"Primary",width:46,height:46}),y.jsxs("div",{className:"overlay",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",children:y.jsx("div",{className:"pause-icon"})})]}),y.jsx("div",{className:"play-state-animation",children:y.jsx(C2,{width:28,height:20,className:"sound-bars"})})]})]}),y.jsxs("div",{className:"media-details",children:[y.jsx("span",{className:"song-name",children:j.Name}),y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"artist",children:j.Artists&&j.Artists.length>0?j.Artists.join(", "):"Unknown Artist"}),y.jsx("div",{className:"divider"}),y.jsx("div",{className:"album",children:j.Album||"Unknown Album"})]})]}),y.jsx(_c,{item:j,disableActions:h,listeners:K,isDraggable:g,removeButton:v})]})};return s&&n.length===0?y.jsx(zn,{}):n.length===0&&!s?y.jsx("div",{className:"empty",children:i==="song"?"No tracks were found":i==="album"?"No albums were found":i==="artist"?"No artists were found":i==="playlist"?"No playlists were found":"No genres were found"}):y.jsxs("ul",{className:"media-list noSelect",children:[g&&y.jsx(A5,{handleDragStart:V,handleDragEnd:F,items:n,renderItem:X,activeId:_,children:y.jsx(O0,{data:R,itemContent:(Q,j)=>"isPlaceholder"in j?X(Q,j):y.jsx(I5,{id:j.queueId||j.Id,cb:({listeners:K})=>X(Q,j,K)},j.queueId||j.Id),endReached:u,overscan:800})}),!g&&y.jsx(O0,{data:R,itemContent:X,endReached:u,overscan:800})]})},A5=({handleDragStart:n,handleDragEnd:e,items:t,renderItem:s,activeId:i,children:r})=>{const a=x6(zT(Py),zT($R));return y.jsxs(vF,{sensors:a,collisionDetection:I6,onDragStart:n,onDragEnd:e,modifiers:[FF],children:[y.jsx(HF,{items:t.map(l=>l.queueId||l.Id),strategy:$F,children:r}),y.jsx(UF,{className:"drag-overlay",children:i?s(t.findIndex(l=>(l.queueId||l.Id)===i),t.find(l=>(l.queueId||l.Id)===i)||{isPlaceholder:!0}):null})]})},I5=({id:n,cb:e})=>{const{attributes:t,listeners:s,setNodeRef:i,transform:r,transition:a,isDragging:l}=WF({id:n}),u={transform:ba.Transform.toString(r),transition:l?"none":a,zIndex:l?999:void 0,opacity:l?0:1},d=C.useMemo(()=>e({listeners:s}),[s,e]);return y.jsx("li",{ref:i,className:l?"active":"",style:u,...t,children:d})},pr=({offlineState:n,size:e,itemId:t})=>{const{queue:s}=pu(),i=s[0]?.mediaItem.Id===t||s[0]?.containerId===t;return n?y.jsxs("div",{className:"download-state",children:[n==="downloading"&&y.jsx("div",{className:`icon downloading ${i?"active-sync":""}`,title:"Syncing...",children:y.jsx($A,{width:e,height:e})}),n==="downloaded"&&y.jsx("div",{className:"icon downloaded",title:"Synced",children:y.jsx(D2,{width:e,height:e})}),n==="deleting"&&y.jsx("div",{className:`icon deleting ${i?"active-sync":""}`,title:"Unsyncing...",children:y.jsx(O2,{width:e,height:e})})]}):null},_c=({item:n,disableActions:e,listeners:t,isDraggable:s,removeButton:i})=>y.jsxs("div",{className:"media-indicators",children:[i&&i(n),y.jsx(pr,{offlineState:n.offlineState,size:16,itemId:n.Id}),!e&&n.UserData?.IsFavorite&&location.pathname!=="/favorites"&&y.jsx("div",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:16})}),s&&y.jsx("div",{className:"draggable",title:"Drag",...t,children:y.jsxs("div",{className:"grid",children:[y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"}),y.jsx("div",{className:"dot"})]})})]}),kw=n=>{if(!n)return"0:00";const e=Math.floor(n/1e7),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return t>0?`${t}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${s}:${i.toString().padStart(2,"0")}`},Yy=({tracks:n,playlistItems:e,showAlbum:t=!1,title:s,hidden:i={}})=>{const r=ss(),a=5,l=n.map(d=>({...d,playCount:d.UserData?.PlayCount||0})).filter(d=>d.playCount>=a).sort((d,h)=>h.playCount-d.playCount).slice(0,3).map(d=>d.Id),u=di();return y.jsx("ul",{className:"tracklist noSelect",children:n.map((d,h)=>{const m=r.currentTrack?.Id===d.Id,g=l.includes(d.Id),v=u.selectedItem?.Id===d.Id&&u.isOpen,S=[m?r.isPlaying?"playing":"paused":"",g?"most-played":"",v?"active":""].filter(Boolean).join(" ");return y.jsxs("li",{className:`track-item ${S}`,onClick:()=>{if(m)r.togglePlayPause();else if(r.setCurrentPlaylistSimple({playlist:e||n||[],title:s})){const x=e?e.findIndex(T=>T.Id===d.Id):h;r.playTrack(x)}},onContextMenu:x=>u.onContextMenu(x,{item:d},!1,i),onTouchStart:x=>u.onTouchStart(x,{item:d},!1,i),onTouchMove:u.onTouchClear,onTouchEnd:u.onTouchClear,children:[y.jsxs("div",{className:"track-indicator",children:[y.jsx("div",{className:"track-number",children:h+1}),y.jsxs("div",{className:"track-state",children:[y.jsx("div",{className:"play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",children:y.jsx("div",{className:"pause-icon"})}),y.jsx("div",{className:"play-state-animation",children:y.jsx(VA,{width:18,height:18,className:"sound-bars"})})]})]}),y.jsxs("div",{className:"track-details",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"name",children:y.jsx("div",{className:"text",children:d.Name})}),t?y.jsx("div",{className:"album",children:y.jsx("div",{className:"text",children:d.Album||"Unknown Album"})}):y.jsx("div",{className:"artist",children:d.Artists&&d.Artists.length>0?d.Artists.join(", "):"Unknown Artist"})]}),y.jsxs("div",{className:"track-indicators",children:[y.jsx(pr,{offlineState:d.offlineState,size:12,itemId:d.Id}),d.UserData?.IsFavorite&&y.jsx("div",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:12})})]}),y.jsx("div",{className:"duration",children:kw(d.RunTimeTicks)})]})]},d.Id)})})},R5=n=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["albumData",n],queryFn:async()=>{const{album:a,tracks:l}=await e.getAlbumDetails(n),d=new Set(l.map(h=>h.ParentIndexNumber||1)).size;return{album:a,tracks:l,discCount:d,loading:!1,error:null}}});return{...t,loading:s||i,error:r?r.message:null,tracks:t?.tracks||[],discCount:t?.discCount||1}},Cl=n=>{if(!n||n<=0)return"0m";const e=Math.floor(n/1e7),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60,r=[];return t>0&&r.push(`${t}h`),(s>0||t>0)&&r.push(`${s}m`),t===0&&s===0&&i>0&&r.push(`${i}s`),r.join(" ")||"0m"},w5=()=>{const n=ss(),{albumId:e}=no(),{album:t,tracks:s,discCount:i,loading:r,error:a}=R5(e),{setPageTitle:l}=fr(),{isOpen:u,selectedItem:d,onContextMenu:h}=di(),{addToFavorites:m,removeFromFavorites:g}=Tl();C.useEffect(()=>(t&&l(t.Name),()=>{l("")}),[t,l]);const v=s.reduce((R,L)=>R+(L.RunTimeTicks||0),0);if(r)return y.jsx(zn,{});if(a||!t)return y.jsx("div",{className:"error",children:a||"Album not found"});const S=s.reduce((R,L)=>R+(L.UserData?.PlayCount||0),0),x=t.ChildCount||s.length,T=s.reduce((R,L)=>{const w=L.ParentIndexNumber||1;return R[w]||(R[w]=[]),R[w].push(L),R},{}),A=Object.keys(T).sort((R,L)=>Number(R)-Number(L)).flatMap(R=>T[Number(R)].sort((L,w)=>(L.IndexNumber||0)-(w.IndexNumber||0))),E=R=>{R.stopPropagation(),h(R,{item:t},!0,{add_to_favorite:!0,remove_from_favorite:!0})};return y.jsxs("div",{className:"album-page",children:[y.jsxs("div",{className:"album-header",children:[y.jsx(Ln,{width:100,height:100,cornerRadius:8,className:"thumbnail",children:y.jsx(yn,{item:t,type:"Primary",width:100,height:100})}),y.jsxs("div",{className:"album-details",children:[y.jsx("div",{className:"artist",children:t.AlbumArtists&&t.AlbumArtists.length>0?y.jsx(sn,{to:`/artist/${t.AlbumArtists[0].Id}`,children:t.AlbumArtist||"Unknown Artist"}):t.AlbumArtist||"Unknown Artist"}),y.jsx("div",{className:"date",children:tw(t.PremiereDate)}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:x})," ",y.jsx("span",{children:x===1?"Track":"Tracks"})]}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(v)})," ",y.jsx("span",{children:"Total"})]}),S>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"plays",children:[y.jsx("span",{className:"number",children:S})," ",S===1?"Play":"Plays"]})]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsxs("div",{className:"primary",children:[y.jsxs("div",{className:"play-album",onClick:()=>{n.setCurrentPlaylistSimple({playlist:A,title:t.Name})&&n.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]}),y.jsx("div",{className:"favorite-state",title:t.UserData?.IsFavorite?"Remove from favorites":"Add to favorites",onClick:async()=>{if(t?.Id)try{t.UserData?.IsFavorite?await g(t):await m(t)}catch(R){console.error("Failed to update favorite status:",R)}},children:t.UserData?.IsFavorite?y.jsx(ci,{size:16}):y.jsx(uu,{size:16})})]}),y.jsxs("div",{className:"secondary",children:[y.jsx(pr,{offlineState:t.offlineState,size:16,itemId:t.Id}),y.jsx("div",{className:`more ${u&&d?.Id===t?.Id?"active":""}`,onClick:E,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})]})]}),Object.keys(T).sort((R,L)=>Number(R)-Number(L)).map((R,L)=>y.jsxs("div",{className:"album-content",children:[i>1&&y.jsxs("div",{className:`disc ${L===0?"first":""}`,children:["Disc ",R]}),y.jsx(Yy,{tracks:T[Number(R)],playlistItems:A,title:t.Name,hidden:{view_album:!0}})]},R))]})},C5=()=>{const n=Yt(),e=40,{jellySort:t}=Li();return _i({queryKey:["albumartists",t.sortBy,t.sortOrder],queryFn:async({pageParam:s=0})=>{const i=s*e;return await n.getAllAlbumArtists(i,e,t.sortBy,t.sortOrder)},queryFnReviver:{fn:"getAllAlbumArtists",params:[ui,e,t.sortBy,t.sortOrder]}})},L5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=C5();return y.jsxs("div",{className:"artists-page",children:[y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"artist",title:"Album Artists",reviver:i,loadMore:r,hidden:{view_artist:!0}}),s&&y.jsx("div",{className:"error",children:s})]})},D5=()=>{const n=Yt(),e=40,{jellySort:t}=Li();return _i({queryKey:["albums",t.sortBy,t.sortOrder],queryFn:async({pageParam:s=0})=>{const i=s*e;return await n.getAllAlbums(i,e,t.sortBy,t.sortOrder)},queryFnReviver:{fn:"getAllAlbums",params:[ui,e,t.sortBy,t.sortOrder]}})},O5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=D5();return y.jsxs("div",{className:"albums-page",children:[y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"album",title:"Albums",reviver:i,loadMore:r,hidden:{view_album:!0}}),s&&y.jsx("div",{className:"error",children:s})]})},Mw=(n,e=5)=>{const t=Yt(),{data:s,isFetching:i,isPending:r,error:a}=nn({queryKey:["artistDetails",n,e],queryFn:()=>t.getArtistDetails(n,e)}),{data:l,error:u}=nn({queryKey:["artistStats",n],queryFn:async()=>{const d=await t.getArtistStats(n,s?.artist.Name||""),m=(await t.fetchAllTracks(n)).reduce((v,S)=>v+(S.UserData?.PlayCount||0),0),g=d.albums.length;return{...d,totalPlays:m,totalAlbumCount:g}},enabled:!!s?.artist});return{artist:s?.artist||null,tracks:s?.tracks||[],albums:l?.albums||[],appearsInAlbums:l?.appearsInAlbums||[],totalTrackCount:l?.totalTrackCount||0,totalPlaytime:l?.totalPlaytime||0,totalPlays:l?.totalPlays||0,totalAlbumCount:l?.totalAlbumCount||0,loading:i||r,error:a?.message||u?.message||null}},_5=n=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["playlistsFeaturingArtist",n],queryFn:async()=>await e.getPlaylistsFeaturingArtist(n)});return{playlists:t||[],loading:s||i,error:r?r.message:null}},P5=()=>{const n=ss(),{artistId:e}=no(),{artist:t,tracks:s,albums:i,appearsInAlbums:r,totalTrackCount:a,totalPlaytime:l,totalPlays:u,totalAlbumCount:d,loading:h,error:m}=Mw(e),{playlists:g,loading:v,error:S}=_5(e),{setPageTitle:x}=fr(),{isOpen:T,selectedItem:A,onContextMenu:E}=di(),{addToFavorites:R,removeFromFavorites:L}=Tl();if(C.useEffect(()=>(t&&x(t.Name),()=>{x("")}),[t,x]),h)return y.jsx(zn,{});if(m||!t)return y.jsx("div",{className:"error",children:m||"Artist not found"});const w=s.slice(0,5),D=t.Genres||[],_=k=>{k.stopPropagation(),E(k,{item:t},!0,{add_to_favorite:!0,remove_from_favorite:!0})};return y.jsxs("div",{className:"artist-page",children:[y.jsxs("div",{className:"artist-header",children:[y.jsx(Ln,{width:100,height:100,cornerRadius:8,className:"thumbnail",children:y.jsx(yn,{item:t,type:"Primary",width:100,height:100})}),y.jsxs("div",{className:"artist-details",children:[y.jsx("div",{className:"artist",children:t.Name}),D.length>0&&y.jsx("div",{className:"genres",children:D.slice(0,6).map((k,N)=>y.jsxs("span",{children:[y.jsx(sn,{to:`/genre/${encodeURIComponent(k)}`,children:k}),N<D.slice(0,6).length-1&&", "]},k))}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:a})," ",y.jsx("span",{children:a===1?"Track":"Tracks"})]}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"album-amount",children:[y.jsx("span",{className:"number",children:d})," ",y.jsx("span",{children:d===1?"Album":"Albums"})]}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(l)})," ",y.jsx("span",{children:"Total"})]}),u>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"plays",children:[y.jsx("span",{className:"number",children:u})," ",u===1?"Play":"Plays"]})]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsxs("div",{className:"primary",children:[y.jsxs("div",{className:"play-artist",onClick:()=>{n.setCurrentPlaylistSimple({playlist:s,title:t.Name})&&n.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]}),y.jsx("div",{className:"favorite-state",title:t.UserData?.IsFavorite?"Remove from favorites":"Add to favorites",onClick:async()=>{if(t?.Id)try{t.UserData?.IsFavorite?await L(t):await R(t)}catch(k){console.error("Failed to update favorite status:",k)}},children:t.UserData?.IsFavorite?y.jsx(ci,{size:16}):y.jsx(uu,{size:16})})]}),y.jsxs("div",{className:"secondary",children:[y.jsx(pr,{offlineState:t.offlineState,size:16,itemId:t.Id}),y.jsx("div",{className:`more ${T&&A?.Id===t?.Id?"active":""}`,onClick:_,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})]})]}),y.jsxs("div",{className:"artist-content",children:[w.length>0&&y.jsxs("div",{className:"section top-songs",children:[y.jsx(Yy,{tracks:w,showAlbum:!0,title:t.Name,hidden:{view_artist:!0,view_artists:!0}}),(a||0)>5&&y.jsx("div",{className:"all-tracks",children:y.jsx(sn,{to:`/artist/${e}/tracks`,className:"textlink",children:"View all tracks"})})]}),i.length>0&&y.jsxs("div",{className:"section albums",children:[y.jsx("div",{className:"title",children:"Albums"}),y.jsx("div",{className:"desc",children:"Complete discography"}),y.jsx(ks,{items:i,infiniteData:{pageParams:[1],pages:[i]},isLoading:h,type:"album",albumDisplayMode:"year",title:t.Name?`${t.Name} Albums`:"Albums",hidden:{view_album:!0,view_artist:!0}})]}),r.length>0&&y.jsxs("div",{className:"section appears-in",children:[y.jsx("div",{className:"title",children:"Appears In"}),y.jsx("div",{className:"desc",children:"Additional recordings"}),y.jsx(ks,{items:r,infiniteData:{pageParams:[1],pages:[r]},isLoading:h,type:"album",albumDisplayMode:"both",title:t.Name?`${t.Name} Albums`:"Albums",hidden:{view_album:!0}})]}),g.length>0&&y.jsxs("div",{className:"section playlists",children:[v?y.jsx(zn,{}):y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"title",children:"Playlists"}),y.jsx("div",{className:"desc",children:"Included in curated collections"}),y.jsx(ks,{items:g,infiniteData:{pageParams:[1],pages:[g]},isLoading:v,type:"playlist",title:t.Name?`${t.Name} Playlists`:"Playlists"})]}),S&&!v&&y.jsx("div",{className:"error",children:S})]})]})]})},N5=()=>{const n=Yt(),e=40,{jellySort:t}=Li();return _i({queryKey:["artists",t.sortBy,t.sortOrder],queryFn:async({pageParam:s=0})=>{const i=s*e;return await n.getAllArtists(i,e,t.sortBy,t.sortOrder)},queryFnReviver:{fn:"getAllArtists",params:[ui,e,t.sortBy,t.sortOrder]}})},k5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=N5();return y.jsxs("div",{className:"artists-page",children:[y.jsx("div",{className:"album-artists",children:y.jsx(sn,{to:"/albumartists",className:"textlink",children:"View album artists"})}),y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"artist",title:"Artists",reviver:i,loadMore:r,hidden:{view_artist:!0}}),s&&y.jsx("div",{className:"error",children:s})]})},Eu=({tracks:n,infiniteData:e={pageParams:[],pages:[]},isLoading:t,playlistId:s,showType:i,title:r,disableUrl:a,reviver:l,loadMore:u})=>{const d=ss(),h=xn(),{displayItems:m,setRowRefs:g}=ew(n,t),v=di(),S=C.useCallback((T,A)=>{d.currentTrack?.Id===T.Id?d.togglePlayPause():d.setCurrentPlaylist({pages:e,title:r,disableUrl:a,reviver:l})&&d.playTrack(A)},[d,e,r,a,l]),x=(T,A)=>{if(!A||"isPlaceholder"in A)return y.jsx("li",{className:"track-item",ref:D=>g(T,D),children:y.jsx(Jo,{type:"playlist"})});const E=A,R=v.selectedItem?.Id===A.Id&&v.isOpen,L=[d.currentTrack?.Id===E.Id?d.isPlaying?"playing":"paused":"",R?"active":""].filter(Boolean).join(" "),w=E.UserData?.IsFavorite&&h.pathname!=="/favorites";return y.jsxs("li",{className:`track-item ${L}`,onClick:()=>S(E,T),ref:D=>g(T,D),onContextMenu:D=>v.onContextMenu(D,{item:A,playlistId:s}),onTouchStart:D=>v.onTouchStart(D,{item:A,playlistId:s}),onTouchMove:v.onTouchClear,onTouchEnd:v.onTouchClear,children:[y.jsxs(Ln,{width:40,height:40,cornerRadius:6,className:"track-state",children:[y.jsx(yn,{item:E,type:"Primary",width:40,height:40}),y.jsxs("div",{className:"overlay",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",children:y.jsx("div",{className:"pause-icon"})})]}),y.jsx("div",{className:"play-state-animation",children:y.jsx(VA,{width:18,height:18,className:"sound-bars"})})]})]}),y.jsxs("div",{className:"track-details",children:[y.jsxs("span",{className:"track-name",children:[y.jsxs("span",{className:"track-number",children:[T+1,"."]}),E.Name]}),y.jsx("div",{className:"container",children:i==="artist"?y.jsx("div",{className:"artist",children:E.Artists&&E.Artists.length>0?E.Artists.join(", "):"Unknown Artist"}):i==="album"?y.jsx("div",{className:"album",children:E.Album||"Unknown Album"}):y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"artist",children:E.Artists&&E.Artists.length>0?E.Artists.join(", "):"Unknown Artist"}),y.jsx("div",{className:"divider"}),y.jsx("div",{className:"album",children:E.Album||"Unknown Album"})]})})]}),y.jsxs("div",{className:"track-indicators",children:[y.jsx(pr,{offlineState:E.offlineState,size:12,itemId:E.Id}),w&&y.jsx("div",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:12})}),y.jsx("div",{className:"track-duration",children:kw(E.RunTimeTicks||0)})]})]},E.Id)};return t&&n.length===0?y.jsx(zn,{}):!t&&n.length===0?y.jsx("div",{className:"empty",children:"No tracks were found"}):y.jsx("ul",{className:"playlist-tracklist noSelect",children:y.jsx(O0,{data:m,itemContent:x,endReached:u,overscan:800},s)})},M5=n=>{const e=Yt(),t=40;return _i({queryKey:["artistTracks",n],queryFn:async({pageParam:s=0})=>{const i=s*t,{Items:r}=await e.getArtistTracks(n,i,t);return r},queryFnReviver:{fn:"getArtistTracks",params:[n,ui,t]}})},U5=()=>{const{artistId:n}=no(),{artist:e}=Mw(n),{items:t,infiniteData:s,isLoading:i,error:r,reviver:a,loadMore:l}=M5(n),{setPageTitle:u}=fr();return C.useEffect(()=>(e&&u(`${e.Name}'s Tracks`),()=>{u("")}),[e,u]),i&&t.length===0?y.jsx(zn,{}):y.jsxs("div",{className:"artist-tracks-page",children:[r&&y.jsx("div",{className:"error",children:r}),y.jsx(Eu,{tracks:t,infiniteData:s,isLoading:i,showType:"album",title:e?`${e.Name}'s Tracks`:"Artist Tracks",reviver:a,loadMore:l})]})},F5=()=>{const n=Sl(),{jellyItemKind:e}=Li(),t=40,{data:s,isFetching:i,isPending:r,error:a,fetchNextPage:l,hasNextPage:u,isFetchingNextPage:d}=GE({queryKey:["downloads",e],queryFn:async({pageParam:g=0})=>await n.getPageFromIndexedDb(g,e,t),getNextPageParam:(g,v)=>g.length===t?v.length:void 0,initialPageParam:0,staleTime:0,retry:!1}),h=s?s.pages.flat():[],m=async()=>{u&&!d&&await l()};return{items:h,isLoading:i||r,error:a?a.message:null,hasNextPage:u,loadMore:m}},B5=()=>{const{items:n,isLoading:e,error:t,loadMore:s}=F5(),{jellyItemKind:i}=Li(),{queue:r,removeFromQueue:a}=pu(),l=r.filter(u=>u.mediaItem.Type===i).map(u=>({...u.mediaItem,offlineState:u.action==="remove"?"deleting":"downloading"})).reverse();return y.jsxs("div",{className:"favorites-page downloads-page",children:[t&&y.jsx("div",{className:"error",children:t}),l.length>0&&y.jsx("div",{className:"queue-list",children:y.jsx(ks,{items:l,infiniteData:{pageParams:[],pages:[]},isLoading:!1,type:i==="Audio"?"song":i==="MusicAlbum"?"album":"artist",title:"Queue",disableActions:!0,disableEvents:!0,removeButton:u=>y.jsx("div",{className:"remove-queue-button",onClick:()=>a(u.Id),title:"Remove from queue","aria-label":"Remove from queue",children:y.jsx(D_,{size:16})})})}),y.jsx(ks,{items:n,infiniteData:{pageParams:[1],pages:[n]},isLoading:e&&l.length===0,type:i==="Audio"?"song":i==="MusicAlbum"?"album":"artist",loadMore:s,title:"Synced",disableActions:!0})]})},j5=()=>{const n=Yt(),e=40,{jellySort:t,jellyItemKind:s}=Li(),{data:i,error:r}=nn({queryKey:["favoritesTotals",s],queryFn:()=>n.getFavoritesTotals(s)});C.useEffect(()=>{r instanceof ro&&r?.response?.status===401&&(localStorage.removeItem("auth"),window.location.href="/login")},[r]);const a=_i({queryKey:["favorites",s,t.sortBy,t.sortOrder],queryFn:async({pageParam:h=0})=>{const m=h*e;return await n.getFavoriteTracks(m,e,t.sortBy,t.sortOrder,s)},queryFnReviver:{fn:"getFavoriteTracks",params:[ui,e,t.sortBy,t.sortOrder,s]}}),l=i?.totalPlaytime||0,u=i?.totalTrackCount||0,d=i?.totalPlays||0;return{...a,totalPlaytime:l,totalTrackCount:u,totalPlays:d}},V5=(n,e)=>{const t=Yt(),{data:s,isFetching:i,isPending:r,error:a}=nn({queryKey:["customContainerItem",n],queryFn:async()=>await t.createCustomContainerMediaItem(n,e),enabled:!0});return{customItem:s,loading:i||r,error:a?a.message:null}},$5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r,totalTrackCount:a,totalPlaytime:l,totalPlays:u}=j5(),{jellyItemKind:d}=Li(),h=ss(),{isOpen:m,onContextMenu:g}=di(),{customItem:v}=V5("favorites","Favorite Songs"),S=x=>{if(x.stopPropagation(),!v){console.warn("Favorites custom item not ready yet");return}g(x,{item:v,customContainer:"favorites"},!0,{instant_mix:!0,add_to_favorite:!0,remove_from_favorite:!0})};return y.jsxs("div",{className:"favorites-page",children:[s&&y.jsx("div",{className:"error",children:s}),d==="Audio"&&y.jsxs("div",{className:"favorites-header",children:[y.jsx(Ln,{width:80,height:80,cornerRadius:8,className:"thumbnail",children:y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(ci,{size:28})})}),y.jsxs("div",{className:"favorites-details",children:[y.jsx("div",{className:"title",children:"Favorite Songs"}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:a})," ",y.jsx("span",{children:a===1?"Track":"Tracks"})]}),l>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(l)})," ",y.jsx("span",{children:"Total"})]})]}),u>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"plays",children:[y.jsx("span",{className:"number",children:u})," ",y.jsx("span",{children:u===1?"Play":"Plays"})]})]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsx("div",{className:"primary",children:y.jsxs("div",{className:"play-playlist",onClick:()=>{h.setCurrentPlaylistSimple({playlist:n,title:"Favorite Songs"})&&h.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]})}),y.jsxs("div",{className:"secondary",children:[y.jsx(pr,{offlineState:v?.offlineState,size:12,itemId:v?.Id}),y.jsx("div",{className:`more ${m?"active":""}`,onClick:S,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})]})]}),d==="Audio"&&y.jsx(Eu,{tracks:n,infiniteData:e,isLoading:t,reviver:i,loadMore:r,title:"Favorites"}),d!=="Audio"&&y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:d==="MusicAlbum"?"album":"artist",reviver:i,loadMore:r,title:"Favorites"})]})},G5=()=>{const n=Yt(),e=40;return _i({queryKey:["frequentlyPlayed"],queryFn:async({pageParam:t=0})=>{const s=t*e;return await n.fetchFrequentlyPlayed(s,e)},queryFnReviver:{fn:"fetchFrequentlyPlayed",params:[ui,e]}})},H5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=G5();return y.jsxs("div",{className:"frequently-page",children:[s&&y.jsx("div",{className:"error",children:s}),y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"song",title:"Frequently Played",reviver:i,loadMore:r})]})},z5=n=>{const e=Yt(),t=40,{jellySort:s}=Li(),{data:i,error:r}=nn({queryKey:["genreTotals",n],queryFn:()=>e.getGenreTotals(n)});C.useEffect(()=>{r instanceof ro&&r.response?.status===401&&(localStorage.removeItem("auth"),window.location.href="/login")},[r]);const a=_i({queryKey:["genreTracks",n,s.sortBy,s.sortOrder],queryFn:async({pageParam:h=0})=>{const m=h*t;return await e.getGenreTracks(n,m,t,s.sortBy,s.sortOrder)},queryFnReviver:{fn:"getGenreTracks",params:[n,ui,t,s.sortBy,s.sortOrder]}}),l=i?.totalPlaytime||0,u=i?.totalTrackCount||0,d=i?.totalPlays||0;return{...a,totalPlaytime:l,totalTrackCount:u,totalPlays:d}},K5=n=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["genre",n],queryFn:async()=>await e.getGenreByName(n)});return{mediaItem:t,loading:s||i,error:r?r.message:null}},Y5=()=>{const{genre:n}=no(),{items:e,infiniteData:t,isLoading:s,error:i,reviver:r,loadMore:a,totalTrackCount:l,totalPlaytime:u,totalPlays:d}=z5(n),{setPageTitle:h}=fr(),m=ss(),{isOpen:g,onContextMenu:v}=di(),{mediaItem:S,loading:x}=K5(n||"");if(C.useEffect(()=>(n&&h(decodeURIComponent(n)),()=>{h("")}),[n,h]),s&&e.length===0)return y.jsx(zn,{});if(x)return y.jsx(zn,{});if(i||!S)return y.jsx("div",{className:"error",children:i||"Genre not found"});const T=A=>{A.stopPropagation(),v(A,{item:S},!0,{add_to_favorite:!0,remove_from_favorite:!0})};return y.jsxs("div",{className:"genre-page",children:[i&&y.jsx("div",{className:"error",children:i}),y.jsxs("div",{className:"genre-header",children:[y.jsx(Ln,{width:80,height:80,cornerRadius:8,className:"thumbnail",children:y.jsx(yn,{item:S,type:"Primary",width:100,height:100})}),y.jsxs("div",{className:"genre-details",children:[y.jsx("div",{className:"title",children:n?decodeURIComponent(n):"Genre"}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:l})," ",y.jsx("span",{children:l===1?"Track":"Tracks"})]}),u>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(u)})," ",y.jsx("span",{children:"Total"})]})]}),d>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"plays",children:[y.jsx("span",{className:"number",children:d})," ",d===1?"Play":"Plays"]})]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsx("div",{className:"primary",children:y.jsxs("div",{className:"play-playlist",onClick:()=>{m.setCurrentPlaylistSimple({playlist:e,title:n?`Genre: ${decodeURIComponent(n)}`:"Genre"})&&m.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]})}),y.jsxs("div",{className:"secondary",children:[y.jsx(pr,{offlineState:S.offlineState,size:12,itemId:S.Id}),y.jsx("div",{className:`more ${g?"active":""}`,onClick:T,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})]})]}),y.jsx(Eu,{tracks:e,infiniteData:t,isLoading:s,title:n?`Genre: ${decodeURIComponent(n)}`:"Genres",reviver:r,loadMore:a})]})},q5=()=>{const n=Yt(),e=40,{jellySort:t}=Li();return _i({queryKey:["genres",t.sortBy,t.sortOrder],queryFn:async({pageParam:s=0})=>{const i=s*e;return await n.getAllGenres(i,e,t.sortBy,t.sortOrder)},queryFnReviver:{fn:"getAllGenres",params:[ui,e,t.sortBy,t.sortOrder]}})},Q5=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=q5();return y.jsxs("div",{className:"genres-page",children:[y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"genre",title:"Genres",reviver:i,loadMore:r,hidden:{add_to_favorite:!0,remove_from_favorite:!0}}),s&&y.jsx("div",{className:"error",children:s})]})},X5=()=>{const n=Yt(),{data:e,isLoading:t,error:s}=nn({queryKey:["homeData"],queryFn:async()=>{const[i,r,a,l]=await Promise.all([n.getRecentlyPlayed(),n.getFrequentlyPlayed(),n.getRecentlyAdded(),n.getRecentGenres()]);return{recentlyPlayed:i.filter(u=>u.Type==="Audio"),frequentlyPlayed:r.filter(u=>u.Type==="Audio"),recentlyAdded:a.filter(u=>u.Type==="MusicAlbum"),recentGenres:l,loading:!1,error:null}}});return{...e,isLoading:t,error:s?s.message:null}},W5=()=>{const{recentlyPlayed:n,frequentlyPlayed:e,recentlyAdded:t,recentGenres:s,isLoading:i,error:r}=X5();return i?y.jsx(zn,{}):r?y.jsx("div",{className:"error",children:r}):y.jsxs("div",{className:"home-page",children:[y.jsxs("div",{className:"section",children:[y.jsxs("div",{className:"section-header",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"section_title",children:"Recently Played"}),y.jsx("div",{className:"section_desc",children:"Songs you queued up lately"})]}),y.jsx(sn,{to:"/recently",className:"see-more noSelect",children:"See more"})]}),y.jsx(ks,{items:n,infiniteData:{pageParams:[1],pages:[n||[]]},isLoading:i,type:"song",title:"Home - Recently Played"})]}),y.jsxs("div",{className:"section",children:[y.jsxs("div",{className:"section-header",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"section_title",children:"Frequently Played"}),y.jsx("div",{className:"section_desc",children:"Songs you listen to often"})]}),y.jsx(sn,{to:"/frequently",className:"see-more noSelect",children:"See more"})]}),y.jsx(ks,{items:e,infiniteData:{pageParams:[1],pages:[e||[]]},isLoading:i,type:"song",title:"Home - Frequently Played"})]}),y.jsxs("div",{className:"section",children:[y.jsx("div",{className:"section-header",children:y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"section_title",children:"Recently Added"}),y.jsx("div",{className:"section_desc",children:"Albums recently added to the Library"})]})}),y.jsx(ks,{items:t,infiniteData:{pageParams:[1],pages:[t||[]]},isLoading:i,type:"album",title:"Home - Recently Added"})]}),y.jsxs("div",{className:"section",children:[y.jsxs("div",{className:"section-header",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"section_title",children:"Explore Genres"}),y.jsx("div",{className:"section_desc",children:"New genres from recently added media"})]}),y.jsx(sn,{to:"/genres",className:"see-more noSelect",children:"See more"})]}),y.jsx(ks,{items:s,infiniteData:{pageParams:[1],pages:[s||[]]},isLoading:i,type:"genre",title:"Home - Recent Genres",hidden:{add_to_favorite:!0,remove_from_favorite:!0}})]})]})},Z5=({songId:n})=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["instantMix",n],queryFn:async()=>{if(!n)throw new Error("Song ID is required for instant mix");return await e.getInstantMixFromSong(n)},enabled:!!n});return{items:t||[],loading:s||i,error:r?r.message:null}},J5=n=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["mediaItem",n],queryFn:async()=>{if(!n)throw new Error("Item ID is required");return await e.getMediaItem(n)},enabled:!!n});return{mediaItem:t,loading:s||i,error:r?r.message:null}},eB=()=>{const{songId:n}=no(),{items:e,loading:t,error:s}=Z5({songId:n}),{mediaItem:i}=J5(n),r=ss(),{setPageTitle:a}=fr();if(C.useEffect(()=>(i&&a(`Instant Mix - ${i.Name}`),()=>{a("")}),[i,a]),t&&e.length===0)return y.jsx(zn,{});if(s)return y.jsx("div",{className:"error",children:s});const l=e.reduce((u,d)=>u+(d.RunTimeTicks||0),0);return y.jsxs("div",{className:"instant-mix-page",children:[y.jsxs("div",{className:"instant-mix-header",children:[i&&y.jsx(Ln,{width:100,height:100,cornerRadius:8,className:"thumbnail",children:y.jsx(yn,{item:i,type:"Primary",width:100,height:100})}),y.jsxs("div",{className:"instant-mix-details",children:[y.jsx("div",{className:"title",children:"Instant Mix"}),y.jsxs("div",{className:"subtitle",children:["Based on ",y.jsx("span",{className:"highlight",children:i?.Name||"Unknown Song"})]}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:e.length})," ",y.jsx("span",{children:e.length===1?"Track":"Tracks"})]}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(l)})," ",y.jsx("span",{children:"Total"})]})]}),y.jsx("div",{className:"actions noSelect",children:y.jsx("div",{className:"primary",children:y.jsxs("div",{className:"play-instant-mix",onClick:()=>{r.setCurrentPlaylistSimple({playlist:e,title:"Instant Mix"})&&r.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]})})})]})]}),y.jsx(Eu,{tracks:e,infiniteData:{pageParams:[1],pages:[e]},isLoading:t,title:i?`Instant Mix - ${i.Name}`:"Instant Mix",disableUrl:!0})]})};function IE(n){return n==null}function tB(){return nn({queryKey:["config"],queryFn:async()=>{try{const e=await(await fetch("/config.json")).json(),t={};return IE(t.defaultJellyfinUrl)&&(t.defaultJellyfinUrl=e.DEFAULT_JELLYFIN_URL),IE(t.lockJellyfinUrl)&&(t.lockJellyfinUrl=e.LOCK_JELLYFIN_URL==="true"||e.LOCK_JELLYFIN_URL===!0),t}catch(n){console.error(n)}return{}}})}const sB=({onLogin:n})=>{const t=new URLSearchParams(window.location.search).get("demo")==="1",s=t?"https://demo.jellyfin.org/stable":localStorage.getItem("lastServerUrl")||"",[i,r]=C.useState(s),{data:a,isPending:l}=tB(),[u,d]=C.useState(t?"demo":""),[h,m]=C.useState(""),[g,v]=C.useState(!1),[S,x]=C.useState("");C.useEffect(()=>{a&&(a.lockJellyfinUrl?r(a.defaultJellyfinUrl||""):i||r(a.defaultJellyfinUrl||""))},[i,l,a]);const T=async A=>{if(A.preventDefault(),v(!0),x(""),!i){x("Please enter a server URL."),v(!1);return}let E=i.toLowerCase().replace(new RegExp("/+$"),"");if(!/^https?:\/\/.+/.test(E)){x("Invalid URL format. Use http:// or https:// followed by a valid address."),v(!1);return}try{let L;try{L=await s0(E,u,h)}catch(k){const N=E.split("/").slice(0,3).join("/");if(E!==N)E=N,L=await s0(E,u,h);else throw k}const{token:w,userId:D,username:_}=L;localStorage.setItem("lastServerUrl",E),n({serverUrl:E,token:w,userId:D,username:_})}catch(L){L instanceof ro?L.response?L.response.status===401?x("Invalid credentials entered."):L.response.status===404?x("Server not found. Please check the URL."):L.response.status===400?x("Invalid request. Please check your input."):x(`Login failed: Server returned status ${L.response.status}.`):x("Login failed: Request setup error."):x("An unexpected error occurred. Please try again.")}finally{v(!1)}};return l?y.jsx(zn,{}):y.jsxs("form",{className:"login_form",onSubmit:T,children:[y.jsx("div",{className:"error_placeholder",children:S&&y.jsx("div",{className:"error",children:S})}),y.jsx("div",{className:"title",children:"Welcome back"}),!a?.lockJellyfinUrl&&y.jsx("div",{className:"input_container",children:y.jsx("input",{type:"text",placeholder:"Server URL (http://localhost:8096)",value:i,onChange:A=>r(A.target.value),disabled:g})}),y.jsx("div",{className:"input_container",children:y.jsx("input",{type:"text",placeholder:"Username",value:u,onChange:A=>d(A.target.value),disabled:g})}),y.jsx("div",{className:"input_container",children:y.jsx("input",{type:"password",placeholder:"Password",value:h,onChange:A=>m(A.target.value),disabled:g})}),y.jsx("button",{className:"submit_button noSelect",type:"submit",disabled:g,children:g?"Logging in...":"Login with Jellyfin"})]})},nB=({onLogin:n})=>y.jsxs("div",{className:"login",children:[y.jsx("div",{className:"login_header",children:y.jsx("div",{className:"logo"})}),y.jsx(sB,{onLogin:n}),y.jsxs("div",{className:"disclaimer",children:["Jelly Music App - Version ","0.4.6"]})]}),Uw=()=>{const n=ss(),e=n.audioRef,[t,s]=C.useState(null),i=C.useRef([]),r=T=>{const A=T/1e4,E=Math.round(A/10),R=E%100,L=Math.floor(E/100),w=L%60,D=Math.floor(L/60),_=D%60,k=Math.floor(D/60),N=k.toString().padStart(2,"0"),F=_.toString().padStart(2,"0"),V=w.toString().padStart(2,"0"),H=R.toString().padStart(2,"0");return(k>0?`${N}:`:"")+`${F}:${V}.${H}`},a=(T,A)=>(T||0)/1e4-(A||0)*1e3,l=n.currentTrackLyrics?.Lyrics,u=C.useMemo(()=>!(!l||l[0].Start===null||l[0].Start===void 0),[l]),d=C.useMemo(()=>{if(!e||!l)return-1;const T=l.findIndex(A=>a(A?.Start||0,t)>0);return l?T>=0?T-1:l.length-1:-1},[e,l,t]),h=C.useMemo(()=>!e||!l?-1:l&&l[d+1]&&l[d+1]?.Start||0,[e,l,d]),m=C.useRef(null),g=()=>{m.current&&(clearTimeout(m.current),m.current=null)};C.useEffect(()=>{const T=a(h,t);return T>0&&(m.current=setTimeout(()=>{t&&n.isPlaying&&s(t+T/1e3),g()},T)),g},[n.isPlaying,t,d,h]),C.useEffect(()=>{g()},[e,l]),C.useEffect(()=>{if(!e||!l)return;const T=()=>{if(!e.duration){s(null);return}s(e?.currentTime||0)};return e.addEventListener("timeupdate",T),e.addEventListener("playing",T),()=>{e.removeEventListener("timeupdate",T),e.removeEventListener("playing",T)}},[e,l,d]);const v=C.useCallback((T,A="smooth")=>{if(!l||T<0)return;const E=i.current[T];if(!E)return;const R=E.getBoundingClientRect(),L=window.pageYOffset||document.documentElement.scrollTop,w=document.querySelector(".main_header")?.offsetHeight||0,D=document.querySelector(".main_footer")?.offsetHeight||0,_=window.innerHeight-w-D,k=L+R.top-(_/2-R.height/2)-w;window.scrollTo({top:k,behavior:A})},[i,l]),S=C.useCallback(T=>{const A=n.audioRef;A&&l&&l[T]?.Start&&(s(l[T].Start/1e7),A.currentTime=l[T].Start/1e7,u&&v(T))},[u,l,n.audioRef,v]),x=C.useMemo(()=>(l||(i.current=[]),l?.map((T,A)=>y.jsxs("div",{className:"lyrics-line"+(d===A?" active":""),ref:E=>{i.current[A]=E},onClick:()=>S(A),children:[u&&n.lyricsTimestamps?y.jsx("div",{className:"numbers",children:T.Start!==null&&T.Start!==void 0&&r(T.Start)}):null,y.jsx("div",{className:"text"+(n.centeredLyrics?" centered":""),children:T.Text})]},`lyrics-${n.currentTrack?.Id}-${A}`))||null),[n.currentTrack,S,n.lyricsTimestamps,n.centeredLyrics,l,d,u]);return C.useEffect(()=>{u&&v(d)},[n.currentTrack,l,d,v,u]),C.useEffect(()=>{e?.src&&window.scrollTo({top:0,behavior:"auto"})},[e?.src]),y.jsx("div",{className:"lyrics-page"+(l?" active":"")+(u?" synced noSelect":""),children:l&&x||y.jsx("div",{className:"empty",children:n.currentTrackLyricsLoading?y.jsx(zn,{}):"No lyrics found for this track"})})},iB=n=>{const e=Yt(),{data:t,isFetching:s,isPending:i,error:r}=nn({queryKey:["trackInfo",n],queryFn:async()=>await e.getTrackInfo(n),enabled:!!n});return{...t,loading:s||i,error:r?r.message:null}},Fw=({currentTrack:n})=>{const e=n?.MediaSources?.[0].Bitrate,t=iB(typeof e=="number"?"":n?.Id||""),s=Math.round((e||t.MediaSources?.[0].Bitrate||0)/1e3);return y.jsx(y.Fragment,{children:s})},rB=()=>{const{goBack:n}=Q0(),{playlistTitle:e,playlistUrl:t,currentTrack:s,bitrate:i}=ss(),r=xn(),a=ss(),l=W0(),{isOpen:u,selectedItem:d,onContextMenu:h}=di(),{addToFavorites:m,removeFromFavorites:g}=Tl(),{setDisabled:v}=J0(),S=A=>{const E=parseFloat(A.target.value);a.setVolume(E)},x=A=>{A.stopPropagation();const E=A.deltaY>0?-.02:.02,R=Math.max(0,Math.min(1,a.volume+E));a.setVolume(R)};C.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[r.pathname]);const T=A=>{s&&(A.stopPropagation(),h(A,{item:s},!0,{add_to_favorite:!0,remove_from_favorite:!0}))};return y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"now-playing-dimmer noSelect"}),y.jsxs("div",{className:a.isPlaying?"now-playing playing":a.currentTrack?"now-playing paused":"now-playing",children:[y.jsxs("div",{className:"ui",children:[y.jsxs("div",{className:"playing-header",children:[y.jsx("div",{className:"primary",children:y.jsx("div",{onClick:n,className:"return_icon",title:"Back",children:y.jsx(tf,{size:16})})}),y.jsxs("div",{className:"secondary",children:[y.jsx("div",{className:"title",children:"Playing From"}),y.jsx("div",{className:"desc",title:e||"No Playlist",children:t?y.jsx(sn,{to:t,className:"textlink",children:e}):y.jsx(y.Fragment,{children:e||"No Playlist"})})]}),y.jsxs("div",{className:"tertiary",children:[y.jsx("div",{className:"favorite-state",title:s?.UserData?.IsFavorite?"Remove from favorites":"Add to favorites",onClick:async()=>{if(s?.Id)try{s?.UserData?.IsFavorite?await g(s):await m(s)}catch(A){console.error("Failed to update favorite status:",A)}},children:s?.UserData?.IsFavorite?y.jsx(ci,{size:16}):y.jsx(uu,{size:16})}),y.jsx("div",{className:`more ${u&&d?.Id===s?.Id?"active":""}`,onClick:T,title:"More",children:y.jsx(io,{width:14,height:14})})]})]}),y.jsxs("div",{className:"playing-content",children:[y.jsx("div",{className:"playing-artwork noSelect",children:y.jsxs(Ln,{width:360,height:360,cornerRadius:14,isResponsive:!0,className:"thumbnail",children:[s&&y.jsx(yn,{item:s,type:"Primary",width:360,height:360}),!s&&y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(dl,{width:"50%",height:"50%"})}),y.jsx("div",{className:"shadow-border"})]})}),y.jsxs("div",{className:"playing-info",children:[y.jsx("div",{className:"song-name",title:s?.Name||"No Track Played",children:s?.Name||"No Track Played"}),y.jsx("div",{className:"artist",title:s?.Artists&&s.Artists.length>0?s.Artists.join(", "):"No Artist",children:s?.Artists&&s.Artists.length>0?s.Artists.join(", "):"No Artist"})]}),y.jsxs("div",{className:"playing-progress noSelect",children:[y.jsxs("div",{className:"info",children:[y.jsx("div",{className:"duration",children:a.formatTime(l.progress)}),y.jsxs("div",{className:"quality",children:[y.jsx("div",{className:"text",children:i===32e4?"High":i===256e3?"Medium":i===192e3?"Low":i===128e3?"Minimal":"Source"}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"bitrate",children:[y.jsx("span",{className:"number",children:i===32e4?"320":i===256e3?"256":i===192e3?"192":i===128e3?"128":y.jsx(Fw,{currentTrack:s})})," ","kbps"]}),y.jsx(pr,{offlineState:s?.offlineState,size:12,itemId:s?.Id})]}),y.jsx("div",{className:"duration",children:a.formatTime(l.duration)})]}),y.jsx(Z0,{})]}),y.jsxs("div",{className:"playing-controls",children:[y.jsx("div",{className:`shuffle ${a.shuffle?"active":""}`,onClick:a.toggleShuffle,title:"Shuffle",children:y.jsx("div",{className:"shuffle-icon"})}),y.jsxs("div",{className:"primary",children:[y.jsx("div",{className:"previous",onClick:a.previousTrack,title:"Previous",children:y.jsx("div",{className:"previous-icon"})}),y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"play",onClick:a.togglePlayPause,title:"Play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",onClick:a.togglePlayPause,title:"Pause",children:y.jsx("div",{className:"pause-icon"})})]}),y.jsx("div",{className:"next",onClick:a.nextTrack,title:"Next",children:y.jsx("div",{className:"next-icon"})})]}),y.jsx("div",{className:`repeat ${a.repeat==="off"?"":"active"}`,onClick:a.toggleRepeat,title:"Repeat",children:y.jsx("div",{className:`repeat-icon${a.repeat==="one"?"-one":""}`})})]})]}),y.jsxs("div",{className:"playing-footer",children:[y.jsxs("div",{className:"actions",children:[y.jsx(sn,{to:"/nowplaying/lyrics",className:"action",title:"Lyrics",children:y.jsx(GA,{width:20,height:20})}),y.jsx(sn,{to:"/queue",className:"action",title:"Queue",children:y.jsx(_2,{width:20,height:20})})]}),y.jsxs("div",{className:"playing-volume",children:[y.jsxs("div",{className:"indicator",children:["Volume: ",(a.volume*100).toFixed(0),"%"]}),y.jsx("div",{className:"control",children:y.jsx("input",{type:"range",id:"volume",name:"volume",min:"0",max:"1",step:"0.02",value:a.volume,onChange:S,onWheel:x,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1)})})]})]})]}),y.jsx("div",{className:"background-artwork noSelect",children:s&&y.jsx(yn,{item:s,type:"Primary",width:360,height:360})})]})]})},aB=()=>{const{goBack:n}=Q0(),{currentTrack:e,bitrate:t}=ss(),s=xn(),i=ss(),r=W0(),{isOpen:a,selectedItem:l,onContextMenu:u}=di(),{addToFavorites:d,removeFromFavorites:h}=Tl();C.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[s.pathname]);const m=g=>{e&&(g.stopPropagation(),u(g,{item:e},!0,{add_to_favorite:!0,remove_from_favorite:!0}))};return y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"now-playing-dimmer noSelect"}),y.jsxs("div",{className:i.isPlaying?"now-playing-lyrics playing":i.currentTrack?"now-playing-lyrics paused":"now-playing-lyrics",children:[y.jsxs("div",{className:"ui",children:[y.jsx("div",{className:"playing-header main_header",children:y.jsx("div",{className:"wrapper",children:y.jsxs("div",{className:"inner",children:[y.jsxs("div",{className:"primary",children:[y.jsx("div",{onClick:n,className:"return_icon",title:"Back",children:y.jsx(tf,{size:16})}),y.jsxs(Ln,{width:40,height:40,cornerRadius:6,className:"thumbnail",children:[e&&y.jsx(yn,{item:e,type:"Primary",width:40,height:40}),!e&&y.jsx("div",{className:"fallback-thumbnail",children:y.jsx(dl,{width:"50%",height:"50%"})}),y.jsx("div",{className:"shadow-border"})]})]}),y.jsxs("div",{className:"secondary",children:[y.jsx("div",{className:"artist",title:e?.Artists&&e.Artists.length>0?e.Artists.join(", "):"No Artist",children:e?.Artists&&e.Artists.length>0?e.Artists.join(", "):"No Artist"}),y.jsx("div",{className:"song-name",title:e?.Name||"No Track Played",children:e?.Name||"No Track Played"})]}),y.jsxs("div",{className:"tertiary",children:[y.jsx("div",{className:"favorite-state",title:e?.UserData?.IsFavorite?"Remove from favorites":"Add to favorites",onClick:async()=>{if(e?.Id)try{e?.UserData?.IsFavorite?await h(e):await d(e)}catch(g){console.error("Failed to update favorite status:",g)}},children:e?.UserData?.IsFavorite?y.jsx(ci,{size:16}):y.jsx(uu,{size:16})}),y.jsx("div",{className:`more ${a&&l?.Id===e?.Id?"active":""}`,onClick:m,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})})}),y.jsx("div",{className:"playing-content",children:y.jsx(Uw,{})}),y.jsx("div",{className:"playing-footer main_footer",children:y.jsx("div",{className:"wrapper",children:y.jsxs("div",{className:"inner",children:[y.jsxs("div",{className:"playing-progress noSelect",children:[y.jsxs("div",{className:"info",children:[y.jsx("div",{className:"duration",children:i.formatTime(r.progress)}),y.jsxs("div",{className:"quality",children:[y.jsx("div",{className:"text",children:t===32e4?"High":t===256e3?"Medium":t===192e3?"Low":t===128e3?"Minimal":"Source"}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"bitrate",children:[y.jsx("span",{className:"number",children:t===32e4?"320":t===256e3?"256":t===192e3?"192":t===128e3?"128":y.jsx(Fw,{currentTrack:e})})," ","kbps"]}),y.jsx(pr,{offlineState:e?.offlineState,size:12,itemId:e?.Id})]}),y.jsx("div",{className:"duration",children:i.formatTime(r.duration)})]}),y.jsx(Z0,{})]}),y.jsxs("div",{className:"playing-controls",children:[y.jsx("div",{className:`shuffle ${i.shuffle?"active":""}`,onClick:i.toggleShuffle,title:"Shuffle",children:y.jsx("div",{className:"shuffle-icon"})}),y.jsxs("div",{className:"primary",children:[y.jsx("div",{className:"previous",onClick:i.previousTrack,title:"Previous",children:y.jsx("div",{className:"previous-icon"})}),y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"play",onClick:i.togglePlayPause,title:"Play",children:y.jsx("div",{className:"play-icon"})}),y.jsx("div",{className:"pause",onClick:i.togglePlayPause,title:"Pause",children:y.jsx("div",{className:"pause-icon"})})]}),y.jsx("div",{className:"next",onClick:i.nextTrack,title:"Next",children:y.jsx("div",{className:"next-icon"})})]}),y.jsx("div",{className:`repeat ${i.repeat==="off"?"":"active"}`,onClick:i.toggleRepeat,title:"Repeat",children:y.jsx("div",{className:`repeat-icon${i.repeat==="one"?"-one":""}`})})]})]})})})]}),y.jsx("div",{className:"background-artwork noSelect",children:e&&y.jsx(yn,{item:e,type:"Primary",width:360,height:360})})]})]})},oB=n=>{const e=Yt(),t=40,{jellySort:s}=Li(),{data:i,error:r}=nn({queryKey:["playlist",n],queryFn:()=>e.getPlaylist(n)}),{data:a,error:l}=nn({queryKey:["playlistTotals",n],queryFn:()=>e.getPlaylistTotals(n)});C.useEffect(()=>{(r||l)instanceof ro&&(r||l)?.response?.status===401&&(localStorage.removeItem("auth"),window.location.href="/login")},[r,l]);const u=_i({queryKey:["playlistTracks",n,s.sortBy,s.sortOrder],queryFn:async({pageParam:g=0})=>{const v=g*t;return await e.getPlaylistTracks(n,v,t,s.sortBy,s.sortOrder)},queryFnReviver:{fn:"getPlaylistTracks",params:[n,ui,t,s.sortBy,s.sortOrder]}}),d=a?.totalPlaytime||0,h=a?.totalTrackCount||0,m=a?.totalPlays||0;return{...u,playlistData:i,totalPlaytime:d,totalTrackCount:h,totalPlays:m}},lB=()=>{const n=ss(),{addToFavorites:e,removeFromFavorites:t}=Tl(),{playlistId:s}=no(),{playlistData:i,items:r,infiniteData:a,isLoading:l,error:u,totalPlaytime:d,totalTrackCount:h,totalPlays:m,reviver:g,loadMore:v}=oB(s),{setPageTitle:S}=fr(),{isOpen:x,selectedItem:T,onContextMenu:A}=di();if(C.useEffect(()=>(i&&S(i.Name),()=>{S("")}),[i,S]),l&&r.length===0)return y.jsx(zn,{});if(u)return y.jsx("div",{className:"error",children:u||"Playlist not found"});if(!i)return y.jsx("div",{className:"error",children:"No tracks were found"});const E=R=>{R.stopPropagation(),A(R,{item:i},!0,{add_to_favorite:!0,remove_from_favorite:!0})};return y.jsxs("div",{className:"playlist-page",children:[y.jsxs("div",{className:"playlist-header",children:[y.jsx(Ln,{width:100,height:100,cornerRadius:8,className:"thumbnail",children:y.jsx(yn,{item:i,type:"Primary",width:100,height:100})}),y.jsxs("div",{className:"playlist-details",children:[y.jsx("div",{className:"title",children:i.Name}),y.jsx("div",{className:"date",children:tw(i.DateCreated)}),y.jsxs("div",{className:"stats",children:[y.jsxs("div",{className:"track-amount",children:[y.jsx("span",{className:"number",children:h})," ",y.jsx("span",{children:h===1?"Track":"Tracks"})]}),y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"length",children:[y.jsx("span",{className:"number",children:Cl(d)})," ",y.jsx("span",{children:"Total"})]}),m>0&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"divider"}),y.jsxs("div",{className:"plays",children:[y.jsx("span",{className:"number",children:m})," ",m===1?"Play":"Plays"]})]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsxs("div",{className:"primary",children:[y.jsxs("div",{className:"play-playlist",onClick:()=>{n.setCurrentPlaylistSimple({playlist:r,title:i.Name})&&n.playTrack(0)},children:[y.jsx("div",{className:"play-icon"}),y.jsx("div",{className:"text",children:"Play"})]}),y.jsx("div",{className:"favorite-state",title:i.UserData?.IsFavorite?"Remove from favorites":"Add to favorites",onClick:async()=>{if(i?.Id)try{i.UserData?.IsFavorite?await t(i):await e(i)}catch(R){console.error("Failed to update favorite status:",R)}},children:i.UserData?.IsFavorite?y.jsx(ci,{size:16}):y.jsx(uu,{size:16})})]}),y.jsxs("div",{className:"secondary",children:[y.jsx(pr,{offlineState:i.offlineState,size:16,itemId:i.Id}),y.jsx("div",{className:`more ${x&&T?.Id===i?.Id?"active":""}`,onClick:E,title:"More",children:y.jsx(io,{width:14,height:14})})]})]})]})]}),y.jsx(Eu,{tracks:r,infiniteData:a,isLoading:l,showType:"artist",playlistId:s,title:i?i.Name:"Playlist",reviver:g,loadMore:v})]})},cB=()=>{const{setPageTitle:n}=fr(),{currentTrack:e,currentPlaylist:t,currentTrackIndex:s,playlistTitle:i,playlistUrl:r,isLoading:a,loadMore:l}=ss();if(C.useEffect(()=>(n("Queue"),()=>n("")),[n]),!e)return y.jsx("div",{className:"empty-queue",children:"Queue is currently empty"});const u=t.slice(s+1);return y.jsxs("div",{className:"queue-page",children:[y.jsx("div",{className:"queue-header",children:y.jsx(ks,{items:[e],infiniteData:{pageParams:[1],pages:[[e]]},isLoading:!1,type:"song",title:"Current Track - Queue",hidden:{add_to_queue:!0,remove_from_queue:!0}})}),(u.length>0||a)&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"queue-title",children:"Playing Next"}),y.jsx("div",{className:"queue-desc",children:y.jsxs("span",{className:"text",children:["From"," ",r?y.jsx(sn,{to:r,className:"textlink",children:i}):y.jsx("span",{className:"highlight",children:i})]})}),y.jsx(ks,{items:u,infiniteData:{pageParams:[1],pages:[u]},indexOffset:s+1,isLoading:a,type:"song",loadMore:l,title:"Next Up - Queue",hidden:{add_to_queue:!0},reviver:"persistAll",isDraggable:!0})]})]})},uB=()=>{const n=Yt(),e=40;return _i({queryKey:["recentlyPlayed"],queryFn:async({pageParam:t=0})=>{const s=t*e;return await n.fetchRecentlyPlayed(s,e)},queryFnReviver:{fn:"fetchRecentlyPlayed",params:[ui,e]}})},dB=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=uB();return y.jsxs("div",{className:"recently-page",children:[s&&y.jsx("div",{className:"error",children:s}),y.jsx(ks,{items:n,infiniteData:e,isLoading:t,type:"song",title:"Recently Played",reviver:i,loadMore:r})]})},hB=n=>{const e=Yt(),t=Sl(),{data:s,isFetching:i,error:r}=nn({queryKey:["searchDetailed",n],queryFn:async()=>{if(!n)return{artists:[],albums:[],playlists:[],songs:[],genres:[]};if(navigator.onLine){const[a,l,u,d,h]=await Promise.all([e.searchArtists(n,10),e.searchAlbumsDetailed(n,10),e.searchPlaylistsDetailed(n,10),e.fetchSongs(n),e.searchGenres(n,10)]),m=a.map(x=>({type:"Artist",id:x.Id,name:x.Name,thumbnailUrl:e.getImageUrl(x,"Primary",{width:36,height:36}),isFavorite:x.UserData?.IsFavorite||!1,_mediaItem:x})),g=l.map(x=>({type:"Album",id:x.Id,name:x.Name,thumbnailUrl:e.getImageUrl(x,"Primary",{width:46,height:46}),artists:[x.AlbumArtists?.[0]?.Name||x.AlbumArtist||"Unknown Artist"],isFavorite:x.UserData?.IsFavorite||!1,_mediaItem:x})),v=u.map(x=>({type:"Playlist",id:x.Id,name:x.Name,thumbnailUrl:e.getImageUrl(x,"Primary",{width:46,height:46}),totalTracks:x.ChildCount||0,isFavorite:x.UserData?.IsFavorite||!1,_mediaItem:x})),S=h.map(x=>({type:"Genre",id:x.Name,name:x.Name,_mediaItem:x}));return{artists:m,albums:g,playlists:v,songs:d,genres:S}}else{const a=await t.searchOfflineItems(n,50);return{artists:[],albums:[],playlists:[],songs:a,genres:[]}}}});return{results:s||{artists:[],albums:[],playlists:[],songs:[],genres:[]},loading:i,error:r?r.message:null}},fB=()=>{const{query:n}=no(),{setPageTitle:e}=fr(),{results:t,loading:s,error:i}=hB(n);return C.useEffect(()=>(n&&e(`Search results for '${n}'`),()=>e("")),[n,e]),s?y.jsx(zn,{}):i?y.jsx("div",{children:i}):n?y.jsx("div",{className:"search-results-page",children:y.jsxs("div",{className:"search-content",children:[t.songs.length>0&&y.jsx("div",{className:"section songs",children:y.jsx(Yy,{tracks:t.songs,title:`Search results for '${n}'`})}),t.artists.length>0&&y.jsxs("div",{className:"section artists",children:[y.jsx("div",{className:"title",children:"Artists"}),y.jsx(ks,{items:t.artists.map(r=>r._mediaItem),infiniteData:{pageParams:[1],pages:[t.artists.map(r=>r._mediaItem)]},isLoading:s,type:"artist",title:`Artists for '${n}'`,hidden:{view_artist:!0}})]}),t.albums.length>0&&y.jsxs("div",{className:"section albums",children:[y.jsx("div",{className:"title",children:"Albums"}),y.jsx(ks,{items:t.albums.map(r=>r._mediaItem),infiniteData:{pageParams:[1],pages:[t.albums.map(r=>r._mediaItem)]},isLoading:s,type:"album",title:`Albums for '${n}'`,albumDisplayMode:"artist",hidden:{view_album:!0}})]}),t.playlists.length>0&&y.jsxs("div",{className:"section playlists",children:[y.jsx("div",{className:"title",children:"Playlists"}),y.jsx(ks,{items:t.playlists.map(r=>r._mediaItem),infiniteData:{pageParams:[1],pages:[t.playlists.map(r=>r._mediaItem)]},isLoading:s,type:"playlist",title:`Playlists for '${n}'`})]}),t.genres.length>0&&y.jsxs("div",{className:"section genres",children:[y.jsx("div",{className:"title",children:"Genres"}),y.jsx("div",{className:"section-list noSelect",children:t.genres.map(r=>y.jsxs(sn,{to:`/genre/${r.id}`,className:"section-item",children:[y.jsx("div",{className:"icon",children:y.jsx(z0,{size:16})}),y.jsx("div",{className:"section-info",children:y.jsx("div",{className:"name",children:r.name})}),r.isFavorite&&y.jsx("div",{className:"favorited",title:"Favorited",children:y.jsx(ci,{size:16})})]},r.id))})]}),t.artists.length===0&&t.albums.length===0&&t.playlists.length===0&&t.songs.length===0&&t.genres.length===0&&y.jsxs("div",{children:["No results found for '",n,"'."]})]})}):y.jsx("div",{children:"Enter a search query to see results."})},mB=({onLogout:n})=>{const e=Ea(),t=Yt(),s=Sl(),{theme:i,toggleTheme:r}=t6(),[a,l]=C.useState(null),[u,d]=C.useState(null),[h,m]=C.useState(null),{sessionPlayCount:g,resetSessionCount:v,bitrate:S,setBitrate:x}=ss(),T=ss(),A=lu(),{storageStats:E,refreshStorageStats:R,queueCount:L,clearQueue:w}=pu(),[D,_]=C.useState(!1);C.useEffect(()=>{(async()=>{try{const[H,J,X]=await Promise.all([t.fetchUserInfo(),t.fetchClientIp(),t.measureLatency()]);if(H.LastLoginDate){const j=new Date(H.LastLoginDate).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",year:"numeric",hour12:!0}).replace(/,/,"");l(j)}else l(null);d(J),m(X)}catch(H){console.error("Error fetching data:",H)}})()},[t]);const k=()=>{T.audioRef.pause(),T.crossfadeRef.pause(),v(),n(),e("/login")},N=C.useCallback(async()=>{if(confirm("Are you sure you want to clear all downloads? This cannot be undone."))try{_(!0),await s.clearAllDownloads(),A.clear(),await zc.removeClient(),w(),await R()}catch(V){console.error("Failed to clear downloads:",V)}finally{_(!1)}},[s,w,A,R]),F=async()=>{A.clear(),await zc.removeClient(),navigator.onLine&&(await Promise.all((await navigator.serviceWorker?.getRegistrations()||[]).map(V=>V.unregister())),await Promise.all((await window.caches?.keys()||[]).map(V=>window.caches.delete(V)))),window.location.reload()};return y.jsxs("div",{className:"settings-page",children:[y.jsxs("div",{className:"section appearance",children:[y.jsx("div",{className:"title",children:"Appearance"}),y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"options primary noSelect",children:[y.jsxs("div",{className:`option light ${i==="light"?"active":""}`,onClick:()=>r("light"),children:[y.jsx("div",{className:"visual"}),y.jsx("div",{className:"desc",children:"Light"})]}),y.jsxs("div",{className:`option dark ${i==="dark"?"active":""}`,onClick:()=>r("dark"),children:[y.jsx("div",{className:"visual"}),y.jsx("div",{className:"desc",children:"Dark"})]}),y.jsxs("div",{className:`option system ${i==="system"?"active":""}`,onClick:()=>r("system"),children:[y.jsx("div",{className:"visual"}),y.jsx("div",{className:"desc",children:"System"})]})]}),y.jsxs("div",{className:"options secondary noSelect",children:[y.jsx("div",{className:`option classic ${T.maxWidth==="800"?"active":""}`,onClick:()=>T.setMaxWidth("800"),children:y.jsx("div",{className:"desc",children:"Classic"})}),y.jsx("div",{className:`option medium ${T.maxWidth==="1000"?"active":""}`,onClick:()=>T.setMaxWidth("1000"),children:y.jsx("div",{className:"desc",children:"Medium"})}),y.jsx("div",{className:`option large ${T.maxWidth==="1400"?"active":""}`,onClick:()=>T.setMaxWidth("1400"),children:y.jsx("div",{className:"desc",children:"Large"})}),y.jsx("div",{className:`option wide ${T.maxWidth==="wide"?"active":""}`,onClick:()=>T.setMaxWidth("wide"),children:y.jsx("div",{className:"desc",children:"Wide"})})]})]})]}),y.jsxs("div",{className:"section quality",children:[y.jsx("div",{className:"title",children:"Audio Quality"}),y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"info",children:[y.jsx("div",{className:"subtitle",children:"Streaming & Offline Sync"}),y.jsx("div",{className:"subdesc",children:"Adjusting audio quality enables server-side transcoding, converting to a compatible format with a lower bitrate for smoother streaming or efficient offline syncing"})]}),y.jsxs("div",{className:"options noSelect",children:[y.jsxs("div",{className:"option source"+(S?"":" active"),onClick:()=>x(0),children:[y.jsx("div",{className:"status",children:y.jsx(Ic,{size:16})}),y.jsxs("div",{className:"details",children:[y.jsx("div",{className:"title",children:"Source"}),y.jsx("div",{className:"desc",children:"Direct playback of the original audio source without modifications"})]})]}),y.jsxs("div",{className:"option high"+(S===32e4?" active":""),onClick:()=>x(32e4),children:[y.jsx("div",{className:"status",children:y.jsx(Ic,{size:16})}),y.jsxs("div",{className:"details",children:[y.jsxs("div",{className:"title",children:["High ",y.jsx("span",{className:"bitrate",children:"320 kbps"})]}),y.jsx("div",{className:"desc",children:"Superior sound quality, perfect for immersive listening with moderate data usage"})]})]}),y.jsxs("div",{className:"option medium"+(S===256e3?" active":""),onClick:()=>x(256e3),children:[y.jsx("div",{className:"status",children:y.jsx(Ic,{size:16})}),y.jsxs("div",{className:"details",children:[y.jsxs("div",{className:"title",children:["Medium ",y.jsx("span",{className:"bitrate",children:"256 kbps"})]}),y.jsx("div",{className:"desc",children:"Crisp audio with a balanced blend of quality and data efficiency"})]})]}),y.jsxs("div",{className:"option low"+(S===192e3?" active":""),onClick:()=>x(192e3),children:[y.jsx("div",{className:"status",children:y.jsx(Ic,{size:16})}),y.jsxs("div",{className:"details",children:[y.jsxs("div",{className:"title",children:["Low ",y.jsx("span",{className:"bitrate",children:"192 kbps"})]}),y.jsx("div",{className:"desc",children:"Solid quality tailored for streaming with reduced bandwidth"})]})]}),y.jsxs("div",{className:"option minimal"+(S===128e3?" active":""),onClick:()=>x(128e3),children:[y.jsx("div",{className:"status",children:y.jsx(Ic,{size:16})}),y.jsxs("div",{className:"details",children:[y.jsxs("div",{className:"title",children:["Minimal ",y.jsx("span",{className:"bitrate",children:"128 kbps"})]}),y.jsx("div",{className:"desc",children:"Essential audio quality optimized for the lowest data consumption"})]})]})]})]})]}),y.jsxs("div",{className:"section offline-sync",children:[y.jsxs("div",{className:"primary",children:[y.jsxs("div",{className:"container",children:[y.jsx("div",{className:"title",children:"Offline Sync"}),y.jsxs("div",{className:"desc",children:["Synced - ",y.jsx("span",{className:"number",children:E.trackCount})," Track",E.trackCount===1?"":"s",L>0?y.jsxs(y.Fragment,{children:[" ","(",y.jsx("span",{className:"number",children:L})," track",L===1?"":"s"," in queue)"]}):""," ","/"," ",y.jsx("span",{className:"number",children:qA(E.trackCount===0?0:E?.indexedDB||0)})," ","Used"]})]}),y.jsx("div",{className:"options noSelect",children:y.jsx("div",{className:"option",children:(E.trackCount>0||L>0||!s.isInitialized())&&y.jsx("button",{className:"btn clear",onClick:N,disabled:D,children:D?"Clearing...":"Clear All"})})})]}),y.jsx("div",{className:"desc",children:y.jsxs("div",{className:"info",children:["Cache your music library for seamless offline playback, with new tracks auto-syncing to saved playlists, albums, or artists."," ",y.jsx(sn,{to:"/synced",className:"textlink",children:"Browse music library"}),", available once tracks are synced"]})})]}),y.jsxs("div",{className:"section preload"+(T.isPreloadActive?"":" disabled"),children:[y.jsxs("div",{className:"primary",children:[y.jsx("div",{className:"container",children:y.jsx("div",{className:"title",children:"Preload"})}),y.jsxs("div",{className:"options noSelect",children:[y.jsxs("div",{className:"option adjustable",children:[y.jsxs("div",{className:"number current",children:[T.preloadDuration,"s"]}),y.jsx("div",{className:"slider",children:y.jsx("input",{type:"range",id:"preload",name:"preload",min:"2",max:"30",step:"1",value:T.preloadDuration,onChange:V=>T.setPreloadDuration(Number(V.target.value))})}),y.jsx("div",{className:"number",children:"30s"})]}),y.jsx("div",{className:"option",children:y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.isPreloadActive,onChange:V=>T.setIsPreloadActive(V.target.checked)}),y.jsx("span",{className:"slider"})]})})]})]}),y.jsx("div",{className:"desc",children:y.jsx("div",{className:"info",children:"Preload the next track to ensure seamless playback, eliminating buffering delays for a smoother, uninterrupted listening experience, even with high-quality audio or slower connections"})})]}),y.jsxs("div",{className:"section crossfade"+(T.isCrossfadeActive?"":" disabled"),children:[y.jsxs("div",{className:"primary",children:[y.jsx("div",{className:"container",children:y.jsx("div",{className:"title",children:"Crossfade"})}),y.jsxs("div",{className:"options noSelect",children:[y.jsxs("div",{className:"option adjustable",children:[y.jsxs("div",{className:"number current",children:[T.crossfadeDuration,"s"]}),y.jsx("div",{className:"slider",children:y.jsx("input",{type:"range",id:"crossfade",name:"crossfade",min:"1",max:"12",step:"1",value:T.crossfadeDuration,onChange:V=>T.setCrossfadeDuration(Number(V.target.value))})}),y.jsx("div",{className:"number",children:"12s"})]}),y.jsx("div",{className:"option",children:y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.isCrossfadeActive,onChange:V=>T.setIsCrossfadeActive(V.target.checked)}),y.jsx("span",{className:"slider"})]})})]})]}),y.jsx("div",{className:"desc",children:y.jsx("div",{className:"info",children:"Smoothly transition between tracks by gradually fading out the current song while simultaneously fading in the next, creating a seamless and immersive listening experience"})})]}),y.jsxs("div",{className:"section interface-ui",children:[y.jsx("div",{className:"title",children:"Interface"}),y.jsx("div",{className:"inner row",children:y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"desc",children:[y.jsx("div",{className:"subtitle",children:"Filter state"}),y.jsx("div",{className:"subdesc",children:"Remember selected filters across sessions for a consistent experience"})]}),y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.rememberFilters,onChange:V=>T.setRememberFilters(V.target.checked)}),y.jsx("span",{className:"slider"})]})]})}),y.jsx("div",{className:"inner row",children:y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"desc",children:[y.jsx("div",{className:"subtitle",children:"Queue protection"}),y.jsx("div",{className:"subdesc",children:"Warn before overwriting the active queue if it includes manually added tracks"})]}),y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.warnBeforeOverwriteQueue,onChange:V=>T.setWarnBeforeOverwriteQueue(V.target.checked)}),y.jsx("span",{className:"slider"})]})]})})]}),y.jsxs("div",{className:"section lyrics",children:[y.jsx("div",{className:"title",children:"Lyrics"}),y.jsx("div",{className:"inner row",children:y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"desc",children:[y.jsx("div",{className:"subtitle",children:"Timestamps"}),y.jsx("div",{className:"subdesc",children:"Show timestamps with the synchronized lyrics"})]}),y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.lyricsTimestamps,onChange:V=>T.setLyricsTimestamps(V.target.checked)}),y.jsx("span",{className:"slider"})]})]})}),y.jsx("div",{className:"inner row",children:y.jsxs("div",{className:"container",children:[y.jsxs("div",{className:"desc",children:[y.jsx("div",{className:"subtitle",children:"Alignment"}),y.jsx("div",{className:"subdesc",children:"Center lyrics for a different look, overriding the default left alignment"})]}),y.jsxs("label",{className:"switch",children:[y.jsx("input",{type:"checkbox",checked:T.centeredLyrics,onChange:V=>T.setCenteredLyrics(V.target.checked)}),y.jsx("span",{className:"slider"})]})]})})]}),y.jsxs("div",{className:"section about",children:[y.jsx("div",{className:"title",children:"About"}),y.jsxs("div",{className:"desc",children:[y.jsxs("p",{className:"subtitle",children:["Jelly Music App - Version ","0.4.6"]}),y.jsx("p",{children:"An open source music player for Jellyfin"}),y.jsxs("p",{children:["Carefully crafted with great attention to detail, aiming to reduce noise and distractions with a minimalistic & lightweight interface:",y.jsx("span",{className:"mantra",children:' "the quieter you become, the more you are able to hear"'})]}),y.jsxs("p",{className:"subfooter",children:[y.jsx("span",{children:"Source code is freely available on "}),y.jsx("a",{target:"_blank",rel:"noopener noreferrer",className:"textlink",href:"https://github.com/Stannnnn/jelly-app",children:"GitHub"}),y.jsx("span",{children:" and is licensed under the MIT license"})]})]})]}),y.jsxs("div",{className:"section session",children:[y.jsx("div",{className:"title",children:"Session"}),y.jsxs("div",{className:"desc",children:[y.jsxs("p",{children:["Currently connected to"," ",y.jsx("a",{target:"_blank",rel:"noopener noreferrer",className:"textlink",href:t.auth.serverUrl,children:t.auth.serverUrl})," ",h!==null&&y.jsx("span",{children:y.jsxs("span",{children:["with ",h,"ms latency"]})})]}),y.jsxs("p",{children:["Last login: ",a," ",u?` from ${u}`:""]}),y.jsxs("p",{children:["Played"," ",g!==null&&y.jsxs("span",{children:[g," ",g===1?"track":"tracks"]})," ","since login"]})]}),y.jsxs("div",{className:"actions noSelect",children:[y.jsx("button",{onClick:k,className:"btn logout",children:"Logout"}),y.jsx("button",{onClick:F,className:"btn reload",title:"Reloading can help with issues like outdated cache or version conflicts.",children:"Reload App"})]})]})]})},pB=()=>{const n=Yt(),e=40,{jellySort:t}=Li();return _i({queryKey:["jellyfinTracks",t.sortBy,t.sortOrder],queryFn:async({pageParam:s=0})=>{const i=s*e;return await n.getAllTracks(i,e,t.sortBy,t.sortOrder)},queryFnReviver:{fn:"getAllTracks",params:[ui,e,t.sortBy,t.sortOrder]}})},gB=()=>{const{items:n,infiniteData:e,isLoading:t,error:s,reviver:i,loadMore:r}=pB();return y.jsxs("div",{className:"tracks-page",children:[s&&y.jsx("div",{className:"error",children:s}),y.jsx(ks,{items:n,infiniteData:e,isLoading:t,reviver:i,type:"song",loadMore:r,title:"Tracks"})]})},yB=()=>y.jsx(S_,{children:window.__NPM_LIFECYCLE_EVENT__==="dev:nocache"?y.jsx(jE,{client:Bg,children:y.jsx(RE,{})}):y.jsx(KD,{client:Bg,persistOptions:{persister:zc},children:y.jsx(RE,{})})}),RE=()=>{const[n,e]=C.useState(()=>{const u=localStorage.getItem("auth");return u?JSON.parse(u):null}),[t,s]=C.useState(!1),i=lu(),r=u=>{e(u),localStorage.setItem("auth",JSON.stringify(u))},a=async()=>{s(!0),localStorage.removeItem("repeatMode"),e(null),localStorage.removeItem("auth"),s(!1),i.clear(),await zc.removeClient()};C.useEffect(()=>{n||localStorage.removeItem("auth")},[n]),C.useEffect(()=>{const u=/Win/.test(navigator.userAgent),d=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),h=/Edg/.test(navigator.userAgent)&&/Microsoft Corporation/.test(navigator.vendor),m=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,g=/Android/.test(navigator.userAgent)&&(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone);u&&(d||h)&&document.getElementsByTagName("html")[0].classList.add("winOS"),m&&document.getElementsByTagName("html")[0].classList.add("iOS"),g&&document.getElementsByTagName("html")[0].classList.add("safeAreaFallback");const v=()=>{const S=m&&!window.matchMedia("(display-mode: standalone)").matches&&!navigator.standalone&&!window.matchMedia("(orientation: landscape)").matches,x=document.getElementsByTagName("html")[0];m&&(S?x.classList.add("safeAreaFallback"):x.classList.remove("safeAreaFallback"))};return v(),window.matchMedia("(orientation: landscape)").addEventListener("change",v),()=>{window.matchMedia("(orientation: landscape)").removeEventListener("change",v)}},[]);const l=y.jsx("div",{className:"music-app",children:y.jsxs(Mg,{children:[y.jsx(rs,{path:"/login",element:n?y.jsx(kg,{to:"/"}):y.jsx(nB,{onLogin:r})}),y.jsx(rs,{path:"/*",element:n?y.jsx($N,{auth:n,children:y.jsx(Y2,{children:y.jsx(e6,{children:y.jsx(X4,{initialVolume:.5,clearOnLogout:t,children:y.jsx(aN,{children:y.jsxs(FN,{children:[y.jsx(vB,{auth:n,handleLogout:a}),y.jsx(y_,{})]})})})})})}):y.jsx(kg,{to:"/login"})})]})});return y.jsx(a_,{basename:"/",children:y.jsx(jN,{children:y.jsx(HN,{children:y.jsx(Z4,{children:y.jsx(n6,{children:l})})})})})},vB=({auth:n,handleLogout:e})=>{i6();const{showSidenav:t,toggleSidenav:s}=X0(),i=di(),{maxWidth:r}=ss(),a=i?.isOpen||!1,l=i?.isTouchDevice||!1;C.useEffect(()=>{const d=document.documentElement;r==="wide"?d.style.setProperty("--interface-max-width","100%"):d.style.setProperty("--interface-max-width",`${r}px`)},[r]);const u=C.useCallback(()=>y.jsx(mB,{onLogout:e}),[e]);return y.jsxs(Mg,{children:[y.jsx(rs,{path:"/nowplaying",element:y.jsx(rB,{})}),y.jsx(rs,{path:"/nowplaying/lyrics",element:y.jsx(aB,{})}),y.jsx(rs,{path:"*",element:y.jsxs("div",{className:"interface",children:[y.jsx("div",{className:t||a&&l?"dimmer active noSelect":"dimmer noSelect",onClick:t?s:i?.closeDropdown}),y.jsx(z2,{username:n.username}),y.jsxs(Mg,{children:[y.jsx(rs,{path:"/",element:y.jsx(Ks,{content:W5})}),y.jsx(rs,{path:"/tracks",element:y.jsx(Ks,{content:gB,filterType:"mediaItems"})}),y.jsx(rs,{path:"/lyrics",element:y.jsx(Ks,{content:Uw})}),y.jsx(rs,{path:"/albums",element:y.jsx(Ks,{content:O5,filterType:"mediaItems"})}),y.jsx(rs,{path:"/album/:albumId",element:y.jsx(Ks,{content:w5})}),y.jsx(rs,{path:"/artists",element:y.jsx(Ks,{content:k5,filterType:"mediaItems"})}),y.jsx(rs,{path:"/artist/:artistId",element:y.jsx(Ks,{content:P5})}),y.jsx(rs,{path:"/artist/:artistId/tracks",element:y.jsx(Ks,{content:U5})}),y.jsx(rs,{path:"/albumartists",element:y.jsx(Ks,{content:L5,filterType:"mediaItems"})}),y.jsx(rs,{path:"/genre/:genre",element:y.jsx(Ks,{content:Y5,filterType:"mediaItems"})}),y.jsx(rs,{path:"/genres",element:y.jsx(Ks,{content:Q5,filterType:"mediaItems"})}),y.jsx(rs,{path:"/playlist/:playlistId",element:y.jsx(Ks,{content:lB,filterType:"mediaItemsPlaylist"})}),y.jsx(rs,{path:"/queue",element:y.jsx(Ks,{content:cB})}),y.jsx(rs,{path:"/favorites",element:y.jsx(Ks,{content:$5,filterType:"favorites"})}),y.jsx(rs,{path:"/recently",element:y.jsx(Ks,{content:dB})}),y.jsx(rs,{path:"/frequently",element:y.jsx(Ks,{content:H5})}),y.jsx(rs,{path:"/synced",element:y.jsx(Ks,{content:B5,filterType:"kind"})}),y.jsx(rs,{path:"/settings",element:y.jsx(Ks,{content:u})}),y.jsx(rs,{path:"/instantmix/:songId",element:y.jsx(Ks,{content:eB})}),y.jsx(rs,{path:"/search/:query",element:y.jsx(Ks,{content:fB})}),y.jsx(rs,{path:"*",element:y.jsx(kg,{to:"/"})})]})]})})]})},wE=localStorage.getItem("theme")||"light",xB=window.matchMedia("(prefers-color-scheme: dark)").matches,SB=wE==="system"?xB?"dark":"light":wE;document.documentElement.classList.add(SB);ZL.createRoot(document.getElementById("root")).render(y.jsx(C.StrictMode,{children:y.jsx(yB,{})}));
